<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "https://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" lang="en-US">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=11"/>
<meta name="generator" content="Doxygen 1.9.8"/>
<meta name="viewport" content="width=device-width, initial-scale=1"/>
<title>AscEmu: AscEmu/dep/StormLib/src/FileStream.cpp File Reference</title>
<link href="tabs.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="jquery.js"></script>
<script type="text/javascript" src="dynsections.js"></script>
<link href="navtree.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="resize.js"></script>
<script type="text/javascript" src="navtreedata.js"></script>
<script type="text/javascript" src="navtree.js"></script>
<link href="search/search.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="search/searchdata.js"></script>
<script type="text/javascript" src="search/search.js"></script>
<link href="doxygen.css" rel="stylesheet" type="text/css" />
<link href="AscEmu.css" rel="stylesheet" type="text/css"/>
<link href="doxygen-awesome.css" rel="stylesheet" type="text/css"/>
</head>
<body>
<div id="top"><!-- do not remove this div, it is closed by doxygen! -->
<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr id="projectrow">
  <td id="projectlogo"><img alt="Logo" src="logo.png"/></td>
  <td id="projectalign">
   <div id="projectname">AscEmu
   </div>
   <div id="projectbrief">OpenSource WoW Emulator</div>
  </td>
 </tr>
 </tbody>
</table>
</div>
<!-- end header part -->
<!-- Generated by Doxygen 1.9.8 -->
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:d3d9a9a6595521f9666a5e94cc830dab83b65699&amp;dn=expat.txt MIT */
var searchBox = new SearchBox("searchBox", "search/",'.html');
/* @license-end */
</script>
<script type="text/javascript" src="menudata.js"></script>
<script type="text/javascript" src="menu.js"></script>
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:d3d9a9a6595521f9666a5e94cc830dab83b65699&amp;dn=expat.txt MIT */
$(function() {
  initMenu('',true,false,'search.php','Search');
  $(document).ready(function() { init_search(); });
});
/* @license-end */
</script>
<div id="main-nav"></div>
</div><!-- top -->
<div id="side-nav" class="ui-resizable side-nav-resizable">
  <div id="nav-tree">
    <div id="nav-tree-contents">
      <div id="nav-sync" class="sync"></div>
    </div>
  </div>
  <div id="splitbar" style="-moz-user-select:none;" 
       class="ui-resizable-handle">
  </div>
</div>
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:d3d9a9a6595521f9666a5e94cc830dab83b65699&amp;dn=expat.txt MIT */
$(document).ready(function(){initNavTree('FileStream_8cpp.html',''); initResizable(); });
/* @license-end */
</script>
<div id="doc-content">
<!-- window showing the filter options -->
<div id="MSearchSelectWindow"
     onmouseover="return searchBox.OnSearchSelectShow()"
     onmouseout="return searchBox.OnSearchSelectHide()"
     onkeydown="return searchBox.OnSearchSelectKey(event)">
</div>

<!-- iframe showing the search results (closed by default) -->
<div id="MSearchResultsWindow">
<div id="MSearchResults">
<div class="SRPage">
<div id="SRIndex">
<div id="SRResults"></div>
<div class="SRStatus" id="Loading">Loading...</div>
<div class="SRStatus" id="Searching">Searching...</div>
<div class="SRStatus" id="NoMatches">No Matches</div>
</div>
</div>
</div>
</div>

<div class="header">
  <div class="summary">
<a href="#define-members">Macros</a> &#124;
<a href="#func-members">Functions</a> &#124;
<a href="#var-members">Variables</a>  </div>
  <div class="headertitle"><div class="title">FileStream.cpp File Reference</div></div>
</div><!--header-->
<div class="contents">
<div class="textblock"><code>#include &quot;<a class="el" href="StormLib_8h_source.html">StormLib.h</a>&quot;</code><br />
<code>#include &quot;<a class="el" href="StormCommon_8h_source.html">StormCommon.h</a>&quot;</code><br />
<code>#include &quot;<a class="el" href="FileStream_8h_source.html">FileStream.h</a>&quot;</code><br />
</div><div class="textblock"><div class="dynheader">
Include dependency graph for FileStream.cpp:</div>
<div class="dyncontent">
<div class="center"><div class="zoom"><iframe scrolling="no" frameborder="0" src="FileStream_8cpp__incl.svg" width="100%" height="569"><p><b>This browser is not able to show SVG: try Firefox, Chrome, Safari, or Opera instead.</b></p></iframe></div></div>
</div>
</div><div class="textblock"><div class="dynheader">
This graph shows which files directly or indirectly include this file:</div>
<div class="dyncontent">
<div class="center"><iframe scrolling="no" frameborder="0" src="FileStream_8cpp__dep__incl.svg" width="196" height="139"><p><b>This browser is not able to show SVG: try Firefox, Chrome, Safari, or Opera instead.</b></p></iframe></div>
</div>
</div>
<p><a href="FileStream_8cpp_source.html">Go to the source code of this file.</a></p>
<table class="memberdecls">
<tr class="heading"><td colspan="2"><h2 class="groupheader"><a id="define-members" name="define-members"></a>
Macros</h2></td></tr>
<tr class="memitem:a6c6f05f604e9e3c9c3536365c5f81665" id="r_a6c6f05f604e9e3c9c3536365c5f81665"><td class="memItemLeft" align="right" valign="top">#define&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="FileStream_8cpp.html#a6c6f05f604e9e3c9c3536365c5f81665">__STORMLIB_SELF__</a></td></tr>
<tr class="separator:a6c6f05f604e9e3c9c3536365c5f81665"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a5fdc7facea201bfce4ad308105f88d0c" id="r_a5fdc7facea201bfce4ad308105f88d0c"><td class="memItemLeft" align="right" valign="top">#define&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="FileStream_8cpp.html#a5fdc7facea201bfce4ad308105f88d0c">INVALID_HANDLE_VALUE</a>&#160;&#160;&#160;((<a class="el" href="StormPort_8h.html#aa8c0374618b33785ccb02f74bcfebc46">HANDLE</a>)-1)</td></tr>
<tr class="separator:a5fdc7facea201bfce4ad308105f88d0c"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:ab527650fea18542c0f5ad9097be0c352" id="r_ab527650fea18542c0f5ad9097be0c352"><td class="memItemLeft" align="right" valign="top">#define&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="FileStream_8cpp.html#ab527650fea18542c0f5ad9097be0c352">BLOCK4_BLOCK_SIZE</a>&#160;&#160;&#160;0x4000</td></tr>
<tr class="separator:ab527650fea18542c0f5ad9097be0c352"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:aec8b42b0300b7efd3a7bbefbacdaa5d2" id="r_aec8b42b0300b7efd3a7bbefbacdaa5d2"><td class="memItemLeft" align="right" valign="top">#define&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="FileStream_8cpp.html#aec8b42b0300b7efd3a7bbefbacdaa5d2">BLOCK4_HASH_SIZE</a>&#160;&#160;&#160;0x20</td></tr>
<tr class="separator:aec8b42b0300b7efd3a7bbefbacdaa5d2"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a4f5c5bf181369788c2091bbc386990f5" id="r_a4f5c5bf181369788c2091bbc386990f5"><td class="memItemLeft" align="right" valign="top">#define&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="FileStream_8cpp.html#a4f5c5bf181369788c2091bbc386990f5">BLOCK4_MAX_BLOCKS</a>&#160;&#160;&#160;0x00002000</td></tr>
<tr class="separator:a4f5c5bf181369788c2091bbc386990f5"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:af4003d23efcf71bac3817c9fb695d662" id="r_af4003d23efcf71bac3817c9fb695d662"><td class="memItemLeft" align="right" valign="top">#define&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="FileStream_8cpp.html#af4003d23efcf71bac3817c9fb695d662">BLOCK4_MAX_FSIZE</a>&#160;&#160;&#160;0x08040000</td></tr>
<tr class="separator:af4003d23efcf71bac3817c9fb695d662"><td class="memSeparator" colspan="2">&#160;</td></tr>
</table><table class="memberdecls">
<tr class="heading"><td colspan="2"><h2 class="groupheader"><a id="func-members" name="func-members"></a>
Functions</h2></td></tr>
<tr class="memitem:ad0f1ed530318d4f8cecb3dfb53e15b0a" id="r_ad0f1ed530318d4f8cecb3dfb53e15b0a"><td class="memItemLeft" align="right" valign="top"><a class="el" href="StormPort_8h.html#a798af1e30bc65f319c1a246cecf59e39">DWORD</a>&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="FileStream_8cpp.html#ad0f1ed530318d4f8cecb3dfb53e15b0a">GetLastError</a> ()</td></tr>
<tr class="separator:ad0f1ed530318d4f8cecb3dfb53e15b0a"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a65dd8d3e416ffbd6ac5f468c6bdccac9" id="r_a65dd8d3e416ffbd6ac5f468c6bdccac9"><td class="memItemLeft" align="right" valign="top">void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="FileStream_8cpp.html#a65dd8d3e416ffbd6ac5f468c6bdccac9">SetLastError</a> (<a class="el" href="StormPort_8h.html#a798af1e30bc65f319c1a246cecf59e39">DWORD</a> dwErrCode)</td></tr>
<tr class="separator:a65dd8d3e416ffbd6ac5f468c6bdccac9"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:ab6c0b30e08b7e1e527b2d1ca2a162b93" id="r_ab6c0b30e08b7e1e527b2d1ca2a162b93"><td class="memItemLeft" align="right" valign="top">static <a class="el" href="StormPort_8h.html#a798af1e30bc65f319c1a246cecf59e39">DWORD</a>&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="FileStream_8cpp.html#ab6c0b30e08b7e1e527b2d1ca2a162b93">StringToInt</a> (<a class="el" href="StormLib_2src_2zlib_2zconf_8h.html#a2c212835823e3c54a8ab6d95c652660e">const</a> char *szString)</td></tr>
<tr class="separator:ab6c0b30e08b7e1e527b2d1ca2a162b93"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a801d4ae05a373852d8c7636f0d9075b8" id="r_a801d4ae05a373852d8c7636f0d9075b8"><td class="memItemLeft" align="right" valign="top">static void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="FileStream_8cpp.html#a801d4ae05a373852d8c7636f0d9075b8">CreateNameWithSuffix</a> (<a class="el" href="StormPort_8h.html#a4164e170dcb78b7da7277a7e1f5953fc">LPTSTR</a> szBuffer, size_t cchMaxChars, <a class="el" href="StormPort_8h.html#a8ff75c0813d9c26a6009f93b02a00254">LPCTSTR</a> szName, unsigned int nValue)</td></tr>
<tr class="separator:a801d4ae05a373852d8c7636f0d9075b8"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a87399e74057f7c5abc1d107319f5c9eb" id="r_a87399e74057f7c5abc1d107319f5c9eb"><td class="memItemLeft" align="right" valign="top">static void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="FileStream_8cpp.html#a87399e74057f7c5abc1d107319f5c9eb">BaseNone_Init</a> (<a class="el" href="structTFileStream.html">TFileStream</a> *)</td></tr>
<tr class="separator:a87399e74057f7c5abc1d107319f5c9eb"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a1fcabccfb3e06e3d9aaa6c20bbbf35b1" id="r_a1fcabccfb3e06e3d9aaa6c20bbbf35b1"><td class="memItemLeft" align="right" valign="top">static <a class="el" href="StormPort_8h.html#abb452686968e48b67397da5f97445f5b">bool</a>&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="FileStream_8cpp.html#a1fcabccfb3e06e3d9aaa6c20bbbf35b1">BaseFile_Create</a> (<a class="el" href="structTFileStream.html">TFileStream</a> *pStream)</td></tr>
<tr class="separator:a1fcabccfb3e06e3d9aaa6c20bbbf35b1"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a2065e645a0a5e3202253dda12bb14063" id="r_a2065e645a0a5e3202253dda12bb14063"><td class="memItemLeft" align="right" valign="top">static <a class="el" href="StormPort_8h.html#abb452686968e48b67397da5f97445f5b">bool</a>&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="FileStream_8cpp.html#a2065e645a0a5e3202253dda12bb14063">BaseFile_Open</a> (<a class="el" href="structTFileStream.html">TFileStream</a> *pStream, <a class="el" href="StormLib_2src_2zlib_2zconf_8h.html#a2c212835823e3c54a8ab6d95c652660e">const</a> <a class="el" href="StormPort_8h.html#a03bdb8ce5895c7e261aadc2529637546">TCHAR</a> *szFileName, <a class="el" href="StormPort_8h.html#a798af1e30bc65f319c1a246cecf59e39">DWORD</a> dwStreamFlags)</td></tr>
<tr class="separator:a2065e645a0a5e3202253dda12bb14063"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a3bcd1cfbdaa107dee9e5e2c4489028c6" id="r_a3bcd1cfbdaa107dee9e5e2c4489028c6"><td class="memItemLeft" align="right" valign="top">static <a class="el" href="StormPort_8h.html#abb452686968e48b67397da5f97445f5b">bool</a>&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="FileStream_8cpp.html#a3bcd1cfbdaa107dee9e5e2c4489028c6">BaseFile_Read</a> (<a class="el" href="structTFileStream.html">TFileStream</a> *pStream, <a class="el" href="StormPort_8h.html#abb9abb9ce956f1a9e5a4081ac40e5649">ULONGLONG</a> *pByteOffset, void *pvBuffer, <a class="el" href="StormPort_8h.html#a798af1e30bc65f319c1a246cecf59e39">DWORD</a> dwBytesToRead)</td></tr>
<tr class="separator:a3bcd1cfbdaa107dee9e5e2c4489028c6"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:adf9b2fa5508bed570c9aaf61f6925844" id="r_adf9b2fa5508bed570c9aaf61f6925844"><td class="memItemLeft" align="right" valign="top">static <a class="el" href="StormPort_8h.html#abb452686968e48b67397da5f97445f5b">bool</a>&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="FileStream_8cpp.html#adf9b2fa5508bed570c9aaf61f6925844">BaseFile_Write</a> (<a class="el" href="structTFileStream.html">TFileStream</a> *pStream, <a class="el" href="StormPort_8h.html#abb9abb9ce956f1a9e5a4081ac40e5649">ULONGLONG</a> *pByteOffset, <a class="el" href="StormLib_2src_2zlib_2zconf_8h.html#a2c212835823e3c54a8ab6d95c652660e">const</a> void *pvBuffer, <a class="el" href="StormPort_8h.html#a798af1e30bc65f319c1a246cecf59e39">DWORD</a> dwBytesToWrite)</td></tr>
<tr class="separator:adf9b2fa5508bed570c9aaf61f6925844"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:ae004fa7bac8a8c891eec3b183701efb6" id="r_ae004fa7bac8a8c891eec3b183701efb6"><td class="memItemLeft" align="right" valign="top">static <a class="el" href="StormPort_8h.html#abb452686968e48b67397da5f97445f5b">bool</a>&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="FileStream_8cpp.html#ae004fa7bac8a8c891eec3b183701efb6">BaseFile_Resize</a> (<a class="el" href="structTFileStream.html">TFileStream</a> *pStream, <a class="el" href="StormPort_8h.html#abb9abb9ce956f1a9e5a4081ac40e5649">ULONGLONG</a> NewFileSize)</td></tr>
<tr class="separator:ae004fa7bac8a8c891eec3b183701efb6"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a55e7d166af5374820da7c39a63eabb78" id="r_a55e7d166af5374820da7c39a63eabb78"><td class="memItemLeft" align="right" valign="top">static <a class="el" href="StormPort_8h.html#abb452686968e48b67397da5f97445f5b">bool</a>&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="FileStream_8cpp.html#a55e7d166af5374820da7c39a63eabb78">BaseFile_GetSize</a> (<a class="el" href="structTFileStream.html">TFileStream</a> *pStream, <a class="el" href="StormPort_8h.html#abb9abb9ce956f1a9e5a4081ac40e5649">ULONGLONG</a> *pFileSize)</td></tr>
<tr class="separator:a55e7d166af5374820da7c39a63eabb78"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a83df9c1c4278b431d59568a3ae4dc39f" id="r_a83df9c1c4278b431d59568a3ae4dc39f"><td class="memItemLeft" align="right" valign="top">static <a class="el" href="StormPort_8h.html#abb452686968e48b67397da5f97445f5b">bool</a>&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="FileStream_8cpp.html#a83df9c1c4278b431d59568a3ae4dc39f">BaseFile_GetPos</a> (<a class="el" href="structTFileStream.html">TFileStream</a> *pStream, <a class="el" href="StormPort_8h.html#abb9abb9ce956f1a9e5a4081ac40e5649">ULONGLONG</a> *pByteOffset)</td></tr>
<tr class="separator:a83df9c1c4278b431d59568a3ae4dc39f"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:ab7eae20c598963167111f04222211b23" id="r_ab7eae20c598963167111f04222211b23"><td class="memItemLeft" align="right" valign="top">static <a class="el" href="StormPort_8h.html#abb452686968e48b67397da5f97445f5b">bool</a>&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="FileStream_8cpp.html#ab7eae20c598963167111f04222211b23">BaseFile_Replace</a> (<a class="el" href="structTFileStream.html">TFileStream</a> *pStream, <a class="el" href="structTFileStream.html">TFileStream</a> *pNewStream)</td></tr>
<tr class="separator:ab7eae20c598963167111f04222211b23"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:ae44b926c84d51b8bf1e58ee562bad8c4" id="r_ae44b926c84d51b8bf1e58ee562bad8c4"><td class="memItemLeft" align="right" valign="top">static void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="FileStream_8cpp.html#ae44b926c84d51b8bf1e58ee562bad8c4">BaseFile_Close</a> (<a class="el" href="structTFileStream.html">TFileStream</a> *pStream)</td></tr>
<tr class="separator:ae44b926c84d51b8bf1e58ee562bad8c4"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a9637c2e0c115380fbdfc33e19891d73b" id="r_a9637c2e0c115380fbdfc33e19891d73b"><td class="memItemLeft" align="right" valign="top">static void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="FileStream_8cpp.html#a9637c2e0c115380fbdfc33e19891d73b">BaseFile_Init</a> (<a class="el" href="structTFileStream.html">TFileStream</a> *pStream)</td></tr>
<tr class="separator:a9637c2e0c115380fbdfc33e19891d73b"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:aaa64c0983d11f20e1f019b98e4a2587b" id="r_aaa64c0983d11f20e1f019b98e4a2587b"><td class="memItemLeft" align="right" valign="top">static <a class="el" href="StormPort_8h.html#abb452686968e48b67397da5f97445f5b">bool</a>&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="FileStream_8cpp.html#aaa64c0983d11f20e1f019b98e4a2587b">BaseMap_Open</a> (<a class="el" href="structTFileStream.html">TFileStream</a> *pStream, <a class="el" href="StormPort_8h.html#a8ff75c0813d9c26a6009f93b02a00254">LPCTSTR</a> szFileName, <a class="el" href="StormPort_8h.html#a798af1e30bc65f319c1a246cecf59e39">DWORD</a> dwStreamFlags)</td></tr>
<tr class="separator:aaa64c0983d11f20e1f019b98e4a2587b"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a5bb3a0e407aa8ded55574693550b4ad2" id="r_a5bb3a0e407aa8ded55574693550b4ad2"><td class="memItemLeft" align="right" valign="top">static <a class="el" href="StormPort_8h.html#abb452686968e48b67397da5f97445f5b">bool</a>&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="FileStream_8cpp.html#a5bb3a0e407aa8ded55574693550b4ad2">BaseMap_Read</a> (<a class="el" href="structTFileStream.html">TFileStream</a> *pStream, <a class="el" href="StormPort_8h.html#abb9abb9ce956f1a9e5a4081ac40e5649">ULONGLONG</a> *pByteOffset, void *pvBuffer, <a class="el" href="StormPort_8h.html#a798af1e30bc65f319c1a246cecf59e39">DWORD</a> dwBytesToRead)</td></tr>
<tr class="separator:a5bb3a0e407aa8ded55574693550b4ad2"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a8bb2c5a67c52652853c0e1dc0938459a" id="r_a8bb2c5a67c52652853c0e1dc0938459a"><td class="memItemLeft" align="right" valign="top">static void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="FileStream_8cpp.html#a8bb2c5a67c52652853c0e1dc0938459a">BaseMap_Close</a> (<a class="el" href="structTFileStream.html">TFileStream</a> *pStream)</td></tr>
<tr class="separator:a8bb2c5a67c52652853c0e1dc0938459a"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:ad38ec64c05bb01e557120b0aa95107fe" id="r_ad38ec64c05bb01e557120b0aa95107fe"><td class="memItemLeft" align="right" valign="top">static void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="FileStream_8cpp.html#ad38ec64c05bb01e557120b0aa95107fe">BaseMap_Init</a> (<a class="el" href="structTFileStream.html">TFileStream</a> *pStream)</td></tr>
<tr class="separator:ad38ec64c05bb01e557120b0aa95107fe"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:ad97af1a620ae3db5bf6917027893ae9f" id="r_ad97af1a620ae3db5bf6917027893ae9f"><td class="memItemLeft" align="right" valign="top">static <a class="el" href="StormLib_2src_2zlib_2zconf_8h.html#a2c212835823e3c54a8ab6d95c652660e">const</a> <a class="el" href="StormPort_8h.html#a03bdb8ce5895c7e261aadc2529637546">TCHAR</a> *&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="FileStream_8cpp.html#ad97af1a620ae3db5bf6917027893ae9f">BaseHttp_ExtractServerName</a> (<a class="el" href="StormLib_2src_2zlib_2zconf_8h.html#a2c212835823e3c54a8ab6d95c652660e">const</a> <a class="el" href="StormPort_8h.html#a03bdb8ce5895c7e261aadc2529637546">TCHAR</a> *szFileName, <a class="el" href="StormPort_8h.html#a03bdb8ce5895c7e261aadc2529637546">TCHAR</a> *szServerName)</td></tr>
<tr class="separator:ad97af1a620ae3db5bf6917027893ae9f"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a23f58ada8682609f6f455ce846ecd83a" id="r_a23f58ada8682609f6f455ce846ecd83a"><td class="memItemLeft" align="right" valign="top">static <a class="el" href="StormPort_8h.html#abb452686968e48b67397da5f97445f5b">bool</a>&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="FileStream_8cpp.html#a23f58ada8682609f6f455ce846ecd83a">BaseHttp_Open</a> (<a class="el" href="structTFileStream.html">TFileStream</a> *pStream, <a class="el" href="StormLib_2src_2zlib_2zconf_8h.html#a2c212835823e3c54a8ab6d95c652660e">const</a> <a class="el" href="StormPort_8h.html#a03bdb8ce5895c7e261aadc2529637546">TCHAR</a> *szFileName, <a class="el" href="StormPort_8h.html#a798af1e30bc65f319c1a246cecf59e39">DWORD</a> dwStreamFlags)</td></tr>
<tr class="separator:a23f58ada8682609f6f455ce846ecd83a"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:ab80f4fa5604af2840f231a7aa9233c31" id="r_ab80f4fa5604af2840f231a7aa9233c31"><td class="memItemLeft" align="right" valign="top">static <a class="el" href="StormPort_8h.html#abb452686968e48b67397da5f97445f5b">bool</a>&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="FileStream_8cpp.html#ab80f4fa5604af2840f231a7aa9233c31">BaseHttp_Read</a> (<a class="el" href="structTFileStream.html">TFileStream</a> *pStream, <a class="el" href="StormPort_8h.html#abb9abb9ce956f1a9e5a4081ac40e5649">ULONGLONG</a> *pByteOffset, void *pvBuffer, <a class="el" href="StormPort_8h.html#a798af1e30bc65f319c1a246cecf59e39">DWORD</a> dwBytesToRead)</td></tr>
<tr class="separator:ab80f4fa5604af2840f231a7aa9233c31"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:aa9415c5baa0b61c1a7a0c1686f8baac3" id="r_aa9415c5baa0b61c1a7a0c1686f8baac3"><td class="memItemLeft" align="right" valign="top">static void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="FileStream_8cpp.html#aa9415c5baa0b61c1a7a0c1686f8baac3">BaseHttp_Close</a> (<a class="el" href="structTFileStream.html">TFileStream</a> *pStream)</td></tr>
<tr class="separator:aa9415c5baa0b61c1a7a0c1686f8baac3"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a5ba2b0289e1a1521baf9174aafce7aa2" id="r_a5ba2b0289e1a1521baf9174aafce7aa2"><td class="memItemLeft" align="right" valign="top">static void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="FileStream_8cpp.html#a5ba2b0289e1a1521baf9174aafce7aa2">BaseHttp_Init</a> (<a class="el" href="structTFileStream.html">TFileStream</a> *pStream)</td></tr>
<tr class="separator:a5ba2b0289e1a1521baf9174aafce7aa2"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a6aad894479c9e1b2cba754f7f3260747" id="r_a6aad894479c9e1b2cba754f7f3260747"><td class="memItemLeft" align="right" valign="top">static <a class="el" href="StormPort_8h.html#abb452686968e48b67397da5f97445f5b">bool</a>&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="FileStream_8cpp.html#a6aad894479c9e1b2cba754f7f3260747">BlockStream_Read</a> (<a class="el" href="structTBlockStream.html">TBlockStream</a> *pStream, <a class="el" href="StormPort_8h.html#abb9abb9ce956f1a9e5a4081ac40e5649">ULONGLONG</a> *pByteOffset, void *pvBuffer, <a class="el" href="StormPort_8h.html#a798af1e30bc65f319c1a246cecf59e39">DWORD</a> dwBytesToRead)</td></tr>
<tr class="separator:a6aad894479c9e1b2cba754f7f3260747"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a3e8398bb76df8b526932fe0c4623cef9" id="r_a3e8398bb76df8b526932fe0c4623cef9"><td class="memItemLeft" align="right" valign="top">static <a class="el" href="StormPort_8h.html#abb452686968e48b67397da5f97445f5b">bool</a>&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="FileStream_8cpp.html#a3e8398bb76df8b526932fe0c4623cef9">BlockStream_GetSize</a> (<a class="el" href="structTFileStream.html">TFileStream</a> *pStream, <a class="el" href="StormPort_8h.html#abb9abb9ce956f1a9e5a4081ac40e5649">ULONGLONG</a> *pFileSize)</td></tr>
<tr class="separator:a3e8398bb76df8b526932fe0c4623cef9"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a298aac8ccf15fff07223077eedbf2db7" id="r_a298aac8ccf15fff07223077eedbf2db7"><td class="memItemLeft" align="right" valign="top">static <a class="el" href="StormPort_8h.html#abb452686968e48b67397da5f97445f5b">bool</a>&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="FileStream_8cpp.html#a298aac8ccf15fff07223077eedbf2db7">BlockStream_GetPos</a> (<a class="el" href="structTFileStream.html">TFileStream</a> *pStream, <a class="el" href="StormPort_8h.html#abb9abb9ce956f1a9e5a4081ac40e5649">ULONGLONG</a> *pByteOffset)</td></tr>
<tr class="separator:a298aac8ccf15fff07223077eedbf2db7"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a5074c346733483a14dce339c940186a9" id="r_a5074c346733483a14dce339c940186a9"><td class="memItemLeft" align="right" valign="top">static void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="FileStream_8cpp.html#a5074c346733483a14dce339c940186a9">BlockStream_Close</a> (<a class="el" href="structTBlockStream.html">TBlockStream</a> *pStream)</td></tr>
<tr class="separator:a5074c346733483a14dce339c940186a9"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:aa5874b3e4d05d2f6dfa3a32d62f56bea" id="r_aa5874b3e4d05d2f6dfa3a32d62f56bea"><td class="memItemLeft" align="right" valign="top">static <a class="el" href="structTFileStream.html">TFileStream</a> *&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="FileStream_8cpp.html#aa5874b3e4d05d2f6dfa3a32d62f56bea">AllocateFileStream</a> (<a class="el" href="StormLib_2src_2zlib_2zconf_8h.html#a2c212835823e3c54a8ab6d95c652660e">const</a> <a class="el" href="StormPort_8h.html#a03bdb8ce5895c7e261aadc2529637546">TCHAR</a> *szFileName, size_t StreamSize, <a class="el" href="StormPort_8h.html#a798af1e30bc65f319c1a246cecf59e39">DWORD</a> dwStreamFlags)</td></tr>
<tr class="separator:aa5874b3e4d05d2f6dfa3a32d62f56bea"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:ace69b2f2759cc834b194c9681b0e2465" id="r_ace69b2f2759cc834b194c9681b0e2465"><td class="memItemLeft" align="right" valign="top">static <a class="el" href="StormPort_8h.html#a798af1e30bc65f319c1a246cecf59e39">DWORD</a>&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="FileStream_8cpp.html#ace69b2f2759cc834b194c9681b0e2465">FlatStream_CheckFile</a> (<a class="el" href="structTBlockStream.html">TBlockStream</a> *pStream)</td></tr>
<tr class="separator:ace69b2f2759cc834b194c9681b0e2465"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:aa42d0ab738da3b67ff30e784323d1da6" id="r_aa42d0ab738da3b67ff30e784323d1da6"><td class="memItemLeft" align="right" valign="top">static <a class="el" href="StormPort_8h.html#abb452686968e48b67397da5f97445f5b">bool</a>&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="FileStream_8cpp.html#aa42d0ab738da3b67ff30e784323d1da6">FlatStream_LoadBitmap</a> (<a class="el" href="structTBlockStream.html">TBlockStream</a> *pStream)</td></tr>
<tr class="separator:aa42d0ab738da3b67ff30e784323d1da6"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a4680036b442f496fde288fabbd9a2c0e" id="r_a4680036b442f496fde288fabbd9a2c0e"><td class="memItemLeft" align="right" valign="top">static void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="FileStream_8cpp.html#a4680036b442f496fde288fabbd9a2c0e">FlatStream_UpdateBitmap</a> (<a class="el" href="structTBlockStream.html">TBlockStream</a> *pStream, <a class="el" href="StormPort_8h.html#abb9abb9ce956f1a9e5a4081ac40e5649">ULONGLONG</a> StartOffset, <a class="el" href="StormPort_8h.html#abb9abb9ce956f1a9e5a4081ac40e5649">ULONGLONG</a> EndOffset)</td></tr>
<tr class="separator:a4680036b442f496fde288fabbd9a2c0e"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a4e4466215f5a417ba8e4e8d77dd0703a" id="r_a4e4466215f5a417ba8e4e8d77dd0703a"><td class="memItemLeft" align="right" valign="top">static <a class="el" href="StormPort_8h.html#abb452686968e48b67397da5f97445f5b">bool</a>&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="FileStream_8cpp.html#a4e4466215f5a417ba8e4e8d77dd0703a">FlatStream_BlockCheck</a> (<a class="el" href="structTBlockStream.html">TBlockStream</a> *pStream, <a class="el" href="StormPort_8h.html#abb9abb9ce956f1a9e5a4081ac40e5649">ULONGLONG</a> BlockOffset)</td></tr>
<tr class="separator:a4e4466215f5a417ba8e4e8d77dd0703a"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a1637f8242ad3484abb17a40d0e4f99b6" id="r_a1637f8242ad3484abb17a40d0e4f99b6"><td class="memItemLeft" align="right" valign="top">static <a class="el" href="StormPort_8h.html#abb452686968e48b67397da5f97445f5b">bool</a>&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="FileStream_8cpp.html#a1637f8242ad3484abb17a40d0e4f99b6">FlatStream_BlockRead</a> (<a class="el" href="structTBlockStream.html">TBlockStream</a> *pStream, <a class="el" href="StormPort_8h.html#abb9abb9ce956f1a9e5a4081ac40e5649">ULONGLONG</a> StartOffset, <a class="el" href="StormPort_8h.html#abb9abb9ce956f1a9e5a4081ac40e5649">ULONGLONG</a> EndOffset, <a class="el" href="StormPort_8h.html#ac2d3fb16b5b34c1e6ab80014309020eb">LPBYTE</a> BlockBuffer, <a class="el" href="StormPort_8h.html#a798af1e30bc65f319c1a246cecf59e39">DWORD</a> BytesNeeded, <a class="el" href="StormPort_8h.html#abb452686968e48b67397da5f97445f5b">bool</a> bAvailable)</td></tr>
<tr class="separator:a1637f8242ad3484abb17a40d0e4f99b6"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:af082ffb0012c931f640399221d1016b2" id="r_af082ffb0012c931f640399221d1016b2"><td class="memItemLeft" align="right" valign="top">static void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="FileStream_8cpp.html#af082ffb0012c931f640399221d1016b2">FlatStream_Close</a> (<a class="el" href="structTBlockStream.html">TBlockStream</a> *pStream)</td></tr>
<tr class="separator:af082ffb0012c931f640399221d1016b2"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:aafefeeb7fed0c48dca2d374277dc08ee" id="r_aafefeeb7fed0c48dca2d374277dc08ee"><td class="memItemLeft" align="right" valign="top">static <a class="el" href="StormPort_8h.html#abb452686968e48b67397da5f97445f5b">bool</a>&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="FileStream_8cpp.html#aafefeeb7fed0c48dca2d374277dc08ee">FlatStream_CreateMirror</a> (<a class="el" href="structTBlockStream.html">TBlockStream</a> *pStream)</td></tr>
<tr class="separator:aafefeeb7fed0c48dca2d374277dc08ee"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a3993766ada9771cb6d9ca35a3f935322" id="r_a3993766ada9771cb6d9ca35a3f935322"><td class="memItemLeft" align="right" valign="top">static <a class="el" href="structTFileStream.html">TFileStream</a> *&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="FileStream_8cpp.html#a3993766ada9771cb6d9ca35a3f935322">FlatStream_Open</a> (<a class="el" href="StormLib_2src_2zlib_2zconf_8h.html#a2c212835823e3c54a8ab6d95c652660e">const</a> <a class="el" href="StormPort_8h.html#a03bdb8ce5895c7e261aadc2529637546">TCHAR</a> *szFileName, <a class="el" href="StormPort_8h.html#a798af1e30bc65f319c1a246cecf59e39">DWORD</a> dwStreamFlags)</td></tr>
<tr class="separator:a3993766ada9771cb6d9ca35a3f935322"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:ab6a8ad643ebb16a4c5fe5b744195d5db" id="r_ab6a8ad643ebb16a4c5fe5b744195d5db"><td class="memItemLeft" align="right" valign="top">static <a class="el" href="StormPort_8h.html#abb452686968e48b67397da5f97445f5b">bool</a>&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="FileStream_8cpp.html#ab6a8ad643ebb16a4c5fe5b744195d5db">IsPartHeader</a> (<a class="el" href="FileStream_8h.html#a6e1415da659848b71bc27051cace9452">PPART_FILE_HEADER</a> pPartHdr)</td></tr>
<tr class="separator:ab6a8ad643ebb16a4c5fe5b744195d5db"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:aaffd3fca4e0a45595bc2f73e6bea76f3" id="r_aaffd3fca4e0a45595bc2f73e6bea76f3"><td class="memItemLeft" align="right" valign="top">static <a class="el" href="StormPort_8h.html#a798af1e30bc65f319c1a246cecf59e39">DWORD</a>&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="FileStream_8cpp.html#aaffd3fca4e0a45595bc2f73e6bea76f3">PartStream_CheckFile</a> (<a class="el" href="structTBlockStream.html">TBlockStream</a> *pStream)</td></tr>
<tr class="separator:aaffd3fca4e0a45595bc2f73e6bea76f3"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:abab48f6b34ad7933671864dd7f1e6ad5" id="r_abab48f6b34ad7933671864dd7f1e6ad5"><td class="memItemLeft" align="right" valign="top">static <a class="el" href="StormPort_8h.html#abb452686968e48b67397da5f97445f5b">bool</a>&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="FileStream_8cpp.html#abab48f6b34ad7933671864dd7f1e6ad5">PartStream_LoadBitmap</a> (<a class="el" href="structTBlockStream.html">TBlockStream</a> *pStream)</td></tr>
<tr class="separator:abab48f6b34ad7933671864dd7f1e6ad5"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a162a6e284e6e7c5c8577e0b98fe76ad3" id="r_a162a6e284e6e7c5c8577e0b98fe76ad3"><td class="memItemLeft" align="right" valign="top">static void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="FileStream_8cpp.html#a162a6e284e6e7c5c8577e0b98fe76ad3">PartStream_UpdateBitmap</a> (<a class="el" href="structTBlockStream.html">TBlockStream</a> *pStream, <a class="el" href="StormPort_8h.html#abb9abb9ce956f1a9e5a4081ac40e5649">ULONGLONG</a> StartOffset, <a class="el" href="StormPort_8h.html#abb9abb9ce956f1a9e5a4081ac40e5649">ULONGLONG</a> EndOffset, <a class="el" href="StormPort_8h.html#abb9abb9ce956f1a9e5a4081ac40e5649">ULONGLONG</a> RealOffset)</td></tr>
<tr class="separator:a162a6e284e6e7c5c8577e0b98fe76ad3"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:aa248b7a4855fbd7cb0e0451eb7afdf96" id="r_aa248b7a4855fbd7cb0e0451eb7afdf96"><td class="memItemLeft" align="right" valign="top">static <a class="el" href="StormPort_8h.html#abb452686968e48b67397da5f97445f5b">bool</a>&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="FileStream_8cpp.html#aa248b7a4855fbd7cb0e0451eb7afdf96">PartStream_BlockCheck</a> (<a class="el" href="structTBlockStream.html">TBlockStream</a> *pStream, <a class="el" href="StormPort_8h.html#abb9abb9ce956f1a9e5a4081ac40e5649">ULONGLONG</a> BlockOffset)</td></tr>
<tr class="separator:aa248b7a4855fbd7cb0e0451eb7afdf96"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a2791646c1575f1cec2fbd508772ad641" id="r_a2791646c1575f1cec2fbd508772ad641"><td class="memItemLeft" align="right" valign="top">static <a class="el" href="StormPort_8h.html#abb452686968e48b67397da5f97445f5b">bool</a>&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="FileStream_8cpp.html#a2791646c1575f1cec2fbd508772ad641">PartStream_BlockRead</a> (<a class="el" href="structTBlockStream.html">TBlockStream</a> *pStream, <a class="el" href="StormPort_8h.html#abb9abb9ce956f1a9e5a4081ac40e5649">ULONGLONG</a> StartOffset, <a class="el" href="StormPort_8h.html#abb9abb9ce956f1a9e5a4081ac40e5649">ULONGLONG</a> EndOffset, <a class="el" href="StormPort_8h.html#ac2d3fb16b5b34c1e6ab80014309020eb">LPBYTE</a> BlockBuffer, <a class="el" href="StormPort_8h.html#a798af1e30bc65f319c1a246cecf59e39">DWORD</a> BytesNeeded, <a class="el" href="StormPort_8h.html#abb452686968e48b67397da5f97445f5b">bool</a> bAvailable)</td></tr>
<tr class="separator:a2791646c1575f1cec2fbd508772ad641"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a44ffcada567ee94f23e575dfe83e9c64" id="r_a44ffcada567ee94f23e575dfe83e9c64"><td class="memItemLeft" align="right" valign="top">static void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="FileStream_8cpp.html#a44ffcada567ee94f23e575dfe83e9c64">PartStream_Close</a> (<a class="el" href="structTBlockStream.html">TBlockStream</a> *pStream)</td></tr>
<tr class="separator:a44ffcada567ee94f23e575dfe83e9c64"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:ac44f22d4353fc2b39957149e3b588f36" id="r_ac44f22d4353fc2b39957149e3b588f36"><td class="memItemLeft" align="right" valign="top">static <a class="el" href="StormPort_8h.html#abb452686968e48b67397da5f97445f5b">bool</a>&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="FileStream_8cpp.html#ac44f22d4353fc2b39957149e3b588f36">PartStream_CreateMirror</a> (<a class="el" href="structTBlockStream.html">TBlockStream</a> *pStream)</td></tr>
<tr class="separator:ac44f22d4353fc2b39957149e3b588f36"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a9109b5dc896abb2d8d9f7fb0995dd911" id="r_a9109b5dc896abb2d8d9f7fb0995dd911"><td class="memItemLeft" align="right" valign="top">static <a class="el" href="structTFileStream.html">TFileStream</a> *&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="FileStream_8cpp.html#a9109b5dc896abb2d8d9f7fb0995dd911">PartStream_Open</a> (<a class="el" href="StormLib_2src_2zlib_2zconf_8h.html#a2c212835823e3c54a8ab6d95c652660e">const</a> <a class="el" href="StormPort_8h.html#a03bdb8ce5895c7e261aadc2529637546">TCHAR</a> *szFileName, <a class="el" href="StormPort_8h.html#a798af1e30bc65f319c1a246cecf59e39">DWORD</a> dwStreamFlags)</td></tr>
<tr class="separator:a9109b5dc896abb2d8d9f7fb0995dd911"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a2ab4669edc8efaf172b769732d83e2f0" id="r_a2ab4669edc8efaf172b769732d83e2f0"><td class="memItemLeft" align="right" valign="top">static <a class="el" href="StormPort_8h.html#a798af1e30bc65f319c1a246cecf59e39">DWORD</a>&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="FileStream_8cpp.html#a2ab4669edc8efaf172b769732d83e2f0">Rol32</a> (<a class="el" href="StormPort_8h.html#a798af1e30bc65f319c1a246cecf59e39">DWORD</a> dwValue, <a class="el" href="StormPort_8h.html#a798af1e30bc65f319c1a246cecf59e39">DWORD</a> dwRolCount)</td></tr>
<tr class="separator:a2ab4669edc8efaf172b769732d83e2f0"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:ad34e1378609413863343bd2dac0eb723" id="r_ad34e1378609413863343bd2dac0eb723"><td class="memItemLeft" align="right" valign="top">static void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="FileStream_8cpp.html#ad34e1378609413863343bd2dac0eb723">CreateKeyFromAuthCode</a> (<a class="el" href="StormPort_8h.html#ac2d3fb16b5b34c1e6ab80014309020eb">LPBYTE</a> pbKeyBuffer, <a class="el" href="StormLib_2src_2zlib_2zconf_8h.html#a2c212835823e3c54a8ab6d95c652660e">const</a> char *szAuthCode)</td></tr>
<tr class="separator:ad34e1378609413863343bd2dac0eb723"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a1a04dfdeabbbf63c5e09fcda34922e7a" id="r_a1a04dfdeabbbf63c5e09fcda34922e7a"><td class="memItemLeft" align="right" valign="top">static void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="FileStream_8cpp.html#a1a04dfdeabbbf63c5e09fcda34922e7a">DecryptFileChunk</a> (<a class="el" href="StormPort_8h.html#a798af1e30bc65f319c1a246cecf59e39">DWORD</a> *MpqData, <a class="el" href="StormPort_8h.html#ac2d3fb16b5b34c1e6ab80014309020eb">LPBYTE</a> pbKey, <a class="el" href="StormPort_8h.html#abb9abb9ce956f1a9e5a4081ac40e5649">ULONGLONG</a> ByteOffset, <a class="el" href="StormPort_8h.html#a798af1e30bc65f319c1a246cecf59e39">DWORD</a> dwLength)</td></tr>
<tr class="separator:a1a04dfdeabbbf63c5e09fcda34922e7a"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a57e39d6cd61a2d41926009c0213025b7" id="r_a57e39d6cd61a2d41926009c0213025b7"><td class="memItemLeft" align="right" valign="top">static <a class="el" href="StormPort_8h.html#abb452686968e48b67397da5f97445f5b">bool</a>&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="FileStream_8cpp.html#a57e39d6cd61a2d41926009c0213025b7">MpqeStream_DetectFileKey</a> (<a class="el" href="structTEncryptedStream.html">TEncryptedStream</a> *pStream)</td></tr>
<tr class="separator:a57e39d6cd61a2d41926009c0213025b7"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a5ade6a02922359f4aee05c2009bc2c82" id="r_a5ade6a02922359f4aee05c2009bc2c82"><td class="memItemLeft" align="right" valign="top">static <a class="el" href="StormPort_8h.html#abb452686968e48b67397da5f97445f5b">bool</a>&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="FileStream_8cpp.html#a5ade6a02922359f4aee05c2009bc2c82">MpqeStream_BlockRead</a> (<a class="el" href="structTEncryptedStream.html">TEncryptedStream</a> *pStream, <a class="el" href="StormPort_8h.html#abb9abb9ce956f1a9e5a4081ac40e5649">ULONGLONG</a> StartOffset, <a class="el" href="StormPort_8h.html#abb9abb9ce956f1a9e5a4081ac40e5649">ULONGLONG</a> EndOffset, <a class="el" href="StormPort_8h.html#ac2d3fb16b5b34c1e6ab80014309020eb">LPBYTE</a> BlockBuffer, <a class="el" href="StormPort_8h.html#a798af1e30bc65f319c1a246cecf59e39">DWORD</a> BytesNeeded, <a class="el" href="StormPort_8h.html#abb452686968e48b67397da5f97445f5b">bool</a> bAvailable)</td></tr>
<tr class="separator:a5ade6a02922359f4aee05c2009bc2c82"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a2c69cb40f8c94bf20bd7c8d6918bb261" id="r_a2c69cb40f8c94bf20bd7c8d6918bb261"><td class="memItemLeft" align="right" valign="top">static <a class="el" href="structTFileStream.html">TFileStream</a> *&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="FileStream_8cpp.html#a2c69cb40f8c94bf20bd7c8d6918bb261">MpqeStream_Open</a> (<a class="el" href="StormLib_2src_2zlib_2zconf_8h.html#a2c212835823e3c54a8ab6d95c652660e">const</a> <a class="el" href="StormPort_8h.html#a03bdb8ce5895c7e261aadc2529637546">TCHAR</a> *szFileName, <a class="el" href="StormPort_8h.html#a798af1e30bc65f319c1a246cecf59e39">DWORD</a> dwStreamFlags)</td></tr>
<tr class="separator:a2c69cb40f8c94bf20bd7c8d6918bb261"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a9e4108abb90b9e3d6118cf7cde1ac35a" id="r_a9e4108abb90b9e3d6118cf7cde1ac35a"><td class="memItemLeft" align="right" valign="top">static <a class="el" href="StormPort_8h.html#abb452686968e48b67397da5f97445f5b">bool</a>&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="FileStream_8cpp.html#a9e4108abb90b9e3d6118cf7cde1ac35a">Block4Stream_BlockRead</a> (<a class="el" href="structTBlockStream.html">TBlockStream</a> *pStream, <a class="el" href="StormPort_8h.html#abb9abb9ce956f1a9e5a4081ac40e5649">ULONGLONG</a> StartOffset, <a class="el" href="StormPort_8h.html#abb9abb9ce956f1a9e5a4081ac40e5649">ULONGLONG</a> EndOffset, <a class="el" href="StormPort_8h.html#ac2d3fb16b5b34c1e6ab80014309020eb">LPBYTE</a> BlockBuffer, <a class="el" href="StormPort_8h.html#a798af1e30bc65f319c1a246cecf59e39">DWORD</a> BytesNeeded, <a class="el" href="StormPort_8h.html#abb452686968e48b67397da5f97445f5b">bool</a> bAvailable)</td></tr>
<tr class="separator:a9e4108abb90b9e3d6118cf7cde1ac35a"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:ae8976be1e1619faf82a3eef7a3489925" id="r_ae8976be1e1619faf82a3eef7a3489925"><td class="memItemLeft" align="right" valign="top">static void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="FileStream_8cpp.html#ae8976be1e1619faf82a3eef7a3489925">Block4Stream_Close</a> (<a class="el" href="structTBlockStream.html">TBlockStream</a> *pStream)</td></tr>
<tr class="separator:ae8976be1e1619faf82a3eef7a3489925"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:ad81c299c6f6062d49a9d7ef331cd4520" id="r_ad81c299c6f6062d49a9d7ef331cd4520"><td class="memItemLeft" align="right" valign="top">static <a class="el" href="structTFileStream.html">TFileStream</a> *&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="FileStream_8cpp.html#ad81c299c6f6062d49a9d7ef331cd4520">Block4Stream_Open</a> (<a class="el" href="StormLib_2src_2zlib_2zconf_8h.html#a2c212835823e3c54a8ab6d95c652660e">const</a> <a class="el" href="StormPort_8h.html#a03bdb8ce5895c7e261aadc2529637546">TCHAR</a> *szFileName, <a class="el" href="StormPort_8h.html#a798af1e30bc65f319c1a246cecf59e39">DWORD</a> dwStreamFlags)</td></tr>
<tr class="separator:ad81c299c6f6062d49a9d7ef331cd4520"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:aaba1ffb5ec458bc89519a891e28ab10e" id="r_aaba1ffb5ec458bc89519a891e28ab10e"><td class="memItemLeft" align="right" valign="top"><a class="el" href="structTFileStream.html">TFileStream</a> *&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="FileStream_8cpp.html#aaba1ffb5ec458bc89519a891e28ab10e">FileStream_CreateFile</a> (<a class="el" href="StormLib_2src_2zlib_2zconf_8h.html#a2c212835823e3c54a8ab6d95c652660e">const</a> <a class="el" href="StormPort_8h.html#a03bdb8ce5895c7e261aadc2529637546">TCHAR</a> *szFileName, <a class="el" href="StormPort_8h.html#a798af1e30bc65f319c1a246cecf59e39">DWORD</a> dwStreamFlags)</td></tr>
<tr class="separator:aaba1ffb5ec458bc89519a891e28ab10e"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a702003c1930c608961b812259bd9dc22" id="r_a702003c1930c608961b812259bd9dc22"><td class="memItemLeft" align="right" valign="top"><a class="el" href="structTFileStream.html">TFileStream</a> *&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="FileStream_8cpp.html#a702003c1930c608961b812259bd9dc22">FileStream_OpenFile</a> (<a class="el" href="StormLib_2src_2zlib_2zconf_8h.html#a2c212835823e3c54a8ab6d95c652660e">const</a> <a class="el" href="StormPort_8h.html#a03bdb8ce5895c7e261aadc2529637546">TCHAR</a> *szFileName, <a class="el" href="StormPort_8h.html#a798af1e30bc65f319c1a246cecf59e39">DWORD</a> dwStreamFlags)</td></tr>
<tr class="separator:a702003c1930c608961b812259bd9dc22"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:aac8a29e50fd6c047ee9288073b54804e" id="r_aac8a29e50fd6c047ee9288073b54804e"><td class="memItemLeft" align="right" valign="top"><a class="el" href="StormLib_2src_2zlib_2zconf_8h.html#a2c212835823e3c54a8ab6d95c652660e">const</a> <a class="el" href="StormPort_8h.html#a03bdb8ce5895c7e261aadc2529637546">TCHAR</a> *&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="FileStream_8cpp.html#aac8a29e50fd6c047ee9288073b54804e">FileStream_GetFileName</a> (<a class="el" href="structTFileStream.html">TFileStream</a> *pStream)</td></tr>
<tr class="separator:aac8a29e50fd6c047ee9288073b54804e"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:aa2107608d75af5dc5674f69c84637e22" id="r_aa2107608d75af5dc5674f69c84637e22"><td class="memItemLeft" align="right" valign="top">size_t&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="FileStream_8cpp.html#aa2107608d75af5dc5674f69c84637e22">FileStream_Prefix</a> (<a class="el" href="StormLib_2src_2zlib_2zconf_8h.html#a2c212835823e3c54a8ab6d95c652660e">const</a> <a class="el" href="StormPort_8h.html#a03bdb8ce5895c7e261aadc2529637546">TCHAR</a> *szFileName, <a class="el" href="StormPort_8h.html#a798af1e30bc65f319c1a246cecf59e39">DWORD</a> *pdwProvider)</td></tr>
<tr class="separator:aa2107608d75af5dc5674f69c84637e22"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:ae33c8e38a5379adbbe49471f8d0ca5af" id="r_ae33c8e38a5379adbbe49471f8d0ca5af"><td class="memItemLeft" align="right" valign="top"><a class="el" href="StormPort_8h.html#abb452686968e48b67397da5f97445f5b">bool</a>&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="FileStream_8cpp.html#ae33c8e38a5379adbbe49471f8d0ca5af">FileStream_SetCallback</a> (<a class="el" href="structTFileStream.html">TFileStream</a> *pStream, <a class="el" href="StormLib_8h.html#aec85f6efb05064d79de5e05fff77c639">SFILE_DOWNLOAD_CALLBACK</a> pfnCallback, void *pvUserData)</td></tr>
<tr class="separator:ae33c8e38a5379adbbe49471f8d0ca5af"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a079730e5345bc1141a1057d4e13e95ac" id="r_a079730e5345bc1141a1057d4e13e95ac"><td class="memItemLeft" align="right" valign="top"><a class="el" href="StormPort_8h.html#abb452686968e48b67397da5f97445f5b">bool</a>&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="FileStream_8cpp.html#a079730e5345bc1141a1057d4e13e95ac">FileStream_GetBitmap</a> (<a class="el" href="structTFileStream.html">TFileStream</a> *pStream, void *pvBitmap, <a class="el" href="StormPort_8h.html#a798af1e30bc65f319c1a246cecf59e39">DWORD</a> cbBitmap, <a class="el" href="StormPort_8h.html#a798af1e30bc65f319c1a246cecf59e39">DWORD</a> *pcbLengthNeeded)</td></tr>
<tr class="separator:a079730e5345bc1141a1057d4e13e95ac"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a593f3b1416f7497c28fa5552cd1b3003" id="r_a593f3b1416f7497c28fa5552cd1b3003"><td class="memItemLeft" align="right" valign="top"><a class="el" href="StormPort_8h.html#abb452686968e48b67397da5f97445f5b">bool</a>&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="FileStream_8cpp.html#a593f3b1416f7497c28fa5552cd1b3003">FileStream_Read</a> (<a class="el" href="structTFileStream.html">TFileStream</a> *pStream, <a class="el" href="StormPort_8h.html#abb9abb9ce956f1a9e5a4081ac40e5649">ULONGLONG</a> *pByteOffset, void *pvBuffer, <a class="el" href="StormPort_8h.html#a798af1e30bc65f319c1a246cecf59e39">DWORD</a> dwBytesToRead)</td></tr>
<tr class="separator:a593f3b1416f7497c28fa5552cd1b3003"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a36307955e8de92f5ea26be07ea3b9cb4" id="r_a36307955e8de92f5ea26be07ea3b9cb4"><td class="memItemLeft" align="right" valign="top"><a class="el" href="StormPort_8h.html#abb452686968e48b67397da5f97445f5b">bool</a>&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="FileStream_8cpp.html#a36307955e8de92f5ea26be07ea3b9cb4">FileStream_Write</a> (<a class="el" href="structTFileStream.html">TFileStream</a> *pStream, <a class="el" href="StormPort_8h.html#abb9abb9ce956f1a9e5a4081ac40e5649">ULONGLONG</a> *pByteOffset, <a class="el" href="StormLib_2src_2zlib_2zconf_8h.html#a2c212835823e3c54a8ab6d95c652660e">const</a> void *pvBuffer, <a class="el" href="StormPort_8h.html#a798af1e30bc65f319c1a246cecf59e39">DWORD</a> dwBytesToWrite)</td></tr>
<tr class="separator:a36307955e8de92f5ea26be07ea3b9cb4"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:af505319882f0f4aaf396b6d061a2275b" id="r_af505319882f0f4aaf396b6d061a2275b"><td class="memItemLeft" align="right" valign="top"><a class="el" href="StormPort_8h.html#abb452686968e48b67397da5f97445f5b">bool</a>&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="FileStream_8cpp.html#af505319882f0f4aaf396b6d061a2275b">FileStream_GetSize</a> (<a class="el" href="structTFileStream.html">TFileStream</a> *pStream, <a class="el" href="StormPort_8h.html#abb9abb9ce956f1a9e5a4081ac40e5649">ULONGLONG</a> *pFileSize)</td></tr>
<tr class="separator:af505319882f0f4aaf396b6d061a2275b"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:abc0fbb4156c7eef2e3162841ffb0d74a" id="r_abc0fbb4156c7eef2e3162841ffb0d74a"><td class="memItemLeft" align="right" valign="top"><a class="el" href="StormPort_8h.html#abb452686968e48b67397da5f97445f5b">bool</a>&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="FileStream_8cpp.html#abc0fbb4156c7eef2e3162841ffb0d74a">FileStream_SetSize</a> (<a class="el" href="structTFileStream.html">TFileStream</a> *pStream, <a class="el" href="StormPort_8h.html#abb9abb9ce956f1a9e5a4081ac40e5649">ULONGLONG</a> NewFileSize)</td></tr>
<tr class="separator:abc0fbb4156c7eef2e3162841ffb0d74a"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a4cda734fc220ab4b32e1f2bf9b5446fc" id="r_a4cda734fc220ab4b32e1f2bf9b5446fc"><td class="memItemLeft" align="right" valign="top"><a class="el" href="StormPort_8h.html#abb452686968e48b67397da5f97445f5b">bool</a>&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="FileStream_8cpp.html#a4cda734fc220ab4b32e1f2bf9b5446fc">FileStream_GetPos</a> (<a class="el" href="structTFileStream.html">TFileStream</a> *pStream, <a class="el" href="StormPort_8h.html#abb9abb9ce956f1a9e5a4081ac40e5649">ULONGLONG</a> *pByteOffset)</td></tr>
<tr class="separator:a4cda734fc220ab4b32e1f2bf9b5446fc"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a4ea733800d58589cd80948dd23421dad" id="r_a4ea733800d58589cd80948dd23421dad"><td class="memItemLeft" align="right" valign="top"><a class="el" href="StormPort_8h.html#abb452686968e48b67397da5f97445f5b">bool</a>&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="FileStream_8cpp.html#a4ea733800d58589cd80948dd23421dad">FileStream_GetTime</a> (<a class="el" href="structTFileStream.html">TFileStream</a> *pStream, <a class="el" href="StormPort_8h.html#abb9abb9ce956f1a9e5a4081ac40e5649">ULONGLONG</a> *pFileTime)</td></tr>
<tr class="separator:a4ea733800d58589cd80948dd23421dad"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a3b0eb2320c6401f6f1b5a92e53bc57dd" id="r_a3b0eb2320c6401f6f1b5a92e53bc57dd"><td class="memItemLeft" align="right" valign="top"><a class="el" href="StormPort_8h.html#abb452686968e48b67397da5f97445f5b">bool</a>&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="FileStream_8cpp.html#a3b0eb2320c6401f6f1b5a92e53bc57dd">FileStream_GetFlags</a> (<a class="el" href="structTFileStream.html">TFileStream</a> *pStream, <a class="el" href="StormPort_8h.html#a143be739596851314f3c386bd6f752f9">LPDWORD</a> pdwStreamFlags)</td></tr>
<tr class="separator:a3b0eb2320c6401f6f1b5a92e53bc57dd"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:afcf883cb4bc8ff873bb286e8f7bf5002" id="r_afcf883cb4bc8ff873bb286e8f7bf5002"><td class="memItemLeft" align="right" valign="top"><a class="el" href="StormPort_8h.html#abb452686968e48b67397da5f97445f5b">bool</a>&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="FileStream_8cpp.html#afcf883cb4bc8ff873bb286e8f7bf5002">FileStream_Replace</a> (<a class="el" href="structTFileStream.html">TFileStream</a> *pStream, <a class="el" href="structTFileStream.html">TFileStream</a> *pNewStream)</td></tr>
<tr class="separator:afcf883cb4bc8ff873bb286e8f7bf5002"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:ae8b75c4797726e9c5ee0b4b03bf31442" id="r_ae8b75c4797726e9c5ee0b4b03bf31442"><td class="memItemLeft" align="right" valign="top">void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="FileStream_8cpp.html#ae8b75c4797726e9c5ee0b4b03bf31442">FileStream_Close</a> (<a class="el" href="structTFileStream.html">TFileStream</a> *pStream)</td></tr>
<tr class="separator:ae8b75c4797726e9c5ee0b4b03bf31442"><td class="memSeparator" colspan="2">&#160;</td></tr>
</table><table class="memberdecls">
<tr class="heading"><td colspan="2"><h2 class="groupheader"><a id="var-members" name="var-members"></a>
Variables</h2></td></tr>
<tr class="memitem:ae1b34ad1b2653fcef5fac54d2fea9943" id="r_ae1b34ad1b2653fcef5fac54d2fea9943"><td class="memItemLeft" align="right" valign="top">static thread_local <a class="el" href="StormPort_8h.html#a798af1e30bc65f319c1a246cecf59e39">DWORD</a>&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="FileStream_8cpp.html#ae1b34ad1b2653fcef5fac54d2fea9943">dwLastError</a> = <a class="el" href="StormPort_8h.html#aea0ae801b7d25c979655a7eb20d034af">ERROR_SUCCESS</a></td></tr>
<tr class="separator:ae1b34ad1b2653fcef5fac54d2fea9943"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:afa38e27a30d69630dd4a86504004742a" id="r_afa38e27a30d69630dd4a86504004742a"><td class="memItemLeft" align="right" valign="top">static <a class="el" href="FileStream_8h.html#ae3d842ec0479cdc757f18d01f9d5095d">STREAM_INIT</a>&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="FileStream_8cpp.html#afa38e27a30d69630dd4a86504004742a">StreamBaseInit</a> [4]</td></tr>
<tr class="separator:afa38e27a30d69630dd4a86504004742a"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a1ba3043bfd83fe4f919a3cb4a871a9cf" id="r_a1ba3043bfd83fe4f919a3cb4a871a9cf"><td class="memItemLeft" align="right" valign="top">static <a class="el" href="StormLib_2src_2zlib_2zconf_8h.html#a2c212835823e3c54a8ab6d95c652660e">const</a> char *&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="FileStream_8cpp.html#a1ba3043bfd83fe4f919a3cb4a871a9cf">szKeyTemplate</a> = &quot;expand 32-<a class="el" href="tomcrypt__macros_8h.html#a76134035baa59a42ca0b5b8fb99d9d53">byte</a> k000000000000000000000000000000000000000000000000&quot;</td></tr>
<tr class="separator:a1ba3043bfd83fe4f919a3cb4a871a9cf"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:aec446bcf08e7a651f948295e316b9475" id="r_aec446bcf08e7a651f948295e316b9475"><td class="memItemLeft" align="right" valign="top">static <a class="el" href="StormLib_2src_2zlib_2zconf_8h.html#a2c212835823e3c54a8ab6d95c652660e">const</a> char *&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="FileStream_8cpp.html#aec446bcf08e7a651f948295e316b9475">AuthCodeArray</a> []</td></tr>
<tr class="separator:aec446bcf08e7a651f948295e316b9475"><td class="memSeparator" colspan="2">&#160;</td></tr>
</table>
<h2 class="groupheader">Macro Definition Documentation</h2>
<a id="a6c6f05f604e9e3c9c3536365c5f81665" name="a6c6f05f604e9e3c9c3536365c5f81665"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a6c6f05f604e9e3c9c3536365c5f81665">&#9670;&#160;</a></span>__STORMLIB_SELF__</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">#define __STORMLIB_SELF__</td>
        </tr>
      </table>
</div><div class="memdoc">

<p class="definition">Definition at line <a class="el" href="FileStream_8cpp_source.html#l00016">16</a> of file <a class="el" href="FileStream_8cpp_source.html">FileStream.cpp</a>.</p>

</div>
</div>
<a id="ab527650fea18542c0f5ad9097be0c352" name="ab527650fea18542c0f5ad9097be0c352"></a>
<h2 class="memtitle"><span class="permalink"><a href="#ab527650fea18542c0f5ad9097be0c352">&#9670;&#160;</a></span>BLOCK4_BLOCK_SIZE</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">#define BLOCK4_BLOCK_SIZE&#160;&#160;&#160;0x4000</td>
        </tr>
      </table>
</div><div class="memdoc">

<p class="definition">Definition at line <a class="el" href="FileStream_8cpp_source.html#l02222">2222</a> of file <a class="el" href="FileStream_8cpp_source.html">FileStream.cpp</a>.</p>

</div>
</div>
<a id="aec8b42b0300b7efd3a7bbefbacdaa5d2" name="aec8b42b0300b7efd3a7bbefbacdaa5d2"></a>
<h2 class="memtitle"><span class="permalink"><a href="#aec8b42b0300b7efd3a7bbefbacdaa5d2">&#9670;&#160;</a></span>BLOCK4_HASH_SIZE</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">#define BLOCK4_HASH_SIZE&#160;&#160;&#160;0x20</td>
        </tr>
      </table>
</div><div class="memdoc">

<p class="definition">Definition at line <a class="el" href="FileStream_8cpp_source.html#l02223">2223</a> of file <a class="el" href="FileStream_8cpp_source.html">FileStream.cpp</a>.</p>

</div>
</div>
<a id="a4f5c5bf181369788c2091bbc386990f5" name="a4f5c5bf181369788c2091bbc386990f5"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a4f5c5bf181369788c2091bbc386990f5">&#9670;&#160;</a></span>BLOCK4_MAX_BLOCKS</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">#define BLOCK4_MAX_BLOCKS&#160;&#160;&#160;0x00002000</td>
        </tr>
      </table>
</div><div class="memdoc">

<p class="definition">Definition at line <a class="el" href="FileStream_8cpp_source.html#l02224">2224</a> of file <a class="el" href="FileStream_8cpp_source.html">FileStream.cpp</a>.</p>

</div>
</div>
<a id="af4003d23efcf71bac3817c9fb695d662" name="af4003d23efcf71bac3817c9fb695d662"></a>
<h2 class="memtitle"><span class="permalink"><a href="#af4003d23efcf71bac3817c9fb695d662">&#9670;&#160;</a></span>BLOCK4_MAX_FSIZE</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">#define BLOCK4_MAX_FSIZE&#160;&#160;&#160;0x08040000</td>
        </tr>
      </table>
</div><div class="memdoc">

<p class="definition">Definition at line <a class="el" href="FileStream_8cpp_source.html#l02225">2225</a> of file <a class="el" href="FileStream_8cpp_source.html">FileStream.cpp</a>.</p>

</div>
</div>
<a id="a5fdc7facea201bfce4ad308105f88d0c" name="a5fdc7facea201bfce4ad308105f88d0c"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a5fdc7facea201bfce4ad308105f88d0c">&#9670;&#160;</a></span>INVALID_HANDLE_VALUE</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">#define INVALID_HANDLE_VALUE&#160;&#160;&#160;((<a class="el" href="StormPort_8h.html#aa8c0374618b33785ccb02f74bcfebc46">HANDLE</a>)-1)</td>
        </tr>
      </table>
</div><div class="memdoc">

<p class="definition">Definition at line <a class="el" href="FileStream_8cpp_source.html#l00030">30</a> of file <a class="el" href="FileStream_8cpp_source.html">FileStream.cpp</a>.</p>

</div>
</div>
<h2 class="groupheader">Function Documentation</h2>
<a id="aa5874b3e4d05d2f6dfa3a32d62f56bea" name="aa5874b3e4d05d2f6dfa3a32d62f56bea"></a>
<h2 class="memtitle"><span class="permalink"><a href="#aa5874b3e4d05d2f6dfa3a32d62f56bea">&#9670;&#160;</a></span>AllocateFileStream()</h2>

<div class="memitem">
<div class="memproto">
<table class="mlabels">
  <tr>
  <td class="mlabels-left">
      <table class="memname">
        <tr>
          <td class="memname">static <a class="el" href="structTFileStream.html">TFileStream</a> * AllocateFileStream </td>
          <td>(</td>
          <td class="paramtype"><a class="el" href="StormLib_2src_2zlib_2zconf_8h.html#a2c212835823e3c54a8ab6d95c652660e">const</a> <a class="el" href="StormPort_8h.html#a03bdb8ce5895c7e261aadc2529637546">TCHAR</a> *&#160;</td>
          <td class="paramname"><em>szFileName</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">size_t&#160;</td>
          <td class="paramname"><em>StreamSize</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype"><a class="el" href="StormPort_8h.html#a798af1e30bc65f319c1a246cecf59e39">DWORD</a>&#160;</td>
          <td class="paramname"><em>dwStreamFlags</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
  </td>
  <td class="mlabels-right">
<span class="mlabels"><span class="mlabel">static</span></span>  </td>
  </tr>
</table>
</div><div class="memdoc">

<p class="definition">Definition at line <a class="el" href="FileStream_8cpp_source.html#l01092">1092</a> of file <a class="el" href="FileStream_8cpp_source.html">FileStream.cpp</a>.</p>
<div class="fragment"><div class="line"><span class="lineno"> 1096</span>{</div>
<div class="line"><span class="lineno"> 1097</span>    <a class="code hl_struct" href="structTFileStream.html">TFileStream</a> * pMaster = NULL;</div>
<div class="line"><span class="lineno"> 1098</span>    <a class="code hl_struct" href="structTFileStream.html">TFileStream</a> * pStream;</div>
<div class="line"><span class="lineno"> 1099</span>    <span class="keyword">const</span> <a class="code hl_typedef" href="StormPort_8h.html#a03bdb8ce5895c7e261aadc2529637546">TCHAR</a> * szNextFile = szFileName;</div>
<div class="line"><span class="lineno"> 1100</span>    <span class="keywordtype">size_t</span> FileNameSize;</div>
<div class="line"><span class="lineno"> 1101</span> </div>
<div class="line"><span class="lineno"> 1102</span>    <span class="comment">// Sanity check</span></div>
<div class="line"><span class="lineno"> 1103</span>    assert(StreamSize != 0);</div>
<div class="line"><span class="lineno"> 1104</span> </div>
<div class="line"><span class="lineno"> 1105</span>    <span class="comment">// The caller can specify chain of files in the following form:</span></div>
<div class="line"><span class="lineno"> 1106</span>    <span class="comment">// C:\archive.MPQ*http://www.server.com/MPQs/archive-server.MPQ</span></div>
<div class="line"><span class="lineno"> 1107</span>    <span class="comment">// In that case, we use the part after &quot;*&quot; as master file name</span></div>
<div class="line"><span class="lineno"> 1108</span>    <span class="keywordflow">while</span>(szNextFile[0] != 0 &amp;&amp; szNextFile[0] != <a class="code hl_define" href="StormPort_8h.html#ae936e4c15227768f7da4e0951def89c8">_T</a>(<span class="charliteral">&#39;*&#39;</span>))</div>
<div class="line"><span class="lineno"> 1109</span>        szNextFile++;</div>
<div class="line"><span class="lineno"> 1110</span>    FileNameSize = (size_t)((szNextFile - szFileName) * <span class="keyword">sizeof</span>(<a class="code hl_typedef" href="StormPort_8h.html#a03bdb8ce5895c7e261aadc2529637546">TCHAR</a>));</div>
<div class="line"><span class="lineno"> 1111</span> </div>
<div class="line"><span class="lineno"> 1112</span>    <span class="comment">// If we have a next file, we need to open it as master stream</span></div>
<div class="line"><span class="lineno"> 1113</span>    <span class="comment">// Note that we don&#39;t care if the master stream exists or not,</span></div>
<div class="line"><span class="lineno"> 1114</span>    <span class="comment">// If it doesn&#39;t, later attempts to read missing file block will fail</span></div>
<div class="line"><span class="lineno"> 1115</span>    <span class="keywordflow">if</span>(szNextFile[0] == <a class="code hl_define" href="StormPort_8h.html#ae936e4c15227768f7da4e0951def89c8">_T</a>(<span class="charliteral">&#39;*&#39;</span>))</div>
<div class="line"><span class="lineno"> 1116</span>    {</div>
<div class="line"><span class="lineno"> 1117</span>        <span class="comment">// Don&#39;t allow another master file in the string</span></div>
<div class="line"><span class="lineno"> 1118</span>        <span class="keywordflow">if</span>(<a class="code hl_define" href="StormPort_8h.html#af43338ad021f11eb1b6aa51b1fb6a8be">_tcschr</a>(szNextFile + 1, <a class="code hl_define" href="StormPort_8h.html#ae936e4c15227768f7da4e0951def89c8">_T</a>(<span class="charliteral">&#39;*&#39;</span>)) != NULL)</div>
<div class="line"><span class="lineno"> 1119</span>        {</div>
<div class="line"><span class="lineno"> 1120</span>            <a class="code hl_function" href="FileStream_8cpp.html#a65dd8d3e416ffbd6ac5f468c6bdccac9">SetLastError</a>(<a class="code hl_define" href="StormPort_8h.html#a176960f93d11db6f58d10a6957a80f38">ERROR_INVALID_PARAMETER</a>);</div>
<div class="line"><span class="lineno"> 1121</span>            <span class="keywordflow">return</span> NULL;</div>
<div class="line"><span class="lineno"> 1122</span>        }</div>
<div class="line"><span class="lineno"> 1123</span> </div>
<div class="line"><span class="lineno"> 1124</span>        <span class="comment">// Open the master file</span></div>
<div class="line"><span class="lineno"> 1125</span>        pMaster = <a class="code hl_function" href="FileStream_8cpp.html#a702003c1930c608961b812259bd9dc22">FileStream_OpenFile</a>(szNextFile + 1, <a class="code hl_define" href="StormLib_8h.html#abdbbf06488f24699775afe6aadaeafc3">STREAM_FLAG_READ_ONLY</a>);</div>
<div class="line"><span class="lineno"> 1126</span>    }</div>
<div class="line"><span class="lineno"> 1127</span> </div>
<div class="line"><span class="lineno"> 1128</span>    <span class="comment">// Allocate the stream structure for the given stream type</span></div>
<div class="line"><span class="lineno"> 1129</span>    pStream = (<a class="code hl_struct" href="structTFileStream.html">TFileStream</a> *)<a class="code hl_define" href="StormCommon_8h.html#a6fe0c42173ef1a4b9f0e837b0c631660">STORM_ALLOC</a>(<a class="code hl_typedef" href="StormPort_8h.html#a4ae1dab0fb4b072a66584546209e7d58">BYTE</a>, StreamSize + FileNameSize + <span class="keyword">sizeof</span>(<a class="code hl_typedef" href="StormPort_8h.html#a03bdb8ce5895c7e261aadc2529637546">TCHAR</a>));</div>
<div class="line"><span class="lineno"> 1130</span>    <span class="keywordflow">if</span>(pStream != NULL)</div>
<div class="line"><span class="lineno"> 1131</span>    {</div>
<div class="line"><span class="lineno"> 1132</span>        <span class="comment">// Zero the entire structure</span></div>
<div class="line"><span class="lineno"> 1133</span>        memset(pStream, 0, StreamSize);</div>
<div class="line"><span class="lineno"> 1134</span>        pStream-&gt;<a class="code hl_variable" href="structTFileStream.html#a26faae83ba546119ac59fc35eaeec274">pMaster</a> = pMaster;</div>
<div class="line"><span class="lineno"> 1135</span>        pStream-&gt;<a class="code hl_variable" href="structTFileStream.html#ae61935eec67ce99ea4091bc0949de1ea">dwFlags</a> = dwStreamFlags;</div>
<div class="line"><span class="lineno"> 1136</span> </div>
<div class="line"><span class="lineno"> 1137</span>        <span class="comment">// Initialize the file name</span></div>
<div class="line"><span class="lineno"> 1138</span>        pStream-&gt;<a class="code hl_variable" href="structTFileStream.html#a7a4da926d708d96cb47333973e705c76">szFileName</a> = (<a class="code hl_typedef" href="StormPort_8h.html#a03bdb8ce5895c7e261aadc2529637546">TCHAR</a> *)((<a class="code hl_typedef" href="StormPort_8h.html#a4ae1dab0fb4b072a66584546209e7d58">BYTE</a> *)pStream + StreamSize);</div>
<div class="line"><span class="lineno"> 1139</span>        memcpy(pStream-&gt;<a class="code hl_variable" href="structTFileStream.html#a7a4da926d708d96cb47333973e705c76">szFileName</a>, szFileName, FileNameSize);</div>
<div class="line"><span class="lineno"> 1140</span>        pStream-&gt;<a class="code hl_variable" href="structTFileStream.html#a7a4da926d708d96cb47333973e705c76">szFileName</a>[FileNameSize / <span class="keyword">sizeof</span>(<a class="code hl_typedef" href="StormPort_8h.html#a03bdb8ce5895c7e261aadc2529637546">TCHAR</a>)] = 0;</div>
<div class="line"><span class="lineno"> 1141</span> </div>
<div class="line"><span class="lineno"> 1142</span>        <span class="comment">// Initialize the stream functions</span></div>
<div class="line"><span class="lineno"> 1143</span>        <a class="code hl_variable" href="FileStream_8cpp.html#afa38e27a30d69630dd4a86504004742a">StreamBaseInit</a>[dwStreamFlags &amp; 0x03](pStream);</div>
<div class="line"><span class="lineno"> 1144</span>    }</div>
<div class="line"><span class="lineno"> 1145</span> </div>
<div class="line"><span class="lineno"> 1146</span>    <span class="keywordflow">return</span> pStream;</div>
<div class="line"><span class="lineno"> 1147</span>}</div>
<div class="ttc" id="aFileStream_8cpp_html_a65dd8d3e416ffbd6ac5f468c6bdccac9"><div class="ttname"><a href="FileStream_8cpp.html#a65dd8d3e416ffbd6ac5f468c6bdccac9">SetLastError</a></div><div class="ttdeci">void SetLastError(DWORD dwErrCode)</div><div class="ttdef"><b>Definition</b> <a href="FileStream_8cpp_source.html#l00049">FileStream.cpp:49</a></div></div>
<div class="ttc" id="aFileStream_8cpp_html_a702003c1930c608961b812259bd9dc22"><div class="ttname"><a href="FileStream_8cpp.html#a702003c1930c608961b812259bd9dc22">FileStream_OpenFile</a></div><div class="ttdeci">TFileStream * FileStream_OpenFile(const TCHAR *szFileName, DWORD dwStreamFlags)</div><div class="ttdef"><b>Definition</b> <a href="FileStream_8cpp_source.html#l02499">FileStream.cpp:2499</a></div></div>
<div class="ttc" id="aFileStream_8cpp_html_afa38e27a30d69630dd4a86504004742a"><div class="ttname"><a href="FileStream_8cpp.html#afa38e27a30d69630dd4a86504004742a">StreamBaseInit</a></div><div class="ttdeci">static STREAM_INIT StreamBaseInit[4]</div><div class="ttdef"><b>Definition</b> <a href="FileStream_8cpp_source.html#l01081">FileStream.cpp:1081</a></div></div>
<div class="ttc" id="aStormCommon_8h_html_a6fe0c42173ef1a4b9f0e837b0c631660"><div class="ttname"><a href="StormCommon_8h.html#a6fe0c42173ef1a4b9f0e837b0c631660">STORM_ALLOC</a></div><div class="ttdeci">#define STORM_ALLOC(type, nitems)</div><div class="ttdef"><b>Definition</b> <a href="StormCommon_8h_source.html#l00132">StormCommon.h:132</a></div></div>
<div class="ttc" id="aStormLib_8h_html_abdbbf06488f24699775afe6aadaeafc3"><div class="ttname"><a href="StormLib_8h.html#abdbbf06488f24699775afe6aadaeafc3">STREAM_FLAG_READ_ONLY</a></div><div class="ttdeci">#define STREAM_FLAG_READ_ONLY</div><div class="ttdef"><b>Definition</b> <a href="StormLib_8h_source.html#l00321">StormLib.h:321</a></div></div>
<div class="ttc" id="aStormPort_8h_html_a03bdb8ce5895c7e261aadc2529637546"><div class="ttname"><a href="StormPort_8h.html#a03bdb8ce5895c7e261aadc2529637546">TCHAR</a></div><div class="ttdeci">char TCHAR</div><div class="ttdef"><b>Definition</b> <a href="StormPort_8h_source.html#l00344">StormPort.h:344</a></div></div>
<div class="ttc" id="aStormPort_8h_html_a176960f93d11db6f58d10a6957a80f38"><div class="ttname"><a href="StormPort_8h.html#a176960f93d11db6f58d10a6957a80f38">ERROR_INVALID_PARAMETER</a></div><div class="ttdeci">#define ERROR_INVALID_PARAMETER</div><div class="ttdef"><b>Definition</b> <a href="StormPort_8h_source.html#l00407">StormPort.h:407</a></div></div>
<div class="ttc" id="aStormPort_8h_html_a4ae1dab0fb4b072a66584546209e7d58"><div class="ttname"><a href="StormPort_8h.html#a4ae1dab0fb4b072a66584546209e7d58">BYTE</a></div><div class="ttdeci">unsigned char BYTE</div><div class="ttdef"><b>Definition</b> <a href="StormPort_8h_source.html#l00333">StormPort.h:333</a></div></div>
<div class="ttc" id="aStormPort_8h_html_ae936e4c15227768f7da4e0951def89c8"><div class="ttname"><a href="StormPort_8h.html#ae936e4c15227768f7da4e0951def89c8">_T</a></div><div class="ttdeci">#define _T(x)</div><div class="ttdef"><b>Definition</b> <a href="StormPort_8h_source.html#l00369">StormPort.h:369</a></div></div>
<div class="ttc" id="aStormPort_8h_html_af43338ad021f11eb1b6aa51b1fb6a8be"><div class="ttname"><a href="StormPort_8h.html#af43338ad021f11eb1b6aa51b1fb6a8be">_tcschr</a></div><div class="ttdeci">#define _tcschr</div><div class="ttdef"><b>Definition</b> <a href="StormPort_8h_source.html#l00373">StormPort.h:373</a></div></div>
<div class="ttc" id="astructTFileStream_html"><div class="ttname"><a href="structTFileStream.html">TFileStream</a></div><div class="ttdef"><b>Definition</b> <a href="FileStream_8h_source.html#l00153">FileStream.h:154</a></div></div>
<div class="ttc" id="astructTFileStream_html_a26faae83ba546119ac59fc35eaeec274"><div class="ttname"><a href="structTFileStream.html#a26faae83ba546119ac59fc35eaeec274">TFileStream::pMaster</a></div><div class="ttdeci">TFileStream * pMaster</div><div class="ttdef"><b>Definition</b> <a href="FileStream_8h_source.html#l00181">FileStream.h:181</a></div></div>
<div class="ttc" id="astructTFileStream_html_a7a4da926d708d96cb47333973e705c76"><div class="ttname"><a href="structTFileStream.html#a7a4da926d708d96cb47333973e705c76">TFileStream::szFileName</a></div><div class="ttdeci">TCHAR * szFileName</div><div class="ttdef"><b>Definition</b> <a href="FileStream_8h_source.html#l00182">FileStream.h:182</a></div></div>
<div class="ttc" id="astructTFileStream_html_ae61935eec67ce99ea4091bc0949de1ea"><div class="ttname"><a href="structTFileStream.html#ae61935eec67ce99ea4091bc0949de1ea">TFileStream::dwFlags</a></div><div class="ttdeci">DWORD dwFlags</div><div class="ttdef"><b>Definition</b> <a href="FileStream_8h_source.html#l00187">FileStream.h:187</a></div></div>
</div><!-- fragment --><div class="dynheader">
Here is the call graph for this function:</div>
<div class="dyncontent">
<div class="center"><div class="zoom"><iframe scrolling="no" frameborder="0" src="FileStream_8cpp_aa5874b3e4d05d2f6dfa3a32d62f56bea_cgraph.svg" width="100%" height="600"><p><b>This browser is not able to show SVG: try Firefox, Chrome, Safari, or Opera instead.</b></p></iframe></div></div>
</div>
<div class="dynheader">
Here is the caller graph for this function:</div>
<div class="dyncontent">
<div class="center"><div class="zoom"><iframe scrolling="no" frameborder="0" src="FileStream_8cpp_aa5874b3e4d05d2f6dfa3a32d62f56bea_icgraph.svg" width="100%" height="600"><p><b>This browser is not able to show SVG: try Firefox, Chrome, Safari, or Opera instead.</b></p></iframe></div></div>
</div>

</div>
</div>
<a id="ae44b926c84d51b8bf1e58ee562bad8c4" name="ae44b926c84d51b8bf1e58ee562bad8c4"></a>
<h2 class="memtitle"><span class="permalink"><a href="#ae44b926c84d51b8bf1e58ee562bad8c4">&#9670;&#160;</a></span>BaseFile_Close()</h2>

<div class="memitem">
<div class="memproto">
<table class="mlabels">
  <tr>
  <td class="mlabels-left">
      <table class="memname">
        <tr>
          <td class="memname">static void BaseFile_Close </td>
          <td>(</td>
          <td class="paramtype"><a class="el" href="structTFileStream.html">TFileStream</a> *&#160;</td>
          <td class="paramname"><em>pStream</em></td><td>)</td>
          <td></td>
        </tr>
      </table>
  </td>
  <td class="mlabels-right">
<span class="mlabels"><span class="mlabel">static</span></span>  </td>
  </tr>
</table>
</div><div class="memdoc">

<p class="definition">Definition at line <a class="el" href="FileStream_8cpp_source.html#l00428">428</a> of file <a class="el" href="FileStream_8cpp_source.html">FileStream.cpp</a>.</p>
<div class="fragment"><div class="line"><span class="lineno">  429</span>{</div>
<div class="line"><span class="lineno">  430</span>    <span class="keywordflow">if</span>(pStream-&gt;<a class="code hl_variable" href="structTFileStream.html#a3428b5a1e790560349940aa04e37e580">Base</a>.<a class="code hl_variable" href="unionTBaseProviderData.html#a60536cc70eff3072cd6c371a99bdf325">File</a>.<a class="code hl_variable" href="unionTBaseProviderData.html#a3ca5c9e4601dd22216f7ef85f4d6f64d">hFile</a> != <a class="code hl_define" href="FileStream_8cpp.html#a5fdc7facea201bfce4ad308105f88d0c">INVALID_HANDLE_VALUE</a>)</div>
<div class="line"><span class="lineno">  431</span>    {</div>
<div class="line"><span class="lineno">  432</span><span class="preprocessor">#ifdef STORMLIB_WINDOWS</span></div>
<div class="line"><span class="lineno">  433</span>        CloseHandle(pStream-&gt;<a class="code hl_variable" href="structTFileStream.html#a3428b5a1e790560349940aa04e37e580">Base</a>.<a class="code hl_variable" href="unionTBaseProviderData.html#a60536cc70eff3072cd6c371a99bdf325">File</a>.<a class="code hl_variable" href="unionTBaseProviderData.html#a3ca5c9e4601dd22216f7ef85f4d6f64d">hFile</a>);</div>
<div class="line"><span class="lineno">  434</span><span class="preprocessor">#endif</span></div>
<div class="line"><span class="lineno">  435</span> </div>
<div class="line"><span class="lineno">  436</span><span class="preprocessor">#if defined(STORMLIB_MAC) || defined(STORMLIB_LINUX)</span></div>
<div class="line"><span class="lineno">  437</span>        close((<a class="code hl_typedef" href="winvs__stdint_8h.html#abd3131a20f4053d808d4277db3e39a23">intptr_t</a>)pStream-&gt;<a class="code hl_variable" href="structTFileStream.html#a3428b5a1e790560349940aa04e37e580">Base</a>.<a class="code hl_variable" href="unionTBaseProviderData.html#a60536cc70eff3072cd6c371a99bdf325">File</a>.<a class="code hl_variable" href="unionTBaseProviderData.html#a3ca5c9e4601dd22216f7ef85f4d6f64d">hFile</a>);</div>
<div class="line"><span class="lineno">  438</span><span class="preprocessor">#endif</span></div>
<div class="line"><span class="lineno">  439</span>    }</div>
<div class="line"><span class="lineno">  440</span> </div>
<div class="line"><span class="lineno">  441</span>    <span class="comment">// Also invalidate the handle</span></div>
<div class="line"><span class="lineno">  442</span>    pStream-&gt;<a class="code hl_variable" href="structTFileStream.html#a3428b5a1e790560349940aa04e37e580">Base</a>.<a class="code hl_variable" href="unionTBaseProviderData.html#a60536cc70eff3072cd6c371a99bdf325">File</a>.<a class="code hl_variable" href="unionTBaseProviderData.html#a3ca5c9e4601dd22216f7ef85f4d6f64d">hFile</a> = <a class="code hl_define" href="FileStream_8cpp.html#a5fdc7facea201bfce4ad308105f88d0c">INVALID_HANDLE_VALUE</a>;</div>
<div class="line"><span class="lineno">  443</span>}</div>
<div class="ttc" id="aFileStream_8cpp_html_a5fdc7facea201bfce4ad308105f88d0c"><div class="ttname"><a href="FileStream_8cpp.html#a5fdc7facea201bfce4ad308105f88d0c">INVALID_HANDLE_VALUE</a></div><div class="ttdeci">#define INVALID_HANDLE_VALUE</div><div class="ttdef"><b>Definition</b> <a href="FileStream_8cpp_source.html#l00030">FileStream.cpp:30</a></div></div>
<div class="ttc" id="astructTFileStream_html_a3428b5a1e790560349940aa04e37e580"><div class="ttname"><a href="structTFileStream.html#a3428b5a1e790560349940aa04e37e580">TFileStream::Base</a></div><div class="ttdeci">TBaseProviderData Base</div><div class="ttdef"><b>Definition</b> <a href="FileStream_8h_source.html#l00178">FileStream.h:178</a></div></div>
<div class="ttc" id="aunionTBaseProviderData_html_a3ca5c9e4601dd22216f7ef85f4d6f64d"><div class="ttname"><a href="unionTBaseProviderData.html#a3ca5c9e4601dd22216f7ef85f4d6f64d">TBaseProviderData::hFile</a></div><div class="ttdeci">HANDLE hFile</div><div class="ttdef"><b>Definition</b> <a href="FileStream_8h_source.html#l00132">FileStream.h:132</a></div></div>
<div class="ttc" id="aunionTBaseProviderData_html_a60536cc70eff3072cd6c371a99bdf325"><div class="ttname"><a href="unionTBaseProviderData.html#a60536cc70eff3072cd6c371a99bdf325">TBaseProviderData::File</a></div><div class="ttdeci">struct TBaseProviderData::@53 File</div></div>
<div class="ttc" id="awinvs__stdint_8h_html_abd3131a20f4053d808d4277db3e39a23"><div class="ttname"><a href="winvs__stdint_8h.html#abd3131a20f4053d808d4277db3e39a23">intptr_t</a></div><div class="ttdeci">_W64 signed int intptr_t</div><div class="ttdef"><b>Definition</b> <a href="winvs__stdint_8h_source.html#l00118">winvs_stdint.h:118</a></div></div>
</div><!-- fragment --><div class="dynheader">
Here is the caller graph for this function:</div>
<div class="dyncontent">
<div class="center"><iframe scrolling="no" frameborder="0" src="FileStream_8cpp_ae44b926c84d51b8bf1e58ee562bad8c4_icgraph.svg" width="284" height="36"><p><b>This browser is not able to show SVG: try Firefox, Chrome, Safari, or Opera instead.</b></p></iframe></div>
</div>

</div>
</div>
<a id="a1fcabccfb3e06e3d9aaa6c20bbbf35b1" name="a1fcabccfb3e06e3d9aaa6c20bbbf35b1"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a1fcabccfb3e06e3d9aaa6c20bbbf35b1">&#9670;&#160;</a></span>BaseFile_Create()</h2>

<div class="memitem">
<div class="memproto">
<table class="mlabels">
  <tr>
  <td class="mlabels-left">
      <table class="memname">
        <tr>
          <td class="memname">static <a class="el" href="StormPort_8h.html#abb452686968e48b67397da5f97445f5b">bool</a> BaseFile_Create </td>
          <td>(</td>
          <td class="paramtype"><a class="el" href="structTFileStream.html">TFileStream</a> *&#160;</td>
          <td class="paramname"><em>pStream</em></td><td>)</td>
          <td></td>
        </tr>
      </table>
  </td>
  <td class="mlabels-right">
<span class="mlabels"><span class="mlabel">static</span></span>  </td>
  </tr>
</table>
</div><div class="memdoc">

<p class="definition">Definition at line <a class="el" href="FileStream_8cpp_source.html#l00095">95</a> of file <a class="el" href="FileStream_8cpp_source.html">FileStream.cpp</a>.</p>
<div class="fragment"><div class="line"><span class="lineno">   96</span>{</div>
<div class="line"><span class="lineno">   97</span><span class="preprocessor">#ifdef STORMLIB_WINDOWS</span></div>
<div class="line"><span class="lineno">   98</span>    {</div>
<div class="line"><span class="lineno">   99</span>        <a class="code hl_typedef" href="StormPort_8h.html#a798af1e30bc65f319c1a246cecf59e39">DWORD</a> dwWriteShare = (pStream-&gt;<a class="code hl_variable" href="structTFileStream.html#ae61935eec67ce99ea4091bc0949de1ea">dwFlags</a> &amp; <a class="code hl_define" href="StormLib_8h.html#a70f64cc8946e34d88ab1c2de9d76ba4c">STREAM_FLAG_WRITE_SHARE</a>) ? FILE_SHARE_WRITE : 0;</div>
<div class="line"><span class="lineno">  100</span> </div>
<div class="line"><span class="lineno">  101</span>        pStream-&gt;<a class="code hl_variable" href="structTFileStream.html#a3428b5a1e790560349940aa04e37e580">Base</a>.<a class="code hl_variable" href="unionTBaseProviderData.html#a60536cc70eff3072cd6c371a99bdf325">File</a>.<a class="code hl_variable" href="unionTBaseProviderData.html#a3ca5c9e4601dd22216f7ef85f4d6f64d">hFile</a> = CreateFile(pStream-&gt;<a class="code hl_variable" href="structTFileStream.html#a7a4da926d708d96cb47333973e705c76">szFileName</a>,</div>
<div class="line"><span class="lineno">  102</span>                                              GENERIC_READ | GENERIC_WRITE,</div>
<div class="line"><span class="lineno">  103</span>                                              dwWriteShare | FILE_SHARE_READ,</div>
<div class="line"><span class="lineno">  104</span>                                              NULL,</div>
<div class="line"><span class="lineno">  105</span>                                              CREATE_ALWAYS,</div>
<div class="line"><span class="lineno">  106</span>                                              0,</div>
<div class="line"><span class="lineno">  107</span>                                              NULL);</div>
<div class="line"><span class="lineno">  108</span>        <span class="keywordflow">if</span>(pStream-&gt;<a class="code hl_variable" href="structTFileStream.html#a3428b5a1e790560349940aa04e37e580">Base</a>.<a class="code hl_variable" href="unionTBaseProviderData.html#a60536cc70eff3072cd6c371a99bdf325">File</a>.<a class="code hl_variable" href="unionTBaseProviderData.html#a3ca5c9e4601dd22216f7ef85f4d6f64d">hFile</a> == <a class="code hl_define" href="FileStream_8cpp.html#a5fdc7facea201bfce4ad308105f88d0c">INVALID_HANDLE_VALUE</a>)</div>
<div class="line"><span class="lineno">  109</span>            <span class="keywordflow">return</span> <span class="keyword">false</span>;</div>
<div class="line"><span class="lineno">  110</span>    }</div>
<div class="line"><span class="lineno">  111</span><span class="preprocessor">#endif</span></div>
<div class="line"><span class="lineno">  112</span> </div>
<div class="line"><span class="lineno">  113</span><span class="preprocessor">#if defined(STORMLIB_MAC) || defined(STORMLIB_LINUX)</span></div>
<div class="line"><span class="lineno">  114</span>    {</div>
<div class="line"><span class="lineno">  115</span>        <a class="code hl_typedef" href="winvs__stdint_8h.html#abd3131a20f4053d808d4277db3e39a23">intptr_t</a> handle;</div>
<div class="line"><span class="lineno">  116</span> </div>
<div class="line"><span class="lineno">  117</span>        handle = open(pStream-&gt;<a class="code hl_variable" href="structTFileStream.html#a7a4da926d708d96cb47333973e705c76">szFileName</a>, O_RDWR | O_CREAT | O_TRUNC | O_LARGEFILE, S_IRUSR | S_IWUSR | S_IRGRP | S_IROTH);</div>
<div class="line"><span class="lineno">  118</span>        <span class="keywordflow">if</span>(handle == -1)</div>
<div class="line"><span class="lineno">  119</span>        {</div>
<div class="line"><span class="lineno">  120</span>            pStream-&gt;<a class="code hl_variable" href="structTFileStream.html#a3428b5a1e790560349940aa04e37e580">Base</a>.<a class="code hl_variable" href="unionTBaseProviderData.html#a60536cc70eff3072cd6c371a99bdf325">File</a>.<a class="code hl_variable" href="unionTBaseProviderData.html#a3ca5c9e4601dd22216f7ef85f4d6f64d">hFile</a> = <a class="code hl_define" href="FileStream_8cpp.html#a5fdc7facea201bfce4ad308105f88d0c">INVALID_HANDLE_VALUE</a>;</div>
<div class="line"><span class="lineno">  121</span>            <a class="code hl_variable" href="FileStream_8cpp.html#ae1b34ad1b2653fcef5fac54d2fea9943">dwLastError</a> = errno;</div>
<div class="line"><span class="lineno">  122</span>            <span class="keywordflow">return</span> <span class="keyword">false</span>;</div>
<div class="line"><span class="lineno">  123</span>        }</div>
<div class="line"><span class="lineno">  124</span> </div>
<div class="line"><span class="lineno">  125</span>        pStream-&gt;<a class="code hl_variable" href="structTFileStream.html#a3428b5a1e790560349940aa04e37e580">Base</a>.<a class="code hl_variable" href="unionTBaseProviderData.html#a60536cc70eff3072cd6c371a99bdf325">File</a>.<a class="code hl_variable" href="unionTBaseProviderData.html#a3ca5c9e4601dd22216f7ef85f4d6f64d">hFile</a> = (<a class="code hl_typedef" href="StormPort_8h.html#aa8c0374618b33785ccb02f74bcfebc46">HANDLE</a>)handle;</div>
<div class="line"><span class="lineno">  126</span>    }</div>
<div class="line"><span class="lineno">  127</span><span class="preprocessor">#endif</span></div>
<div class="line"><span class="lineno">  128</span> </div>
<div class="line"><span class="lineno">  129</span>    <span class="comment">// Reset the file size and position</span></div>
<div class="line"><span class="lineno">  130</span>    pStream-&gt;<a class="code hl_variable" href="structTFileStream.html#a3428b5a1e790560349940aa04e37e580">Base</a>.<a class="code hl_variable" href="unionTBaseProviderData.html#a60536cc70eff3072cd6c371a99bdf325">File</a>.<a class="code hl_variable" href="unionTBaseProviderData.html#ad644c7067435cf51727186729b970d55">FileSize</a> = 0;</div>
<div class="line"><span class="lineno">  131</span>    pStream-&gt;<a class="code hl_variable" href="structTFileStream.html#a3428b5a1e790560349940aa04e37e580">Base</a>.<a class="code hl_variable" href="unionTBaseProviderData.html#a60536cc70eff3072cd6c371a99bdf325">File</a>.<a class="code hl_variable" href="unionTBaseProviderData.html#ac625a3e6bcdc60e1cd5d1bb7ed062028">FilePos</a> = 0;</div>
<div class="line"><span class="lineno">  132</span>    <span class="keywordflow">return</span> <span class="keyword">true</span>;</div>
<div class="line"><span class="lineno">  133</span>}</div>
<div class="ttc" id="aFileStream_8cpp_html_ae1b34ad1b2653fcef5fac54d2fea9943"><div class="ttname"><a href="FileStream_8cpp.html#ae1b34ad1b2653fcef5fac54d2fea9943">dwLastError</a></div><div class="ttdeci">static thread_local DWORD dwLastError</div><div class="ttdef"><b>Definition</b> <a href="FileStream_8cpp_source.html#l00039">FileStream.cpp:39</a></div></div>
<div class="ttc" id="aStormLib_8h_html_a70f64cc8946e34d88ab1c2de9d76ba4c"><div class="ttname"><a href="StormLib_8h.html#a70f64cc8946e34d88ab1c2de9d76ba4c">STREAM_FLAG_WRITE_SHARE</a></div><div class="ttdeci">#define STREAM_FLAG_WRITE_SHARE</div><div class="ttdef"><b>Definition</b> <a href="StormLib_8h_source.html#l00322">StormLib.h:322</a></div></div>
<div class="ttc" id="aStormPort_8h_html_a798af1e30bc65f319c1a246cecf59e39"><div class="ttname"><a href="StormPort_8h.html#a798af1e30bc65f319c1a246cecf59e39">DWORD</a></div><div class="ttdeci">unsigned int DWORD</div><div class="ttdef"><b>Definition</b> <a href="StormPort_8h_source.html#l00336">StormPort.h:336</a></div></div>
<div class="ttc" id="aStormPort_8h_html_aa8c0374618b33785ccb02f74bcfebc46"><div class="ttname"><a href="StormPort_8h.html#aa8c0374618b33785ccb02f74bcfebc46">HANDLE</a></div><div class="ttdeci">void * HANDLE</div><div class="ttdef"><b>Definition</b> <a href="StormPort_8h_source.html#l00342">StormPort.h:342</a></div></div>
<div class="ttc" id="aunionTBaseProviderData_html_ac625a3e6bcdc60e1cd5d1bb7ed062028"><div class="ttname"><a href="unionTBaseProviderData.html#ac625a3e6bcdc60e1cd5d1bb7ed062028">TBaseProviderData::FilePos</a></div><div class="ttdeci">ULONGLONG FilePos</div><div class="ttdef"><b>Definition</b> <a href="FileStream_8h_source.html#l00130">FileStream.h:130</a></div></div>
<div class="ttc" id="aunionTBaseProviderData_html_ad644c7067435cf51727186729b970d55"><div class="ttname"><a href="unionTBaseProviderData.html#ad644c7067435cf51727186729b970d55">TBaseProviderData::FileSize</a></div><div class="ttdeci">ULONGLONG FileSize</div><div class="ttdef"><b>Definition</b> <a href="FileStream_8h_source.html#l00129">FileStream.h:129</a></div></div>
</div><!-- fragment --><div class="dynheader">
Here is the caller graph for this function:</div>
<div class="dyncontent">
<div class="center"><div class="zoom"><iframe scrolling="no" frameborder="0" src="FileStream_8cpp_a1fcabccfb3e06e3d9aaa6c20bbbf35b1_icgraph.svg" width="100%" height="401"><p><b>This browser is not able to show SVG: try Firefox, Chrome, Safari, or Opera instead.</b></p></iframe></div></div>
</div>

</div>
</div>
<a id="a83df9c1c4278b431d59568a3ae4dc39f" name="a83df9c1c4278b431d59568a3ae4dc39f"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a83df9c1c4278b431d59568a3ae4dc39f">&#9670;&#160;</a></span>BaseFile_GetPos()</h2>

<div class="memitem">
<div class="memproto">
<table class="mlabels">
  <tr>
  <td class="mlabels-left">
      <table class="memname">
        <tr>
          <td class="memname">static <a class="el" href="StormPort_8h.html#abb452686968e48b67397da5f97445f5b">bool</a> BaseFile_GetPos </td>
          <td>(</td>
          <td class="paramtype"><a class="el" href="structTFileStream.html">TFileStream</a> *&#160;</td>
          <td class="paramname"><em>pStream</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype"><a class="el" href="StormPort_8h.html#abb9abb9ce956f1a9e5a4081ac40e5649">ULONGLONG</a> *&#160;</td>
          <td class="paramname"><em>pByteOffset</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
  </td>
  <td class="mlabels-right">
<span class="mlabels"><span class="mlabel">static</span></span>  </td>
  </tr>
</table>
</div><div class="memdoc">

<p class="definition">Definition at line <a class="el" href="FileStream_8cpp_source.html#l00396">396</a> of file <a class="el" href="FileStream_8cpp_source.html">FileStream.cpp</a>.</p>
<div class="fragment"><div class="line"><span class="lineno">  397</span>{</div>
<div class="line"><span class="lineno">  398</span>    <span class="comment">// Note: Used by all thre base providers.</span></div>
<div class="line"><span class="lineno">  399</span>    <span class="comment">// Requires the TBaseData union to have the same layout for all three base providers</span></div>
<div class="line"><span class="lineno">  400</span>    *pByteOffset = pStream-&gt;<a class="code hl_variable" href="structTFileStream.html#a3428b5a1e790560349940aa04e37e580">Base</a>.<a class="code hl_variable" href="unionTBaseProviderData.html#a60536cc70eff3072cd6c371a99bdf325">File</a>.<a class="code hl_variable" href="unionTBaseProviderData.html#ac625a3e6bcdc60e1cd5d1bb7ed062028">FilePos</a>;</div>
<div class="line"><span class="lineno">  401</span>    <span class="keywordflow">return</span> <span class="keyword">true</span>;</div>
<div class="line"><span class="lineno">  402</span>}</div>
</div><!-- fragment --><div class="dynheader">
Here is the caller graph for this function:</div>
<div class="dyncontent">
<div class="center"><iframe scrolling="no" frameborder="0" src="FileStream_8cpp_a83df9c1c4278b431d59568a3ae4dc39f_icgraph.svg" width="300" height="135"><p><b>This browser is not able to show SVG: try Firefox, Chrome, Safari, or Opera instead.</b></p></iframe></div>
</div>

</div>
</div>
<a id="a55e7d166af5374820da7c39a63eabb78" name="a55e7d166af5374820da7c39a63eabb78"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a55e7d166af5374820da7c39a63eabb78">&#9670;&#160;</a></span>BaseFile_GetSize()</h2>

<div class="memitem">
<div class="memproto">
<table class="mlabels">
  <tr>
  <td class="mlabels-left">
      <table class="memname">
        <tr>
          <td class="memname">static <a class="el" href="StormPort_8h.html#abb452686968e48b67397da5f97445f5b">bool</a> BaseFile_GetSize </td>
          <td>(</td>
          <td class="paramtype"><a class="el" href="structTFileStream.html">TFileStream</a> *&#160;</td>
          <td class="paramname"><em>pStream</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype"><a class="el" href="StormPort_8h.html#abb9abb9ce956f1a9e5a4081ac40e5649">ULONGLONG</a> *&#160;</td>
          <td class="paramname"><em>pFileSize</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
  </td>
  <td class="mlabels-right">
<span class="mlabels"><span class="mlabel">static</span></span>  </td>
  </tr>
</table>
</div><div class="memdoc">

<p class="definition">Definition at line <a class="el" href="FileStream_8cpp_source.html#l00387">387</a> of file <a class="el" href="FileStream_8cpp_source.html">FileStream.cpp</a>.</p>
<div class="fragment"><div class="line"><span class="lineno">  388</span>{</div>
<div class="line"><span class="lineno">  389</span>    <span class="comment">// Note: Used by all thre base providers.</span></div>
<div class="line"><span class="lineno">  390</span>    <span class="comment">// Requires the TBaseData union to have the same layout for all three base providers</span></div>
<div class="line"><span class="lineno">  391</span>    *pFileSize = pStream-&gt;<a class="code hl_variable" href="structTFileStream.html#a3428b5a1e790560349940aa04e37e580">Base</a>.<a class="code hl_variable" href="unionTBaseProviderData.html#a60536cc70eff3072cd6c371a99bdf325">File</a>.<a class="code hl_variable" href="unionTBaseProviderData.html#ad644c7067435cf51727186729b970d55">FileSize</a>;</div>
<div class="line"><span class="lineno">  392</span>    <span class="keywordflow">return</span> <span class="keyword">true</span>;</div>
<div class="line"><span class="lineno">  393</span>}</div>
</div><!-- fragment --><div class="dynheader">
Here is the caller graph for this function:</div>
<div class="dyncontent">
<div class="center"><iframe scrolling="no" frameborder="0" src="FileStream_8cpp_a55e7d166af5374820da7c39a63eabb78_icgraph.svg" width="304" height="135"><p><b>This browser is not able to show SVG: try Firefox, Chrome, Safari, or Opera instead.</b></p></iframe></div>
</div>

</div>
</div>
<a id="a9637c2e0c115380fbdfc33e19891d73b" name="a9637c2e0c115380fbdfc33e19891d73b"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a9637c2e0c115380fbdfc33e19891d73b">&#9670;&#160;</a></span>BaseFile_Init()</h2>

<div class="memitem">
<div class="memproto">
<table class="mlabels">
  <tr>
  <td class="mlabels-left">
      <table class="memname">
        <tr>
          <td class="memname">static void BaseFile_Init </td>
          <td>(</td>
          <td class="paramtype"><a class="el" href="structTFileStream.html">TFileStream</a> *&#160;</td>
          <td class="paramname"><em>pStream</em></td><td>)</td>
          <td></td>
        </tr>
      </table>
  </td>
  <td class="mlabels-right">
<span class="mlabels"><span class="mlabel">static</span></span>  </td>
  </tr>
</table>
</div><div class="memdoc">

<p class="definition">Definition at line <a class="el" href="FileStream_8cpp_source.html#l00446">446</a> of file <a class="el" href="FileStream_8cpp_source.html">FileStream.cpp</a>.</p>
<div class="fragment"><div class="line"><span class="lineno">  447</span>{</div>
<div class="line"><span class="lineno">  448</span>    pStream-&gt;<a class="code hl_variable" href="structTFileStream.html#a1082d451ef30de1e906bc3a4d26d8d65">BaseCreate</a>  = <a class="code hl_function" href="FileStream_8cpp.html#a1fcabccfb3e06e3d9aaa6c20bbbf35b1">BaseFile_Create</a>;</div>
<div class="line"><span class="lineno">  449</span>    pStream-&gt;<a class="code hl_variable" href="structTFileStream.html#a82013f6bc9d5e52d1efe42b0dc464d4c">BaseOpen</a>    = <a class="code hl_function" href="FileStream_8cpp.html#a2065e645a0a5e3202253dda12bb14063">BaseFile_Open</a>;</div>
<div class="line"><span class="lineno">  450</span>    pStream-&gt;<a class="code hl_variable" href="structTFileStream.html#a5b6aa0a4b5d6b97770f73fbc47412da1">BaseRead</a>    = <a class="code hl_function" href="FileStream_8cpp.html#a3bcd1cfbdaa107dee9e5e2c4489028c6">BaseFile_Read</a>;</div>
<div class="line"><span class="lineno">  451</span>    pStream-&gt;<a class="code hl_variable" href="structTFileStream.html#a811c9b3d565324e51361768847fe50a8">BaseWrite</a>   = <a class="code hl_function" href="FileStream_8cpp.html#adf9b2fa5508bed570c9aaf61f6925844">BaseFile_Write</a>;</div>
<div class="line"><span class="lineno">  452</span>    pStream-&gt;<a class="code hl_variable" href="structTFileStream.html#a00a7a9d0ce7cdea1c4ecdbd72a3bd282">BaseResize</a>  = <a class="code hl_function" href="FileStream_8cpp.html#ae004fa7bac8a8c891eec3b183701efb6">BaseFile_Resize</a>;</div>
<div class="line"><span class="lineno">  453</span>    pStream-&gt;<a class="code hl_variable" href="structTFileStream.html#a0366f518ffecab4131bf2527f22964e3">BaseGetSize</a> = <a class="code hl_function" href="FileStream_8cpp.html#a55e7d166af5374820da7c39a63eabb78">BaseFile_GetSize</a>;</div>
<div class="line"><span class="lineno">  454</span>    pStream-&gt;<a class="code hl_variable" href="structTFileStream.html#aa9c8095dd8a2e07b83611e0b5dac3fde">BaseGetPos</a>  = <a class="code hl_function" href="FileStream_8cpp.html#a83df9c1c4278b431d59568a3ae4dc39f">BaseFile_GetPos</a>;</div>
<div class="line"><span class="lineno">  455</span>    pStream-&gt;<a class="code hl_variable" href="structTFileStream.html#acbdc7dfef3127e4c077310381f8f6c7d">BaseClose</a>   = <a class="code hl_function" href="FileStream_8cpp.html#ae44b926c84d51b8bf1e58ee562bad8c4">BaseFile_Close</a>;</div>
<div class="line"><span class="lineno">  456</span>}</div>
<div class="ttc" id="aFileStream_8cpp_html_a1fcabccfb3e06e3d9aaa6c20bbbf35b1"><div class="ttname"><a href="FileStream_8cpp.html#a1fcabccfb3e06e3d9aaa6c20bbbf35b1">BaseFile_Create</a></div><div class="ttdeci">static bool BaseFile_Create(TFileStream *pStream)</div><div class="ttdef"><b>Definition</b> <a href="FileStream_8cpp_source.html#l00095">FileStream.cpp:95</a></div></div>
<div class="ttc" id="aFileStream_8cpp_html_a2065e645a0a5e3202253dda12bb14063"><div class="ttname"><a href="FileStream_8cpp.html#a2065e645a0a5e3202253dda12bb14063">BaseFile_Open</a></div><div class="ttdeci">static bool BaseFile_Open(TFileStream *pStream, const TCHAR *szFileName, DWORD dwStreamFlags)</div><div class="ttdef"><b>Definition</b> <a href="FileStream_8cpp_source.html#l00135">FileStream.cpp:135</a></div></div>
<div class="ttc" id="aFileStream_8cpp_html_a3bcd1cfbdaa107dee9e5e2c4489028c6"><div class="ttname"><a href="FileStream_8cpp.html#a3bcd1cfbdaa107dee9e5e2c4489028c6">BaseFile_Read</a></div><div class="ttdeci">static bool BaseFile_Read(TFileStream *pStream, ULONGLONG *pByteOffset, void *pvBuffer, DWORD dwBytesToRead)</div><div class="ttdef"><b>Definition</b> <a href="FileStream_8cpp_source.html#l00201">FileStream.cpp:201</a></div></div>
<div class="ttc" id="aFileStream_8cpp_html_a55e7d166af5374820da7c39a63eabb78"><div class="ttname"><a href="FileStream_8cpp.html#a55e7d166af5374820da7c39a63eabb78">BaseFile_GetSize</a></div><div class="ttdeci">static bool BaseFile_GetSize(TFileStream *pStream, ULONGLONG *pFileSize)</div><div class="ttdef"><b>Definition</b> <a href="FileStream_8cpp_source.html#l00387">FileStream.cpp:387</a></div></div>
<div class="ttc" id="aFileStream_8cpp_html_a83df9c1c4278b431d59568a3ae4dc39f"><div class="ttname"><a href="FileStream_8cpp.html#a83df9c1c4278b431d59568a3ae4dc39f">BaseFile_GetPos</a></div><div class="ttdeci">static bool BaseFile_GetPos(TFileStream *pStream, ULONGLONG *pByteOffset)</div><div class="ttdef"><b>Definition</b> <a href="FileStream_8cpp_source.html#l00396">FileStream.cpp:396</a></div></div>
<div class="ttc" id="aFileStream_8cpp_html_adf9b2fa5508bed570c9aaf61f6925844"><div class="ttname"><a href="FileStream_8cpp.html#adf9b2fa5508bed570c9aaf61f6925844">BaseFile_Write</a></div><div class="ttdeci">static bool BaseFile_Write(TFileStream *pStream, ULONGLONG *pByteOffset, const void *pvBuffer, DWORD dwBytesToWrite)</div><div class="ttdef"><b>Definition</b> <a href="FileStream_8cpp_source.html#l00276">FileStream.cpp:276</a></div></div>
<div class="ttc" id="aFileStream_8cpp_html_ae004fa7bac8a8c891eec3b183701efb6"><div class="ttname"><a href="FileStream_8cpp.html#ae004fa7bac8a8c891eec3b183701efb6">BaseFile_Resize</a></div><div class="ttdeci">static bool BaseFile_Resize(TFileStream *pStream, ULONGLONG NewFileSize)</div><div class="ttdef"><b>Definition</b> <a href="FileStream_8cpp_source.html#l00345">FileStream.cpp:345</a></div></div>
<div class="ttc" id="aFileStream_8cpp_html_ae44b926c84d51b8bf1e58ee562bad8c4"><div class="ttname"><a href="FileStream_8cpp.html#ae44b926c84d51b8bf1e58ee562bad8c4">BaseFile_Close</a></div><div class="ttdeci">static void BaseFile_Close(TFileStream *pStream)</div><div class="ttdef"><b>Definition</b> <a href="FileStream_8cpp_source.html#l00428">FileStream.cpp:428</a></div></div>
<div class="ttc" id="astructTFileStream_html_a00a7a9d0ce7cdea1c4ecdbd72a3bd282"><div class="ttname"><a href="structTFileStream.html#a00a7a9d0ce7cdea1c4ecdbd72a3bd282">TFileStream::BaseResize</a></div><div class="ttdeci">STREAM_RESIZE BaseResize</div><div class="ttdef"><b>Definition</b> <a href="FileStream_8h_source.html#l00172">FileStream.h:172</a></div></div>
<div class="ttc" id="astructTFileStream_html_a0366f518ffecab4131bf2527f22964e3"><div class="ttname"><a href="structTFileStream.html#a0366f518ffecab4131bf2527f22964e3">TFileStream::BaseGetSize</a></div><div class="ttdeci">STREAM_GETSIZE BaseGetSize</div><div class="ttdef"><b>Definition</b> <a href="FileStream_8h_source.html#l00173">FileStream.h:173</a></div></div>
<div class="ttc" id="astructTFileStream_html_a1082d451ef30de1e906bc3a4d26d8d65"><div class="ttname"><a href="structTFileStream.html#a1082d451ef30de1e906bc3a4d26d8d65">TFileStream::BaseCreate</a></div><div class="ttdeci">STREAM_CREATE BaseCreate</div><div class="ttdef"><b>Definition</b> <a href="FileStream_8h_source.html#l00168">FileStream.h:168</a></div></div>
<div class="ttc" id="astructTFileStream_html_a5b6aa0a4b5d6b97770f73fbc47412da1"><div class="ttname"><a href="structTFileStream.html#a5b6aa0a4b5d6b97770f73fbc47412da1">TFileStream::BaseRead</a></div><div class="ttdeci">STREAM_READ BaseRead</div><div class="ttdef"><b>Definition</b> <a href="FileStream_8h_source.html#l00170">FileStream.h:170</a></div></div>
<div class="ttc" id="astructTFileStream_html_a811c9b3d565324e51361768847fe50a8"><div class="ttname"><a href="structTFileStream.html#a811c9b3d565324e51361768847fe50a8">TFileStream::BaseWrite</a></div><div class="ttdeci">STREAM_WRITE BaseWrite</div><div class="ttdef"><b>Definition</b> <a href="FileStream_8h_source.html#l00171">FileStream.h:171</a></div></div>
<div class="ttc" id="astructTFileStream_html_a82013f6bc9d5e52d1efe42b0dc464d4c"><div class="ttname"><a href="structTFileStream.html#a82013f6bc9d5e52d1efe42b0dc464d4c">TFileStream::BaseOpen</a></div><div class="ttdeci">STREAM_OPEN BaseOpen</div><div class="ttdef"><b>Definition</b> <a href="FileStream_8h_source.html#l00169">FileStream.h:169</a></div></div>
<div class="ttc" id="astructTFileStream_html_aa9c8095dd8a2e07b83611e0b5dac3fde"><div class="ttname"><a href="structTFileStream.html#aa9c8095dd8a2e07b83611e0b5dac3fde">TFileStream::BaseGetPos</a></div><div class="ttdeci">STREAM_GETPOS BaseGetPos</div><div class="ttdef"><b>Definition</b> <a href="FileStream_8h_source.html#l00174">FileStream.h:174</a></div></div>
<div class="ttc" id="astructTFileStream_html_acbdc7dfef3127e4c077310381f8f6c7d"><div class="ttname"><a href="structTFileStream.html#acbdc7dfef3127e4c077310381f8f6c7d">TFileStream::BaseClose</a></div><div class="ttdeci">STREAM_CLOSE BaseClose</div><div class="ttdef"><b>Definition</b> <a href="FileStream_8h_source.html#l00175">FileStream.h:175</a></div></div>
</div><!-- fragment --><div class="dynheader">
Here is the call graph for this function:</div>
<div class="dyncontent">
<div class="center"><iframe scrolling="no" frameborder="0" src="FileStream_8cpp_a9637c2e0c115380fbdfc33e19891d73b_cgraph.svg" width="615" height="431"><p><b>This browser is not able to show SVG: try Firefox, Chrome, Safari, or Opera instead.</b></p></iframe></div>
</div>

</div>
</div>
<a id="a2065e645a0a5e3202253dda12bb14063" name="a2065e645a0a5e3202253dda12bb14063"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a2065e645a0a5e3202253dda12bb14063">&#9670;&#160;</a></span>BaseFile_Open()</h2>

<div class="memitem">
<div class="memproto">
<table class="mlabels">
  <tr>
  <td class="mlabels-left">
      <table class="memname">
        <tr>
          <td class="memname">static <a class="el" href="StormPort_8h.html#abb452686968e48b67397da5f97445f5b">bool</a> BaseFile_Open </td>
          <td>(</td>
          <td class="paramtype"><a class="el" href="structTFileStream.html">TFileStream</a> *&#160;</td>
          <td class="paramname"><em>pStream</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype"><a class="el" href="StormLib_2src_2zlib_2zconf_8h.html#a2c212835823e3c54a8ab6d95c652660e">const</a> <a class="el" href="StormPort_8h.html#a03bdb8ce5895c7e261aadc2529637546">TCHAR</a> *&#160;</td>
          <td class="paramname"><em>szFileName</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype"><a class="el" href="StormPort_8h.html#a798af1e30bc65f319c1a246cecf59e39">DWORD</a>&#160;</td>
          <td class="paramname"><em>dwStreamFlags</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
  </td>
  <td class="mlabels-right">
<span class="mlabels"><span class="mlabel">static</span></span>  </td>
  </tr>
</table>
</div><div class="memdoc">

<p class="definition">Definition at line <a class="el" href="FileStream_8cpp_source.html#l00135">135</a> of file <a class="el" href="FileStream_8cpp_source.html">FileStream.cpp</a>.</p>
<div class="fragment"><div class="line"><span class="lineno">  136</span>{</div>
<div class="line"><span class="lineno">  137</span><span class="preprocessor">#ifdef STORMLIB_WINDOWS</span></div>
<div class="line"><span class="lineno">  138</span>    {</div>
<div class="line"><span class="lineno">  139</span>        ULARGE_INTEGER FileSize;</div>
<div class="line"><span class="lineno">  140</span>        <a class="code hl_typedef" href="StormPort_8h.html#a798af1e30bc65f319c1a246cecf59e39">DWORD</a> dwWriteAccess = (dwStreamFlags &amp; <a class="code hl_define" href="StormLib_8h.html#abdbbf06488f24699775afe6aadaeafc3">STREAM_FLAG_READ_ONLY</a>) ? 0 : FILE_WRITE_DATA | FILE_APPEND_DATA | FILE_WRITE_ATTRIBUTES;</div>
<div class="line"><span class="lineno">  141</span>        <a class="code hl_typedef" href="StormPort_8h.html#a798af1e30bc65f319c1a246cecf59e39">DWORD</a> dwWriteShare = (dwStreamFlags &amp; <a class="code hl_define" href="StormLib_8h.html#a70f64cc8946e34d88ab1c2de9d76ba4c">STREAM_FLAG_WRITE_SHARE</a>) ? FILE_SHARE_WRITE : 0;</div>
<div class="line"><span class="lineno">  142</span> </div>
<div class="line"><span class="lineno">  143</span>        <span class="comment">// Open the file</span></div>
<div class="line"><span class="lineno">  144</span>        pStream-&gt;<a class="code hl_variable" href="structTFileStream.html#a3428b5a1e790560349940aa04e37e580">Base</a>.<a class="code hl_variable" href="unionTBaseProviderData.html#a60536cc70eff3072cd6c371a99bdf325">File</a>.<a class="code hl_variable" href="unionTBaseProviderData.html#a3ca5c9e4601dd22216f7ef85f4d6f64d">hFile</a> = CreateFile(szFileName,</div>
<div class="line"><span class="lineno">  145</span>                                              FILE_READ_DATA | FILE_READ_ATTRIBUTES | dwWriteAccess,</div>
<div class="line"><span class="lineno">  146</span>                                              FILE_SHARE_READ | dwWriteShare,</div>
<div class="line"><span class="lineno">  147</span>                                              NULL,</div>
<div class="line"><span class="lineno">  148</span>                                              OPEN_EXISTING,</div>
<div class="line"><span class="lineno">  149</span>                                              0,</div>
<div class="line"><span class="lineno">  150</span>                                              NULL);</div>
<div class="line"><span class="lineno">  151</span>        <span class="keywordflow">if</span>(pStream-&gt;<a class="code hl_variable" href="structTFileStream.html#a3428b5a1e790560349940aa04e37e580">Base</a>.<a class="code hl_variable" href="unionTBaseProviderData.html#a60536cc70eff3072cd6c371a99bdf325">File</a>.<a class="code hl_variable" href="unionTBaseProviderData.html#a3ca5c9e4601dd22216f7ef85f4d6f64d">hFile</a> == <a class="code hl_define" href="FileStream_8cpp.html#a5fdc7facea201bfce4ad308105f88d0c">INVALID_HANDLE_VALUE</a>)</div>
<div class="line"><span class="lineno">  152</span>            <span class="keywordflow">return</span> <span class="keyword">false</span>;</div>
<div class="line"><span class="lineno">  153</span> </div>
<div class="line"><span class="lineno">  154</span>        <span class="comment">// Query the file size</span></div>
<div class="line"><span class="lineno">  155</span>        FileSize.LowPart = <a class="code hl_function" href="storm_8cpp.html#a73746c1c75c90ae66df94ed4b6933f3d">GetFileSize</a>(pStream-&gt;<a class="code hl_variable" href="structTFileStream.html#a3428b5a1e790560349940aa04e37e580">Base</a>.<a class="code hl_variable" href="unionTBaseProviderData.html#a60536cc70eff3072cd6c371a99bdf325">File</a>.<a class="code hl_variable" href="unionTBaseProviderData.html#a3ca5c9e4601dd22216f7ef85f4d6f64d">hFile</a>, &amp;FileSize.HighPart);</div>
<div class="line"><span class="lineno">  156</span>        pStream-&gt;<a class="code hl_variable" href="structTFileStream.html#a3428b5a1e790560349940aa04e37e580">Base</a>.<a class="code hl_variable" href="unionTBaseProviderData.html#a60536cc70eff3072cd6c371a99bdf325">File</a>.<a class="code hl_variable" href="unionTBaseProviderData.html#ad644c7067435cf51727186729b970d55">FileSize</a> = FileSize.QuadPart;</div>
<div class="line"><span class="lineno">  157</span> </div>
<div class="line"><span class="lineno">  158</span>        <span class="comment">// Query last write time</span></div>
<div class="line"><span class="lineno">  159</span>        GetFileTime(pStream-&gt;<a class="code hl_variable" href="structTFileStream.html#a3428b5a1e790560349940aa04e37e580">Base</a>.<a class="code hl_variable" href="unionTBaseProviderData.html#a60536cc70eff3072cd6c371a99bdf325">File</a>.<a class="code hl_variable" href="unionTBaseProviderData.html#a3ca5c9e4601dd22216f7ef85f4d6f64d">hFile</a>, NULL, NULL, (LPFILETIME)&amp;pStream-&gt;<a class="code hl_variable" href="structTFileStream.html#a3428b5a1e790560349940aa04e37e580">Base</a>.<a class="code hl_variable" href="unionTBaseProviderData.html#a60536cc70eff3072cd6c371a99bdf325">File</a>.<a class="code hl_variable" href="unionTBaseProviderData.html#a5488a6d2334bab001fbdd9e2ae2cdb00">FileTime</a>);</div>
<div class="line"><span class="lineno">  160</span>    }</div>
<div class="line"><span class="lineno">  161</span><span class="preprocessor">#endif</span></div>
<div class="line"><span class="lineno">  162</span> </div>
<div class="line"><span class="lineno">  163</span><span class="preprocessor">#if defined(STORMLIB_MAC) || defined(STORMLIB_LINUX)</span></div>
<div class="line"><span class="lineno">  164</span>    {</div>
<div class="line"><span class="lineno">  165</span>        <span class="keyword">struct </span>stat64 fileinfo;</div>
<div class="line"><span class="lineno">  166</span>        <span class="keywordtype">int</span> oflag = (dwStreamFlags &amp; <a class="code hl_define" href="StormLib_8h.html#abdbbf06488f24699775afe6aadaeafc3">STREAM_FLAG_READ_ONLY</a>) ? O_RDONLY : O_RDWR;</div>
<div class="line"><span class="lineno">  167</span>        <a class="code hl_typedef" href="winvs__stdint_8h.html#abd3131a20f4053d808d4277db3e39a23">intptr_t</a> handle;</div>
<div class="line"><span class="lineno">  168</span> </div>
<div class="line"><span class="lineno">  169</span>        <span class="comment">// Open the file</span></div>
<div class="line"><span class="lineno">  170</span>        handle = open(szFileName, oflag | O_LARGEFILE);</div>
<div class="line"><span class="lineno">  171</span>        <span class="keywordflow">if</span>(handle == -1)</div>
<div class="line"><span class="lineno">  172</span>        {</div>
<div class="line"><span class="lineno">  173</span>            pStream-&gt;<a class="code hl_variable" href="structTFileStream.html#a3428b5a1e790560349940aa04e37e580">Base</a>.<a class="code hl_variable" href="unionTBaseProviderData.html#a60536cc70eff3072cd6c371a99bdf325">File</a>.<a class="code hl_variable" href="unionTBaseProviderData.html#a3ca5c9e4601dd22216f7ef85f4d6f64d">hFile</a> = <a class="code hl_define" href="FileStream_8cpp.html#a5fdc7facea201bfce4ad308105f88d0c">INVALID_HANDLE_VALUE</a>;</div>
<div class="line"><span class="lineno">  174</span>            <a class="code hl_variable" href="FileStream_8cpp.html#ae1b34ad1b2653fcef5fac54d2fea9943">dwLastError</a> = errno;</div>
<div class="line"><span class="lineno">  175</span>            <span class="keywordflow">return</span> <span class="keyword">false</span>;</div>
<div class="line"><span class="lineno">  176</span>        }</div>
<div class="line"><span class="lineno">  177</span> </div>
<div class="line"><span class="lineno">  178</span>        <span class="comment">// Get the file size</span></div>
<div class="line"><span class="lineno">  179</span>        <span class="keywordflow">if</span>(fstat64(handle, &amp;fileinfo) == -1)</div>
<div class="line"><span class="lineno">  180</span>        {</div>
<div class="line"><span class="lineno">  181</span>            pStream-&gt;<a class="code hl_variable" href="structTFileStream.html#a3428b5a1e790560349940aa04e37e580">Base</a>.<a class="code hl_variable" href="unionTBaseProviderData.html#a60536cc70eff3072cd6c371a99bdf325">File</a>.<a class="code hl_variable" href="unionTBaseProviderData.html#a3ca5c9e4601dd22216f7ef85f4d6f64d">hFile</a> = <a class="code hl_define" href="FileStream_8cpp.html#a5fdc7facea201bfce4ad308105f88d0c">INVALID_HANDLE_VALUE</a>;</div>
<div class="line"><span class="lineno">  182</span>            <a class="code hl_variable" href="FileStream_8cpp.html#ae1b34ad1b2653fcef5fac54d2fea9943">dwLastError</a> = errno;</div>
<div class="line"><span class="lineno">  183</span>            close(handle);</div>
<div class="line"><span class="lineno">  184</span>            <span class="keywordflow">return</span> <span class="keyword">false</span>;</div>
<div class="line"><span class="lineno">  185</span>        }</div>
<div class="line"><span class="lineno">  186</span> </div>
<div class="line"><span class="lineno">  187</span>        <span class="comment">// time_t is number of seconds since 1.1.1970, UTC.</span></div>
<div class="line"><span class="lineno">  188</span>        <span class="comment">// 1 second = 10000000 (decimal) in FILETIME</span></div>
<div class="line"><span class="lineno">  189</span>        <span class="comment">// Set the start to 1.1.1970 00:00:00</span></div>
<div class="line"><span class="lineno">  190</span>        pStream-&gt;<a class="code hl_variable" href="structTFileStream.html#a3428b5a1e790560349940aa04e37e580">Base</a>.<a class="code hl_variable" href="unionTBaseProviderData.html#a60536cc70eff3072cd6c371a99bdf325">File</a>.<a class="code hl_variable" href="unionTBaseProviderData.html#a5488a6d2334bab001fbdd9e2ae2cdb00">FileTime</a> = 0x019DB1DED53E8000ULL + (10000000 * fileinfo.st_mtime);</div>
<div class="line"><span class="lineno">  191</span>        pStream-&gt;<a class="code hl_variable" href="structTFileStream.html#a3428b5a1e790560349940aa04e37e580">Base</a>.<a class="code hl_variable" href="unionTBaseProviderData.html#a60536cc70eff3072cd6c371a99bdf325">File</a>.<a class="code hl_variable" href="unionTBaseProviderData.html#ad644c7067435cf51727186729b970d55">FileSize</a> = (<a class="code hl_typedef" href="StormPort_8h.html#abb9abb9ce956f1a9e5a4081ac40e5649">ULONGLONG</a>)fileinfo.st_size;</div>
<div class="line"><span class="lineno">  192</span>        pStream-&gt;<a class="code hl_variable" href="structTFileStream.html#a3428b5a1e790560349940aa04e37e580">Base</a>.<a class="code hl_variable" href="unionTBaseProviderData.html#a60536cc70eff3072cd6c371a99bdf325">File</a>.<a class="code hl_variable" href="unionTBaseProviderData.html#a3ca5c9e4601dd22216f7ef85f4d6f64d">hFile</a> = (<a class="code hl_typedef" href="StormPort_8h.html#aa8c0374618b33785ccb02f74bcfebc46">HANDLE</a>)handle;</div>
<div class="line"><span class="lineno">  193</span>    }</div>
<div class="line"><span class="lineno">  194</span><span class="preprocessor">#endif</span></div>
<div class="line"><span class="lineno">  195</span> </div>
<div class="line"><span class="lineno">  196</span>    <span class="comment">// Reset the file position</span></div>
<div class="line"><span class="lineno">  197</span>    pStream-&gt;<a class="code hl_variable" href="structTFileStream.html#a3428b5a1e790560349940aa04e37e580">Base</a>.<a class="code hl_variable" href="unionTBaseProviderData.html#a60536cc70eff3072cd6c371a99bdf325">File</a>.<a class="code hl_variable" href="unionTBaseProviderData.html#ac625a3e6bcdc60e1cd5d1bb7ed062028">FilePos</a> = 0;</div>
<div class="line"><span class="lineno">  198</span>    <span class="keywordflow">return</span> <span class="keyword">true</span>;</div>
<div class="line"><span class="lineno">  199</span>}</div>
<div class="ttc" id="aStormPort_8h_html_abb9abb9ce956f1a9e5a4081ac40e5649"><div class="ttname"><a href="StormPort_8h.html#abb9abb9ce956f1a9e5a4081ac40e5649">ULONGLONG</a></div><div class="ttdeci">unsigned long long ULONGLONG</div><div class="ttdef"><b>Definition</b> <a href="StormPort_8h_source.html#l00341">StormPort.h:341</a></div></div>
<div class="ttc" id="astorm_8cpp_html_a73746c1c75c90ae66df94ed4b6933f3d"><div class="ttname"><a href="storm_8cpp.html#a73746c1c75c90ae66df94ed4b6933f3d">GetFileSize</a></div><div class="ttdeci">DWORD WINAPI SFILE() GetFileSize(HANDLE hFile, LPDWORD lpFileSizeHigh)</div><div class="ttdef"><b>Definition</b> <a href="storm_8cpp_source.html#l00053">storm.cpp:53</a></div></div>
<div class="ttc" id="aunionTBaseProviderData_html_a5488a6d2334bab001fbdd9e2ae2cdb00"><div class="ttname"><a href="unionTBaseProviderData.html#a5488a6d2334bab001fbdd9e2ae2cdb00">TBaseProviderData::FileTime</a></div><div class="ttdeci">ULONGLONG FileTime</div><div class="ttdef"><b>Definition</b> <a href="FileStream_8h_source.html#l00131">FileStream.h:131</a></div></div>
</div><!-- fragment --><div class="dynheader">
Here is the call graph for this function:</div>
<div class="dyncontent">
<div class="center"><iframe scrolling="no" frameborder="0" src="FileStream_8cpp_a2065e645a0a5e3202253dda12bb14063_cgraph.svg" width="422" height="36"><p><b>This browser is not able to show SVG: try Firefox, Chrome, Safari, or Opera instead.</b></p></iframe></div>
</div>
<div class="dynheader">
Here is the caller graph for this function:</div>
<div class="dyncontent">
<div class="center"><iframe scrolling="no" frameborder="0" src="FileStream_8cpp_a2065e645a0a5e3202253dda12bb14063_icgraph.svg" width="536" height="86"><p><b>This browser is not able to show SVG: try Firefox, Chrome, Safari, or Opera instead.</b></p></iframe></div>
</div>

</div>
</div>
<a id="a3bcd1cfbdaa107dee9e5e2c4489028c6" name="a3bcd1cfbdaa107dee9e5e2c4489028c6"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a3bcd1cfbdaa107dee9e5e2c4489028c6">&#9670;&#160;</a></span>BaseFile_Read()</h2>

<div class="memitem">
<div class="memproto">
<table class="mlabels">
  <tr>
  <td class="mlabels-left">
      <table class="memname">
        <tr>
          <td class="memname">static <a class="el" href="StormPort_8h.html#abb452686968e48b67397da5f97445f5b">bool</a> BaseFile_Read </td>
          <td>(</td>
          <td class="paramtype"><a class="el" href="structTFileStream.html">TFileStream</a> *&#160;</td>
          <td class="paramname"><em>pStream</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype"><a class="el" href="StormPort_8h.html#abb9abb9ce956f1a9e5a4081ac40e5649">ULONGLONG</a> *&#160;</td>
          <td class="paramname"><em>pByteOffset</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">void *&#160;</td>
          <td class="paramname"><em>pvBuffer</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype"><a class="el" href="StormPort_8h.html#a798af1e30bc65f319c1a246cecf59e39">DWORD</a>&#160;</td>
          <td class="paramname"><em>dwBytesToRead</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
  </td>
  <td class="mlabels-right">
<span class="mlabels"><span class="mlabel">static</span></span>  </td>
  </tr>
</table>
</div><div class="memdoc">

<p class="definition">Definition at line <a class="el" href="FileStream_8cpp_source.html#l00201">201</a> of file <a class="el" href="FileStream_8cpp_source.html">FileStream.cpp</a>.</p>
<div class="fragment"><div class="line"><span class="lineno">  206</span>{</div>
<div class="line"><span class="lineno">  207</span>    <a class="code hl_typedef" href="StormPort_8h.html#abb9abb9ce956f1a9e5a4081ac40e5649">ULONGLONG</a> ByteOffset = (pByteOffset != NULL) ? *pByteOffset : pStream-&gt;Base.File.FilePos;</div>
<div class="line"><span class="lineno">  208</span>    <a class="code hl_typedef" href="StormPort_8h.html#a798af1e30bc65f319c1a246cecf59e39">DWORD</a> dwBytesRead = 0;                  <span class="comment">// Must be set by platform-specific code</span></div>
<div class="line"><span class="lineno">  209</span> </div>
<div class="line"><span class="lineno">  210</span><span class="preprocessor">#ifdef STORMLIB_WINDOWS</span></div>
<div class="line"><span class="lineno">  211</span>    {</div>
<div class="line"><span class="lineno">  212</span>        <span class="comment">// Note: StormLib no longer supports Windows 9x.</span></div>
<div class="line"><span class="lineno">  213</span>        <span class="comment">// Thus, we can use the OVERLAPPED structure to specify</span></div>
<div class="line"><span class="lineno">  214</span>        <span class="comment">// file offset to read from file. This allows us to skip</span></div>
<div class="line"><span class="lineno">  215</span>        <span class="comment">// one system call to SetFilePointer</span></div>
<div class="line"><span class="lineno">  216</span> </div>
<div class="line"><span class="lineno">  217</span>        <span class="comment">// Update the byte offset</span></div>
<div class="line"><span class="lineno">  218</span>        pStream-&gt;<a class="code hl_variable" href="structTFileStream.html#a3428b5a1e790560349940aa04e37e580">Base</a>.<a class="code hl_variable" href="unionTBaseProviderData.html#a60536cc70eff3072cd6c371a99bdf325">File</a>.<a class="code hl_variable" href="unionTBaseProviderData.html#ac625a3e6bcdc60e1cd5d1bb7ed062028">FilePos</a> = ByteOffset;</div>
<div class="line"><span class="lineno">  219</span> </div>
<div class="line"><span class="lineno">  220</span>        <span class="comment">// Read the data</span></div>
<div class="line"><span class="lineno">  221</span>        <span class="keywordflow">if</span>(dwBytesToRead != 0)</div>
<div class="line"><span class="lineno">  222</span>        {</div>
<div class="line"><span class="lineno">  223</span>            OVERLAPPED Overlapped;</div>
<div class="line"><span class="lineno">  224</span> </div>
<div class="line"><span class="lineno">  225</span>            Overlapped.OffsetHigh = (<a class="code hl_typedef" href="StormPort_8h.html#a798af1e30bc65f319c1a246cecf59e39">DWORD</a>)(ByteOffset &gt;&gt; 32);</div>
<div class="line"><span class="lineno">  226</span>            Overlapped.Offset = (<a class="code hl_typedef" href="StormPort_8h.html#a798af1e30bc65f319c1a246cecf59e39">DWORD</a>)ByteOffset;</div>
<div class="line"><span class="lineno">  227</span>            Overlapped.hEvent = NULL;</div>
<div class="line"><span class="lineno">  228</span>            <span class="keywordflow">if</span>(!<a class="code hl_function" href="storm_8cpp.html#a0d007c8d5f37cbf41a0a6c4efb404963">ReadFile</a>(pStream-&gt;<a class="code hl_variable" href="structTFileStream.html#a3428b5a1e790560349940aa04e37e580">Base</a>.<a class="code hl_variable" href="unionTBaseProviderData.html#a60536cc70eff3072cd6c371a99bdf325">File</a>.<a class="code hl_variable" href="unionTBaseProviderData.html#a3ca5c9e4601dd22216f7ef85f4d6f64d">hFile</a>, pvBuffer, dwBytesToRead, &amp;dwBytesRead, &amp;Overlapped))</div>
<div class="line"><span class="lineno">  229</span>                <span class="keywordflow">return</span> <span class="keyword">false</span>;</div>
<div class="line"><span class="lineno">  230</span>        }</div>
<div class="line"><span class="lineno">  231</span>    }</div>
<div class="line"><span class="lineno">  232</span><span class="preprocessor">#endif</span></div>
<div class="line"><span class="lineno">  233</span> </div>
<div class="line"><span class="lineno">  234</span><span class="preprocessor">#if defined(STORMLIB_MAC) || defined(STORMLIB_LINUX)</span></div>
<div class="line"><span class="lineno">  235</span>    {</div>
<div class="line"><span class="lineno">  236</span>        ssize_t bytes_read;</div>
<div class="line"><span class="lineno">  237</span> </div>
<div class="line"><span class="lineno">  238</span>        <span class="comment">// If the byte offset is different from the current file position,</span></div>
<div class="line"><span class="lineno">  239</span>        <span class="comment">// we have to update the file position   xxx</span></div>
<div class="line"><span class="lineno">  240</span>        <span class="keywordflow">if</span>(ByteOffset != pStream-&gt;<a class="code hl_variable" href="structTFileStream.html#a3428b5a1e790560349940aa04e37e580">Base</a>.<a class="code hl_variable" href="unionTBaseProviderData.html#a60536cc70eff3072cd6c371a99bdf325">File</a>.<a class="code hl_variable" href="unionTBaseProviderData.html#ac625a3e6bcdc60e1cd5d1bb7ed062028">FilePos</a>)</div>
<div class="line"><span class="lineno">  241</span>        {</div>
<div class="line"><span class="lineno">  242</span>            lseek64((<a class="code hl_typedef" href="winvs__stdint_8h.html#abd3131a20f4053d808d4277db3e39a23">intptr_t</a>)pStream-&gt;<a class="code hl_variable" href="structTFileStream.html#a3428b5a1e790560349940aa04e37e580">Base</a>.<a class="code hl_variable" href="unionTBaseProviderData.html#a60536cc70eff3072cd6c371a99bdf325">File</a>.<a class="code hl_variable" href="unionTBaseProviderData.html#a3ca5c9e4601dd22216f7ef85f4d6f64d">hFile</a>, (off64_t)(ByteOffset), <a class="code hl_define" href="StormLib_2src_2zlib_2zconf_8h.html#a0d112bae8fd35be772185b6ec6bcbe64">SEEK_SET</a>);</div>
<div class="line"><span class="lineno">  243</span>            pStream-&gt;<a class="code hl_variable" href="structTFileStream.html#a3428b5a1e790560349940aa04e37e580">Base</a>.<a class="code hl_variable" href="unionTBaseProviderData.html#a60536cc70eff3072cd6c371a99bdf325">File</a>.<a class="code hl_variable" href="unionTBaseProviderData.html#ac625a3e6bcdc60e1cd5d1bb7ed062028">FilePos</a> = ByteOffset;</div>
<div class="line"><span class="lineno">  244</span>        }</div>
<div class="line"><span class="lineno">  245</span> </div>
<div class="line"><span class="lineno">  246</span>        <span class="comment">// Perform the read operation</span></div>
<div class="line"><span class="lineno">  247</span>        <span class="keywordflow">if</span>(dwBytesToRead != 0)</div>
<div class="line"><span class="lineno">  248</span>        {</div>
<div class="line"><span class="lineno">  249</span>            bytes_read = read((<a class="code hl_typedef" href="winvs__stdint_8h.html#abd3131a20f4053d808d4277db3e39a23">intptr_t</a>)pStream-&gt;<a class="code hl_variable" href="structTFileStream.html#a3428b5a1e790560349940aa04e37e580">Base</a>.<a class="code hl_variable" href="unionTBaseProviderData.html#a60536cc70eff3072cd6c371a99bdf325">File</a>.<a class="code hl_variable" href="unionTBaseProviderData.html#a3ca5c9e4601dd22216f7ef85f4d6f64d">hFile</a>, pvBuffer, (<span class="keywordtype">size_t</span>)dwBytesToRead);</div>
<div class="line"><span class="lineno">  250</span>            <span class="keywordflow">if</span>(bytes_read == -1)</div>
<div class="line"><span class="lineno">  251</span>            {</div>
<div class="line"><span class="lineno">  252</span>                <a class="code hl_variable" href="FileStream_8cpp.html#ae1b34ad1b2653fcef5fac54d2fea9943">dwLastError</a> = errno;</div>
<div class="line"><span class="lineno">  253</span>                <span class="keywordflow">return</span> <span class="keyword">false</span>;</div>
<div class="line"><span class="lineno">  254</span>            }</div>
<div class="line"><span class="lineno">  255</span> </div>
<div class="line"><span class="lineno">  256</span>            dwBytesRead = (<a class="code hl_typedef" href="StormPort_8h.html#a798af1e30bc65f319c1a246cecf59e39">DWORD</a>)(<span class="keywordtype">size_t</span>)bytes_read;</div>
<div class="line"><span class="lineno">  257</span>        }</div>
<div class="line"><span class="lineno">  258</span>    }</div>
<div class="line"><span class="lineno">  259</span><span class="preprocessor">#endif</span></div>
<div class="line"><span class="lineno">  260</span> </div>
<div class="line"><span class="lineno">  261</span>    <span class="comment">// Increment the current file position by number of bytes read</span></div>
<div class="line"><span class="lineno">  262</span>    <span class="comment">// If the number of bytes read doesn&#39;t match to required amount, return false</span></div>
<div class="line"><span class="lineno">  263</span>    pStream-&gt;<a class="code hl_variable" href="structTFileStream.html#a3428b5a1e790560349940aa04e37e580">Base</a>.<a class="code hl_variable" href="unionTBaseProviderData.html#a60536cc70eff3072cd6c371a99bdf325">File</a>.<a class="code hl_variable" href="unionTBaseProviderData.html#ac625a3e6bcdc60e1cd5d1bb7ed062028">FilePos</a> = ByteOffset + dwBytesRead;</div>
<div class="line"><span class="lineno">  264</span>    <span class="keywordflow">if</span>(dwBytesRead != dwBytesToRead)</div>
<div class="line"><span class="lineno">  265</span>        <a class="code hl_function" href="FileStream_8cpp.html#a65dd8d3e416ffbd6ac5f468c6bdccac9">SetLastError</a>(<a class="code hl_define" href="StormPort_8h.html#a71791529fd25c32cd91d6a716e5e1755">ERROR_HANDLE_EOF</a>);</div>
<div class="line"><span class="lineno">  266</span>    <span class="keywordflow">return</span> (dwBytesRead == dwBytesToRead);</div>
<div class="line"><span class="lineno">  267</span>}</div>
<div class="ttc" id="aStormLib_2src_2zlib_2zconf_8h_html_a0d112bae8fd35be772185b6ec6bcbe64"><div class="ttname"><a href="StormLib_2src_2zlib_2zconf_8h.html#a0d112bae8fd35be772185b6ec6bcbe64">SEEK_SET</a></div><div class="ttdeci">#define SEEK_SET</div><div class="ttdef"><b>Definition</b> <a href="StormLib_2src_2zlib_2zconf_8h_source.html#l00388">zconf.h:388</a></div></div>
<div class="ttc" id="aStormPort_8h_html_a71791529fd25c32cd91d6a716e5e1755"><div class="ttname"><a href="StormPort_8h.html#a71791529fd25c32cd91d6a716e5e1755">ERROR_HANDLE_EOF</a></div><div class="ttdeci">#define ERROR_HANDLE_EOF</div><div class="ttdef"><b>Definition</b> <a href="StormPort_8h_source.html#l00414">StormPort.h:414</a></div></div>
<div class="ttc" id="astorm_8cpp_html_a0d007c8d5f37cbf41a0a6c4efb404963"><div class="ttname"><a href="storm_8cpp.html#a0d007c8d5f37cbf41a0a6c4efb404963">ReadFile</a></div><div class="ttdeci">BOOL WINAPI SFILE() ReadFile(HANDLE hFile, LPVOID lpBuffer, DWORD nNumberOfBytesToRead, LPDWORD lpNumberOfBytesRead, LPOVERLAPPED lpOverlapped)</div><div class="ttdef"><b>Definition</b> <a href="storm_8cpp_source.html#l00077">storm.cpp:77</a></div></div>
</div><!-- fragment --><div class="dynheader">
Here is the call graph for this function:</div>
<div class="dyncontent">
<div class="center"><iframe scrolling="no" frameborder="0" src="FileStream_8cpp_a3bcd1cfbdaa107dee9e5e2c4489028c6_cgraph.svg" width="404" height="62"><p><b>This browser is not able to show SVG: try Firefox, Chrome, Safari, or Opera instead.</b></p></iframe></div>
</div>
<div class="dynheader">
Here is the caller graph for this function:</div>
<div class="dyncontent">
<div class="center"><iframe scrolling="no" frameborder="0" src="FileStream_8cpp_a3bcd1cfbdaa107dee9e5e2c4489028c6_icgraph.svg" width="282" height="36"><p><b>This browser is not able to show SVG: try Firefox, Chrome, Safari, or Opera instead.</b></p></iframe></div>
</div>

</div>
</div>
<a id="ab7eae20c598963167111f04222211b23" name="ab7eae20c598963167111f04222211b23"></a>
<h2 class="memtitle"><span class="permalink"><a href="#ab7eae20c598963167111f04222211b23">&#9670;&#160;</a></span>BaseFile_Replace()</h2>

<div class="memitem">
<div class="memproto">
<table class="mlabels">
  <tr>
  <td class="mlabels-left">
      <table class="memname">
        <tr>
          <td class="memname">static <a class="el" href="StormPort_8h.html#abb452686968e48b67397da5f97445f5b">bool</a> BaseFile_Replace </td>
          <td>(</td>
          <td class="paramtype"><a class="el" href="structTFileStream.html">TFileStream</a> *&#160;</td>
          <td class="paramname"><em>pStream</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype"><a class="el" href="structTFileStream.html">TFileStream</a> *&#160;</td>
          <td class="paramname"><em>pNewStream</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
  </td>
  <td class="mlabels-right">
<span class="mlabels"><span class="mlabel">static</span></span>  </td>
  </tr>
</table>
</div><div class="memdoc">

<p class="definition">Definition at line <a class="el" href="FileStream_8cpp_source.html#l00405">405</a> of file <a class="el" href="FileStream_8cpp_source.html">FileStream.cpp</a>.</p>
<div class="fragment"><div class="line"><span class="lineno">  406</span>{</div>
<div class="line"><span class="lineno">  407</span><span class="preprocessor">#ifdef STORMLIB_WINDOWS</span></div>
<div class="line"><span class="lineno">  408</span>    <span class="comment">// Delete the original stream file. Don&#39;t check the result value,</span></div>
<div class="line"><span class="lineno">  409</span>    <span class="comment">// because if the file doesn&#39;t exist, it would fail</span></div>
<div class="line"><span class="lineno">  410</span>    DeleteFile(pStream-&gt;<a class="code hl_variable" href="structTFileStream.html#a7a4da926d708d96cb47333973e705c76">szFileName</a>);</div>
<div class="line"><span class="lineno">  411</span> </div>
<div class="line"><span class="lineno">  412</span>    <span class="comment">// Rename the new file to the old stream&#39;s file</span></div>
<div class="line"><span class="lineno">  413</span>    <span class="keywordflow">return</span> (<span class="keywordtype">bool</span>)MoveFile(pNewStream-&gt;<a class="code hl_variable" href="structTFileStream.html#a7a4da926d708d96cb47333973e705c76">szFileName</a>, pStream-&gt;<a class="code hl_variable" href="structTFileStream.html#a7a4da926d708d96cb47333973e705c76">szFileName</a>);</div>
<div class="line"><span class="lineno">  414</span><span class="preprocessor">#endif</span></div>
<div class="line"><span class="lineno">  415</span> </div>
<div class="line"><span class="lineno">  416</span><span class="preprocessor">#if defined(STORMLIB_MAC) || defined(STORMLIB_LINUX)</span></div>
<div class="line"><span class="lineno">  417</span>    <span class="comment">// &quot;rename&quot; on Linux also works if the target file exists</span></div>
<div class="line"><span class="lineno">  418</span>    <span class="keywordflow">if</span>(rename(pNewStream-&gt;<a class="code hl_variable" href="structTFileStream.html#a7a4da926d708d96cb47333973e705c76">szFileName</a>, pStream-&gt;<a class="code hl_variable" href="structTFileStream.html#a7a4da926d708d96cb47333973e705c76">szFileName</a>) == -1)</div>
<div class="line"><span class="lineno">  419</span>    {</div>
<div class="line"><span class="lineno">  420</span>        <a class="code hl_variable" href="FileStream_8cpp.html#ae1b34ad1b2653fcef5fac54d2fea9943">dwLastError</a> = errno;</div>
<div class="line"><span class="lineno">  421</span>        <span class="keywordflow">return</span> <span class="keyword">false</span>;</div>
<div class="line"><span class="lineno">  422</span>    }</div>
<div class="line"><span class="lineno">  423</span> </div>
<div class="line"><span class="lineno">  424</span>    <span class="keywordflow">return</span> <span class="keyword">true</span>;</div>
<div class="line"><span class="lineno">  425</span><span class="preprocessor">#endif</span></div>
<div class="line"><span class="lineno">  426</span>}</div>
</div><!-- fragment --><div class="dynheader">
Here is the caller graph for this function:</div>
<div class="dyncontent">
<div class="center"><iframe scrolling="no" frameborder="0" src="FileStream_8cpp_ab7eae20c598963167111f04222211b23_icgraph.svg" width="554" height="36"><p><b>This browser is not able to show SVG: try Firefox, Chrome, Safari, or Opera instead.</b></p></iframe></div>
</div>

</div>
</div>
<a id="ae004fa7bac8a8c891eec3b183701efb6" name="ae004fa7bac8a8c891eec3b183701efb6"></a>
<h2 class="memtitle"><span class="permalink"><a href="#ae004fa7bac8a8c891eec3b183701efb6">&#9670;&#160;</a></span>BaseFile_Resize()</h2>

<div class="memitem">
<div class="memproto">
<table class="mlabels">
  <tr>
  <td class="mlabels-left">
      <table class="memname">
        <tr>
          <td class="memname">static <a class="el" href="StormPort_8h.html#abb452686968e48b67397da5f97445f5b">bool</a> BaseFile_Resize </td>
          <td>(</td>
          <td class="paramtype"><a class="el" href="structTFileStream.html">TFileStream</a> *&#160;</td>
          <td class="paramname"><em>pStream</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype"><a class="el" href="StormPort_8h.html#abb9abb9ce956f1a9e5a4081ac40e5649">ULONGLONG</a>&#160;</td>
          <td class="paramname"><em>NewFileSize</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
  </td>
  <td class="mlabels-right">
<span class="mlabels"><span class="mlabel">static</span></span>  </td>
  </tr>
</table>
</div><div class="memdoc">
<p><em>pStream</em> Pointer to an open stream <em>NewFileSize</em> New size of the file </p>

<p class="definition">Definition at line <a class="el" href="FileStream_8cpp_source.html#l00345">345</a> of file <a class="el" href="FileStream_8cpp_source.html">FileStream.cpp</a>.</p>
<div class="fragment"><div class="line"><span class="lineno">  346</span>{</div>
<div class="line"><span class="lineno">  347</span><span class="preprocessor">#ifdef STORMLIB_WINDOWS</span></div>
<div class="line"><span class="lineno">  348</span>    {</div>
<div class="line"><span class="lineno">  349</span>        <a class="code hl_typedef" href="StormPort_8h.html#a9154c0d0c21af4686624543215b4e5f2">LONG</a> FileSizeHi = (<a class="code hl_typedef" href="StormPort_8h.html#a9154c0d0c21af4686624543215b4e5f2">LONG</a>)(NewFileSize &gt;&gt; 32);</div>
<div class="line"><span class="lineno">  350</span>        <a class="code hl_typedef" href="StormPort_8h.html#a9154c0d0c21af4686624543215b4e5f2">LONG</a> FileSizeLo;</div>
<div class="line"><span class="lineno">  351</span>        <a class="code hl_typedef" href="StormPort_8h.html#a798af1e30bc65f319c1a246cecf59e39">DWORD</a> dwNewPos;</div>
<div class="line"><span class="lineno">  352</span>        <span class="keywordtype">bool</span> bResult;</div>
<div class="line"><span class="lineno">  353</span> </div>
<div class="line"><span class="lineno">  354</span>        <span class="comment">// Set the position at the new file size</span></div>
<div class="line"><span class="lineno">  355</span>        dwNewPos = <a class="code hl_function" href="storm_8cpp.html#a5efe0815e93bfc2df5a8a2c7f309173d">SetFilePointer</a>(pStream-&gt;<a class="code hl_variable" href="structTFileStream.html#a3428b5a1e790560349940aa04e37e580">Base</a>.<a class="code hl_variable" href="unionTBaseProviderData.html#a60536cc70eff3072cd6c371a99bdf325">File</a>.<a class="code hl_variable" href="unionTBaseProviderData.html#a3ca5c9e4601dd22216f7ef85f4d6f64d">hFile</a>, (<a class="code hl_typedef" href="StormPort_8h.html#a9154c0d0c21af4686624543215b4e5f2">LONG</a>)NewFileSize, &amp;FileSizeHi, <a class="code hl_define" href="StormPort_8h.html#a1b6a16ca70fb99d4c13aeae1e7283680">FILE_BEGIN</a>);</div>
<div class="line"><span class="lineno">  356</span>        <span class="keywordflow">if</span>(dwNewPos == INVALID_SET_FILE_POINTER &amp;&amp; <a class="code hl_function" href="FileStream_8cpp.html#ad0f1ed530318d4f8cecb3dfb53e15b0a">GetLastError</a>() != <a class="code hl_define" href="StormPort_8h.html#aea0ae801b7d25c979655a7eb20d034af">ERROR_SUCCESS</a>)</div>
<div class="line"><span class="lineno">  357</span>            <span class="keywordflow">return</span> <span class="keyword">false</span>;</div>
<div class="line"><span class="lineno">  358</span> </div>
<div class="line"><span class="lineno">  359</span>        <span class="comment">// Set the current file pointer as the end of the file</span></div>
<div class="line"><span class="lineno">  360</span>        bResult = (<a class="code hl_define" href="StormPort_8h.html#abb452686968e48b67397da5f97445f5b">bool</a>)SetEndOfFile(pStream-&gt;<a class="code hl_variable" href="structTFileStream.html#a3428b5a1e790560349940aa04e37e580">Base</a>.<a class="code hl_variable" href="unionTBaseProviderData.html#a60536cc70eff3072cd6c371a99bdf325">File</a>.<a class="code hl_variable" href="unionTBaseProviderData.html#a3ca5c9e4601dd22216f7ef85f4d6f64d">hFile</a>);</div>
<div class="line"><span class="lineno">  361</span>        <span class="keywordflow">if</span>(bResult)</div>
<div class="line"><span class="lineno">  362</span>            pStream-&gt;<a class="code hl_variable" href="structTFileStream.html#a3428b5a1e790560349940aa04e37e580">Base</a>.<a class="code hl_variable" href="unionTBaseProviderData.html#a60536cc70eff3072cd6c371a99bdf325">File</a>.<a class="code hl_variable" href="unionTBaseProviderData.html#ad644c7067435cf51727186729b970d55">FileSize</a> = NewFileSize;</div>
<div class="line"><span class="lineno">  363</span> </div>
<div class="line"><span class="lineno">  364</span>        <span class="comment">// Restore the file position</span></div>
<div class="line"><span class="lineno">  365</span>        FileSizeHi = (<a class="code hl_typedef" href="StormPort_8h.html#a9154c0d0c21af4686624543215b4e5f2">LONG</a>)(pStream-&gt;<a class="code hl_variable" href="structTFileStream.html#a3428b5a1e790560349940aa04e37e580">Base</a>.<a class="code hl_variable" href="unionTBaseProviderData.html#a60536cc70eff3072cd6c371a99bdf325">File</a>.<a class="code hl_variable" href="unionTBaseProviderData.html#ac625a3e6bcdc60e1cd5d1bb7ed062028">FilePos</a> &gt;&gt; 32);</div>
<div class="line"><span class="lineno">  366</span>        FileSizeLo = (<a class="code hl_typedef" href="StormPort_8h.html#a9154c0d0c21af4686624543215b4e5f2">LONG</a>)(pStream-&gt;<a class="code hl_variable" href="structTFileStream.html#a3428b5a1e790560349940aa04e37e580">Base</a>.<a class="code hl_variable" href="unionTBaseProviderData.html#a60536cc70eff3072cd6c371a99bdf325">File</a>.<a class="code hl_variable" href="unionTBaseProviderData.html#ac625a3e6bcdc60e1cd5d1bb7ed062028">FilePos</a>);</div>
<div class="line"><span class="lineno">  367</span>        <a class="code hl_function" href="storm_8cpp.html#a5efe0815e93bfc2df5a8a2c7f309173d">SetFilePointer</a>(pStream-&gt;<a class="code hl_variable" href="structTFileStream.html#a3428b5a1e790560349940aa04e37e580">Base</a>.<a class="code hl_variable" href="unionTBaseProviderData.html#a60536cc70eff3072cd6c371a99bdf325">File</a>.<a class="code hl_variable" href="unionTBaseProviderData.html#a3ca5c9e4601dd22216f7ef85f4d6f64d">hFile</a>, FileSizeLo, &amp;FileSizeHi, <a class="code hl_define" href="StormPort_8h.html#a1b6a16ca70fb99d4c13aeae1e7283680">FILE_BEGIN</a>);</div>
<div class="line"><span class="lineno">  368</span>        <span class="keywordflow">return</span> bResult;</div>
<div class="line"><span class="lineno">  369</span>    }</div>
<div class="line"><span class="lineno">  370</span><span class="preprocessor">#endif</span></div>
<div class="line"><span class="lineno">  371</span> </div>
<div class="line"><span class="lineno">  372</span><span class="preprocessor">#if defined(STORMLIB_MAC) || defined(STORMLIB_LINUX)</span></div>
<div class="line"><span class="lineno">  373</span>    {</div>
<div class="line"><span class="lineno">  374</span>        <span class="keywordflow">if</span>(ftruncate64((<a class="code hl_typedef" href="winvs__stdint_8h.html#abd3131a20f4053d808d4277db3e39a23">intptr_t</a>)pStream-&gt;<a class="code hl_variable" href="structTFileStream.html#a3428b5a1e790560349940aa04e37e580">Base</a>.<a class="code hl_variable" href="unionTBaseProviderData.html#a60536cc70eff3072cd6c371a99bdf325">File</a>.<a class="code hl_variable" href="unionTBaseProviderData.html#a3ca5c9e4601dd22216f7ef85f4d6f64d">hFile</a>, (off64_t)NewFileSize) == -1)</div>
<div class="line"><span class="lineno">  375</span>        {</div>
<div class="line"><span class="lineno">  376</span>            <a class="code hl_variable" href="FileStream_8cpp.html#ae1b34ad1b2653fcef5fac54d2fea9943">dwLastError</a> = errno;</div>
<div class="line"><span class="lineno">  377</span>            <span class="keywordflow">return</span> <span class="keyword">false</span>;</div>
<div class="line"><span class="lineno">  378</span>        }</div>
<div class="line"><span class="lineno">  379</span> </div>
<div class="line"><span class="lineno">  380</span>        pStream-&gt;<a class="code hl_variable" href="structTFileStream.html#a3428b5a1e790560349940aa04e37e580">Base</a>.<a class="code hl_variable" href="unionTBaseProviderData.html#a60536cc70eff3072cd6c371a99bdf325">File</a>.<a class="code hl_variable" href="unionTBaseProviderData.html#ad644c7067435cf51727186729b970d55">FileSize</a> = NewFileSize;</div>
<div class="line"><span class="lineno">  381</span>        <span class="keywordflow">return</span> <span class="keyword">true</span>;</div>
<div class="line"><span class="lineno">  382</span>    }</div>
<div class="line"><span class="lineno">  383</span><span class="preprocessor">#endif</span></div>
<div class="line"><span class="lineno">  384</span>}</div>
<div class="ttc" id="aFileStream_8cpp_html_ad0f1ed530318d4f8cecb3dfb53e15b0a"><div class="ttname"><a href="FileStream_8cpp.html#ad0f1ed530318d4f8cecb3dfb53e15b0a">GetLastError</a></div><div class="ttdeci">DWORD GetLastError()</div><div class="ttdef"><b>Definition</b> <a href="FileStream_8cpp_source.html#l00044">FileStream.cpp:44</a></div></div>
<div class="ttc" id="aStormPort_8h_html_a1b6a16ca70fb99d4c13aeae1e7283680"><div class="ttname"><a href="StormPort_8h.html#a1b6a16ca70fb99d4c13aeae1e7283680">FILE_BEGIN</a></div><div class="ttdeci">#define FILE_BEGIN</div><div class="ttdef"><b>Definition</b> <a href="StormPort_8h_source.html#l00365">StormPort.h:365</a></div></div>
<div class="ttc" id="aStormPort_8h_html_a9154c0d0c21af4686624543215b4e5f2"><div class="ttname"><a href="StormPort_8h.html#a9154c0d0c21af4686624543215b4e5f2">LONG</a></div><div class="ttdeci">int LONG</div><div class="ttdef"><b>Definition</b> <a href="StormPort_8h_source.html#l00335">StormPort.h:335</a></div></div>
<div class="ttc" id="aStormPort_8h_html_abb452686968e48b67397da5f97445f5b"><div class="ttname"><a href="StormPort_8h.html#abb452686968e48b67397da5f97445f5b">bool</a></div><div class="ttdeci">#define bool</div><div class="ttdef"><b>Definition</b> <a href="StormPort_8h_source.html#l00031">StormPort.h:31</a></div></div>
<div class="ttc" id="aStormPort_8h_html_aea0ae801b7d25c979655a7eb20d034af"><div class="ttname"><a href="StormPort_8h.html#aea0ae801b7d25c979655a7eb20d034af">ERROR_SUCCESS</a></div><div class="ttdeci">#define ERROR_SUCCESS</div><div class="ttdef"><b>Definition</b> <a href="StormPort_8h_source.html#l00401">StormPort.h:401</a></div></div>
<div class="ttc" id="astorm_8cpp_html_a5efe0815e93bfc2df5a8a2c7f309173d"><div class="ttname"><a href="storm_8cpp.html#a5efe0815e93bfc2df5a8a2c7f309173d">SetFilePointer</a></div><div class="ttdeci">DWORD WINAPI SFILE() SetFilePointer(HANDLE hFile, long lDistanceToMove, PLONG lplDistanceToMoveHigh, DWORD dwMoveMethod)</div><div class="ttdef"><b>Definition</b> <a href="storm_8cpp_source.html#l00071">storm.cpp:71</a></div></div>
</div><!-- fragment --><div class="dynheader">
Here is the call graph for this function:</div>
<div class="dyncontent">
<div class="center"><iframe scrolling="no" frameborder="0" src="FileStream_8cpp_ae004fa7bac8a8c891eec3b183701efb6_cgraph.svg" width="447" height="86"><p><b>This browser is not able to show SVG: try Firefox, Chrome, Safari, or Opera instead.</b></p></iframe></div>
</div>
<div class="dynheader">
Here is the caller graph for this function:</div>
<div class="dyncontent">
<div class="center"><iframe scrolling="no" frameborder="0" src="FileStream_8cpp_ae004fa7bac8a8c891eec3b183701efb6_icgraph.svg" width="291" height="36"><p><b>This browser is not able to show SVG: try Firefox, Chrome, Safari, or Opera instead.</b></p></iframe></div>
</div>

</div>
</div>
<a id="adf9b2fa5508bed570c9aaf61f6925844" name="adf9b2fa5508bed570c9aaf61f6925844"></a>
<h2 class="memtitle"><span class="permalink"><a href="#adf9b2fa5508bed570c9aaf61f6925844">&#9670;&#160;</a></span>BaseFile_Write()</h2>

<div class="memitem">
<div class="memproto">
<table class="mlabels">
  <tr>
  <td class="mlabels-left">
      <table class="memname">
        <tr>
          <td class="memname">static <a class="el" href="StormPort_8h.html#abb452686968e48b67397da5f97445f5b">bool</a> BaseFile_Write </td>
          <td>(</td>
          <td class="paramtype"><a class="el" href="structTFileStream.html">TFileStream</a> *&#160;</td>
          <td class="paramname"><em>pStream</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype"><a class="el" href="StormPort_8h.html#abb9abb9ce956f1a9e5a4081ac40e5649">ULONGLONG</a> *&#160;</td>
          <td class="paramname"><em>pByteOffset</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype"><a class="el" href="StormLib_2src_2zlib_2zconf_8h.html#a2c212835823e3c54a8ab6d95c652660e">const</a> void *&#160;</td>
          <td class="paramname"><em>pvBuffer</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype"><a class="el" href="StormPort_8h.html#a798af1e30bc65f319c1a246cecf59e39">DWORD</a>&#160;</td>
          <td class="paramname"><em>dwBytesToWrite</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
  </td>
  <td class="mlabels-right">
<span class="mlabels"><span class="mlabel">static</span></span>  </td>
  </tr>
</table>
</div><div class="memdoc">
<p><em>pStream</em> Pointer to an open stream <em>pByteOffset</em> Pointer to file byte offset. If NULL, writes to current position <em>pvBuffer</em> Pointer to data to be written <em>dwBytesToWrite</em> Number of bytes to write to the file </p>

<p class="definition">Definition at line <a class="el" href="FileStream_8cpp_source.html#l00276">276</a> of file <a class="el" href="FileStream_8cpp_source.html">FileStream.cpp</a>.</p>
<div class="fragment"><div class="line"><span class="lineno">  277</span>{</div>
<div class="line"><span class="lineno">  278</span>    <a class="code hl_typedef" href="StormPort_8h.html#abb9abb9ce956f1a9e5a4081ac40e5649">ULONGLONG</a> ByteOffset = (pByteOffset != NULL) ? *pByteOffset : pStream-&gt;Base.File.FilePos;</div>
<div class="line"><span class="lineno">  279</span>    <a class="code hl_typedef" href="StormPort_8h.html#a798af1e30bc65f319c1a246cecf59e39">DWORD</a> dwBytesWritten = 0;               <span class="comment">// Must be set by platform-specific code</span></div>
<div class="line"><span class="lineno">  280</span> </div>
<div class="line"><span class="lineno">  281</span><span class="preprocessor">#ifdef STORMLIB_WINDOWS</span></div>
<div class="line"><span class="lineno">  282</span>    {</div>
<div class="line"><span class="lineno">  283</span>        <span class="comment">// Note: StormLib no longer supports Windows 9x.</span></div>
<div class="line"><span class="lineno">  284</span>        <span class="comment">// Thus, we can use the OVERLAPPED structure to specify</span></div>
<div class="line"><span class="lineno">  285</span>        <span class="comment">// file offset to read from file. This allows us to skip</span></div>
<div class="line"><span class="lineno">  286</span>        <span class="comment">// one system call to SetFilePointer</span></div>
<div class="line"><span class="lineno">  287</span> </div>
<div class="line"><span class="lineno">  288</span>        <span class="comment">// Update the byte offset</span></div>
<div class="line"><span class="lineno">  289</span>        pStream-&gt;<a class="code hl_variable" href="structTFileStream.html#a3428b5a1e790560349940aa04e37e580">Base</a>.<a class="code hl_variable" href="unionTBaseProviderData.html#a60536cc70eff3072cd6c371a99bdf325">File</a>.<a class="code hl_variable" href="unionTBaseProviderData.html#ac625a3e6bcdc60e1cd5d1bb7ed062028">FilePos</a> = ByteOffset;</div>
<div class="line"><span class="lineno">  290</span> </div>
<div class="line"><span class="lineno">  291</span>        <span class="comment">// Read the data</span></div>
<div class="line"><span class="lineno">  292</span>        <span class="keywordflow">if</span>(dwBytesToWrite != 0)</div>
<div class="line"><span class="lineno">  293</span>        {</div>
<div class="line"><span class="lineno">  294</span>            OVERLAPPED Overlapped;</div>
<div class="line"><span class="lineno">  295</span> </div>
<div class="line"><span class="lineno">  296</span>            Overlapped.OffsetHigh = (<a class="code hl_typedef" href="StormPort_8h.html#a798af1e30bc65f319c1a246cecf59e39">DWORD</a>)(ByteOffset &gt;&gt; 32);</div>
<div class="line"><span class="lineno">  297</span>            Overlapped.Offset = (<a class="code hl_typedef" href="StormPort_8h.html#a798af1e30bc65f319c1a246cecf59e39">DWORD</a>)ByteOffset;</div>
<div class="line"><span class="lineno">  298</span>            Overlapped.hEvent = NULL;</div>
<div class="line"><span class="lineno">  299</span>            <span class="keywordflow">if</span>(!WriteFile(pStream-&gt;<a class="code hl_variable" href="structTFileStream.html#a3428b5a1e790560349940aa04e37e580">Base</a>.<a class="code hl_variable" href="unionTBaseProviderData.html#a60536cc70eff3072cd6c371a99bdf325">File</a>.<a class="code hl_variable" href="unionTBaseProviderData.html#a3ca5c9e4601dd22216f7ef85f4d6f64d">hFile</a>, pvBuffer, dwBytesToWrite, &amp;dwBytesWritten, &amp;Overlapped))</div>
<div class="line"><span class="lineno">  300</span>                <span class="keywordflow">return</span> <span class="keyword">false</span>;</div>
<div class="line"><span class="lineno">  301</span>        }</div>
<div class="line"><span class="lineno">  302</span>    }</div>
<div class="line"><span class="lineno">  303</span><span class="preprocessor">#endif</span></div>
<div class="line"><span class="lineno">  304</span> </div>
<div class="line"><span class="lineno">  305</span><span class="preprocessor">#if defined(STORMLIB_MAC) || defined(STORMLIB_LINUX)</span></div>
<div class="line"><span class="lineno">  306</span>    {</div>
<div class="line"><span class="lineno">  307</span>        ssize_t bytes_written;</div>
<div class="line"><span class="lineno">  308</span> </div>
<div class="line"><span class="lineno">  309</span>        <span class="comment">// If the byte offset is different from the current file position,</span></div>
<div class="line"><span class="lineno">  310</span>        <span class="comment">// we have to update the file position</span></div>
<div class="line"><span class="lineno">  311</span>        <span class="keywordflow">if</span>(ByteOffset != pStream-&gt;<a class="code hl_variable" href="structTFileStream.html#a3428b5a1e790560349940aa04e37e580">Base</a>.<a class="code hl_variable" href="unionTBaseProviderData.html#a60536cc70eff3072cd6c371a99bdf325">File</a>.<a class="code hl_variable" href="unionTBaseProviderData.html#ac625a3e6bcdc60e1cd5d1bb7ed062028">FilePos</a>)</div>
<div class="line"><span class="lineno">  312</span>        {</div>
<div class="line"><span class="lineno">  313</span>            lseek64((<a class="code hl_typedef" href="winvs__stdint_8h.html#abd3131a20f4053d808d4277db3e39a23">intptr_t</a>)pStream-&gt;<a class="code hl_variable" href="structTFileStream.html#a3428b5a1e790560349940aa04e37e580">Base</a>.<a class="code hl_variable" href="unionTBaseProviderData.html#a60536cc70eff3072cd6c371a99bdf325">File</a>.<a class="code hl_variable" href="unionTBaseProviderData.html#a3ca5c9e4601dd22216f7ef85f4d6f64d">hFile</a>, (off64_t)(ByteOffset), <a class="code hl_define" href="StormLib_2src_2zlib_2zconf_8h.html#a0d112bae8fd35be772185b6ec6bcbe64">SEEK_SET</a>);</div>
<div class="line"><span class="lineno">  314</span>            pStream-&gt;<a class="code hl_variable" href="structTFileStream.html#a3428b5a1e790560349940aa04e37e580">Base</a>.<a class="code hl_variable" href="unionTBaseProviderData.html#a60536cc70eff3072cd6c371a99bdf325">File</a>.<a class="code hl_variable" href="unionTBaseProviderData.html#ac625a3e6bcdc60e1cd5d1bb7ed062028">FilePos</a> = ByteOffset;</div>
<div class="line"><span class="lineno">  315</span>        }</div>
<div class="line"><span class="lineno">  316</span> </div>
<div class="line"><span class="lineno">  317</span>        <span class="comment">// Perform the read operation</span></div>
<div class="line"><span class="lineno">  318</span>        bytes_written = <a class="code hl_function" href="namespacedetail.html#a29dacf26eedc9e3575fb57329a5ca0a3">write</a>((<a class="code hl_typedef" href="winvs__stdint_8h.html#abd3131a20f4053d808d4277db3e39a23">intptr_t</a>)pStream-&gt;<a class="code hl_variable" href="structTFileStream.html#a3428b5a1e790560349940aa04e37e580">Base</a>.<a class="code hl_variable" href="unionTBaseProviderData.html#a60536cc70eff3072cd6c371a99bdf325">File</a>.<a class="code hl_variable" href="unionTBaseProviderData.html#a3ca5c9e4601dd22216f7ef85f4d6f64d">hFile</a>, pvBuffer, (<span class="keywordtype">size_t</span>)dwBytesToWrite);</div>
<div class="line"><span class="lineno">  319</span>        <span class="keywordflow">if</span>(bytes_written == -1)</div>
<div class="line"><span class="lineno">  320</span>        {</div>
<div class="line"><span class="lineno">  321</span>            <a class="code hl_variable" href="FileStream_8cpp.html#ae1b34ad1b2653fcef5fac54d2fea9943">dwLastError</a> = errno;</div>
<div class="line"><span class="lineno">  322</span>            <span class="keywordflow">return</span> <span class="keyword">false</span>;</div>
<div class="line"><span class="lineno">  323</span>        }</div>
<div class="line"><span class="lineno">  324</span> </div>
<div class="line"><span class="lineno">  325</span>        dwBytesWritten = (<a class="code hl_typedef" href="StormPort_8h.html#a798af1e30bc65f319c1a246cecf59e39">DWORD</a>)(<span class="keywordtype">size_t</span>)bytes_written;</div>
<div class="line"><span class="lineno">  326</span>    }</div>
<div class="line"><span class="lineno">  327</span><span class="preprocessor">#endif</span></div>
<div class="line"><span class="lineno">  328</span> </div>
<div class="line"><span class="lineno">  329</span>    <span class="comment">// Increment the current file position by number of bytes read</span></div>
<div class="line"><span class="lineno">  330</span>    pStream-&gt;<a class="code hl_variable" href="structTFileStream.html#a3428b5a1e790560349940aa04e37e580">Base</a>.<a class="code hl_variable" href="unionTBaseProviderData.html#a60536cc70eff3072cd6c371a99bdf325">File</a>.<a class="code hl_variable" href="unionTBaseProviderData.html#ac625a3e6bcdc60e1cd5d1bb7ed062028">FilePos</a> = ByteOffset + dwBytesWritten;</div>
<div class="line"><span class="lineno">  331</span> </div>
<div class="line"><span class="lineno">  332</span>    <span class="comment">// Also modify the file size, if needed</span></div>
<div class="line"><span class="lineno">  333</span>    <span class="keywordflow">if</span>(pStream-&gt;<a class="code hl_variable" href="structTFileStream.html#a3428b5a1e790560349940aa04e37e580">Base</a>.<a class="code hl_variable" href="unionTBaseProviderData.html#a60536cc70eff3072cd6c371a99bdf325">File</a>.<a class="code hl_variable" href="unionTBaseProviderData.html#ac625a3e6bcdc60e1cd5d1bb7ed062028">FilePos</a> &gt; pStream-&gt;<a class="code hl_variable" href="structTFileStream.html#a3428b5a1e790560349940aa04e37e580">Base</a>.<a class="code hl_variable" href="unionTBaseProviderData.html#a60536cc70eff3072cd6c371a99bdf325">File</a>.<a class="code hl_variable" href="unionTBaseProviderData.html#ad644c7067435cf51727186729b970d55">FileSize</a>)</div>
<div class="line"><span class="lineno">  334</span>        pStream-&gt;<a class="code hl_variable" href="structTFileStream.html#a3428b5a1e790560349940aa04e37e580">Base</a>.<a class="code hl_variable" href="unionTBaseProviderData.html#a60536cc70eff3072cd6c371a99bdf325">File</a>.<a class="code hl_variable" href="unionTBaseProviderData.html#ad644c7067435cf51727186729b970d55">FileSize</a> = pStream-&gt;<a class="code hl_variable" href="structTFileStream.html#a3428b5a1e790560349940aa04e37e580">Base</a>.<a class="code hl_variable" href="unionTBaseProviderData.html#a60536cc70eff3072cd6c371a99bdf325">File</a>.<a class="code hl_variable" href="unionTBaseProviderData.html#ac625a3e6bcdc60e1cd5d1bb7ed062028">FilePos</a>;</div>
<div class="line"><span class="lineno">  335</span> </div>
<div class="line"><span class="lineno">  336</span>    <span class="keywordflow">if</span>(dwBytesWritten != dwBytesToWrite)</div>
<div class="line"><span class="lineno">  337</span>        <a class="code hl_function" href="FileStream_8cpp.html#a65dd8d3e416ffbd6ac5f468c6bdccac9">SetLastError</a>(<a class="code hl_define" href="StormPort_8h.html#a5ec52746aa53db64b107d409b8da5372">ERROR_DISK_FULL</a>);</div>
<div class="line"><span class="lineno">  338</span>    <span class="keywordflow">return</span> (dwBytesWritten == dwBytesToWrite);</div>
<div class="line"><span class="lineno">  339</span>}</div>
<div class="ttc" id="aStormPort_8h_html_a5ec52746aa53db64b107d409b8da5372"><div class="ttname"><a href="StormPort_8h.html#a5ec52746aa53db64b107d409b8da5372">ERROR_DISK_FULL</a></div><div class="ttdeci">#define ERROR_DISK_FULL</div><div class="ttdef"><b>Definition</b> <a href="StormPort_8h_source.html#l00409">StormPort.h:409</a></div></div>
<div class="ttc" id="anamespacedetail_html_a29dacf26eedc9e3575fb57329a5ca0a3"><div class="ttname"><a href="namespacedetail.html#a29dacf26eedc9e3575fb57329a5ca0a3">detail::write</a></div><div class="ttdeci">auto write(OutputIt out, const std::tm &amp;time, const std::locale &amp;loc, char format, char modifier=0) -&gt; OutputIt</div><div class="ttdef"><b>Definition</b> <a href="chrono_8h_source.html#l00419">chrono.h:419</a></div></div>
</div><!-- fragment --><div class="dynheader">
Here is the call graph for this function:</div>
<div class="dyncontent">
<div class="center"><iframe scrolling="no" frameborder="0" src="FileStream_8cpp_adf9b2fa5508bed570c9aaf61f6925844_cgraph.svg" width="279" height="36"><p><b>This browser is not able to show SVG: try Firefox, Chrome, Safari, or Opera instead.</b></p></iframe></div>
</div>
<div class="dynheader">
Here is the caller graph for this function:</div>
<div class="dyncontent">
<div class="center"><iframe scrolling="no" frameborder="0" src="FileStream_8cpp_adf9b2fa5508bed570c9aaf61f6925844_icgraph.svg" width="283" height="36"><p><b>This browser is not able to show SVG: try Firefox, Chrome, Safari, or Opera instead.</b></p></iframe></div>
</div>

</div>
</div>
<a id="aa9415c5baa0b61c1a7a0c1686f8baac3" name="aa9415c5baa0b61c1a7a0c1686f8baac3"></a>
<h2 class="memtitle"><span class="permalink"><a href="#aa9415c5baa0b61c1a7a0c1686f8baac3">&#9670;&#160;</a></span>BaseHttp_Close()</h2>

<div class="memitem">
<div class="memproto">
<table class="mlabels">
  <tr>
  <td class="mlabels-left">
      <table class="memname">
        <tr>
          <td class="memname">static void BaseHttp_Close </td>
          <td>(</td>
          <td class="paramtype"><a class="el" href="structTFileStream.html">TFileStream</a> *&#160;</td>
          <td class="paramname"><em>pStream</em></td><td>)</td>
          <td></td>
        </tr>
      </table>
  </td>
  <td class="mlabels-right">
<span class="mlabels"><span class="mlabel">static</span></span>  </td>
  </tr>
</table>
</div><div class="memdoc">

<p class="definition">Definition at line <a class="el" href="FileStream_8cpp_source.html#l00880">880</a> of file <a class="el" href="FileStream_8cpp_source.html">FileStream.cpp</a>.</p>
<div class="fragment"><div class="line"><span class="lineno">  881</span>{</div>
<div class="line"><span class="lineno">  882</span><span class="preprocessor">#ifdef STORMLIB_WINDOWS</span></div>
<div class="line"><span class="lineno">  883</span>    <span class="keywordflow">if</span>(pStream-&gt;<a class="code hl_variable" href="structTFileStream.html#a3428b5a1e790560349940aa04e37e580">Base</a>.<a class="code hl_variable" href="unionTBaseProviderData.html#a6590a4657a7d8ac3102397fbf8527142">Http</a>.<a class="code hl_variable" href="unionTBaseProviderData.html#a5f1669f33fb9d76f8fb0e416a2d0807a">hConnect</a> != NULL)</div>
<div class="line"><span class="lineno">  884</span>        InternetCloseHandle(pStream-&gt;<a class="code hl_variable" href="structTFileStream.html#a3428b5a1e790560349940aa04e37e580">Base</a>.<a class="code hl_variable" href="unionTBaseProviderData.html#a6590a4657a7d8ac3102397fbf8527142">Http</a>.<a class="code hl_variable" href="unionTBaseProviderData.html#a5f1669f33fb9d76f8fb0e416a2d0807a">hConnect</a>);</div>
<div class="line"><span class="lineno">  885</span>    pStream-&gt;<a class="code hl_variable" href="structTFileStream.html#a3428b5a1e790560349940aa04e37e580">Base</a>.<a class="code hl_variable" href="unionTBaseProviderData.html#a6590a4657a7d8ac3102397fbf8527142">Http</a>.<a class="code hl_variable" href="unionTBaseProviderData.html#a5f1669f33fb9d76f8fb0e416a2d0807a">hConnect</a> = NULL;</div>
<div class="line"><span class="lineno">  886</span> </div>
<div class="line"><span class="lineno">  887</span>    <span class="keywordflow">if</span>(pStream-&gt;<a class="code hl_variable" href="structTFileStream.html#a3428b5a1e790560349940aa04e37e580">Base</a>.<a class="code hl_variable" href="unionTBaseProviderData.html#a6590a4657a7d8ac3102397fbf8527142">Http</a>.<a class="code hl_variable" href="unionTBaseProviderData.html#a7600eddf4d54431e5ee51d9c53c348f5">hInternet</a> != NULL)</div>
<div class="line"><span class="lineno">  888</span>        InternetCloseHandle(pStream-&gt;<a class="code hl_variable" href="structTFileStream.html#a3428b5a1e790560349940aa04e37e580">Base</a>.<a class="code hl_variable" href="unionTBaseProviderData.html#a6590a4657a7d8ac3102397fbf8527142">Http</a>.<a class="code hl_variable" href="unionTBaseProviderData.html#a7600eddf4d54431e5ee51d9c53c348f5">hInternet</a>);</div>
<div class="line"><span class="lineno">  889</span>    pStream-&gt;<a class="code hl_variable" href="structTFileStream.html#a3428b5a1e790560349940aa04e37e580">Base</a>.<a class="code hl_variable" href="unionTBaseProviderData.html#a6590a4657a7d8ac3102397fbf8527142">Http</a>.<a class="code hl_variable" href="unionTBaseProviderData.html#a7600eddf4d54431e5ee51d9c53c348f5">hInternet</a> = NULL;</div>
<div class="line"><span class="lineno">  890</span><span class="preprocessor">#else</span></div>
<div class="line"><span class="lineno">  891</span>    pStream = pStream;</div>
<div class="line"><span class="lineno">  892</span><span class="preprocessor">#endif</span></div>
<div class="line"><span class="lineno">  893</span>}</div>
<div class="ttc" id="aunionTBaseProviderData_html_a5f1669f33fb9d76f8fb0e416a2d0807a"><div class="ttname"><a href="unionTBaseProviderData.html#a5f1669f33fb9d76f8fb0e416a2d0807a">TBaseProviderData::hConnect</a></div><div class="ttdeci">HANDLE hConnect</div><div class="ttdef"><b>Definition</b> <a href="FileStream_8h_source.html#l00149">FileStream.h:149</a></div></div>
<div class="ttc" id="aunionTBaseProviderData_html_a6590a4657a7d8ac3102397fbf8527142"><div class="ttname"><a href="unionTBaseProviderData.html#a6590a4657a7d8ac3102397fbf8527142">TBaseProviderData::Http</a></div><div class="ttdeci">struct TBaseProviderData::@55 Http</div></div>
<div class="ttc" id="aunionTBaseProviderData_html_a7600eddf4d54431e5ee51d9c53c348f5"><div class="ttname"><a href="unionTBaseProviderData.html#a7600eddf4d54431e5ee51d9c53c348f5">TBaseProviderData::hInternet</a></div><div class="ttdeci">HANDLE hInternet</div><div class="ttdef"><b>Definition</b> <a href="FileStream_8h_source.html#l00148">FileStream.h:148</a></div></div>
</div><!-- fragment --><div class="dynheader">
Here is the caller graph for this function:</div>
<div class="dyncontent">
<div class="center"><iframe scrolling="no" frameborder="0" src="FileStream_8cpp_aa9415c5baa0b61c1a7a0c1686f8baac3_icgraph.svg" width="295" height="36"><p><b>This browser is not able to show SVG: try Firefox, Chrome, Safari, or Opera instead.</b></p></iframe></div>
</div>

</div>
</div>
<a id="ad97af1a620ae3db5bf6917027893ae9f" name="ad97af1a620ae3db5bf6917027893ae9f"></a>
<h2 class="memtitle"><span class="permalink"><a href="#ad97af1a620ae3db5bf6917027893ae9f">&#9670;&#160;</a></span>BaseHttp_ExtractServerName()</h2>

<div class="memitem">
<div class="memproto">
<table class="mlabels">
  <tr>
  <td class="mlabels-left">
      <table class="memname">
        <tr>
          <td class="memname">static <a class="el" href="StormLib_2src_2zlib_2zconf_8h.html#a2c212835823e3c54a8ab6d95c652660e">const</a> <a class="el" href="StormPort_8h.html#a03bdb8ce5895c7e261aadc2529637546">TCHAR</a> * BaseHttp_ExtractServerName </td>
          <td>(</td>
          <td class="paramtype"><a class="el" href="StormLib_2src_2zlib_2zconf_8h.html#a2c212835823e3c54a8ab6d95c652660e">const</a> <a class="el" href="StormPort_8h.html#a03bdb8ce5895c7e261aadc2529637546">TCHAR</a> *&#160;</td>
          <td class="paramname"><em>szFileName</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype"><a class="el" href="StormPort_8h.html#a03bdb8ce5895c7e261aadc2529637546">TCHAR</a> *&#160;</td>
          <td class="paramname"><em>szServerName</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
  </td>
  <td class="mlabels-right">
<span class="mlabels"><span class="mlabel">static</span></span>  </td>
  </tr>
</table>
</div><div class="memdoc">

<p class="definition">Definition at line <a class="el" href="FileStream_8cpp_source.html#l00672">672</a> of file <a class="el" href="FileStream_8cpp_source.html">FileStream.cpp</a>.</p>
<div class="fragment"><div class="line"><span class="lineno">  673</span>{</div>
<div class="line"><span class="lineno">  674</span>    <span class="comment">// Check for HTTP</span></div>
<div class="line"><span class="lineno">  675</span>    <span class="keywordflow">if</span>(!<a class="code hl_define" href="StormPort_8h.html#aa73bb733e1922cfb964b0ff6228e3089">_tcsnicmp</a>(szFileName, <a class="code hl_define" href="StormPort_8h.html#ae936e4c15227768f7da4e0951def89c8">_T</a>(<span class="stringliteral">&quot;http://&quot;</span>), 7))</div>
<div class="line"><span class="lineno">  676</span>        szFileName += 7;</div>
<div class="line"><span class="lineno">  677</span> </div>
<div class="line"><span class="lineno">  678</span>    <span class="comment">// Cut off the server name</span></div>
<div class="line"><span class="lineno">  679</span>    <span class="keywordflow">if</span>(szServerName != NULL)</div>
<div class="line"><span class="lineno">  680</span>    {</div>
<div class="line"><span class="lineno">  681</span>        <span class="keywordflow">while</span>(szFileName[0] != 0 &amp;&amp; szFileName[0] != <a class="code hl_define" href="StormPort_8h.html#ae936e4c15227768f7da4e0951def89c8">_T</a>(<span class="charliteral">&#39;/&#39;</span>))</div>
<div class="line"><span class="lineno">  682</span>            *szServerName++ = *szFileName++;</div>
<div class="line"><span class="lineno">  683</span>        *szServerName = 0;</div>
<div class="line"><span class="lineno">  684</span>    }</div>
<div class="line"><span class="lineno">  685</span>    <span class="keywordflow">else</span></div>
<div class="line"><span class="lineno">  686</span>    {</div>
<div class="line"><span class="lineno">  687</span>        <span class="keywordflow">while</span>(szFileName[0] != 0 &amp;&amp; szFileName[0] != <a class="code hl_define" href="StormPort_8h.html#ae936e4c15227768f7da4e0951def89c8">_T</a>(<span class="charliteral">&#39;/&#39;</span>))</div>
<div class="line"><span class="lineno">  688</span>            szFileName++;</div>
<div class="line"><span class="lineno">  689</span>    }</div>
<div class="line"><span class="lineno">  690</span> </div>
<div class="line"><span class="lineno">  691</span>    <span class="comment">// Return the remainder</span></div>
<div class="line"><span class="lineno">  692</span>    <span class="keywordflow">return</span> szFileName;</div>
<div class="line"><span class="lineno">  693</span>}</div>
<div class="ttc" id="aStormPort_8h_html_aa73bb733e1922cfb964b0ff6228e3089"><div class="ttname"><a href="StormPort_8h.html#aa73bb733e1922cfb964b0ff6228e3089">_tcsnicmp</a></div><div class="ttdeci">#define _tcsnicmp</div><div class="ttdef"><b>Definition</b> <a href="StormPort_8h_source.html#l00376">StormPort.h:376</a></div></div>
</div><!-- fragment --><div class="dynheader">
Here is the caller graph for this function:</div>
<div class="dyncontent">
<div class="center"><iframe scrolling="no" frameborder="0" src="FileStream_8cpp_ad97af1a620ae3db5bf6917027893ae9f_icgraph.svg" width="556" height="86"><p><b>This browser is not able to show SVG: try Firefox, Chrome, Safari, or Opera instead.</b></p></iframe></div>
</div>

</div>
</div>
<a id="a5ba2b0289e1a1521baf9174aafce7aa2" name="a5ba2b0289e1a1521baf9174aafce7aa2"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a5ba2b0289e1a1521baf9174aafce7aa2">&#9670;&#160;</a></span>BaseHttp_Init()</h2>

<div class="memitem">
<div class="memproto">
<table class="mlabels">
  <tr>
  <td class="mlabels-left">
      <table class="memname">
        <tr>
          <td class="memname">static void BaseHttp_Init </td>
          <td>(</td>
          <td class="paramtype"><a class="el" href="structTFileStream.html">TFileStream</a> *&#160;</td>
          <td class="paramname"><em>pStream</em></td><td>)</td>
          <td></td>
        </tr>
      </table>
  </td>
  <td class="mlabels-right">
<span class="mlabels"><span class="mlabel">static</span></span>  </td>
  </tr>
</table>
</div><div class="memdoc">

<p class="definition">Definition at line <a class="el" href="FileStream_8cpp_source.html#l00896">896</a> of file <a class="el" href="FileStream_8cpp_source.html">FileStream.cpp</a>.</p>
<div class="fragment"><div class="line"><span class="lineno">  897</span>{</div>
<div class="line"><span class="lineno">  898</span>    <span class="comment">// Supply the stream functions</span></div>
<div class="line"><span class="lineno">  899</span>    pStream-&gt;<a class="code hl_variable" href="structTFileStream.html#a82013f6bc9d5e52d1efe42b0dc464d4c">BaseOpen</a>    = <a class="code hl_function" href="FileStream_8cpp.html#a23f58ada8682609f6f455ce846ecd83a">BaseHttp_Open</a>;</div>
<div class="line"><span class="lineno">  900</span>    pStream-&gt;<a class="code hl_variable" href="structTFileStream.html#a5b6aa0a4b5d6b97770f73fbc47412da1">BaseRead</a>    = <a class="code hl_function" href="FileStream_8cpp.html#ab80f4fa5604af2840f231a7aa9233c31">BaseHttp_Read</a>;</div>
<div class="line"><span class="lineno">  901</span>    pStream-&gt;<a class="code hl_variable" href="structTFileStream.html#a0366f518ffecab4131bf2527f22964e3">BaseGetSize</a> = <a class="code hl_function" href="FileStream_8cpp.html#a55e7d166af5374820da7c39a63eabb78">BaseFile_GetSize</a>;    <span class="comment">// Reuse BaseFile function</span></div>
<div class="line"><span class="lineno">  902</span>    pStream-&gt;<a class="code hl_variable" href="structTFileStream.html#aa9c8095dd8a2e07b83611e0b5dac3fde">BaseGetPos</a>  = <a class="code hl_function" href="FileStream_8cpp.html#a83df9c1c4278b431d59568a3ae4dc39f">BaseFile_GetPos</a>;     <span class="comment">// Reuse BaseFile function</span></div>
<div class="line"><span class="lineno">  903</span>    pStream-&gt;<a class="code hl_variable" href="structTFileStream.html#acbdc7dfef3127e4c077310381f8f6c7d">BaseClose</a>   = <a class="code hl_function" href="FileStream_8cpp.html#aa9415c5baa0b61c1a7a0c1686f8baac3">BaseHttp_Close</a>;</div>
<div class="line"><span class="lineno">  904</span> </div>
<div class="line"><span class="lineno">  905</span>    <span class="comment">// HTTP files are read-only</span></div>
<div class="line"><span class="lineno">  906</span>    pStream-&gt;<a class="code hl_variable" href="structTFileStream.html#ae61935eec67ce99ea4091bc0949de1ea">dwFlags</a> |= <a class="code hl_define" href="StormLib_8h.html#abdbbf06488f24699775afe6aadaeafc3">STREAM_FLAG_READ_ONLY</a>;</div>
<div class="line"><span class="lineno">  907</span>}</div>
<div class="ttc" id="aFileStream_8cpp_html_a23f58ada8682609f6f455ce846ecd83a"><div class="ttname"><a href="FileStream_8cpp.html#a23f58ada8682609f6f455ce846ecd83a">BaseHttp_Open</a></div><div class="ttdeci">static bool BaseHttp_Open(TFileStream *pStream, const TCHAR *szFileName, DWORD dwStreamFlags)</div><div class="ttdef"><b>Definition</b> <a href="FileStream_8cpp_source.html#l00695">FileStream.cpp:695</a></div></div>
<div class="ttc" id="aFileStream_8cpp_html_aa9415c5baa0b61c1a7a0c1686f8baac3"><div class="ttname"><a href="FileStream_8cpp.html#aa9415c5baa0b61c1a7a0c1686f8baac3">BaseHttp_Close</a></div><div class="ttdeci">static void BaseHttp_Close(TFileStream *pStream)</div><div class="ttdef"><b>Definition</b> <a href="FileStream_8cpp_source.html#l00880">FileStream.cpp:880</a></div></div>
<div class="ttc" id="aFileStream_8cpp_html_ab80f4fa5604af2840f231a7aa9233c31"><div class="ttname"><a href="FileStream_8cpp.html#ab80f4fa5604af2840f231a7aa9233c31">BaseHttp_Read</a></div><div class="ttdeci">static bool BaseHttp_Read(TFileStream *pStream, ULONGLONG *pByteOffset, void *pvBuffer, DWORD dwBytesToRead)</div><div class="ttdef"><b>Definition</b> <a href="FileStream_8cpp_source.html#l00803">FileStream.cpp:803</a></div></div>
</div><!-- fragment --><div class="dynheader">
Here is the call graph for this function:</div>
<div class="dyncontent">
<div class="center"><iframe scrolling="no" frameborder="0" src="FileStream_8cpp_a5ba2b0289e1a1521baf9174aafce7aa2_cgraph.svg" width="568" height="234"><p><b>This browser is not able to show SVG: try Firefox, Chrome, Safari, or Opera instead.</b></p></iframe></div>
</div>

</div>
</div>
<a id="a23f58ada8682609f6f455ce846ecd83a" name="a23f58ada8682609f6f455ce846ecd83a"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a23f58ada8682609f6f455ce846ecd83a">&#9670;&#160;</a></span>BaseHttp_Open()</h2>

<div class="memitem">
<div class="memproto">
<table class="mlabels">
  <tr>
  <td class="mlabels-left">
      <table class="memname">
        <tr>
          <td class="memname">static <a class="el" href="StormPort_8h.html#abb452686968e48b67397da5f97445f5b">bool</a> BaseHttp_Open </td>
          <td>(</td>
          <td class="paramtype"><a class="el" href="structTFileStream.html">TFileStream</a> *&#160;</td>
          <td class="paramname"><em>pStream</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype"><a class="el" href="StormLib_2src_2zlib_2zconf_8h.html#a2c212835823e3c54a8ab6d95c652660e">const</a> <a class="el" href="StormPort_8h.html#a03bdb8ce5895c7e261aadc2529637546">TCHAR</a> *&#160;</td>
          <td class="paramname"><em>szFileName</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype"><a class="el" href="StormPort_8h.html#a798af1e30bc65f319c1a246cecf59e39">DWORD</a>&#160;</td>
          <td class="paramname"><em>dwStreamFlags</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
  </td>
  <td class="mlabels-right">
<span class="mlabels"><span class="mlabel">static</span></span>  </td>
  </tr>
</table>
</div><div class="memdoc">

<p class="definition">Definition at line <a class="el" href="FileStream_8cpp_source.html#l00695">695</a> of file <a class="el" href="FileStream_8cpp_source.html">FileStream.cpp</a>.</p>
<div class="fragment"><div class="line"><span class="lineno">  696</span>{</div>
<div class="line"><span class="lineno">  697</span><span class="preprocessor">#ifdef STORMLIB_WINDOWS</span></div>
<div class="line"><span class="lineno">  698</span> </div>
<div class="line"><span class="lineno">  699</span>    HINTERNET hRequest;</div>
<div class="line"><span class="lineno">  700</span>    <a class="code hl_typedef" href="StormPort_8h.html#a798af1e30bc65f319c1a246cecf59e39">DWORD</a> dwTemp = 0;</div>
<div class="line"><span class="lineno">  701</span> </div>
<div class="line"><span class="lineno">  702</span>    <span class="comment">// Keep compiler happy</span></div>
<div class="line"><span class="lineno">  703</span>    dwStreamFlags = dwStreamFlags;</div>
<div class="line"><span class="lineno">  704</span> </div>
<div class="line"><span class="lineno">  705</span>    <span class="comment">// Don&#39;t connect to the internet</span></div>
<div class="line"><span class="lineno">  706</span>    <span class="keywordflow">if</span>(!InternetGetConnectedState(&amp;dwTemp, 0))</div>
<div class="line"><span class="lineno">  707</span>        <span class="keywordflow">return</span> <span class="keyword">false</span>;</div>
<div class="line"><span class="lineno">  708</span> </div>
<div class="line"><span class="lineno">  709</span>    <span class="comment">// Initiate the connection to the internet</span></div>
<div class="line"><span class="lineno">  710</span>    pStream-&gt;<a class="code hl_variable" href="structTFileStream.html#a3428b5a1e790560349940aa04e37e580">Base</a>.<a class="code hl_variable" href="unionTBaseProviderData.html#a6590a4657a7d8ac3102397fbf8527142">Http</a>.<a class="code hl_variable" href="unionTBaseProviderData.html#a7600eddf4d54431e5ee51d9c53c348f5">hInternet</a> = InternetOpen(<a class="code hl_define" href="StormPort_8h.html#ae936e4c15227768f7da4e0951def89c8">_T</a>(<span class="stringliteral">&quot;StormLib HTTP MPQ reader&quot;</span>),</div>
<div class="line"><span class="lineno">  711</span>                                                INTERNET_OPEN_TYPE_PRECONFIG,</div>
<div class="line"><span class="lineno">  712</span>                                                NULL,</div>
<div class="line"><span class="lineno">  713</span>                                                NULL,</div>
<div class="line"><span class="lineno">  714</span>                                                0);</div>
<div class="line"><span class="lineno">  715</span>    <span class="keywordflow">if</span>(pStream-&gt;<a class="code hl_variable" href="structTFileStream.html#a3428b5a1e790560349940aa04e37e580">Base</a>.<a class="code hl_variable" href="unionTBaseProviderData.html#a6590a4657a7d8ac3102397fbf8527142">Http</a>.<a class="code hl_variable" href="unionTBaseProviderData.html#a7600eddf4d54431e5ee51d9c53c348f5">hInternet</a> != NULL)</div>
<div class="line"><span class="lineno">  716</span>    {</div>
<div class="line"><span class="lineno">  717</span>        <a class="code hl_typedef" href="StormPort_8h.html#a03bdb8ce5895c7e261aadc2529637546">TCHAR</a> szServerName[<a class="code hl_define" href="StormPort_8h.html#ab99ded389af74001a6298fc9e44e74e5">MAX_PATH</a>];</div>
<div class="line"><span class="lineno">  718</span>        <a class="code hl_typedef" href="StormPort_8h.html#a798af1e30bc65f319c1a246cecf59e39">DWORD</a> dwFlags = INTERNET_FLAG_KEEP_CONNECTION | INTERNET_FLAG_NO_UI | INTERNET_FLAG_NO_CACHE_WRITE;</div>
<div class="line"><span class="lineno">  719</span> </div>
<div class="line"><span class="lineno">  720</span>        <span class="comment">// Initiate connection with the server</span></div>
<div class="line"><span class="lineno">  721</span>        szFileName = <a class="code hl_function" href="FileStream_8cpp.html#ad97af1a620ae3db5bf6917027893ae9f">BaseHttp_ExtractServerName</a>(szFileName, szServerName);</div>
<div class="line"><span class="lineno">  722</span>        pStream-&gt;<a class="code hl_variable" href="structTFileStream.html#a3428b5a1e790560349940aa04e37e580">Base</a>.<a class="code hl_variable" href="unionTBaseProviderData.html#a6590a4657a7d8ac3102397fbf8527142">Http</a>.<a class="code hl_variable" href="unionTBaseProviderData.html#a5f1669f33fb9d76f8fb0e416a2d0807a">hConnect</a> = InternetConnect(pStream-&gt;<a class="code hl_variable" href="structTFileStream.html#a3428b5a1e790560349940aa04e37e580">Base</a>.<a class="code hl_variable" href="unionTBaseProviderData.html#a6590a4657a7d8ac3102397fbf8527142">Http</a>.<a class="code hl_variable" href="unionTBaseProviderData.html#a7600eddf4d54431e5ee51d9c53c348f5">hInternet</a>,</div>
<div class="line"><span class="lineno">  723</span>                                                      szServerName,</div>
<div class="line"><span class="lineno">  724</span>                                                      INTERNET_DEFAULT_HTTP_PORT,</div>
<div class="line"><span class="lineno">  725</span>                                                      NULL,</div>
<div class="line"><span class="lineno">  726</span>                                                      NULL,</div>
<div class="line"><span class="lineno">  727</span>                                                      INTERNET_SERVICE_HTTP,</div>
<div class="line"><span class="lineno">  728</span>                                                      dwFlags,</div>
<div class="line"><span class="lineno">  729</span>                                                      0);</div>
<div class="line"><span class="lineno">  730</span>        <span class="keywordflow">if</span>(pStream-&gt;<a class="code hl_variable" href="structTFileStream.html#a3428b5a1e790560349940aa04e37e580">Base</a>.<a class="code hl_variable" href="unionTBaseProviderData.html#a6590a4657a7d8ac3102397fbf8527142">Http</a>.<a class="code hl_variable" href="unionTBaseProviderData.html#a5f1669f33fb9d76f8fb0e416a2d0807a">hConnect</a> != NULL)</div>
<div class="line"><span class="lineno">  731</span>        {</div>
<div class="line"><span class="lineno">  732</span>            <span class="comment">// Open HTTP request to the file</span></div>
<div class="line"><span class="lineno">  733</span>            hRequest = HttpOpenRequest(pStream-&gt;<a class="code hl_variable" href="structTFileStream.html#a3428b5a1e790560349940aa04e37e580">Base</a>.<a class="code hl_variable" href="unionTBaseProviderData.html#a6590a4657a7d8ac3102397fbf8527142">Http</a>.<a class="code hl_variable" href="unionTBaseProviderData.html#a5f1669f33fb9d76f8fb0e416a2d0807a">hConnect</a>, <a class="code hl_define" href="StormPort_8h.html#ae936e4c15227768f7da4e0951def89c8">_T</a>(<span class="stringliteral">&quot;GET&quot;</span>), szFileName, NULL, NULL, NULL, INTERNET_FLAG_NO_CACHE_WRITE, 0);</div>
<div class="line"><span class="lineno">  734</span>            <span class="keywordflow">if</span>(hRequest != NULL)</div>
<div class="line"><span class="lineno">  735</span>            {</div>
<div class="line"><span class="lineno">  736</span>                <span class="keywordflow">if</span>(HttpSendRequest(hRequest, NULL, 0, NULL, 0))</div>
<div class="line"><span class="lineno">  737</span>                {</div>
<div class="line"><span class="lineno">  738</span>                    <a class="code hl_typedef" href="StormPort_8h.html#abb9abb9ce956f1a9e5a4081ac40e5649">ULONGLONG</a> FileTime = 0;</div>
<div class="line"><span class="lineno">  739</span>                    <a class="code hl_typedef" href="StormPort_8h.html#a798af1e30bc65f319c1a246cecf59e39">DWORD</a> dwFileSize = 0;</div>
<div class="line"><span class="lineno">  740</span>                    <a class="code hl_typedef" href="StormPort_8h.html#a798af1e30bc65f319c1a246cecf59e39">DWORD</a> dwDataSize;</div>
<div class="line"><span class="lineno">  741</span>                    <a class="code hl_typedef" href="StormPort_8h.html#a798af1e30bc65f319c1a246cecf59e39">DWORD</a> dwIndex = 0;</div>
<div class="line"><span class="lineno">  742</span>                    <a class="code hl_typedef" href="StormPort_8h.html#a03bdb8ce5895c7e261aadc2529637546">TCHAR</a> StatusCode[0x08];</div>
<div class="line"><span class="lineno">  743</span> </div>
<div class="line"><span class="lineno">  744</span>                    <span class="comment">// Check if the file succeeded to open</span></div>
<div class="line"><span class="lineno">  745</span>                    dwDataSize = <span class="keyword">sizeof</span>(StatusCode);</div>
<div class="line"><span class="lineno">  746</span>                    <span class="keywordflow">if</span>(HttpQueryInfo(hRequest, HTTP_QUERY_STATUS_CODE, StatusCode, &amp;dwDataSize, &amp;dwIndex))</div>
<div class="line"><span class="lineno">  747</span>                    {</div>
<div class="line"><span class="lineno">  748</span>                        <span class="keywordflow">if</span>(_tcscmp(StatusCode, <a class="code hl_define" href="StormPort_8h.html#ae936e4c15227768f7da4e0951def89c8">_T</a>(<span class="stringliteral">&quot;200&quot;</span>)))</div>
<div class="line"><span class="lineno">  749</span>                        {</div>
<div class="line"><span class="lineno">  750</span>                            InternetCloseHandle(hRequest);</div>
<div class="line"><span class="lineno">  751</span>                            <a class="code hl_function" href="FileStream_8cpp.html#a65dd8d3e416ffbd6ac5f468c6bdccac9">SetLastError</a>(<a class="code hl_define" href="StormPort_8h.html#aecc8b368d5ba0386b219fdd6a916b0b2">ERROR_FILE_NOT_FOUND</a>);</div>
<div class="line"><span class="lineno">  752</span>                            <span class="keywordflow">return</span> <span class="keyword">false</span>;</div>
<div class="line"><span class="lineno">  753</span>                        }</div>
<div class="line"><span class="lineno">  754</span>                    }</div>
<div class="line"><span class="lineno">  755</span> </div>
<div class="line"><span class="lineno">  756</span>                    <span class="comment">// Check if the MPQ has Last Modified field</span></div>
<div class="line"><span class="lineno">  757</span>                    dwDataSize = <span class="keyword">sizeof</span>(<a class="code hl_typedef" href="StormPort_8h.html#abb9abb9ce956f1a9e5a4081ac40e5649">ULONGLONG</a>);</div>
<div class="line"><span class="lineno">  758</span>                    <span class="keywordflow">if</span>(HttpQueryInfo(hRequest, HTTP_QUERY_LAST_MODIFIED | HTTP_QUERY_FLAG_SYSTEMTIME, &amp;FileTime, &amp;dwDataSize, &amp;dwIndex))</div>
<div class="line"><span class="lineno">  759</span>                        pStream-&gt;<a class="code hl_variable" href="structTFileStream.html#a3428b5a1e790560349940aa04e37e580">Base</a>.<a class="code hl_variable" href="unionTBaseProviderData.html#a6590a4657a7d8ac3102397fbf8527142">Http</a>.<a class="code hl_variable" href="unionTBaseProviderData.html#a5488a6d2334bab001fbdd9e2ae2cdb00">FileTime</a> = FileTime;</div>
<div class="line"><span class="lineno">  760</span> </div>
<div class="line"><span class="lineno">  761</span>                    <span class="comment">// Verify if the server supports random access</span></div>
<div class="line"><span class="lineno">  762</span>                    dwDataSize = <span class="keyword">sizeof</span>(<a class="code hl_typedef" href="StormPort_8h.html#a798af1e30bc65f319c1a246cecf59e39">DWORD</a>);</div>
<div class="line"><span class="lineno">  763</span>                    <span class="keywordflow">if</span>(HttpQueryInfo(hRequest, HTTP_QUERY_CONTENT_LENGTH | HTTP_QUERY_FLAG_NUMBER, &amp;dwFileSize, &amp;dwDataSize, &amp;dwIndex))</div>
<div class="line"><span class="lineno">  764</span>                    {</div>
<div class="line"><span class="lineno">  765</span>                        <span class="keywordflow">if</span>(dwFileSize != 0)</div>
<div class="line"><span class="lineno">  766</span>                        {</div>
<div class="line"><span class="lineno">  767</span>                            InternetCloseHandle(hRequest);</div>
<div class="line"><span class="lineno">  768</span>                            pStream-&gt;<a class="code hl_variable" href="structTFileStream.html#a3428b5a1e790560349940aa04e37e580">Base</a>.<a class="code hl_variable" href="unionTBaseProviderData.html#a6590a4657a7d8ac3102397fbf8527142">Http</a>.<a class="code hl_variable" href="unionTBaseProviderData.html#ad644c7067435cf51727186729b970d55">FileSize</a> = dwFileSize;</div>
<div class="line"><span class="lineno">  769</span>                            pStream-&gt;<a class="code hl_variable" href="structTFileStream.html#a3428b5a1e790560349940aa04e37e580">Base</a>.<a class="code hl_variable" href="unionTBaseProviderData.html#a6590a4657a7d8ac3102397fbf8527142">Http</a>.<a class="code hl_variable" href="unionTBaseProviderData.html#ac625a3e6bcdc60e1cd5d1bb7ed062028">FilePos</a> = 0;</div>
<div class="line"><span class="lineno">  770</span>                            <span class="keywordflow">return</span> <span class="keyword">true</span>;</div>
<div class="line"><span class="lineno">  771</span>                        }</div>
<div class="line"><span class="lineno">  772</span>                    }</div>
<div class="line"><span class="lineno">  773</span>                }</div>
<div class="line"><span class="lineno">  774</span> </div>
<div class="line"><span class="lineno">  775</span>                <span class="comment">// Close the request</span></div>
<div class="line"><span class="lineno">  776</span>                InternetCloseHandle(hRequest);</div>
<div class="line"><span class="lineno">  777</span>            }</div>
<div class="line"><span class="lineno">  778</span> </div>
<div class="line"><span class="lineno">  779</span>            <span class="comment">// Close the connection handle</span></div>
<div class="line"><span class="lineno">  780</span>            InternetCloseHandle(pStream-&gt;<a class="code hl_variable" href="structTFileStream.html#a3428b5a1e790560349940aa04e37e580">Base</a>.<a class="code hl_variable" href="unionTBaseProviderData.html#a6590a4657a7d8ac3102397fbf8527142">Http</a>.<a class="code hl_variable" href="unionTBaseProviderData.html#a5f1669f33fb9d76f8fb0e416a2d0807a">hConnect</a>);</div>
<div class="line"><span class="lineno">  781</span>            pStream-&gt;<a class="code hl_variable" href="structTFileStream.html#a3428b5a1e790560349940aa04e37e580">Base</a>.<a class="code hl_variable" href="unionTBaseProviderData.html#a6590a4657a7d8ac3102397fbf8527142">Http</a>.<a class="code hl_variable" href="unionTBaseProviderData.html#a5f1669f33fb9d76f8fb0e416a2d0807a">hConnect</a> = NULL;</div>
<div class="line"><span class="lineno">  782</span>        }</div>
<div class="line"><span class="lineno">  783</span> </div>
<div class="line"><span class="lineno">  784</span>        <span class="comment">// Close the internet handle</span></div>
<div class="line"><span class="lineno">  785</span>        InternetCloseHandle(pStream-&gt;<a class="code hl_variable" href="structTFileStream.html#a3428b5a1e790560349940aa04e37e580">Base</a>.<a class="code hl_variable" href="unionTBaseProviderData.html#a6590a4657a7d8ac3102397fbf8527142">Http</a>.<a class="code hl_variable" href="unionTBaseProviderData.html#a7600eddf4d54431e5ee51d9c53c348f5">hInternet</a>);</div>
<div class="line"><span class="lineno">  786</span>        pStream-&gt;<a class="code hl_variable" href="structTFileStream.html#a3428b5a1e790560349940aa04e37e580">Base</a>.<a class="code hl_variable" href="unionTBaseProviderData.html#a6590a4657a7d8ac3102397fbf8527142">Http</a>.<a class="code hl_variable" href="unionTBaseProviderData.html#a7600eddf4d54431e5ee51d9c53c348f5">hInternet</a> = NULL;</div>
<div class="line"><span class="lineno">  787</span>    }</div>
<div class="line"><span class="lineno">  788</span> </div>
<div class="line"><span class="lineno">  789</span>    <span class="comment">// If the file is not there or is not available for random access, report error</span></div>
<div class="line"><span class="lineno">  790</span>    pStream-&gt;<a class="code hl_variable" href="structTFileStream.html#acbdc7dfef3127e4c077310381f8f6c7d">BaseClose</a>(pStream);</div>
<div class="line"><span class="lineno">  791</span>    <span class="keywordflow">return</span> <span class="keyword">false</span>;</div>
<div class="line"><span class="lineno">  792</span> </div>
<div class="line"><span class="lineno">  793</span><span class="preprocessor">#else</span></div>
<div class="line"><span class="lineno">  794</span> </div>
<div class="line"><span class="lineno">  795</span>    <span class="comment">// Not supported</span></div>
<div class="line"><span class="lineno">  796</span>    <a class="code hl_function" href="FileStream_8cpp.html#a65dd8d3e416ffbd6ac5f468c6bdccac9">SetLastError</a>(<a class="code hl_define" href="StormPort_8h.html#ab72d05032a6d1152bad9af394811d447">ERROR_NOT_SUPPORTED</a>);</div>
<div class="line"><span class="lineno">  797</span>    pStream = pStream;</div>
<div class="line"><span class="lineno">  798</span>    <span class="keywordflow">return</span> <span class="keyword">false</span>;</div>
<div class="line"><span class="lineno">  799</span> </div>
<div class="line"><span class="lineno">  800</span><span class="preprocessor">#endif</span></div>
<div class="line"><span class="lineno">  801</span>}</div>
<div class="ttc" id="aFileStream_8cpp_html_ad97af1a620ae3db5bf6917027893ae9f"><div class="ttname"><a href="FileStream_8cpp.html#ad97af1a620ae3db5bf6917027893ae9f">BaseHttp_ExtractServerName</a></div><div class="ttdeci">static const TCHAR * BaseHttp_ExtractServerName(const TCHAR *szFileName, TCHAR *szServerName)</div><div class="ttdef"><b>Definition</b> <a href="FileStream_8cpp_source.html#l00672">FileStream.cpp:672</a></div></div>
<div class="ttc" id="aStormPort_8h_html_ab72d05032a6d1152bad9af394811d447"><div class="ttname"><a href="StormPort_8h.html#ab72d05032a6d1152bad9af394811d447">ERROR_NOT_SUPPORTED</a></div><div class="ttdeci">#define ERROR_NOT_SUPPORTED</div><div class="ttdef"><b>Definition</b> <a href="StormPort_8h_source.html#l00406">StormPort.h:406</a></div></div>
<div class="ttc" id="aStormPort_8h_html_ab99ded389af74001a6298fc9e44e74e5"><div class="ttname"><a href="StormPort_8h.html#ab99ded389af74001a6298fc9e44e74e5">MAX_PATH</a></div><div class="ttdeci">#define MAX_PATH</div><div class="ttdef"><b>Definition</b> <a href="StormPort_8h_source.html#l00360">StormPort.h:360</a></div></div>
<div class="ttc" id="aStormPort_8h_html_aecc8b368d5ba0386b219fdd6a916b0b2"><div class="ttname"><a href="StormPort_8h.html#aecc8b368d5ba0386b219fdd6a916b0b2">ERROR_FILE_NOT_FOUND</a></div><div class="ttdeci">#define ERROR_FILE_NOT_FOUND</div><div class="ttdef"><b>Definition</b> <a href="StormPort_8h_source.html#l00402">StormPort.h:402</a></div></div>
</div><!-- fragment --><div class="dynheader">
Here is the call graph for this function:</div>
<div class="dyncontent">
<div class="center"><iframe scrolling="no" frameborder="0" src="FileStream_8cpp_a23f58ada8682609f6f455ce846ecd83a_cgraph.svg" width="398" height="86"><p><b>This browser is not able to show SVG: try Firefox, Chrome, Safari, or Opera instead.</b></p></iframe></div>
</div>
<div class="dynheader">
Here is the caller graph for this function:</div>
<div class="dyncontent">
<div class="center"><iframe scrolling="no" frameborder="0" src="FileStream_8cpp_a23f58ada8682609f6f455ce846ecd83a_icgraph.svg" width="292" height="36"><p><b>This browser is not able to show SVG: try Firefox, Chrome, Safari, or Opera instead.</b></p></iframe></div>
</div>

</div>
</div>
<a id="ab80f4fa5604af2840f231a7aa9233c31" name="ab80f4fa5604af2840f231a7aa9233c31"></a>
<h2 class="memtitle"><span class="permalink"><a href="#ab80f4fa5604af2840f231a7aa9233c31">&#9670;&#160;</a></span>BaseHttp_Read()</h2>

<div class="memitem">
<div class="memproto">
<table class="mlabels">
  <tr>
  <td class="mlabels-left">
      <table class="memname">
        <tr>
          <td class="memname">static <a class="el" href="StormPort_8h.html#abb452686968e48b67397da5f97445f5b">bool</a> BaseHttp_Read </td>
          <td>(</td>
          <td class="paramtype"><a class="el" href="structTFileStream.html">TFileStream</a> *&#160;</td>
          <td class="paramname"><em>pStream</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype"><a class="el" href="StormPort_8h.html#abb9abb9ce956f1a9e5a4081ac40e5649">ULONGLONG</a> *&#160;</td>
          <td class="paramname"><em>pByteOffset</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">void *&#160;</td>
          <td class="paramname"><em>pvBuffer</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype"><a class="el" href="StormPort_8h.html#a798af1e30bc65f319c1a246cecf59e39">DWORD</a>&#160;</td>
          <td class="paramname"><em>dwBytesToRead</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
  </td>
  <td class="mlabels-right">
<span class="mlabels"><span class="mlabel">static</span></span>  </td>
  </tr>
</table>
</div><div class="memdoc">

<p class="definition">Definition at line <a class="el" href="FileStream_8cpp_source.html#l00803">803</a> of file <a class="el" href="FileStream_8cpp_source.html">FileStream.cpp</a>.</p>
<div class="fragment"><div class="line"><span class="lineno">  808</span>{</div>
<div class="line"><span class="lineno">  809</span><span class="preprocessor">#ifdef STORMLIB_WINDOWS</span></div>
<div class="line"><span class="lineno">  810</span>    <a class="code hl_typedef" href="StormPort_8h.html#abb9abb9ce956f1a9e5a4081ac40e5649">ULONGLONG</a> ByteOffset = (pByteOffset != NULL) ? *pByteOffset : pStream-&gt;Base.Http.FilePos;</div>
<div class="line"><span class="lineno">  811</span>    <a class="code hl_typedef" href="StormPort_8h.html#a798af1e30bc65f319c1a246cecf59e39">DWORD</a> dwTotalBytesRead = 0;</div>
<div class="line"><span class="lineno">  812</span> </div>
<div class="line"><span class="lineno">  813</span>    <span class="comment">// Do we have to read anything at all?</span></div>
<div class="line"><span class="lineno">  814</span>    <span class="keywordflow">if</span>(dwBytesToRead != 0)</div>
<div class="line"><span class="lineno">  815</span>    {</div>
<div class="line"><span class="lineno">  816</span>        HINTERNET hRequest;</div>
<div class="line"><span class="lineno">  817</span>        <a class="code hl_typedef" href="StormPort_8h.html#a8ff75c0813d9c26a6009f93b02a00254">LPCTSTR</a> szFileName;</div>
<div class="line"><span class="lineno">  818</span>        <a class="code hl_typedef" href="StormPort_8h.html#ac2d3fb16b5b34c1e6ab80014309020eb">LPBYTE</a> pbBuffer = (<a class="code hl_typedef" href="StormPort_8h.html#ac2d3fb16b5b34c1e6ab80014309020eb">LPBYTE</a>)pvBuffer;</div>
<div class="line"><span class="lineno">  819</span>        <a class="code hl_typedef" href="StormPort_8h.html#a03bdb8ce5895c7e261aadc2529637546">TCHAR</a> szRangeRequest[0x80];</div>
<div class="line"><span class="lineno">  820</span>        <a class="code hl_typedef" href="StormPort_8h.html#a798af1e30bc65f319c1a246cecf59e39">DWORD</a> dwStartOffset = (<a class="code hl_typedef" href="StormPort_8h.html#a798af1e30bc65f319c1a246cecf59e39">DWORD</a>)ByteOffset;</div>
<div class="line"><span class="lineno">  821</span>        <a class="code hl_typedef" href="StormPort_8h.html#a798af1e30bc65f319c1a246cecf59e39">DWORD</a> dwEndOffset = dwStartOffset + dwBytesToRead;</div>
<div class="line"><span class="lineno">  822</span> </div>
<div class="line"><span class="lineno">  823</span>        <span class="comment">// Open HTTP request to the file</span></div>
<div class="line"><span class="lineno">  824</span>        szFileName = <a class="code hl_function" href="FileStream_8cpp.html#ad97af1a620ae3db5bf6917027893ae9f">BaseHttp_ExtractServerName</a>(pStream-&gt;<a class="code hl_variable" href="structTFileStream.html#a7a4da926d708d96cb47333973e705c76">szFileName</a>, NULL);</div>
<div class="line"><span class="lineno">  825</span>        hRequest = HttpOpenRequest(pStream-&gt;<a class="code hl_variable" href="structTFileStream.html#a3428b5a1e790560349940aa04e37e580">Base</a>.<a class="code hl_variable" href="unionTBaseProviderData.html#a6590a4657a7d8ac3102397fbf8527142">Http</a>.<a class="code hl_variable" href="unionTBaseProviderData.html#a5f1669f33fb9d76f8fb0e416a2d0807a">hConnect</a>, <a class="code hl_define" href="StormPort_8h.html#ae936e4c15227768f7da4e0951def89c8">_T</a>(<span class="stringliteral">&quot;GET&quot;</span>), szFileName, NULL, NULL, NULL, INTERNET_FLAG_NO_CACHE_WRITE, 0);</div>
<div class="line"><span class="lineno">  826</span>        <span class="keywordflow">if</span>(hRequest != NULL)</div>
<div class="line"><span class="lineno">  827</span>        {</div>
<div class="line"><span class="lineno">  828</span>            <span class="comment">// Add range request to the HTTP headers</span></div>
<div class="line"><span class="lineno">  829</span>            <span class="comment">// http://www.clevercomponents.com/articles/article015/resuming.asp</span></div>
<div class="line"><span class="lineno">  830</span>            wsprintf(szRangeRequest, <a class="code hl_define" href="StormPort_8h.html#ae936e4c15227768f7da4e0951def89c8">_T</a>(<span class="stringliteral">&quot;Range: bytes=%u-%u&quot;</span>), (<span class="keywordtype">unsigned</span> <span class="keywordtype">int</span>)dwStartOffset, (<span class="keywordtype">unsigned</span> <span class="keywordtype">int</span>)dwEndOffset);</div>
<div class="line"><span class="lineno">  831</span>            HttpAddRequestHeaders(hRequest, szRangeRequest, 0xFFFFFFFF, HTTP_ADDREQ_FLAG_ADD_IF_NEW);</div>
<div class="line"><span class="lineno">  832</span> </div>
<div class="line"><span class="lineno">  833</span>            <span class="comment">// Send the request to the server</span></div>
<div class="line"><span class="lineno">  834</span>            <span class="keywordflow">if</span>(HttpSendRequest(hRequest, NULL, 0, NULL, 0))</div>
<div class="line"><span class="lineno">  835</span>            {</div>
<div class="line"><span class="lineno">  836</span>                <span class="keywordflow">while</span>(dwTotalBytesRead &lt; dwBytesToRead)</div>
<div class="line"><span class="lineno">  837</span>                {</div>
<div class="line"><span class="lineno">  838</span>                    <a class="code hl_typedef" href="StormPort_8h.html#a798af1e30bc65f319c1a246cecf59e39">DWORD</a> dwBlockBytesToRead = dwBytesToRead - dwTotalBytesRead;</div>
<div class="line"><span class="lineno">  839</span>                    <a class="code hl_typedef" href="StormPort_8h.html#a798af1e30bc65f319c1a246cecf59e39">DWORD</a> dwBlockBytesRead = 0;</div>
<div class="line"><span class="lineno">  840</span> </div>
<div class="line"><span class="lineno">  841</span>                    <span class="comment">// Read the block from the file</span></div>
<div class="line"><span class="lineno">  842</span>                    <span class="keywordflow">if</span>(dwBlockBytesToRead &gt; 0x200)</div>
<div class="line"><span class="lineno">  843</span>                        dwBlockBytesToRead = 0x200;</div>
<div class="line"><span class="lineno">  844</span>                    InternetReadFile(hRequest, pbBuffer, dwBlockBytesToRead, &amp;dwBlockBytesRead);</div>
<div class="line"><span class="lineno">  845</span> </div>
<div class="line"><span class="lineno">  846</span>                    <span class="comment">// Check for end</span></div>
<div class="line"><span class="lineno">  847</span>                    <span class="keywordflow">if</span>(dwBlockBytesRead == 0)</div>
<div class="line"><span class="lineno">  848</span>                        <span class="keywordflow">break</span>;</div>
<div class="line"><span class="lineno">  849</span> </div>
<div class="line"><span class="lineno">  850</span>                    <span class="comment">// Move buffers</span></div>
<div class="line"><span class="lineno">  851</span>                    dwTotalBytesRead += dwBlockBytesRead;</div>
<div class="line"><span class="lineno">  852</span>                    pbBuffer += dwBlockBytesRead;</div>
<div class="line"><span class="lineno">  853</span>                }</div>
<div class="line"><span class="lineno">  854</span>            }</div>
<div class="line"><span class="lineno">  855</span>            InternetCloseHandle(hRequest);</div>
<div class="line"><span class="lineno">  856</span>        }</div>
<div class="line"><span class="lineno">  857</span>    }</div>
<div class="line"><span class="lineno">  858</span> </div>
<div class="line"><span class="lineno">  859</span>    <span class="comment">// Increment the current file position by number of bytes read</span></div>
<div class="line"><span class="lineno">  860</span>    pStream-&gt;<a class="code hl_variable" href="structTFileStream.html#a3428b5a1e790560349940aa04e37e580">Base</a>.<a class="code hl_variable" href="unionTBaseProviderData.html#a6590a4657a7d8ac3102397fbf8527142">Http</a>.<a class="code hl_variable" href="unionTBaseProviderData.html#ac625a3e6bcdc60e1cd5d1bb7ed062028">FilePos</a> = ByteOffset + dwTotalBytesRead;</div>
<div class="line"><span class="lineno">  861</span> </div>
<div class="line"><span class="lineno">  862</span>    <span class="comment">// If the number of bytes read doesn&#39;t match the required amount, return false</span></div>
<div class="line"><span class="lineno">  863</span>    <span class="keywordflow">if</span>(dwTotalBytesRead != dwBytesToRead)</div>
<div class="line"><span class="lineno">  864</span>        <a class="code hl_function" href="FileStream_8cpp.html#a65dd8d3e416ffbd6ac5f468c6bdccac9">SetLastError</a>(<a class="code hl_define" href="StormPort_8h.html#a71791529fd25c32cd91d6a716e5e1755">ERROR_HANDLE_EOF</a>);</div>
<div class="line"><span class="lineno">  865</span>    <span class="keywordflow">return</span> (dwTotalBytesRead == dwBytesToRead);</div>
<div class="line"><span class="lineno">  866</span> </div>
<div class="line"><span class="lineno">  867</span><span class="preprocessor">#else</span></div>
<div class="line"><span class="lineno">  868</span> </div>
<div class="line"><span class="lineno">  869</span>    <span class="comment">// Not supported</span></div>
<div class="line"><span class="lineno">  870</span>    pStream = pStream;</div>
<div class="line"><span class="lineno">  871</span>    pByteOffset = pByteOffset;</div>
<div class="line"><span class="lineno">  872</span>    pvBuffer = pvBuffer;</div>
<div class="line"><span class="lineno">  873</span>    dwBytesToRead = dwBytesToRead;</div>
<div class="line"><span class="lineno">  874</span>    <a class="code hl_function" href="FileStream_8cpp.html#a65dd8d3e416ffbd6ac5f468c6bdccac9">SetLastError</a>(<a class="code hl_define" href="StormPort_8h.html#ab72d05032a6d1152bad9af394811d447">ERROR_NOT_SUPPORTED</a>);</div>
<div class="line"><span class="lineno">  875</span>    <span class="keywordflow">return</span> <span class="keyword">false</span>;</div>
<div class="line"><span class="lineno">  876</span> </div>
<div class="line"><span class="lineno">  877</span><span class="preprocessor">#endif</span></div>
<div class="line"><span class="lineno">  878</span>}</div>
<div class="ttc" id="aStormPort_8h_html_a8ff75c0813d9c26a6009f93b02a00254"><div class="ttname"><a href="StormPort_8h.html#a8ff75c0813d9c26a6009f93b02a00254">LPCTSTR</a></div><div class="ttdeci">const char * LPCTSTR</div><div class="ttdef"><b>Definition</b> <a href="StormPort_8h_source.html#l00349">StormPort.h:349</a></div></div>
<div class="ttc" id="aStormPort_8h_html_ac2d3fb16b5b34c1e6ab80014309020eb"><div class="ttname"><a href="StormPort_8h.html#ac2d3fb16b5b34c1e6ab80014309020eb">LPBYTE</a></div><div class="ttdeci">BYTE * LPBYTE</div><div class="ttdef"><b>Definition</b> <a href="StormPort_8h_source.html#l00348">StormPort.h:348</a></div></div>
</div><!-- fragment --><div class="dynheader">
Here is the call graph for this function:</div>
<div class="dyncontent">
<div class="center"><iframe scrolling="no" frameborder="0" src="FileStream_8cpp_ab80f4fa5604af2840f231a7aa9233c31_cgraph.svg" width="398" height="86"><p><b>This browser is not able to show SVG: try Firefox, Chrome, Safari, or Opera instead.</b></p></iframe></div>
</div>
<div class="dynheader">
Here is the caller graph for this function:</div>
<div class="dyncontent">
<div class="center"><iframe scrolling="no" frameborder="0" src="FileStream_8cpp_ab80f4fa5604af2840f231a7aa9233c31_icgraph.svg" width="292" height="36"><p><b>This browser is not able to show SVG: try Firefox, Chrome, Safari, or Opera instead.</b></p></iframe></div>
</div>

</div>
</div>
<a id="a8bb2c5a67c52652853c0e1dc0938459a" name="a8bb2c5a67c52652853c0e1dc0938459a"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a8bb2c5a67c52652853c0e1dc0938459a">&#9670;&#160;</a></span>BaseMap_Close()</h2>

<div class="memitem">
<div class="memproto">
<table class="mlabels">
  <tr>
  <td class="mlabels-left">
      <table class="memname">
        <tr>
          <td class="memname">static void BaseMap_Close </td>
          <td>(</td>
          <td class="paramtype"><a class="el" href="structTFileStream.html">TFileStream</a> *&#160;</td>
          <td class="paramname"><em>pStream</em></td><td>)</td>
          <td></td>
        </tr>
      </table>
  </td>
  <td class="mlabels-right">
<span class="mlabels"><span class="mlabel">static</span></span>  </td>
  </tr>
</table>
</div><div class="memdoc">

<p class="definition">Definition at line <a class="el" href="FileStream_8cpp_source.html#l00637">637</a> of file <a class="el" href="FileStream_8cpp_source.html">FileStream.cpp</a>.</p>
<div class="fragment"><div class="line"><span class="lineno">  638</span>{</div>
<div class="line"><span class="lineno">  639</span> </div>
<div class="line"><span class="lineno">  640</span><span class="preprocessor">#ifdef STORMLIB_WINDOWS</span></div>
<div class="line"><span class="lineno">  641</span> </div>
<div class="line"><span class="lineno">  642</span>    <span class="keywordflow">if</span>(pStream-&gt;<a class="code hl_variable" href="structTFileStream.html#a3428b5a1e790560349940aa04e37e580">Base</a>.<a class="code hl_variable" href="unionTBaseProviderData.html#ab63d3152bef4e6ffa5c370771ea959d8">Map</a>.<a class="code hl_variable" href="unionTBaseProviderData.html#aea205a6b13a6cfadd115a4e44513eb2e">pbFile</a> != NULL)</div>
<div class="line"><span class="lineno">  643</span>        UnmapViewOfFile(pStream-&gt;<a class="code hl_variable" href="structTFileStream.html#a3428b5a1e790560349940aa04e37e580">Base</a>.<a class="code hl_variable" href="unionTBaseProviderData.html#ab63d3152bef4e6ffa5c370771ea959d8">Map</a>.<a class="code hl_variable" href="unionTBaseProviderData.html#aea205a6b13a6cfadd115a4e44513eb2e">pbFile</a>);</div>
<div class="line"><span class="lineno">  644</span> </div>
<div class="line"><span class="lineno">  645</span><span class="preprocessor">#elif defined(STORMLIB_HAS_MMAP)</span></div>
<div class="line"><span class="lineno">  646</span> </div>
<div class="line"><span class="lineno">  647</span>    <span class="keywordflow">if</span>(pStream-&gt;<a class="code hl_variable" href="structTFileStream.html#a3428b5a1e790560349940aa04e37e580">Base</a>.<a class="code hl_variable" href="unionTBaseProviderData.html#ab63d3152bef4e6ffa5c370771ea959d8">Map</a>.<a class="code hl_variable" href="unionTBaseProviderData.html#aea205a6b13a6cfadd115a4e44513eb2e">pbFile</a> != NULL)</div>
<div class="line"><span class="lineno">  648</span>        munmap(pStream-&gt;<a class="code hl_variable" href="structTFileStream.html#a3428b5a1e790560349940aa04e37e580">Base</a>.<a class="code hl_variable" href="unionTBaseProviderData.html#ab63d3152bef4e6ffa5c370771ea959d8">Map</a>.<a class="code hl_variable" href="unionTBaseProviderData.html#aea205a6b13a6cfadd115a4e44513eb2e">pbFile</a>, (<span class="keywordtype">size_t</span> )pStream-&gt;<a class="code hl_variable" href="structTFileStream.html#a3428b5a1e790560349940aa04e37e580">Base</a>.<a class="code hl_variable" href="unionTBaseProviderData.html#ab63d3152bef4e6ffa5c370771ea959d8">Map</a>.<a class="code hl_variable" href="unionTBaseProviderData.html#ad644c7067435cf51727186729b970d55">FileSize</a>);</div>
<div class="line"><span class="lineno">  649</span> </div>
<div class="line"><span class="lineno">  650</span><span class="preprocessor">#endif</span></div>
<div class="line"><span class="lineno">  651</span> </div>
<div class="line"><span class="lineno">  652</span>    pStream-&gt;<a class="code hl_variable" href="structTFileStream.html#a3428b5a1e790560349940aa04e37e580">Base</a>.<a class="code hl_variable" href="unionTBaseProviderData.html#ab63d3152bef4e6ffa5c370771ea959d8">Map</a>.<a class="code hl_variable" href="unionTBaseProviderData.html#aea205a6b13a6cfadd115a4e44513eb2e">pbFile</a> = NULL;</div>
<div class="line"><span class="lineno">  653</span>}</div>
<div class="ttc" id="aunionTBaseProviderData_html_ab63d3152bef4e6ffa5c370771ea959d8"><div class="ttname"><a href="unionTBaseProviderData.html#ab63d3152bef4e6ffa5c370771ea959d8">TBaseProviderData::Map</a></div><div class="ttdeci">struct TBaseProviderData::@54 Map</div></div>
<div class="ttc" id="aunionTBaseProviderData_html_aea205a6b13a6cfadd115a4e44513eb2e"><div class="ttname"><a href="unionTBaseProviderData.html#aea205a6b13a6cfadd115a4e44513eb2e">TBaseProviderData::pbFile</a></div><div class="ttdeci">LPBYTE pbFile</div><div class="ttdef"><b>Definition</b> <a href="FileStream_8h_source.html#l00140">FileStream.h:140</a></div></div>
</div><!-- fragment --><div class="dynheader">
Here is the caller graph for this function:</div>
<div class="dyncontent">
<div class="center"><iframe scrolling="no" frameborder="0" src="FileStream_8cpp_a8bb2c5a67c52652853c0e1dc0938459a_icgraph.svg" width="295" height="36"><p><b>This browser is not able to show SVG: try Firefox, Chrome, Safari, or Opera instead.</b></p></iframe></div>
</div>

</div>
</div>
<a id="ad38ec64c05bb01e557120b0aa95107fe" name="ad38ec64c05bb01e557120b0aa95107fe"></a>
<h2 class="memtitle"><span class="permalink"><a href="#ad38ec64c05bb01e557120b0aa95107fe">&#9670;&#160;</a></span>BaseMap_Init()</h2>

<div class="memitem">
<div class="memproto">
<table class="mlabels">
  <tr>
  <td class="mlabels-left">
      <table class="memname">
        <tr>
          <td class="memname">static void BaseMap_Init </td>
          <td>(</td>
          <td class="paramtype"><a class="el" href="structTFileStream.html">TFileStream</a> *&#160;</td>
          <td class="paramname"><em>pStream</em></td><td>)</td>
          <td></td>
        </tr>
      </table>
  </td>
  <td class="mlabels-right">
<span class="mlabels"><span class="mlabel">static</span></span>  </td>
  </tr>
</table>
</div><div class="memdoc">

<p class="definition">Definition at line <a class="el" href="FileStream_8cpp_source.html#l00656">656</a> of file <a class="el" href="FileStream_8cpp_source.html">FileStream.cpp</a>.</p>
<div class="fragment"><div class="line"><span class="lineno">  657</span>{</div>
<div class="line"><span class="lineno">  658</span>    <span class="comment">// Supply the file stream functions</span></div>
<div class="line"><span class="lineno">  659</span>    pStream-&gt;<a class="code hl_variable" href="structTFileStream.html#a82013f6bc9d5e52d1efe42b0dc464d4c">BaseOpen</a>    = <a class="code hl_function" href="FileStream_8cpp.html#aaa64c0983d11f20e1f019b98e4a2587b">BaseMap_Open</a>;</div>
<div class="line"><span class="lineno">  660</span>    pStream-&gt;<a class="code hl_variable" href="structTFileStream.html#a5b6aa0a4b5d6b97770f73fbc47412da1">BaseRead</a>    = <a class="code hl_function" href="FileStream_8cpp.html#a5bb3a0e407aa8ded55574693550b4ad2">BaseMap_Read</a>;</div>
<div class="line"><span class="lineno">  661</span>    pStream-&gt;<a class="code hl_variable" href="structTFileStream.html#a0366f518ffecab4131bf2527f22964e3">BaseGetSize</a> = <a class="code hl_function" href="FileStream_8cpp.html#a55e7d166af5374820da7c39a63eabb78">BaseFile_GetSize</a>;    <span class="comment">// Reuse BaseFile function</span></div>
<div class="line"><span class="lineno">  662</span>    pStream-&gt;<a class="code hl_variable" href="structTFileStream.html#aa9c8095dd8a2e07b83611e0b5dac3fde">BaseGetPos</a>  = <a class="code hl_function" href="FileStream_8cpp.html#a83df9c1c4278b431d59568a3ae4dc39f">BaseFile_GetPos</a>;     <span class="comment">// Reuse BaseFile function</span></div>
<div class="line"><span class="lineno">  663</span>    pStream-&gt;<a class="code hl_variable" href="structTFileStream.html#acbdc7dfef3127e4c077310381f8f6c7d">BaseClose</a>   = <a class="code hl_function" href="FileStream_8cpp.html#a8bb2c5a67c52652853c0e1dc0938459a">BaseMap_Close</a>;</div>
<div class="line"><span class="lineno">  664</span> </div>
<div class="line"><span class="lineno">  665</span>    <span class="comment">// Mapped files are read-only</span></div>
<div class="line"><span class="lineno">  666</span>    pStream-&gt;<a class="code hl_variable" href="structTFileStream.html#ae61935eec67ce99ea4091bc0949de1ea">dwFlags</a> |= <a class="code hl_define" href="StormLib_8h.html#abdbbf06488f24699775afe6aadaeafc3">STREAM_FLAG_READ_ONLY</a>;</div>
<div class="line"><span class="lineno">  667</span>}</div>
<div class="ttc" id="aFileStream_8cpp_html_a5bb3a0e407aa8ded55574693550b4ad2"><div class="ttname"><a href="FileStream_8cpp.html#a5bb3a0e407aa8ded55574693550b4ad2">BaseMap_Read</a></div><div class="ttdeci">static bool BaseMap_Read(TFileStream *pStream, ULONGLONG *pByteOffset, void *pvBuffer, DWORD dwBytesToRead)</div><div class="ttdef"><b>Definition</b> <a href="FileStream_8cpp_source.html#l00613">FileStream.cpp:613</a></div></div>
<div class="ttc" id="aFileStream_8cpp_html_a8bb2c5a67c52652853c0e1dc0938459a"><div class="ttname"><a href="FileStream_8cpp.html#a8bb2c5a67c52652853c0e1dc0938459a">BaseMap_Close</a></div><div class="ttdeci">static void BaseMap_Close(TFileStream *pStream)</div><div class="ttdef"><b>Definition</b> <a href="FileStream_8cpp_source.html#l00637">FileStream.cpp:637</a></div></div>
<div class="ttc" id="aFileStream_8cpp_html_aaa64c0983d11f20e1f019b98e4a2587b"><div class="ttname"><a href="FileStream_8cpp.html#aaa64c0983d11f20e1f019b98e4a2587b">BaseMap_Open</a></div><div class="ttdeci">static bool BaseMap_Open(TFileStream *pStream, LPCTSTR szFileName, DWORD dwStreamFlags)</div><div class="ttdef"><b>Definition</b> <a href="FileStream_8cpp_source.html#l00502">FileStream.cpp:502</a></div></div>
</div><!-- fragment --><div class="dynheader">
Here is the call graph for this function:</div>
<div class="dyncontent">
<div class="center"><iframe scrolling="no" frameborder="0" src="FileStream_8cpp_ad38ec64c05bb01e557120b0aa95107fe_cgraph.svg" width="596" height="234"><p><b>This browser is not able to show SVG: try Firefox, Chrome, Safari, or Opera instead.</b></p></iframe></div>
</div>

</div>
</div>
<a id="aaa64c0983d11f20e1f019b98e4a2587b" name="aaa64c0983d11f20e1f019b98e4a2587b"></a>
<h2 class="memtitle"><span class="permalink"><a href="#aaa64c0983d11f20e1f019b98e4a2587b">&#9670;&#160;</a></span>BaseMap_Open()</h2>

<div class="memitem">
<div class="memproto">
<table class="mlabels">
  <tr>
  <td class="mlabels-left">
      <table class="memname">
        <tr>
          <td class="memname">static <a class="el" href="StormPort_8h.html#abb452686968e48b67397da5f97445f5b">bool</a> BaseMap_Open </td>
          <td>(</td>
          <td class="paramtype"><a class="el" href="structTFileStream.html">TFileStream</a> *&#160;</td>
          <td class="paramname"><em>pStream</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype"><a class="el" href="StormPort_8h.html#a8ff75c0813d9c26a6009f93b02a00254">LPCTSTR</a>&#160;</td>
          <td class="paramname"><em>szFileName</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype"><a class="el" href="StormPort_8h.html#a798af1e30bc65f319c1a246cecf59e39">DWORD</a>&#160;</td>
          <td class="paramname"><em>dwStreamFlags</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
  </td>
  <td class="mlabels-right">
<span class="mlabels"><span class="mlabel">static</span></span>  </td>
  </tr>
</table>
</div><div class="memdoc">

<p class="definition">Definition at line <a class="el" href="FileStream_8cpp_source.html#l00502">502</a> of file <a class="el" href="FileStream_8cpp_source.html">FileStream.cpp</a>.</p>
<div class="fragment"><div class="line"><span class="lineno">  503</span>{</div>
<div class="line"><span class="lineno">  504</span><span class="preprocessor">#ifdef STORMLIB_WINDOWS</span></div>
<div class="line"><span class="lineno">  505</span> </div>
<div class="line"><span class="lineno">  506</span>    ULARGE_INTEGER FileSize = {0};</div>
<div class="line"><span class="lineno">  507</span>    <a class="code hl_typedef" href="StormPort_8h.html#aa8c0374618b33785ccb02f74bcfebc46">HANDLE</a> hFile = <a class="code hl_define" href="FileStream_8cpp.html#a5fdc7facea201bfce4ad308105f88d0c">INVALID_HANDLE_VALUE</a>;</div>
<div class="line"><span class="lineno">  508</span>    <a class="code hl_typedef" href="StormPort_8h.html#aa8c0374618b33785ccb02f74bcfebc46">HANDLE</a> hMap = NULL;</div>
<div class="line"><span class="lineno">  509</span>    <span class="keywordtype">bool</span> bResult = <span class="keyword">false</span>;</div>
<div class="line"><span class="lineno">  510</span> </div>
<div class="line"><span class="lineno">  511</span>    <span class="comment">// Keep compiler happy</span></div>
<div class="line"><span class="lineno">  512</span>    dwStreamFlags = dwStreamFlags;</div>
<div class="line"><span class="lineno">  513</span> </div>
<div class="line"><span class="lineno">  514</span>    <span class="comment">// 1) Try to treat &quot;szFileName&quot; as a section name</span></div>
<div class="line"><span class="lineno">  515</span>    hMap = OpenFileMapping(SECTION_QUERY | FILE_MAP_READ, <a class="code hl_define" href="mpq-internal_8h.html#aa93f0eb578d23995850d61f7d61c55c1">FALSE</a>, szFileName);</div>
<div class="line"><span class="lineno">  516</span>    <span class="keywordflow">if</span>(hMap != NULL)</div>
<div class="line"><span class="lineno">  517</span>    {</div>
<div class="line"><span class="lineno">  518</span>        <span class="comment">// Try to retrieve the size of the mapping</span></div>
<div class="line"><span class="lineno">  519</span>        <span class="keywordflow">if</span>(!RetrieveFileMappingSize(hMap, FileSize))</div>
<div class="line"><span class="lineno">  520</span>        {</div>
<div class="line"><span class="lineno">  521</span>            CloseHandle(hMap);</div>
<div class="line"><span class="lineno">  522</span>            hMap = NULL;</div>
<div class="line"><span class="lineno">  523</span>        }</div>
<div class="line"><span class="lineno">  524</span>    }</div>
<div class="line"><span class="lineno">  525</span> </div>
<div class="line"><span class="lineno">  526</span>    <span class="comment">// 2) Treat the name as file name</span></div>
<div class="line"><span class="lineno">  527</span>    <span class="keywordflow">else</span></div>
<div class="line"><span class="lineno">  528</span>    {</div>
<div class="line"><span class="lineno">  529</span>        hFile = CreateFile(szFileName, FILE_READ_DATA, FILE_SHARE_READ, NULL, OPEN_EXISTING, 0, NULL);</div>
<div class="line"><span class="lineno">  530</span>        <span class="keywordflow">if</span>(hFile != <a class="code hl_define" href="FileStream_8cpp.html#a5fdc7facea201bfce4ad308105f88d0c">INVALID_HANDLE_VALUE</a>)</div>
<div class="line"><span class="lineno">  531</span>        {</div>
<div class="line"><span class="lineno">  532</span>            <span class="comment">// Retrieve file size. Don&#39;t allow mapping file of a zero size.</span></div>
<div class="line"><span class="lineno">  533</span>            FileSize.LowPart = <a class="code hl_function" href="storm_8cpp.html#a73746c1c75c90ae66df94ed4b6933f3d">GetFileSize</a>(hFile, &amp;FileSize.HighPart);</div>
<div class="line"><span class="lineno">  534</span>            <span class="keywordflow">if</span>(FileSize.QuadPart != 0)</div>
<div class="line"><span class="lineno">  535</span>            {</div>
<div class="line"><span class="lineno">  536</span>                <span class="comment">// Now create file mapping over the file</span></div>
<div class="line"><span class="lineno">  537</span>                hMap = CreateFileMapping(hFile, NULL, PAGE_READONLY, 0, 0, NULL);</div>
<div class="line"><span class="lineno">  538</span>            }</div>
<div class="line"><span class="lineno">  539</span>        }</div>
<div class="line"><span class="lineno">  540</span>    }</div>
<div class="line"><span class="lineno">  541</span> </div>
<div class="line"><span class="lineno">  542</span>    <span class="comment">// Did it succeed?</span></div>
<div class="line"><span class="lineno">  543</span>    <span class="keywordflow">if</span>(hMap != NULL)</div>
<div class="line"><span class="lineno">  544</span>    {</div>
<div class="line"><span class="lineno">  545</span>        <span class="comment">// Map the entire view into memory</span></div>
<div class="line"><span class="lineno">  546</span>        <span class="comment">// Note that this operation will fail if the file can&#39;t fit</span></div>
<div class="line"><span class="lineno">  547</span>        <span class="comment">// into usermode address space</span></div>
<div class="line"><span class="lineno">  548</span>        pStream-&gt;<a class="code hl_variable" href="structTFileStream.html#a3428b5a1e790560349940aa04e37e580">Base</a>.<a class="code hl_variable" href="unionTBaseProviderData.html#ab63d3152bef4e6ffa5c370771ea959d8">Map</a>.<a class="code hl_variable" href="unionTBaseProviderData.html#aea205a6b13a6cfadd115a4e44513eb2e">pbFile</a> = (<a class="code hl_typedef" href="StormPort_8h.html#ac2d3fb16b5b34c1e6ab80014309020eb">LPBYTE</a>)MapViewOfFile(hMap, FILE_MAP_READ, 0, 0, 0);</div>
<div class="line"><span class="lineno">  549</span>        <span class="keywordflow">if</span>(pStream-&gt;<a class="code hl_variable" href="structTFileStream.html#a3428b5a1e790560349940aa04e37e580">Base</a>.<a class="code hl_variable" href="unionTBaseProviderData.html#ab63d3152bef4e6ffa5c370771ea959d8">Map</a>.<a class="code hl_variable" href="unionTBaseProviderData.html#aea205a6b13a6cfadd115a4e44513eb2e">pbFile</a> != NULL)</div>
<div class="line"><span class="lineno">  550</span>        {</div>
<div class="line"><span class="lineno">  551</span>            <span class="comment">// Retrieve file time. If it&#39;s named section, put 0</span></div>
<div class="line"><span class="lineno">  552</span>            <span class="keywordflow">if</span>(hFile != <a class="code hl_define" href="FileStream_8cpp.html#a5fdc7facea201bfce4ad308105f88d0c">INVALID_HANDLE_VALUE</a>)</div>
<div class="line"><span class="lineno">  553</span>                GetFileTime(hFile, NULL, NULL, (LPFILETIME)&amp;pStream-&gt;<a class="code hl_variable" href="structTFileStream.html#a3428b5a1e790560349940aa04e37e580">Base</a>.<a class="code hl_variable" href="unionTBaseProviderData.html#ab63d3152bef4e6ffa5c370771ea959d8">Map</a>.<a class="code hl_variable" href="unionTBaseProviderData.html#a5488a6d2334bab001fbdd9e2ae2cdb00">FileTime</a>);</div>
<div class="line"><span class="lineno">  554</span> </div>
<div class="line"><span class="lineno">  555</span>            <span class="comment">// Retrieve file size and position</span></div>
<div class="line"><span class="lineno">  556</span>            pStream-&gt;<a class="code hl_variable" href="structTFileStream.html#a3428b5a1e790560349940aa04e37e580">Base</a>.<a class="code hl_variable" href="unionTBaseProviderData.html#ab63d3152bef4e6ffa5c370771ea959d8">Map</a>.<a class="code hl_variable" href="unionTBaseProviderData.html#ad644c7067435cf51727186729b970d55">FileSize</a> = FileSize.QuadPart;</div>
<div class="line"><span class="lineno">  557</span>            pStream-&gt;<a class="code hl_variable" href="structTFileStream.html#a3428b5a1e790560349940aa04e37e580">Base</a>.<a class="code hl_variable" href="unionTBaseProviderData.html#ab63d3152bef4e6ffa5c370771ea959d8">Map</a>.<a class="code hl_variable" href="unionTBaseProviderData.html#ac625a3e6bcdc60e1cd5d1bb7ed062028">FilePos</a> = 0;</div>
<div class="line"><span class="lineno">  558</span>            bResult = <span class="keyword">true</span>;</div>
<div class="line"><span class="lineno">  559</span>        }</div>
<div class="line"><span class="lineno">  560</span> </div>
<div class="line"><span class="lineno">  561</span>        <span class="comment">// Close the map handle</span></div>
<div class="line"><span class="lineno">  562</span>        CloseHandle(hMap);</div>
<div class="line"><span class="lineno">  563</span>    }</div>
<div class="line"><span class="lineno">  564</span> </div>
<div class="line"><span class="lineno">  565</span>    <span class="comment">// Close the file handle</span></div>
<div class="line"><span class="lineno">  566</span>    <span class="keywordflow">if</span>(hFile != <a class="code hl_define" href="FileStream_8cpp.html#a5fdc7facea201bfce4ad308105f88d0c">INVALID_HANDLE_VALUE</a>)</div>
<div class="line"><span class="lineno">  567</span>        CloseHandle(hFile);</div>
<div class="line"><span class="lineno">  568</span> </div>
<div class="line"><span class="lineno">  569</span>    <span class="comment">// Return the result of the operation</span></div>
<div class="line"><span class="lineno">  570</span>    <span class="keywordflow">return</span> bResult;</div>
<div class="line"><span class="lineno">  571</span> </div>
<div class="line"><span class="lineno">  572</span><span class="preprocessor">#elif defined(STORMLIB_HAS_MMAP)</span></div>
<div class="line"><span class="lineno">  573</span> </div>
<div class="line"><span class="lineno">  574</span>    <span class="keyword">struct </span>stat64 fileinfo;</div>
<div class="line"><span class="lineno">  575</span>    <a class="code hl_typedef" href="winvs__stdint_8h.html#abd3131a20f4053d808d4277db3e39a23">intptr_t</a> handle;</div>
<div class="line"><span class="lineno">  576</span>    <span class="keywordtype">bool</span> bResult = <span class="keyword">false</span>;</div>
<div class="line"><span class="lineno">  577</span> </div>
<div class="line"><span class="lineno">  578</span>    <span class="comment">// Open the file</span></div>
<div class="line"><span class="lineno">  579</span>    handle = open(szFileName, O_RDONLY);</div>
<div class="line"><span class="lineno">  580</span>    <span class="keywordflow">if</span>(handle != -1)</div>
<div class="line"><span class="lineno">  581</span>    {</div>
<div class="line"><span class="lineno">  582</span>        <span class="comment">// Get the file size</span></div>
<div class="line"><span class="lineno">  583</span>        <span class="keywordflow">if</span>(fstat64(handle, &amp;fileinfo) != -1)</div>
<div class="line"><span class="lineno">  584</span>        {</div>
<div class="line"><span class="lineno">  585</span>            pStream-&gt;<a class="code hl_variable" href="structTFileStream.html#a3428b5a1e790560349940aa04e37e580">Base</a>.<a class="code hl_variable" href="unionTBaseProviderData.html#ab63d3152bef4e6ffa5c370771ea959d8">Map</a>.<a class="code hl_variable" href="unionTBaseProviderData.html#aea205a6b13a6cfadd115a4e44513eb2e">pbFile</a> = (<a class="code hl_typedef" href="StormPort_8h.html#ac2d3fb16b5b34c1e6ab80014309020eb">LPBYTE</a>)mmap(NULL, (<span class="keywordtype">size_t</span>)fileinfo.st_size, PROT_READ, MAP_PRIVATE, handle, 0);</div>
<div class="line"><span class="lineno">  586</span>            <span class="keywordflow">if</span>(pStream-&gt;<a class="code hl_variable" href="structTFileStream.html#a3428b5a1e790560349940aa04e37e580">Base</a>.<a class="code hl_variable" href="unionTBaseProviderData.html#ab63d3152bef4e6ffa5c370771ea959d8">Map</a>.<a class="code hl_variable" href="unionTBaseProviderData.html#aea205a6b13a6cfadd115a4e44513eb2e">pbFile</a> != NULL)</div>
<div class="line"><span class="lineno">  587</span>            {</div>
<div class="line"><span class="lineno">  588</span>                <span class="comment">// time_t is number of seconds since 1.1.1970, UTC.</span></div>
<div class="line"><span class="lineno">  589</span>                <span class="comment">// 1 second = 10000000 (decimal) in FILETIME</span></div>
<div class="line"><span class="lineno">  590</span>                <span class="comment">// Set the start to 1.1.1970 00:00:00</span></div>
<div class="line"><span class="lineno">  591</span>                pStream-&gt;<a class="code hl_variable" href="structTFileStream.html#a3428b5a1e790560349940aa04e37e580">Base</a>.<a class="code hl_variable" href="unionTBaseProviderData.html#ab63d3152bef4e6ffa5c370771ea959d8">Map</a>.<a class="code hl_variable" href="unionTBaseProviderData.html#a5488a6d2334bab001fbdd9e2ae2cdb00">FileTime</a> = 0x019DB1DED53E8000ULL + (10000000 * fileinfo.st_mtime);</div>
<div class="line"><span class="lineno">  592</span>                pStream-&gt;<a class="code hl_variable" href="structTFileStream.html#a3428b5a1e790560349940aa04e37e580">Base</a>.<a class="code hl_variable" href="unionTBaseProviderData.html#ab63d3152bef4e6ffa5c370771ea959d8">Map</a>.<a class="code hl_variable" href="unionTBaseProviderData.html#ad644c7067435cf51727186729b970d55">FileSize</a> = (<a class="code hl_typedef" href="StormPort_8h.html#abb9abb9ce956f1a9e5a4081ac40e5649">ULONGLONG</a>)fileinfo.st_size;</div>
<div class="line"><span class="lineno">  593</span>                pStream-&gt;<a class="code hl_variable" href="structTFileStream.html#a3428b5a1e790560349940aa04e37e580">Base</a>.<a class="code hl_variable" href="unionTBaseProviderData.html#ab63d3152bef4e6ffa5c370771ea959d8">Map</a>.<a class="code hl_variable" href="unionTBaseProviderData.html#ac625a3e6bcdc60e1cd5d1bb7ed062028">FilePos</a> = 0;</div>
<div class="line"><span class="lineno">  594</span>                bResult = <span class="keyword">true</span>;</div>
<div class="line"><span class="lineno">  595</span>            }</div>
<div class="line"><span class="lineno">  596</span>        }</div>
<div class="line"><span class="lineno">  597</span>        close(handle);</div>
<div class="line"><span class="lineno">  598</span>    }</div>
<div class="line"><span class="lineno">  599</span> </div>
<div class="line"><span class="lineno">  600</span>    <span class="comment">// Did the mapping fail?</span></div>
<div class="line"><span class="lineno">  601</span>    <span class="keywordflow">if</span>(bResult == <span class="keyword">false</span>)</div>
<div class="line"><span class="lineno">  602</span>        <a class="code hl_variable" href="FileStream_8cpp.html#ae1b34ad1b2653fcef5fac54d2fea9943">dwLastError</a> = errno;</div>
<div class="line"><span class="lineno">  603</span>    <span class="keywordflow">return</span> bResult;</div>
<div class="line"><span class="lineno">  604</span> </div>
<div class="line"><span class="lineno">  605</span><span class="preprocessor">#else</span></div>
<div class="line"><span class="lineno">  606</span> </div>
<div class="line"><span class="lineno">  607</span>    <span class="comment">// File mapping is not supported</span></div>
<div class="line"><span class="lineno">  608</span>    <span class="keywordflow">return</span> <span class="keyword">false</span>;</div>
<div class="line"><span class="lineno">  609</span> </div>
<div class="line"><span class="lineno">  610</span><span class="preprocessor">#endif</span></div>
<div class="line"><span class="lineno">  611</span>}</div>
<div class="ttc" id="ampq-internal_8h_html_aa93f0eb578d23995850d61f7d61c55c1"><div class="ttname"><a href="mpq-internal_8h.html#aa93f0eb578d23995850d61f7d61c55c1">FALSE</a></div><div class="ttdeci">#define FALSE</div><div class="ttdef"><b>Definition</b> <a href="mpq-internal_8h_source.html#l00059">mpq-internal.h:59</a></div></div>
</div><!-- fragment --><div class="dynheader">
Here is the call graph for this function:</div>
<div class="dyncontent">
<div class="center"><iframe scrolling="no" frameborder="0" src="FileStream_8cpp_aaa64c0983d11f20e1f019b98e4a2587b_cgraph.svg" width="426" height="36"><p><b>This browser is not able to show SVG: try Firefox, Chrome, Safari, or Opera instead.</b></p></iframe></div>
</div>
<div class="dynheader">
Here is the caller graph for this function:</div>
<div class="dyncontent">
<div class="center"><iframe scrolling="no" frameborder="0" src="FileStream_8cpp_aaa64c0983d11f20e1f019b98e4a2587b_icgraph.svg" width="292" height="36"><p><b>This browser is not able to show SVG: try Firefox, Chrome, Safari, or Opera instead.</b></p></iframe></div>
</div>

</div>
</div>
<a id="a5bb3a0e407aa8ded55574693550b4ad2" name="a5bb3a0e407aa8ded55574693550b4ad2"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a5bb3a0e407aa8ded55574693550b4ad2">&#9670;&#160;</a></span>BaseMap_Read()</h2>

<div class="memitem">
<div class="memproto">
<table class="mlabels">
  <tr>
  <td class="mlabels-left">
      <table class="memname">
        <tr>
          <td class="memname">static <a class="el" href="StormPort_8h.html#abb452686968e48b67397da5f97445f5b">bool</a> BaseMap_Read </td>
          <td>(</td>
          <td class="paramtype"><a class="el" href="structTFileStream.html">TFileStream</a> *&#160;</td>
          <td class="paramname"><em>pStream</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype"><a class="el" href="StormPort_8h.html#abb9abb9ce956f1a9e5a4081ac40e5649">ULONGLONG</a> *&#160;</td>
          <td class="paramname"><em>pByteOffset</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">void *&#160;</td>
          <td class="paramname"><em>pvBuffer</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype"><a class="el" href="StormPort_8h.html#a798af1e30bc65f319c1a246cecf59e39">DWORD</a>&#160;</td>
          <td class="paramname"><em>dwBytesToRead</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
  </td>
  <td class="mlabels-right">
<span class="mlabels"><span class="mlabel">static</span></span>  </td>
  </tr>
</table>
</div><div class="memdoc">

<p class="definition">Definition at line <a class="el" href="FileStream_8cpp_source.html#l00613">613</a> of file <a class="el" href="FileStream_8cpp_source.html">FileStream.cpp</a>.</p>
<div class="fragment"><div class="line"><span class="lineno">  618</span>{</div>
<div class="line"><span class="lineno">  619</span>    <a class="code hl_typedef" href="StormPort_8h.html#abb9abb9ce956f1a9e5a4081ac40e5649">ULONGLONG</a> ByteOffset = (pByteOffset != NULL) ? *pByteOffset : pStream-&gt;Base.<a class="code hl_namespace" href="namespaceMap.html">Map</a>.FilePos;</div>
<div class="line"><span class="lineno">  620</span> </div>
<div class="line"><span class="lineno">  621</span>    <span class="comment">// Do we have to read anything at all?</span></div>
<div class="line"><span class="lineno">  622</span>    <span class="keywordflow">if</span>(dwBytesToRead != 0)</div>
<div class="line"><span class="lineno">  623</span>    {</div>
<div class="line"><span class="lineno">  624</span>        <span class="comment">// Don&#39;t allow reading past file size</span></div>
<div class="line"><span class="lineno">  625</span>        <span class="keywordflow">if</span>((ByteOffset + dwBytesToRead) &gt; pStream-&gt;<a class="code hl_variable" href="structTFileStream.html#a3428b5a1e790560349940aa04e37e580">Base</a>.<a class="code hl_variable" href="unionTBaseProviderData.html#ab63d3152bef4e6ffa5c370771ea959d8">Map</a>.<a class="code hl_variable" href="unionTBaseProviderData.html#ad644c7067435cf51727186729b970d55">FileSize</a>)</div>
<div class="line"><span class="lineno">  626</span>            <span class="keywordflow">return</span> <span class="keyword">false</span>;</div>
<div class="line"><span class="lineno">  627</span> </div>
<div class="line"><span class="lineno">  628</span>        <span class="comment">// Copy the required data</span></div>
<div class="line"><span class="lineno">  629</span>        memcpy(pvBuffer, pStream-&gt;<a class="code hl_variable" href="structTFileStream.html#a3428b5a1e790560349940aa04e37e580">Base</a>.<a class="code hl_variable" href="unionTBaseProviderData.html#ab63d3152bef4e6ffa5c370771ea959d8">Map</a>.<a class="code hl_variable" href="unionTBaseProviderData.html#aea205a6b13a6cfadd115a4e44513eb2e">pbFile</a> + (<span class="keywordtype">size_t</span>)ByteOffset, dwBytesToRead);</div>
<div class="line"><span class="lineno">  630</span>    }</div>
<div class="line"><span class="lineno">  631</span> </div>
<div class="line"><span class="lineno">  632</span>    <span class="comment">// Move the current file position</span></div>
<div class="line"><span class="lineno">  633</span>    pStream-&gt;<a class="code hl_variable" href="structTFileStream.html#a3428b5a1e790560349940aa04e37e580">Base</a>.<a class="code hl_variable" href="unionTBaseProviderData.html#ab63d3152bef4e6ffa5c370771ea959d8">Map</a>.<a class="code hl_variable" href="unionTBaseProviderData.html#ac625a3e6bcdc60e1cd5d1bb7ed062028">FilePos</a> += dwBytesToRead;</div>
<div class="line"><span class="lineno">  634</span>    <span class="keywordflow">return</span> <span class="keyword">true</span>;</div>
<div class="line"><span class="lineno">  635</span>}</div>
<div class="ttc" id="anamespaceMap_html"><div class="ttname"><a href="namespaceMap.html">Map</a></div><div class="ttdef"><b>Definition</b> <a href="CellHandlerDefines_8hpp_source.html#l00008">CellHandlerDefines.hpp:9</a></div></div>
</div><!-- fragment --><div class="dynheader">
Here is the caller graph for this function:</div>
<div class="dyncontent">
<div class="center"><iframe scrolling="no" frameborder="0" src="FileStream_8cpp_a5bb3a0e407aa8ded55574693550b4ad2_icgraph.svg" width="292" height="36"><p><b>This browser is not able to show SVG: try Firefox, Chrome, Safari, or Opera instead.</b></p></iframe></div>
</div>

</div>
</div>
<a id="a87399e74057f7c5abc1d107319f5c9eb" name="a87399e74057f7c5abc1d107319f5c9eb"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a87399e74057f7c5abc1d107319f5c9eb">&#9670;&#160;</a></span>BaseNone_Init()</h2>

<div class="memitem">
<div class="memproto">
<table class="mlabels">
  <tr>
  <td class="mlabels-left">
      <table class="memname">
        <tr>
          <td class="memname">static void BaseNone_Init </td>
          <td>(</td>
          <td class="paramtype"><a class="el" href="structTFileStream.html">TFileStream</a> *&#160;</td>
          <td class="paramname"></td><td>)</td>
          <td></td>
        </tr>
      </table>
  </td>
  <td class="mlabels-right">
<span class="mlabels"><span class="mlabel">static</span></span>  </td>
  </tr>
</table>
</div><div class="memdoc">

<p class="definition">Definition at line <a class="el" href="FileStream_8cpp_source.html#l00087">87</a> of file <a class="el" href="FileStream_8cpp_source.html">FileStream.cpp</a>.</p>
<div class="fragment"><div class="line"><span class="lineno">   88</span>{</div>
<div class="line"><span class="lineno">   89</span>    <span class="comment">// Nothing here</span></div>
<div class="line"><span class="lineno">   90</span>}</div>
</div><!-- fragment -->
</div>
</div>
<a id="a9e4108abb90b9e3d6118cf7cde1ac35a" name="a9e4108abb90b9e3d6118cf7cde1ac35a"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a9e4108abb90b9e3d6118cf7cde1ac35a">&#9670;&#160;</a></span>Block4Stream_BlockRead()</h2>

<div class="memitem">
<div class="memproto">
<table class="mlabels">
  <tr>
  <td class="mlabels-left">
      <table class="memname">
        <tr>
          <td class="memname">static <a class="el" href="StormPort_8h.html#abb452686968e48b67397da5f97445f5b">bool</a> Block4Stream_BlockRead </td>
          <td>(</td>
          <td class="paramtype"><a class="el" href="structTBlockStream.html">TBlockStream</a> *&#160;</td>
          <td class="paramname"><em>pStream</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype"><a class="el" href="StormPort_8h.html#abb9abb9ce956f1a9e5a4081ac40e5649">ULONGLONG</a>&#160;</td>
          <td class="paramname"><em>StartOffset</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype"><a class="el" href="StormPort_8h.html#abb9abb9ce956f1a9e5a4081ac40e5649">ULONGLONG</a>&#160;</td>
          <td class="paramname"><em>EndOffset</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype"><a class="el" href="StormPort_8h.html#ac2d3fb16b5b34c1e6ab80014309020eb">LPBYTE</a>&#160;</td>
          <td class="paramname"><em>BlockBuffer</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype"><a class="el" href="StormPort_8h.html#a798af1e30bc65f319c1a246cecf59e39">DWORD</a>&#160;</td>
          <td class="paramname"><em>BytesNeeded</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype"><a class="el" href="StormPort_8h.html#abb452686968e48b67397da5f97445f5b">bool</a>&#160;</td>
          <td class="paramname"><em>bAvailable</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
  </td>
  <td class="mlabels-right">
<span class="mlabels"><span class="mlabel">static</span></span>  </td>
  </tr>
</table>
</div><div class="memdoc">

<p class="definition">Definition at line <a class="el" href="FileStream_8cpp_source.html#l02227">2227</a> of file <a class="el" href="FileStream_8cpp_source.html">FileStream.cpp</a>.</p>
<div class="fragment"><div class="line"><span class="lineno"> 2234</span>{</div>
<div class="line"><span class="lineno"> 2235</span>    <a class="code hl_union" href="unionTBaseProviderData.html">TBaseProviderData</a> * BaseArray = (<a class="code hl_union" href="unionTBaseProviderData.html">TBaseProviderData</a> *)pStream-&gt;<a class="code hl_variable" href="structTBlockStream.html#a1e2d4a2467ab4b43cec1bdd1a2f6d21a">FileBitmap</a>;</div>
<div class="line"><span class="lineno"> 2236</span>    <a class="code hl_typedef" href="StormPort_8h.html#abb9abb9ce956f1a9e5a4081ac40e5649">ULONGLONG</a> ByteOffset;</div>
<div class="line"><span class="lineno"> 2237</span>    <a class="code hl_typedef" href="StormPort_8h.html#a798af1e30bc65f319c1a246cecf59e39">DWORD</a> BytesToRead;</div>
<div class="line"><span class="lineno"> 2238</span>    <a class="code hl_typedef" href="StormPort_8h.html#a798af1e30bc65f319c1a246cecf59e39">DWORD</a> StreamIndex;</div>
<div class="line"><span class="lineno"> 2239</span>    <a class="code hl_typedef" href="StormPort_8h.html#a798af1e30bc65f319c1a246cecf59e39">DWORD</a> BlockIndex;</div>
<div class="line"><span class="lineno"> 2240</span>    <span class="keywordtype">bool</span> bResult;</div>
<div class="line"><span class="lineno"> 2241</span> </div>
<div class="line"><span class="lineno"> 2242</span>    <span class="comment">// The starting offset must be aligned to size of the block</span></div>
<div class="line"><span class="lineno"> 2243</span>    assert(pStream-&gt;<a class="code hl_variable" href="structTBlockStream.html#a1e2d4a2467ab4b43cec1bdd1a2f6d21a">FileBitmap</a> != NULL);</div>
<div class="line"><span class="lineno"> 2244</span>    assert((StartOffset &amp; (pStream-&gt;<a class="code hl_variable" href="structTBlockStream.html#a8c7180184928638b30809f7f85061fb7">BlockSize</a> - 1)) == 0);</div>
<div class="line"><span class="lineno"> 2245</span>    assert(StartOffset &lt; EndOffset);</div>
<div class="line"><span class="lineno"> 2246</span>    assert(bAvailable == <span class="keyword">true</span>);</div>
<div class="line"><span class="lineno"> 2247</span> </div>
<div class="line"><span class="lineno"> 2248</span>    <span class="comment">// Keep compiler happy</span></div>
<div class="line"><span class="lineno"> 2249</span>    bAvailable = bAvailable;</div>
<div class="line"><span class="lineno"> 2250</span>    EndOffset = EndOffset;</div>
<div class="line"><span class="lineno"> 2251</span> </div>
<div class="line"><span class="lineno"> 2252</span>    <span class="keywordflow">while</span>(BytesNeeded != 0)</div>
<div class="line"><span class="lineno"> 2253</span>    {</div>
<div class="line"><span class="lineno"> 2254</span>        <span class="comment">// Calculate the block index and the file index</span></div>
<div class="line"><span class="lineno"> 2255</span>        StreamIndex = (<a class="code hl_typedef" href="StormPort_8h.html#a798af1e30bc65f319c1a246cecf59e39">DWORD</a>)((StartOffset / pStream-&gt;<a class="code hl_variable" href="structTBlockStream.html#a8c7180184928638b30809f7f85061fb7">BlockSize</a>) / <a class="code hl_define" href="FileStream_8cpp.html#a4f5c5bf181369788c2091bbc386990f5">BLOCK4_MAX_BLOCKS</a>);</div>
<div class="line"><span class="lineno"> 2256</span>        BlockIndex  = (<a class="code hl_typedef" href="StormPort_8h.html#a798af1e30bc65f319c1a246cecf59e39">DWORD</a>)((StartOffset / pStream-&gt;<a class="code hl_variable" href="structTBlockStream.html#a8c7180184928638b30809f7f85061fb7">BlockSize</a>) % <a class="code hl_define" href="FileStream_8cpp.html#a4f5c5bf181369788c2091bbc386990f5">BLOCK4_MAX_BLOCKS</a>);</div>
<div class="line"><span class="lineno"> 2257</span>        <span class="keywordflow">if</span>(StreamIndex &gt; pStream-&gt;<a class="code hl_variable" href="structTBlockStream.html#a15f8225b96883446b4c4076ba8deca2b">BitmapSize</a>)</div>
<div class="line"><span class="lineno"> 2258</span>            <span class="keywordflow">return</span> <span class="keyword">false</span>;</div>
<div class="line"><span class="lineno"> 2259</span> </div>
<div class="line"><span class="lineno"> 2260</span>        <span class="comment">// Calculate the block offset</span></div>
<div class="line"><span class="lineno"> 2261</span>        ByteOffset = ((<a class="code hl_typedef" href="StormPort_8h.html#abb9abb9ce956f1a9e5a4081ac40e5649">ULONGLONG</a>)BlockIndex * (<a class="code hl_define" href="FileStream_8cpp.html#ab527650fea18542c0f5ad9097be0c352">BLOCK4_BLOCK_SIZE</a> + <a class="code hl_define" href="FileStream_8cpp.html#aec8b42b0300b7efd3a7bbefbacdaa5d2">BLOCK4_HASH_SIZE</a>));</div>
<div class="line"><span class="lineno"> 2262</span>        BytesToRead = <a class="code hl_define" href="StormCommon_8h.html#ad017b78e0f06caf4fcc17e7b1224424c">STORMLIB_MIN</a>(BytesNeeded, <a class="code hl_define" href="FileStream_8cpp.html#ab527650fea18542c0f5ad9097be0c352">BLOCK4_BLOCK_SIZE</a>);</div>
<div class="line"><span class="lineno"> 2263</span> </div>
<div class="line"><span class="lineno"> 2264</span>        <span class="comment">// Read from the base stream</span></div>
<div class="line"><span class="lineno"> 2265</span>        pStream-&gt;<a class="code hl_variable" href="structTFileStream.html#a3428b5a1e790560349940aa04e37e580">Base</a> = BaseArray[StreamIndex];</div>
<div class="line"><span class="lineno"> 2266</span>        bResult = pStream-&gt;<a class="code hl_variable" href="structTFileStream.html#a5b6aa0a4b5d6b97770f73fbc47412da1">BaseRead</a>(pStream, &amp;ByteOffset, BlockBuffer, BytesToRead);</div>
<div class="line"><span class="lineno"> 2267</span>        BaseArray[StreamIndex] = pStream-&gt;<a class="code hl_variable" href="structTFileStream.html#a3428b5a1e790560349940aa04e37e580">Base</a>;</div>
<div class="line"><span class="lineno"> 2268</span> </div>
<div class="line"><span class="lineno"> 2269</span>        <span class="comment">// Did the result succeed?</span></div>
<div class="line"><span class="lineno"> 2270</span>        <span class="keywordflow">if</span>(bResult == <span class="keyword">false</span>)</div>
<div class="line"><span class="lineno"> 2271</span>            <span class="keywordflow">return</span> <span class="keyword">false</span>;</div>
<div class="line"><span class="lineno"> 2272</span> </div>
<div class="line"><span class="lineno"> 2273</span>        <span class="comment">// Move pointers</span></div>
<div class="line"><span class="lineno"> 2274</span>        StartOffset += BytesToRead;</div>
<div class="line"><span class="lineno"> 2275</span>        BlockBuffer += BytesToRead;</div>
<div class="line"><span class="lineno"> 2276</span>        BytesNeeded -= BytesToRead;</div>
<div class="line"><span class="lineno"> 2277</span>    }</div>
<div class="line"><span class="lineno"> 2278</span> </div>
<div class="line"><span class="lineno"> 2279</span>    <span class="keywordflow">return</span> <span class="keyword">true</span>;</div>
<div class="line"><span class="lineno"> 2280</span>}</div>
<div class="ttc" id="aFileStream_8cpp_html_a4f5c5bf181369788c2091bbc386990f5"><div class="ttname"><a href="FileStream_8cpp.html#a4f5c5bf181369788c2091bbc386990f5">BLOCK4_MAX_BLOCKS</a></div><div class="ttdeci">#define BLOCK4_MAX_BLOCKS</div><div class="ttdef"><b>Definition</b> <a href="FileStream_8cpp_source.html#l02224">FileStream.cpp:2224</a></div></div>
<div class="ttc" id="aFileStream_8cpp_html_ab527650fea18542c0f5ad9097be0c352"><div class="ttname"><a href="FileStream_8cpp.html#ab527650fea18542c0f5ad9097be0c352">BLOCK4_BLOCK_SIZE</a></div><div class="ttdeci">#define BLOCK4_BLOCK_SIZE</div><div class="ttdef"><b>Definition</b> <a href="FileStream_8cpp_source.html#l02222">FileStream.cpp:2222</a></div></div>
<div class="ttc" id="aFileStream_8cpp_html_aec8b42b0300b7efd3a7bbefbacdaa5d2"><div class="ttname"><a href="FileStream_8cpp.html#aec8b42b0300b7efd3a7bbefbacdaa5d2">BLOCK4_HASH_SIZE</a></div><div class="ttdeci">#define BLOCK4_HASH_SIZE</div><div class="ttdef"><b>Definition</b> <a href="FileStream_8cpp_source.html#l02223">FileStream.cpp:2223</a></div></div>
<div class="ttc" id="aStormCommon_8h_html_ad017b78e0f06caf4fcc17e7b1224424c"><div class="ttname"><a href="StormCommon_8h.html#ad017b78e0f06caf4fcc17e7b1224424c">STORMLIB_MIN</a></div><div class="ttdeci">#define STORMLIB_MIN(a, b)</div><div class="ttdef"><b>Definition</b> <a href="StormCommon_8h_source.html#l00066">StormCommon.h:66</a></div></div>
<div class="ttc" id="astructTBlockStream_html_a15f8225b96883446b4c4076ba8deca2b"><div class="ttname"><a href="structTBlockStream.html#a15f8225b96883446b4c4076ba8deca2b">TBlockStream::BitmapSize</a></div><div class="ttdeci">DWORD BitmapSize</div><div class="ttdef"><b>Definition</b> <a href="FileStream_8h_source.html#l00200">FileStream.h:200</a></div></div>
<div class="ttc" id="astructTBlockStream_html_a1e2d4a2467ab4b43cec1bdd1a2f6d21a"><div class="ttname"><a href="structTBlockStream.html#a1e2d4a2467ab4b43cec1bdd1a2f6d21a">TBlockStream::FileBitmap</a></div><div class="ttdeci">void * FileBitmap</div><div class="ttdef"><b>Definition</b> <a href="FileStream_8h_source.html#l00198">FileStream.h:198</a></div></div>
<div class="ttc" id="astructTBlockStream_html_a8c7180184928638b30809f7f85061fb7"><div class="ttname"><a href="structTBlockStream.html#a8c7180184928638b30809f7f85061fb7">TBlockStream::BlockSize</a></div><div class="ttdeci">DWORD BlockSize</div><div class="ttdef"><b>Definition</b> <a href="FileStream_8h_source.html#l00201">FileStream.h:201</a></div></div>
<div class="ttc" id="aunionTBaseProviderData_html"><div class="ttname"><a href="unionTBaseProviderData.html">TBaseProviderData</a></div><div class="ttdef"><b>Definition</b> <a href="FileStream_8h_source.html#l00125">FileStream.h:126</a></div></div>
</div><!-- fragment --><div class="dynheader">
Here is the caller graph for this function:</div>
<div class="dyncontent">
<div class="center"><div class="zoom"><iframe scrolling="no" frameborder="0" src="FileStream_8cpp_a9e4108abb90b9e3d6118cf7cde1ac35a_icgraph.svg" width="100%" height="600"><p><b>This browser is not able to show SVG: try Firefox, Chrome, Safari, or Opera instead.</b></p></iframe></div></div>
</div>

</div>
</div>
<a id="ae8976be1e1619faf82a3eef7a3489925" name="ae8976be1e1619faf82a3eef7a3489925"></a>
<h2 class="memtitle"><span class="permalink"><a href="#ae8976be1e1619faf82a3eef7a3489925">&#9670;&#160;</a></span>Block4Stream_Close()</h2>

<div class="memitem">
<div class="memproto">
<table class="mlabels">
  <tr>
  <td class="mlabels-left">
      <table class="memname">
        <tr>
          <td class="memname">static void Block4Stream_Close </td>
          <td>(</td>
          <td class="paramtype"><a class="el" href="structTBlockStream.html">TBlockStream</a> *&#160;</td>
          <td class="paramname"><em>pStream</em></td><td>)</td>
          <td></td>
        </tr>
      </table>
  </td>
  <td class="mlabels-right">
<span class="mlabels"><span class="mlabel">static</span></span>  </td>
  </tr>
</table>
</div><div class="memdoc">

<p class="definition">Definition at line <a class="el" href="FileStream_8cpp_source.html#l02283">2283</a> of file <a class="el" href="FileStream_8cpp_source.html">FileStream.cpp</a>.</p>
<div class="fragment"><div class="line"><span class="lineno"> 2284</span>{</div>
<div class="line"><span class="lineno"> 2285</span>    <a class="code hl_union" href="unionTBaseProviderData.html">TBaseProviderData</a> * BaseArray = (<a class="code hl_union" href="unionTBaseProviderData.html">TBaseProviderData</a> *)pStream-&gt;<a class="code hl_variable" href="structTBlockStream.html#a1e2d4a2467ab4b43cec1bdd1a2f6d21a">FileBitmap</a>;</div>
<div class="line"><span class="lineno"> 2286</span> </div>
<div class="line"><span class="lineno"> 2287</span>    <span class="comment">// If we have a non-zero count of base streams,</span></div>
<div class="line"><span class="lineno"> 2288</span>    <span class="comment">// we have to close them all</span></div>
<div class="line"><span class="lineno"> 2289</span>    <span class="keywordflow">if</span>(BaseArray != NULL)</div>
<div class="line"><span class="lineno"> 2290</span>    {</div>
<div class="line"><span class="lineno"> 2291</span>        <span class="comment">// Close all base streams</span></div>
<div class="line"><span class="lineno"> 2292</span>        <span class="keywordflow">for</span>(<a class="code hl_typedef" href="StormPort_8h.html#a798af1e30bc65f319c1a246cecf59e39">DWORD</a> i = 0; i &lt; pStream-&gt;<a class="code hl_variable" href="structTBlockStream.html#a15f8225b96883446b4c4076ba8deca2b">BitmapSize</a>; i++)</div>
<div class="line"><span class="lineno"> 2293</span>        {</div>
<div class="line"><span class="lineno"> 2294</span>            memcpy(&amp;pStream-&gt;<a class="code hl_variable" href="structTFileStream.html#a3428b5a1e790560349940aa04e37e580">Base</a>, BaseArray + i, <span class="keyword">sizeof</span>(<a class="code hl_union" href="unionTBaseProviderData.html">TBaseProviderData</a>));</div>
<div class="line"><span class="lineno"> 2295</span>            pStream-&gt;<a class="code hl_variable" href="structTFileStream.html#acbdc7dfef3127e4c077310381f8f6c7d">BaseClose</a>(pStream);</div>
<div class="line"><span class="lineno"> 2296</span>        }</div>
<div class="line"><span class="lineno"> 2297</span>    }</div>
<div class="line"><span class="lineno"> 2298</span> </div>
<div class="line"><span class="lineno"> 2299</span>    <span class="comment">// Free the data map, if any</span></div>
<div class="line"><span class="lineno"> 2300</span>    <span class="keywordflow">if</span>(pStream-&gt;<a class="code hl_variable" href="structTBlockStream.html#a1e2d4a2467ab4b43cec1bdd1a2f6d21a">FileBitmap</a> != NULL)</div>
<div class="line"><span class="lineno"> 2301</span>        <a class="code hl_define" href="StormCommon_8h.html#a50487dadfceefebfb0de8fa711eaf4b3">STORM_FREE</a>(pStream-&gt;<a class="code hl_variable" href="structTBlockStream.html#a1e2d4a2467ab4b43cec1bdd1a2f6d21a">FileBitmap</a>);</div>
<div class="line"><span class="lineno"> 2302</span>    pStream-&gt;<a class="code hl_variable" href="structTBlockStream.html#a1e2d4a2467ab4b43cec1bdd1a2f6d21a">FileBitmap</a> = NULL;</div>
<div class="line"><span class="lineno"> 2303</span> </div>
<div class="line"><span class="lineno"> 2304</span>    <span class="comment">// Do not call the BaseClose function,</span></div>
<div class="line"><span class="lineno"> 2305</span>    <span class="comment">// we closed all handles already</span></div>
<div class="line"><span class="lineno"> 2306</span>    <span class="keywordflow">return</span>;</div>
<div class="line"><span class="lineno"> 2307</span>}</div>
<div class="ttc" id="aStormCommon_8h_html_a50487dadfceefebfb0de8fa711eaf4b3"><div class="ttname"><a href="StormCommon_8h.html#a50487dadfceefebfb0de8fa711eaf4b3">STORM_FREE</a></div><div class="ttdeci">#define STORM_FREE(ptr)</div><div class="ttdef"><b>Definition</b> <a href="StormCommon_8h_source.html#l00134">StormCommon.h:134</a></div></div>
</div><!-- fragment --><div class="dynheader">
Here is the caller graph for this function:</div>
<div class="dyncontent">
<div class="center"><div class="zoom"><iframe scrolling="no" frameborder="0" src="FileStream_8cpp_ae8976be1e1619faf82a3eef7a3489925_icgraph.svg" width="100%" height="600"><p><b>This browser is not able to show SVG: try Firefox, Chrome, Safari, or Opera instead.</b></p></iframe></div></div>
</div>

</div>
</div>
<a id="ad81c299c6f6062d49a9d7ef331cd4520" name="ad81c299c6f6062d49a9d7ef331cd4520"></a>
<h2 class="memtitle"><span class="permalink"><a href="#ad81c299c6f6062d49a9d7ef331cd4520">&#9670;&#160;</a></span>Block4Stream_Open()</h2>

<div class="memitem">
<div class="memproto">
<table class="mlabels">
  <tr>
  <td class="mlabels-left">
      <table class="memname">
        <tr>
          <td class="memname">static <a class="el" href="structTFileStream.html">TFileStream</a> * Block4Stream_Open </td>
          <td>(</td>
          <td class="paramtype"><a class="el" href="StormLib_2src_2zlib_2zconf_8h.html#a2c212835823e3c54a8ab6d95c652660e">const</a> <a class="el" href="StormPort_8h.html#a03bdb8ce5895c7e261aadc2529637546">TCHAR</a> *&#160;</td>
          <td class="paramname"><em>szFileName</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype"><a class="el" href="StormPort_8h.html#a798af1e30bc65f319c1a246cecf59e39">DWORD</a>&#160;</td>
          <td class="paramname"><em>dwStreamFlags</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
  </td>
  <td class="mlabels-right">
<span class="mlabels"><span class="mlabel">static</span></span>  </td>
  </tr>
</table>
</div><div class="memdoc">

<p class="definition">Definition at line <a class="el" href="FileStream_8cpp_source.html#l02309">2309</a> of file <a class="el" href="FileStream_8cpp_source.html">FileStream.cpp</a>.</p>
<div class="fragment"><div class="line"><span class="lineno"> 2310</span>{</div>
<div class="line"><span class="lineno"> 2311</span>    <a class="code hl_union" href="unionTBaseProviderData.html">TBaseProviderData</a> * NewBaseArray = NULL;</div>
<div class="line"><span class="lineno"> 2312</span>    <a class="code hl_typedef" href="StormPort_8h.html#abb9abb9ce956f1a9e5a4081ac40e5649">ULONGLONG</a> RemainderBlock;</div>
<div class="line"><span class="lineno"> 2313</span>    <a class="code hl_typedef" href="StormPort_8h.html#abb9abb9ce956f1a9e5a4081ac40e5649">ULONGLONG</a> BlockCount;</div>
<div class="line"><span class="lineno"> 2314</span>    <a class="code hl_typedef" href="StormPort_8h.html#abb9abb9ce956f1a9e5a4081ac40e5649">ULONGLONG</a> FileSize;</div>
<div class="line"><span class="lineno"> 2315</span>    <a class="code hl_struct" href="structTBlockStream.html">TBlockStream</a> * pStream;</div>
<div class="line"><span class="lineno"> 2316</span>    <a class="code hl_typedef" href="StormPort_8h.html#a03bdb8ce5895c7e261aadc2529637546">TCHAR</a> * szNameBuff;</div>
<div class="line"><span class="lineno"> 2317</span>    <span class="keywordtype">size_t</span> nNameLength;</div>
<div class="line"><span class="lineno"> 2318</span>    <a class="code hl_typedef" href="StormPort_8h.html#a798af1e30bc65f319c1a246cecf59e39">DWORD</a> dwBaseFiles = 0;</div>
<div class="line"><span class="lineno"> 2319</span>    <a class="code hl_typedef" href="StormPort_8h.html#a798af1e30bc65f319c1a246cecf59e39">DWORD</a> dwBaseFlags;</div>
<div class="line"><span class="lineno"> 2320</span> </div>
<div class="line"><span class="lineno"> 2321</span>    <span class="comment">// Create new empty stream</span></div>
<div class="line"><span class="lineno"> 2322</span>    pStream = (<a class="code hl_struct" href="structTBlockStream.html">TBlockStream</a> *)<a class="code hl_function" href="FileStream_8cpp.html#aa5874b3e4d05d2f6dfa3a32d62f56bea">AllocateFileStream</a>(szFileName, <span class="keyword">sizeof</span>(<a class="code hl_struct" href="structTBlockStream.html">TBlockStream</a>), dwStreamFlags);</div>
<div class="line"><span class="lineno"> 2323</span>    <span class="keywordflow">if</span>(pStream == NULL)</div>
<div class="line"><span class="lineno"> 2324</span>        <span class="keywordflow">return</span> NULL;</div>
<div class="line"><span class="lineno"> 2325</span> </div>
<div class="line"><span class="lineno"> 2326</span>    <span class="comment">// Sanity check</span></div>
<div class="line"><span class="lineno"> 2327</span>    assert(pStream-&gt;<a class="code hl_variable" href="structTFileStream.html#a82013f6bc9d5e52d1efe42b0dc464d4c">BaseOpen</a> != NULL);</div>
<div class="line"><span class="lineno"> 2328</span> </div>
<div class="line"><span class="lineno"> 2329</span>    <span class="comment">// Get the length of the file name without numeric suffix</span></div>
<div class="line"><span class="lineno"> 2330</span>    nNameLength = <a class="code hl_define" href="StormPort_8h.html#ad253c68ce58b12b277fedc2d785d7977">_tcslen</a>(pStream-&gt;<a class="code hl_variable" href="structTFileStream.html#a7a4da926d708d96cb47333973e705c76">szFileName</a>);</div>
<div class="line"><span class="lineno"> 2331</span>    <span class="keywordflow">if</span>(pStream-&gt;<a class="code hl_variable" href="structTFileStream.html#a7a4da926d708d96cb47333973e705c76">szFileName</a>[nNameLength - 2] == <span class="charliteral">&#39;.&#39;</span> &amp;&amp; pStream-&gt;<a class="code hl_variable" href="structTFileStream.html#a7a4da926d708d96cb47333973e705c76">szFileName</a>[nNameLength - 1] == <span class="charliteral">&#39;0&#39;</span>)</div>
<div class="line"><span class="lineno"> 2332</span>        nNameLength -= 2;</div>
<div class="line"><span class="lineno"> 2333</span>    pStream-&gt;<a class="code hl_variable" href="structTFileStream.html#a7a4da926d708d96cb47333973e705c76">szFileName</a>[nNameLength] = 0;</div>
<div class="line"><span class="lineno"> 2334</span> </div>
<div class="line"><span class="lineno"> 2335</span>    <span class="comment">// Supply the stream functions</span></div>
<div class="line"><span class="lineno"> 2336</span>    pStream-&gt;<a class="code hl_variable" href="structTFileStream.html#aaf7da0af26da32b968cdb66eb87f26ce">StreamRead</a>    = (<a class="code hl_typedef" href="FileStream_8h.html#a606a64221d9b9881a1f52bce34bbbf02">STREAM_READ</a>)<a class="code hl_function" href="FileStream_8cpp.html#a6aad894479c9e1b2cba754f7f3260747">BlockStream_Read</a>;</div>
<div class="line"><span class="lineno"> 2337</span>    pStream-&gt;<a class="code hl_variable" href="structTFileStream.html#a95b85c4ef3254dc6a73fdb2e566ebbba">StreamGetSize</a> = <a class="code hl_function" href="FileStream_8cpp.html#a3e8398bb76df8b526932fe0c4623cef9">BlockStream_GetSize</a>;</div>
<div class="line"><span class="lineno"> 2338</span>    pStream-&gt;<a class="code hl_variable" href="structTFileStream.html#a158f1621a05e8b3002c1729fd5d4cfca">StreamGetPos</a>  = <a class="code hl_function" href="FileStream_8cpp.html#a298aac8ccf15fff07223077eedbf2db7">BlockStream_GetPos</a>;</div>
<div class="line"><span class="lineno"> 2339</span>    pStream-&gt;<a class="code hl_variable" href="structTFileStream.html#ac3f8968d1ae374c58ab50404221834e4">StreamClose</a>   = (<a class="code hl_typedef" href="FileStream_8h.html#a585e2b6ef8c0d46cf78a6be488f8685d">STREAM_CLOSE</a>)<a class="code hl_function" href="FileStream_8cpp.html#ae8976be1e1619faf82a3eef7a3489925">Block4Stream_Close</a>;</div>
<div class="line"><span class="lineno"> 2340</span>    pStream-&gt;<a class="code hl_variable" href="structTFileStream.html#a68391daa44e09cd7654e765d81d937a3">BlockRead</a>     = (<a class="code hl_typedef" href="FileStream_8h.html#ad07760b526786fe7097b34605659f3dc">BLOCK_READ</a>)<a class="code hl_function" href="FileStream_8cpp.html#a9e4108abb90b9e3d6118cf7cde1ac35a">Block4Stream_BlockRead</a>;</div>
<div class="line"><span class="lineno"> 2341</span> </div>
<div class="line"><span class="lineno"> 2342</span>    <span class="comment">// Allocate work space for numeric names</span></div>
<div class="line"><span class="lineno"> 2343</span>    szNameBuff = <a class="code hl_define" href="StormCommon_8h.html#a6fe0c42173ef1a4b9f0e837b0c631660">STORM_ALLOC</a>(<a class="code hl_typedef" href="StormPort_8h.html#a03bdb8ce5895c7e261aadc2529637546">TCHAR</a>, nNameLength + 4);</div>
<div class="line"><span class="lineno"> 2344</span>    <span class="keywordflow">if</span>(szNameBuff != NULL)</div>
<div class="line"><span class="lineno"> 2345</span>    {</div>
<div class="line"><span class="lineno"> 2346</span>        <span class="comment">// Set the base flags</span></div>
<div class="line"><span class="lineno"> 2347</span>        dwBaseFlags = (dwStreamFlags &amp; <a class="code hl_define" href="StormLib_8h.html#a07a964e92d9c6a64250c80b56e75c520">STREAM_PROVIDERS_MASK</a>) | <a class="code hl_define" href="StormLib_8h.html#abdbbf06488f24699775afe6aadaeafc3">STREAM_FLAG_READ_ONLY</a>;</div>
<div class="line"><span class="lineno"> 2348</span> </div>
<div class="line"><span class="lineno"> 2349</span>        <span class="comment">// Go all suffixes from 0 to 30</span></div>
<div class="line"><span class="lineno"> 2350</span>        <span class="keywordflow">for</span>(<span class="keywordtype">int</span> nSuffix = 0; nSuffix &lt; 30; nSuffix++)</div>
<div class="line"><span class="lineno"> 2351</span>        {</div>
<div class="line"><span class="lineno"> 2352</span>            <span class="comment">// Open the n-th file</span></div>
<div class="line"><span class="lineno"> 2353</span>            <a class="code hl_function" href="FileStream_8cpp.html#a801d4ae05a373852d8c7636f0d9075b8">CreateNameWithSuffix</a>(szNameBuff, nNameLength + 4, pStream-&gt;<a class="code hl_variable" href="structTFileStream.html#a7a4da926d708d96cb47333973e705c76">szFileName</a>, nSuffix);</div>
<div class="line"><span class="lineno"> 2354</span>            <span class="keywordflow">if</span>(!pStream-&gt;<a class="code hl_variable" href="structTFileStream.html#a82013f6bc9d5e52d1efe42b0dc464d4c">BaseOpen</a>(pStream, szNameBuff, dwBaseFlags))</div>
<div class="line"><span class="lineno"> 2355</span>                <span class="keywordflow">break</span>;</div>
<div class="line"><span class="lineno"> 2356</span> </div>
<div class="line"><span class="lineno"> 2357</span>            <span class="comment">// If the open succeeded, we re-allocate the base provider array</span></div>
<div class="line"><span class="lineno"> 2358</span>            NewBaseArray = <a class="code hl_define" href="StormCommon_8h.html#a6fe0c42173ef1a4b9f0e837b0c631660">STORM_ALLOC</a>(<a class="code hl_union" href="unionTBaseProviderData.html">TBaseProviderData</a>, dwBaseFiles + 1);</div>
<div class="line"><span class="lineno"> 2359</span>            <span class="keywordflow">if</span>(NewBaseArray == NULL)</div>
<div class="line"><span class="lineno"> 2360</span>            {</div>
<div class="line"><span class="lineno"> 2361</span>                <a class="code hl_function" href="FileStream_8cpp.html#a65dd8d3e416ffbd6ac5f468c6bdccac9">SetLastError</a>(<a class="code hl_define" href="StormPort_8h.html#a0e8ed8133680d2d6b8909e71b8048307">ERROR_NOT_ENOUGH_MEMORY</a>);</div>
<div class="line"><span class="lineno"> 2362</span>                <span class="keywordflow">return</span> NULL;</div>
<div class="line"><span class="lineno"> 2363</span>            }</div>
<div class="line"><span class="lineno"> 2364</span> </div>
<div class="line"><span class="lineno"> 2365</span>            <span class="comment">// Copy the old base data array to the new base data array</span></div>
<div class="line"><span class="lineno"> 2366</span>            <span class="keywordflow">if</span>(pStream-&gt;<a class="code hl_variable" href="structTBlockStream.html#a1e2d4a2467ab4b43cec1bdd1a2f6d21a">FileBitmap</a> != NULL)</div>
<div class="line"><span class="lineno"> 2367</span>            {</div>
<div class="line"><span class="lineno"> 2368</span>                memcpy(NewBaseArray, pStream-&gt;<a class="code hl_variable" href="structTBlockStream.html#a1e2d4a2467ab4b43cec1bdd1a2f6d21a">FileBitmap</a>, <span class="keyword">sizeof</span>(<a class="code hl_union" href="unionTBaseProviderData.html">TBaseProviderData</a>) * dwBaseFiles);</div>
<div class="line"><span class="lineno"> 2369</span>                <a class="code hl_define" href="StormCommon_8h.html#a50487dadfceefebfb0de8fa711eaf4b3">STORM_FREE</a>(pStream-&gt;<a class="code hl_variable" href="structTBlockStream.html#a1e2d4a2467ab4b43cec1bdd1a2f6d21a">FileBitmap</a>);</div>
<div class="line"><span class="lineno"> 2370</span>            }</div>
<div class="line"><span class="lineno"> 2371</span> </div>
<div class="line"><span class="lineno"> 2372</span>            <span class="comment">// Also copy the opened base array</span></div>
<div class="line"><span class="lineno"> 2373</span>            memcpy(NewBaseArray + dwBaseFiles, &amp;pStream-&gt;<a class="code hl_variable" href="structTFileStream.html#a3428b5a1e790560349940aa04e37e580">Base</a>, <span class="keyword">sizeof</span>(<a class="code hl_union" href="unionTBaseProviderData.html">TBaseProviderData</a>));</div>
<div class="line"><span class="lineno"> 2374</span>            pStream-&gt;<a class="code hl_variable" href="structTBlockStream.html#a1e2d4a2467ab4b43cec1bdd1a2f6d21a">FileBitmap</a> = NewBaseArray;</div>
<div class="line"><span class="lineno"> 2375</span>            dwBaseFiles++;</div>
<div class="line"><span class="lineno"> 2376</span> </div>
<div class="line"><span class="lineno"> 2377</span>            <span class="comment">// Get the size of the base stream</span></div>
<div class="line"><span class="lineno"> 2378</span>            pStream-&gt;<a class="code hl_variable" href="structTFileStream.html#a0366f518ffecab4131bf2527f22964e3">BaseGetSize</a>(pStream, &amp;FileSize);</div>
<div class="line"><span class="lineno"> 2379</span>            assert(FileSize &lt;= <a class="code hl_define" href="FileStream_8cpp.html#af4003d23efcf71bac3817c9fb695d662">BLOCK4_MAX_FSIZE</a>);</div>
<div class="line"><span class="lineno"> 2380</span>            RemainderBlock = FileSize % (<a class="code hl_define" href="FileStream_8cpp.html#ab527650fea18542c0f5ad9097be0c352">BLOCK4_BLOCK_SIZE</a> + <a class="code hl_define" href="FileStream_8cpp.html#aec8b42b0300b7efd3a7bbefbacdaa5d2">BLOCK4_HASH_SIZE</a>);</div>
<div class="line"><span class="lineno"> 2381</span>            BlockCount = FileSize / (<a class="code hl_define" href="FileStream_8cpp.html#ab527650fea18542c0f5ad9097be0c352">BLOCK4_BLOCK_SIZE</a> + <a class="code hl_define" href="FileStream_8cpp.html#aec8b42b0300b7efd3a7bbefbacdaa5d2">BLOCK4_HASH_SIZE</a>);</div>
<div class="line"><span class="lineno"> 2382</span> </div>
<div class="line"><span class="lineno"> 2383</span>            <span class="comment">// Increment the stream size and number of blocks</span></div>
<div class="line"><span class="lineno"> 2384</span>            pStream-&gt;<a class="code hl_variable" href="structTFileStream.html#a99bdae10f74cf57156e65bd76ba64771">StreamSize</a> += (BlockCount * <a class="code hl_define" href="FileStream_8cpp.html#ab527650fea18542c0f5ad9097be0c352">BLOCK4_BLOCK_SIZE</a>);</div>
<div class="line"><span class="lineno"> 2385</span>            pStream-&gt;<a class="code hl_variable" href="structTBlockStream.html#a05210a0cd78477e541734ba7e3abe2b1">BlockCount</a> += (<a class="code hl_typedef" href="StormPort_8h.html#a798af1e30bc65f319c1a246cecf59e39">DWORD</a>)BlockCount;</div>
<div class="line"><span class="lineno"> 2386</span> </div>
<div class="line"><span class="lineno"> 2387</span>            <span class="comment">// Is this the last file?</span></div>
<div class="line"><span class="lineno"> 2388</span>            <span class="keywordflow">if</span>(FileSize &lt; <a class="code hl_define" href="FileStream_8cpp.html#af4003d23efcf71bac3817c9fb695d662">BLOCK4_MAX_FSIZE</a>)</div>
<div class="line"><span class="lineno"> 2389</span>            {</div>
<div class="line"><span class="lineno"> 2390</span>                <span class="keywordflow">if</span>(RemainderBlock)</div>
<div class="line"><span class="lineno"> 2391</span>                {</div>
<div class="line"><span class="lineno"> 2392</span>                    pStream-&gt;<a class="code hl_variable" href="structTFileStream.html#a99bdae10f74cf57156e65bd76ba64771">StreamSize</a> += (RemainderBlock - <a class="code hl_define" href="FileStream_8cpp.html#aec8b42b0300b7efd3a7bbefbacdaa5d2">BLOCK4_HASH_SIZE</a>);</div>
<div class="line"><span class="lineno"> 2393</span>                    pStream-&gt;<a class="code hl_variable" href="structTBlockStream.html#a05210a0cd78477e541734ba7e3abe2b1">BlockCount</a>++;</div>
<div class="line"><span class="lineno"> 2394</span>                }</div>
<div class="line"><span class="lineno"> 2395</span>                <span class="keywordflow">break</span>;</div>
<div class="line"><span class="lineno"> 2396</span>            }</div>
<div class="line"><span class="lineno"> 2397</span>        }</div>
<div class="line"><span class="lineno"> 2398</span> </div>
<div class="line"><span class="lineno"> 2399</span>        <span class="comment">// Fill the remainining block stream variables</span></div>
<div class="line"><span class="lineno"> 2400</span>        pStream-&gt;<a class="code hl_variable" href="structTBlockStream.html#a15f8225b96883446b4c4076ba8deca2b">BitmapSize</a> = dwBaseFiles;</div>
<div class="line"><span class="lineno"> 2401</span>        pStream-&gt;<a class="code hl_variable" href="structTBlockStream.html#a8c7180184928638b30809f7f85061fb7">BlockSize</a>  = <a class="code hl_define" href="FileStream_8cpp.html#ab527650fea18542c0f5ad9097be0c352">BLOCK4_BLOCK_SIZE</a>;</div>
<div class="line"><span class="lineno"> 2402</span>        pStream-&gt;<a class="code hl_variable" href="structTBlockStream.html#a8bb8ee629c5bc59f65d01eead9b62762">IsComplete</a> = 1;</div>
<div class="line"><span class="lineno"> 2403</span>        pStream-&gt;<a class="code hl_variable" href="structTBlockStream.html#ab405154b8f27af633d8f3116cce2ac66">IsModified</a> = 0;</div>
<div class="line"><span class="lineno"> 2404</span> </div>
<div class="line"><span class="lineno"> 2405</span>        <span class="comment">// Fill the remaining stream variables</span></div>
<div class="line"><span class="lineno"> 2406</span>        pStream-&gt;<a class="code hl_variable" href="structTFileStream.html#a84324f2f19bfc3fcbc563ef2391f84fe">StreamPos</a> = 0;</div>
<div class="line"><span class="lineno"> 2407</span>        pStream-&gt;<a class="code hl_variable" href="structTFileStream.html#ae61935eec67ce99ea4091bc0949de1ea">dwFlags</a> |= <a class="code hl_define" href="StormLib_8h.html#abdbbf06488f24699775afe6aadaeafc3">STREAM_FLAG_READ_ONLY</a>;</div>
<div class="line"><span class="lineno"> 2408</span> </div>
<div class="line"><span class="lineno"> 2409</span>        <a class="code hl_define" href="StormCommon_8h.html#a50487dadfceefebfb0de8fa711eaf4b3">STORM_FREE</a>(szNameBuff);</div>
<div class="line"><span class="lineno"> 2410</span>    }</div>
<div class="line"><span class="lineno"> 2411</span> </div>
<div class="line"><span class="lineno"> 2412</span>    <span class="comment">// If we opened something, return success</span></div>
<div class="line"><span class="lineno"> 2413</span>    <span class="keywordflow">if</span>(dwBaseFiles == 0)</div>
<div class="line"><span class="lineno"> 2414</span>    {</div>
<div class="line"><span class="lineno"> 2415</span>        <a class="code hl_function" href="FileStream_8cpp.html#ae8b75c4797726e9c5ee0b4b03bf31442">FileStream_Close</a>(pStream);</div>
<div class="line"><span class="lineno"> 2416</span>        <a class="code hl_function" href="FileStream_8cpp.html#a65dd8d3e416ffbd6ac5f468c6bdccac9">SetLastError</a>(<a class="code hl_define" href="StormPort_8h.html#aecc8b368d5ba0386b219fdd6a916b0b2">ERROR_FILE_NOT_FOUND</a>);</div>
<div class="line"><span class="lineno"> 2417</span>        pStream = NULL;</div>
<div class="line"><span class="lineno"> 2418</span>    }</div>
<div class="line"><span class="lineno"> 2419</span> </div>
<div class="line"><span class="lineno"> 2420</span>    <span class="keywordflow">return</span> pStream;</div>
<div class="line"><span class="lineno"> 2421</span>}</div>
<div class="ttc" id="aFileStream_8cpp_html_a298aac8ccf15fff07223077eedbf2db7"><div class="ttname"><a href="FileStream_8cpp.html#a298aac8ccf15fff07223077eedbf2db7">BlockStream_GetPos</a></div><div class="ttdeci">static bool BlockStream_GetPos(TFileStream *pStream, ULONGLONG *pByteOffset)</div><div class="ttdef"><b>Definition</b> <a href="FileStream_8cpp_source.html#l01061">FileStream.cpp:1061</a></div></div>
<div class="ttc" id="aFileStream_8cpp_html_a3e8398bb76df8b526932fe0c4623cef9"><div class="ttname"><a href="FileStream_8cpp.html#a3e8398bb76df8b526932fe0c4623cef9">BlockStream_GetSize</a></div><div class="ttdeci">static bool BlockStream_GetSize(TFileStream *pStream, ULONGLONG *pFileSize)</div><div class="ttdef"><b>Definition</b> <a href="FileStream_8cpp_source.html#l01055">FileStream.cpp:1055</a></div></div>
<div class="ttc" id="aFileStream_8cpp_html_a6aad894479c9e1b2cba754f7f3260747"><div class="ttname"><a href="FileStream_8cpp.html#a6aad894479c9e1b2cba754f7f3260747">BlockStream_Read</a></div><div class="ttdeci">static bool BlockStream_Read(TBlockStream *pStream, ULONGLONG *pByteOffset, void *pvBuffer, DWORD dwBytesToRead)</div><div class="ttdef"><b>Definition</b> <a href="FileStream_8cpp_source.html#l00915">FileStream.cpp:915</a></div></div>
<div class="ttc" id="aFileStream_8cpp_html_a801d4ae05a373852d8c7636f0d9075b8"><div class="ttname"><a href="FileStream_8cpp.html#a801d4ae05a373852d8c7636f0d9075b8">CreateNameWithSuffix</a></div><div class="ttdeci">static void CreateNameWithSuffix(LPTSTR szBuffer, size_t cchMaxChars, LPCTSTR szName, unsigned int nValue)</div><div class="ttdef"><b>Definition</b> <a href="FileStream_8cpp_source.html#l00068">FileStream.cpp:68</a></div></div>
<div class="ttc" id="aFileStream_8cpp_html_a9e4108abb90b9e3d6118cf7cde1ac35a"><div class="ttname"><a href="FileStream_8cpp.html#a9e4108abb90b9e3d6118cf7cde1ac35a">Block4Stream_BlockRead</a></div><div class="ttdeci">static bool Block4Stream_BlockRead(TBlockStream *pStream, ULONGLONG StartOffset, ULONGLONG EndOffset, LPBYTE BlockBuffer, DWORD BytesNeeded, bool bAvailable)</div><div class="ttdef"><b>Definition</b> <a href="FileStream_8cpp_source.html#l02227">FileStream.cpp:2227</a></div></div>
<div class="ttc" id="aFileStream_8cpp_html_aa5874b3e4d05d2f6dfa3a32d62f56bea"><div class="ttname"><a href="FileStream_8cpp.html#aa5874b3e4d05d2f6dfa3a32d62f56bea">AllocateFileStream</a></div><div class="ttdeci">static TFileStream * AllocateFileStream(const TCHAR *szFileName, size_t StreamSize, DWORD dwStreamFlags)</div><div class="ttdef"><b>Definition</b> <a href="FileStream_8cpp_source.html#l01092">FileStream.cpp:1092</a></div></div>
<div class="ttc" id="aFileStream_8cpp_html_ae8976be1e1619faf82a3eef7a3489925"><div class="ttname"><a href="FileStream_8cpp.html#ae8976be1e1619faf82a3eef7a3489925">Block4Stream_Close</a></div><div class="ttdeci">static void Block4Stream_Close(TBlockStream *pStream)</div><div class="ttdef"><b>Definition</b> <a href="FileStream_8cpp_source.html#l02283">FileStream.cpp:2283</a></div></div>
<div class="ttc" id="aFileStream_8cpp_html_ae8b75c4797726e9c5ee0b4b03bf31442"><div class="ttname"><a href="FileStream_8cpp.html#ae8b75c4797726e9c5ee0b4b03bf31442">FileStream_Close</a></div><div class="ttdeci">void FileStream_Close(TFileStream *pStream)</div><div class="ttdef"><b>Definition</b> <a href="FileStream_8cpp_source.html#l02907">FileStream.cpp:2907</a></div></div>
<div class="ttc" id="aFileStream_8cpp_html_af4003d23efcf71bac3817c9fb695d662"><div class="ttname"><a href="FileStream_8cpp.html#af4003d23efcf71bac3817c9fb695d662">BLOCK4_MAX_FSIZE</a></div><div class="ttdeci">#define BLOCK4_MAX_FSIZE</div><div class="ttdef"><b>Definition</b> <a href="FileStream_8cpp_source.html#l02225">FileStream.cpp:2225</a></div></div>
<div class="ttc" id="aFileStream_8h_html_a585e2b6ef8c0d46cf78a6be488f8685d"><div class="ttname"><a href="FileStream_8h.html#a585e2b6ef8c0d46cf78a6be488f8685d">STREAM_CLOSE</a></div><div class="ttdeci">void(* STREAM_CLOSE)(struct TFileStream *pStream)</div><div class="ttdef"><b>Definition</b> <a href="FileStream_8h_source.html#l00060">FileStream.h:60</a></div></div>
<div class="ttc" id="aFileStream_8h_html_a606a64221d9b9881a1f52bce34bbbf02"><div class="ttname"><a href="FileStream_8h.html#a606a64221d9b9881a1f52bce34bbbf02">STREAM_READ</a></div><div class="ttdeci">bool(* STREAM_READ)(struct TFileStream *pStream, ULONGLONG *pByteOffset, void *pvBuffer, DWORD dwBytesToRead)</div><div class="ttdef"><b>Definition</b> <a href="FileStream_8h_source.html#l00031">FileStream.h:31</a></div></div>
<div class="ttc" id="aFileStream_8h_html_ad07760b526786fe7097b34605659f3dc"><div class="ttname"><a href="FileStream_8h.html#ad07760b526786fe7097b34605659f3dc">BLOCK_READ</a></div><div class="ttdeci">bool(* BLOCK_READ)(struct TFileStream *pStream, ULONGLONG StartOffset, ULONGLONG EndOffset, LPBYTE BlockBuffer, DWORD BytesNeeded, bool bAvailable)</div><div class="ttdef"><b>Definition</b> <a href="FileStream_8h_source.html#l00064">FileStream.h:64</a></div></div>
<div class="ttc" id="aStormLib_8h_html_a07a964e92d9c6a64250c80b56e75c520"><div class="ttname"><a href="StormLib_8h.html#a07a964e92d9c6a64250c80b56e75c520">STREAM_PROVIDERS_MASK</a></div><div class="ttdeci">#define STREAM_PROVIDERS_MASK</div><div class="ttdef"><b>Definition</b> <a href="StormLib_8h_source.html#l00326">StormLib.h:326</a></div></div>
<div class="ttc" id="aStormPort_8h_html_a0e8ed8133680d2d6b8909e71b8048307"><div class="ttname"><a href="StormPort_8h.html#a0e8ed8133680d2d6b8909e71b8048307">ERROR_NOT_ENOUGH_MEMORY</a></div><div class="ttdeci">#define ERROR_NOT_ENOUGH_MEMORY</div><div class="ttdef"><b>Definition</b> <a href="StormPort_8h_source.html#l00405">StormPort.h:405</a></div></div>
<div class="ttc" id="aStormPort_8h_html_ad253c68ce58b12b277fedc2d785d7977"><div class="ttname"><a href="StormPort_8h.html#ad253c68ce58b12b277fedc2d785d7977">_tcslen</a></div><div class="ttdeci">#define _tcslen</div><div class="ttdef"><b>Definition</b> <a href="StormPort_8h_source.html#l00370">StormPort.h:370</a></div></div>
<div class="ttc" id="astructTBlockStream_html"><div class="ttname"><a href="structTBlockStream.html">TBlockStream</a></div><div class="ttdef"><b>Definition</b> <a href="FileStream_8h_source.html#l00195">FileStream.h:196</a></div></div>
<div class="ttc" id="astructTBlockStream_html_a05210a0cd78477e541734ba7e3abe2b1"><div class="ttname"><a href="structTBlockStream.html#a05210a0cd78477e541734ba7e3abe2b1">TBlockStream::BlockCount</a></div><div class="ttdeci">DWORD BlockCount</div><div class="ttdef"><b>Definition</b> <a href="FileStream_8h_source.html#l00202">FileStream.h:202</a></div></div>
<div class="ttc" id="astructTBlockStream_html_a8bb8ee629c5bc59f65d01eead9b62762"><div class="ttname"><a href="structTBlockStream.html#a8bb8ee629c5bc59f65d01eead9b62762">TBlockStream::IsComplete</a></div><div class="ttdeci">DWORD IsComplete</div><div class="ttdef"><b>Definition</b> <a href="FileStream_8h_source.html#l00203">FileStream.h:203</a></div></div>
<div class="ttc" id="astructTBlockStream_html_ab405154b8f27af633d8f3116cce2ac66"><div class="ttname"><a href="structTBlockStream.html#ab405154b8f27af633d8f3116cce2ac66">TBlockStream::IsModified</a></div><div class="ttdeci">DWORD IsModified</div><div class="ttdef"><b>Definition</b> <a href="FileStream_8h_source.html#l00204">FileStream.h:204</a></div></div>
<div class="ttc" id="astructTFileStream_html_a158f1621a05e8b3002c1729fd5d4cfca"><div class="ttname"><a href="structTFileStream.html#a158f1621a05e8b3002c1729fd5d4cfca">TFileStream::StreamGetPos</a></div><div class="ttdeci">STREAM_GETPOS StreamGetPos</div><div class="ttdef"><b>Definition</b> <a href="FileStream_8h_source.html#l00160">FileStream.h:160</a></div></div>
<div class="ttc" id="astructTFileStream_html_a68391daa44e09cd7654e765d81d937a3"><div class="ttname"><a href="structTFileStream.html#a68391daa44e09cd7654e765d81d937a3">TFileStream::BlockRead</a></div><div class="ttdeci">BLOCK_READ BlockRead</div><div class="ttdef"><b>Definition</b> <a href="FileStream_8h_source.html#l00164">FileStream.h:164</a></div></div>
<div class="ttc" id="astructTFileStream_html_a84324f2f19bfc3fcbc563ef2391f84fe"><div class="ttname"><a href="structTFileStream.html#a84324f2f19bfc3fcbc563ef2391f84fe">TFileStream::StreamPos</a></div><div class="ttdeci">ULONGLONG StreamPos</div><div class="ttdef"><b>Definition</b> <a href="FileStream_8h_source.html#l00185">FileStream.h:185</a></div></div>
<div class="ttc" id="astructTFileStream_html_a95b85c4ef3254dc6a73fdb2e566ebbba"><div class="ttname"><a href="structTFileStream.html#a95b85c4ef3254dc6a73fdb2e566ebbba">TFileStream::StreamGetSize</a></div><div class="ttdeci">STREAM_GETSIZE StreamGetSize</div><div class="ttdef"><b>Definition</b> <a href="FileStream_8h_source.html#l00159">FileStream.h:159</a></div></div>
<div class="ttc" id="astructTFileStream_html_a99bdae10f74cf57156e65bd76ba64771"><div class="ttname"><a href="structTFileStream.html#a99bdae10f74cf57156e65bd76ba64771">TFileStream::StreamSize</a></div><div class="ttdeci">ULONGLONG StreamSize</div><div class="ttdef"><b>Definition</b> <a href="FileStream_8h_source.html#l00184">FileStream.h:184</a></div></div>
<div class="ttc" id="astructTFileStream_html_aaf7da0af26da32b968cdb66eb87f26ce"><div class="ttname"><a href="structTFileStream.html#aaf7da0af26da32b968cdb66eb87f26ce">TFileStream::StreamRead</a></div><div class="ttdeci">STREAM_READ StreamRead</div><div class="ttdef"><b>Definition</b> <a href="FileStream_8h_source.html#l00156">FileStream.h:156</a></div></div>
<div class="ttc" id="astructTFileStream_html_ac3f8968d1ae374c58ab50404221834e4"><div class="ttname"><a href="structTFileStream.html#ac3f8968d1ae374c58ab50404221834e4">TFileStream::StreamClose</a></div><div class="ttdeci">STREAM_CLOSE StreamClose</div><div class="ttdef"><b>Definition</b> <a href="FileStream_8h_source.html#l00161">FileStream.h:161</a></div></div>
</div><!-- fragment --><div class="dynheader">
Here is the call graph for this function:</div>
<div class="dyncontent">
<div class="center"><div class="zoom"><iframe scrolling="no" frameborder="0" src="FileStream_8cpp_ad81c299c6f6062d49a9d7ef331cd4520_cgraph.svg" width="100%" height="600"><p><b>This browser is not able to show SVG: try Firefox, Chrome, Safari, or Opera instead.</b></p></iframe></div></div>
</div>
<div class="dynheader">
Here is the caller graph for this function:</div>
<div class="dyncontent">
<div class="center"><div class="zoom"><iframe scrolling="no" frameborder="0" src="FileStream_8cpp_ad81c299c6f6062d49a9d7ef331cd4520_icgraph.svg" width="100%" height="600"><p><b>This browser is not able to show SVG: try Firefox, Chrome, Safari, or Opera instead.</b></p></iframe></div></div>
</div>

</div>
</div>
<a id="a5074c346733483a14dce339c940186a9" name="a5074c346733483a14dce339c940186a9"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a5074c346733483a14dce339c940186a9">&#9670;&#160;</a></span>BlockStream_Close()</h2>

<div class="memitem">
<div class="memproto">
<table class="mlabels">
  <tr>
  <td class="mlabels-left">
      <table class="memname">
        <tr>
          <td class="memname">static void BlockStream_Close </td>
          <td>(</td>
          <td class="paramtype"><a class="el" href="structTBlockStream.html">TBlockStream</a> *&#160;</td>
          <td class="paramname"><em>pStream</em></td><td>)</td>
          <td></td>
        </tr>
      </table>
  </td>
  <td class="mlabels-right">
<span class="mlabels"><span class="mlabel">static</span></span>  </td>
  </tr>
</table>
</div><div class="memdoc">

<p class="definition">Definition at line <a class="el" href="FileStream_8cpp_source.html#l01067">1067</a> of file <a class="el" href="FileStream_8cpp_source.html">FileStream.cpp</a>.</p>
<div class="fragment"><div class="line"><span class="lineno"> 1068</span>{</div>
<div class="line"><span class="lineno"> 1069</span>    <span class="comment">// Free the data map, if any</span></div>
<div class="line"><span class="lineno"> 1070</span>    <span class="keywordflow">if</span>(pStream-&gt;<a class="code hl_variable" href="structTBlockStream.html#a1e2d4a2467ab4b43cec1bdd1a2f6d21a">FileBitmap</a> != NULL)</div>
<div class="line"><span class="lineno"> 1071</span>        <a class="code hl_define" href="StormCommon_8h.html#a50487dadfceefebfb0de8fa711eaf4b3">STORM_FREE</a>(pStream-&gt;<a class="code hl_variable" href="structTBlockStream.html#a1e2d4a2467ab4b43cec1bdd1a2f6d21a">FileBitmap</a>);</div>
<div class="line"><span class="lineno"> 1072</span>    pStream-&gt;<a class="code hl_variable" href="structTBlockStream.html#a1e2d4a2467ab4b43cec1bdd1a2f6d21a">FileBitmap</a> = NULL;</div>
<div class="line"><span class="lineno"> 1073</span> </div>
<div class="line"><span class="lineno"> 1074</span>    <span class="comment">// Call the base class for closing the stream</span></div>
<div class="line"><span class="lineno"> 1075</span>    pStream-&gt;<a class="code hl_variable" href="structTFileStream.html#acbdc7dfef3127e4c077310381f8f6c7d">BaseClose</a>(pStream);</div>
<div class="line"><span class="lineno"> 1076</span>}</div>
</div><!-- fragment --><div class="dynheader">
Here is the caller graph for this function:</div>
<div class="dyncontent">
<div class="center"><div class="zoom"><iframe scrolling="no" frameborder="0" src="FileStream_8cpp_a5074c346733483a14dce339c940186a9_icgraph.svg" width="100%" height="600"><p><b>This browser is not able to show SVG: try Firefox, Chrome, Safari, or Opera instead.</b></p></iframe></div></div>
</div>

</div>
</div>
<a id="a298aac8ccf15fff07223077eedbf2db7" name="a298aac8ccf15fff07223077eedbf2db7"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a298aac8ccf15fff07223077eedbf2db7">&#9670;&#160;</a></span>BlockStream_GetPos()</h2>

<div class="memitem">
<div class="memproto">
<table class="mlabels">
  <tr>
  <td class="mlabels-left">
      <table class="memname">
        <tr>
          <td class="memname">static <a class="el" href="StormPort_8h.html#abb452686968e48b67397da5f97445f5b">bool</a> BlockStream_GetPos </td>
          <td>(</td>
          <td class="paramtype"><a class="el" href="structTFileStream.html">TFileStream</a> *&#160;</td>
          <td class="paramname"><em>pStream</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype"><a class="el" href="StormPort_8h.html#abb9abb9ce956f1a9e5a4081ac40e5649">ULONGLONG</a> *&#160;</td>
          <td class="paramname"><em>pByteOffset</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
  </td>
  <td class="mlabels-right">
<span class="mlabels"><span class="mlabel">static</span></span>  </td>
  </tr>
</table>
</div><div class="memdoc">

<p class="definition">Definition at line <a class="el" href="FileStream_8cpp_source.html#l01061">1061</a> of file <a class="el" href="FileStream_8cpp_source.html">FileStream.cpp</a>.</p>
<div class="fragment"><div class="line"><span class="lineno"> 1062</span>{</div>
<div class="line"><span class="lineno"> 1063</span>    *pByteOffset = pStream-&gt;<a class="code hl_variable" href="structTFileStream.html#a84324f2f19bfc3fcbc563ef2391f84fe">StreamPos</a>;</div>
<div class="line"><span class="lineno"> 1064</span>    <span class="keywordflow">return</span> <span class="keyword">true</span>;</div>
<div class="line"><span class="lineno"> 1065</span>}</div>
</div><!-- fragment --><div class="dynheader">
Here is the caller graph for this function:</div>
<div class="dyncontent">
<div class="center"><div class="zoom"><iframe scrolling="no" frameborder="0" src="FileStream_8cpp_a298aac8ccf15fff07223077eedbf2db7_icgraph.svg" width="100%" height="600"><p><b>This browser is not able to show SVG: try Firefox, Chrome, Safari, or Opera instead.</b></p></iframe></div></div>
</div>

</div>
</div>
<a id="a3e8398bb76df8b526932fe0c4623cef9" name="a3e8398bb76df8b526932fe0c4623cef9"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a3e8398bb76df8b526932fe0c4623cef9">&#9670;&#160;</a></span>BlockStream_GetSize()</h2>

<div class="memitem">
<div class="memproto">
<table class="mlabels">
  <tr>
  <td class="mlabels-left">
      <table class="memname">
        <tr>
          <td class="memname">static <a class="el" href="StormPort_8h.html#abb452686968e48b67397da5f97445f5b">bool</a> BlockStream_GetSize </td>
          <td>(</td>
          <td class="paramtype"><a class="el" href="structTFileStream.html">TFileStream</a> *&#160;</td>
          <td class="paramname"><em>pStream</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype"><a class="el" href="StormPort_8h.html#abb9abb9ce956f1a9e5a4081ac40e5649">ULONGLONG</a> *&#160;</td>
          <td class="paramname"><em>pFileSize</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
  </td>
  <td class="mlabels-right">
<span class="mlabels"><span class="mlabel">static</span></span>  </td>
  </tr>
</table>
</div><div class="memdoc">

<p class="definition">Definition at line <a class="el" href="FileStream_8cpp_source.html#l01055">1055</a> of file <a class="el" href="FileStream_8cpp_source.html">FileStream.cpp</a>.</p>
<div class="fragment"><div class="line"><span class="lineno"> 1056</span>{</div>
<div class="line"><span class="lineno"> 1057</span>    *pFileSize = pStream-&gt;<a class="code hl_variable" href="structTFileStream.html#a99bdae10f74cf57156e65bd76ba64771">StreamSize</a>;</div>
<div class="line"><span class="lineno"> 1058</span>    <span class="keywordflow">return</span> <span class="keyword">true</span>;</div>
<div class="line"><span class="lineno"> 1059</span>}</div>
</div><!-- fragment --><div class="dynheader">
Here is the caller graph for this function:</div>
<div class="dyncontent">
<div class="center"><div class="zoom"><iframe scrolling="no" frameborder="0" src="FileStream_8cpp_a3e8398bb76df8b526932fe0c4623cef9_icgraph.svg" width="100%" height="600"><p><b>This browser is not able to show SVG: try Firefox, Chrome, Safari, or Opera instead.</b></p></iframe></div></div>
</div>

</div>
</div>
<a id="a6aad894479c9e1b2cba754f7f3260747" name="a6aad894479c9e1b2cba754f7f3260747"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a6aad894479c9e1b2cba754f7f3260747">&#9670;&#160;</a></span>BlockStream_Read()</h2>

<div class="memitem">
<div class="memproto">
<table class="mlabels">
  <tr>
  <td class="mlabels-left">
      <table class="memname">
        <tr>
          <td class="memname">static <a class="el" href="StormPort_8h.html#abb452686968e48b67397da5f97445f5b">bool</a> BlockStream_Read </td>
          <td>(</td>
          <td class="paramtype"><a class="el" href="structTBlockStream.html">TBlockStream</a> *&#160;</td>
          <td class="paramname"><em>pStream</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype"><a class="el" href="StormPort_8h.html#abb9abb9ce956f1a9e5a4081ac40e5649">ULONGLONG</a> *&#160;</td>
          <td class="paramname"><em>pByteOffset</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">void *&#160;</td>
          <td class="paramname"><em>pvBuffer</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype"><a class="el" href="StormPort_8h.html#a798af1e30bc65f319c1a246cecf59e39">DWORD</a>&#160;</td>
          <td class="paramname"><em>dwBytesToRead</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
  </td>
  <td class="mlabels-right">
<span class="mlabels"><span class="mlabel">static</span></span>  </td>
  </tr>
</table>
</div><div class="memdoc">

<p class="definition">Definition at line <a class="el" href="FileStream_8cpp_source.html#l00915">915</a> of file <a class="el" href="FileStream_8cpp_source.html">FileStream.cpp</a>.</p>
<div class="fragment"><div class="line"><span class="lineno">  920</span>{</div>
<div class="line"><span class="lineno">  921</span>    <a class="code hl_typedef" href="StormPort_8h.html#abb9abb9ce956f1a9e5a4081ac40e5649">ULONGLONG</a> BlockOffset0;</div>
<div class="line"><span class="lineno">  922</span>    <a class="code hl_typedef" href="StormPort_8h.html#abb9abb9ce956f1a9e5a4081ac40e5649">ULONGLONG</a> BlockOffset;</div>
<div class="line"><span class="lineno">  923</span>    <a class="code hl_typedef" href="StormPort_8h.html#abb9abb9ce956f1a9e5a4081ac40e5649">ULONGLONG</a> ByteOffset;</div>
<div class="line"><span class="lineno">  924</span>    <a class="code hl_typedef" href="StormPort_8h.html#abb9abb9ce956f1a9e5a4081ac40e5649">ULONGLONG</a> EndOffset;</div>
<div class="line"><span class="lineno">  925</span>    <a class="code hl_typedef" href="StormPort_8h.html#ac2d3fb16b5b34c1e6ab80014309020eb">LPBYTE</a> TransferBuffer;</div>
<div class="line"><span class="lineno">  926</span>    <a class="code hl_typedef" href="StormPort_8h.html#ac2d3fb16b5b34c1e6ab80014309020eb">LPBYTE</a> BlockBuffer;</div>
<div class="line"><span class="lineno">  927</span>    <a class="code hl_typedef" href="StormPort_8h.html#a798af1e30bc65f319c1a246cecf59e39">DWORD</a> BlockBufferOffset;                <span class="comment">// Offset of the desired data in the block buffer</span></div>
<div class="line"><span class="lineno">  928</span>    <a class="code hl_typedef" href="StormPort_8h.html#a798af1e30bc65f319c1a246cecf59e39">DWORD</a> BytesNeeded;                      <span class="comment">// Number of bytes that really need to be read</span></div>
<div class="line"><span class="lineno">  929</span>    <a class="code hl_typedef" href="StormPort_8h.html#a798af1e30bc65f319c1a246cecf59e39">DWORD</a> BlockSize = pStream-&gt;<a class="code hl_variable" href="structTBlockStream.html#a8c7180184928638b30809f7f85061fb7">BlockSize</a>;</div>
<div class="line"><span class="lineno">  930</span>    <a class="code hl_typedef" href="StormPort_8h.html#a798af1e30bc65f319c1a246cecf59e39">DWORD</a> BlockCount;</div>
<div class="line"><span class="lineno">  931</span>    <span class="keywordtype">bool</span> bPrevBlockAvailable;</div>
<div class="line"><span class="lineno">  932</span>    <span class="keywordtype">bool</span> bCallbackCalled = <span class="keyword">false</span>;</div>
<div class="line"><span class="lineno">  933</span>    <span class="keywordtype">bool</span> bBlockAvailable;</div>
<div class="line"><span class="lineno">  934</span>    <span class="keywordtype">bool</span> bResult = <span class="keyword">true</span>;</div>
<div class="line"><span class="lineno">  935</span> </div>
<div class="line"><span class="lineno">  936</span>    <span class="comment">// The base block read function must be present</span></div>
<div class="line"><span class="lineno">  937</span>    assert(pStream-&gt;<a class="code hl_variable" href="structTFileStream.html#a68391daa44e09cd7654e765d81d937a3">BlockRead</a> != NULL);</div>
<div class="line"><span class="lineno">  938</span> </div>
<div class="line"><span class="lineno">  939</span>    <span class="comment">// NOP reading of zero bytes</span></div>
<div class="line"><span class="lineno">  940</span>    <span class="keywordflow">if</span>(dwBytesToRead == 0)</div>
<div class="line"><span class="lineno">  941</span>        <span class="keywordflow">return</span> <span class="keyword">true</span>;</div>
<div class="line"><span class="lineno">  942</span> </div>
<div class="line"><span class="lineno">  943</span>    <span class="comment">// Get the current position in the stream</span></div>
<div class="line"><span class="lineno">  944</span>    ByteOffset = (pByteOffset != NULL) ? pByteOffset[0] : pStream-&gt;StreamPos;</div>
<div class="line"><span class="lineno">  945</span>    EndOffset = ByteOffset + dwBytesToRead;</div>
<div class="line"><span class="lineno">  946</span>    <span class="keywordflow">if</span>(EndOffset &gt; pStream-&gt;<a class="code hl_variable" href="structTFileStream.html#a99bdae10f74cf57156e65bd76ba64771">StreamSize</a>)</div>
<div class="line"><span class="lineno">  947</span>    {</div>
<div class="line"><span class="lineno">  948</span>        <a class="code hl_function" href="FileStream_8cpp.html#a65dd8d3e416ffbd6ac5f468c6bdccac9">SetLastError</a>(<a class="code hl_define" href="StormPort_8h.html#a71791529fd25c32cd91d6a716e5e1755">ERROR_HANDLE_EOF</a>);</div>
<div class="line"><span class="lineno">  949</span>        <span class="keywordflow">return</span> <span class="keyword">false</span>;</div>
<div class="line"><span class="lineno">  950</span>    }</div>
<div class="line"><span class="lineno">  951</span> </div>
<div class="line"><span class="lineno">  952</span>    <span class="comment">// Calculate the block parameters</span></div>
<div class="line"><span class="lineno">  953</span>    BlockOffset0 = BlockOffset = ByteOffset &amp; ~((<a class="code hl_typedef" href="StormPort_8h.html#abb9abb9ce956f1a9e5a4081ac40e5649">ULONGLONG</a>)BlockSize - 1);</div>
<div class="line"><span class="lineno">  954</span>    BlockCount  = (<a class="code hl_typedef" href="StormPort_8h.html#a798af1e30bc65f319c1a246cecf59e39">DWORD</a>)(((EndOffset - BlockOffset) + (BlockSize - 1)) / BlockSize);</div>
<div class="line"><span class="lineno">  955</span>    BytesNeeded = (<a class="code hl_typedef" href="StormPort_8h.html#a798af1e30bc65f319c1a246cecf59e39">DWORD</a>)(EndOffset - BlockOffset);</div>
<div class="line"><span class="lineno">  956</span> </div>
<div class="line"><span class="lineno">  957</span>    <span class="comment">// Remember where we have our data</span></div>
<div class="line"><span class="lineno">  958</span>    assert((BlockSize &amp; (BlockSize - 1)) == 0);</div>
<div class="line"><span class="lineno">  959</span>    BlockBufferOffset = (<a class="code hl_typedef" href="StormPort_8h.html#a798af1e30bc65f319c1a246cecf59e39">DWORD</a>)(ByteOffset &amp; (BlockSize - 1));</div>
<div class="line"><span class="lineno">  960</span> </div>
<div class="line"><span class="lineno">  961</span>    <span class="comment">// Allocate buffer for reading blocks</span></div>
<div class="line"><span class="lineno">  962</span>    TransferBuffer = BlockBuffer = <a class="code hl_define" href="StormCommon_8h.html#a6fe0c42173ef1a4b9f0e837b0c631660">STORM_ALLOC</a>(<a class="code hl_typedef" href="StormPort_8h.html#a4ae1dab0fb4b072a66584546209e7d58">BYTE</a>, (BlockCount * BlockSize));</div>
<div class="line"><span class="lineno">  963</span>    <span class="keywordflow">if</span>(TransferBuffer == NULL)</div>
<div class="line"><span class="lineno">  964</span>    {</div>
<div class="line"><span class="lineno">  965</span>        <a class="code hl_function" href="FileStream_8cpp.html#a65dd8d3e416ffbd6ac5f468c6bdccac9">SetLastError</a>(<a class="code hl_define" href="StormPort_8h.html#a0e8ed8133680d2d6b8909e71b8048307">ERROR_NOT_ENOUGH_MEMORY</a>);</div>
<div class="line"><span class="lineno">  966</span>        <span class="keywordflow">return</span> <span class="keyword">false</span>;</div>
<div class="line"><span class="lineno">  967</span>    }</div>
<div class="line"><span class="lineno">  968</span> </div>
<div class="line"><span class="lineno">  969</span>    <span class="comment">// If all blocks are available, just read all blocks at once</span></div>
<div class="line"><span class="lineno">  970</span>    <span class="keywordflow">if</span>(pStream-&gt;<a class="code hl_variable" href="structTBlockStream.html#a8bb8ee629c5bc59f65d01eead9b62762">IsComplete</a> == 0)</div>
<div class="line"><span class="lineno">  971</span>    {</div>
<div class="line"><span class="lineno">  972</span>        <span class="comment">// Now parse the blocks and send the block read request</span></div>
<div class="line"><span class="lineno">  973</span>        <span class="comment">// to all blocks with the same availability</span></div>
<div class="line"><span class="lineno">  974</span>        assert(pStream-&gt;<a class="code hl_variable" href="structTFileStream.html#a707b42c85dd8f372ce802efb6bc1955e">BlockCheck</a> != NULL);</div>
<div class="line"><span class="lineno">  975</span>        bPrevBlockAvailable = pStream-&gt;<a class="code hl_variable" href="structTFileStream.html#a707b42c85dd8f372ce802efb6bc1955e">BlockCheck</a>(pStream, BlockOffset);</div>
<div class="line"><span class="lineno">  976</span> </div>
<div class="line"><span class="lineno">  977</span>        <span class="comment">// Loop as long as we have something to read</span></div>
<div class="line"><span class="lineno">  978</span>        <span class="keywordflow">while</span>(BlockOffset &lt; EndOffset)</div>
<div class="line"><span class="lineno">  979</span>        {</div>
<div class="line"><span class="lineno">  980</span>            <span class="comment">// Determine availability of the next block</span></div>
<div class="line"><span class="lineno">  981</span>            bBlockAvailable = pStream-&gt;<a class="code hl_variable" href="structTFileStream.html#a707b42c85dd8f372ce802efb6bc1955e">BlockCheck</a>(pStream, BlockOffset);</div>
<div class="line"><span class="lineno">  982</span> </div>
<div class="line"><span class="lineno">  983</span>            <span class="comment">// If the availability has changed, read all blocks up to this one</span></div>
<div class="line"><span class="lineno">  984</span>            <span class="keywordflow">if</span>(bBlockAvailable != bPrevBlockAvailable)</div>
<div class="line"><span class="lineno">  985</span>            {</div>
<div class="line"><span class="lineno">  986</span>                <span class="comment">// Call the file stream callback, if the block is not available</span></div>
<div class="line"><span class="lineno">  987</span>                <span class="keywordflow">if</span>(pStream-&gt;<a class="code hl_variable" href="structTFileStream.html#a26faae83ba546119ac59fc35eaeec274">pMaster</a> &amp;&amp; pStream-&gt;<a class="code hl_variable" href="structTBlockStream.html#af22a8a5a72b77e2f095ac7669f365871">pfnCallback</a> &amp;&amp; bPrevBlockAvailable == <span class="keyword">false</span>)</div>
<div class="line"><span class="lineno">  988</span>                {</div>
<div class="line"><span class="lineno">  989</span>                    pStream-&gt;<a class="code hl_variable" href="structTBlockStream.html#af22a8a5a72b77e2f095ac7669f365871">pfnCallback</a>(pStream-&gt;<a class="code hl_variable" href="structTBlockStream.html#a749a949501319933437ccf3bf7f08303">UserData</a>, BlockOffset0, (<a class="code hl_typedef" href="StormPort_8h.html#a798af1e30bc65f319c1a246cecf59e39">DWORD</a>)(BlockOffset - BlockOffset0));</div>
<div class="line"><span class="lineno">  990</span>                    bCallbackCalled = <span class="keyword">true</span>;</div>
<div class="line"><span class="lineno">  991</span>                }</div>
<div class="line"><span class="lineno">  992</span> </div>
<div class="line"><span class="lineno">  993</span>                <span class="comment">// Load the continuous blocks with the same availability</span></div>
<div class="line"><span class="lineno">  994</span>                assert(BlockOffset &gt; BlockOffset0);</div>
<div class="line"><span class="lineno">  995</span>                bResult = pStream-&gt;<a class="code hl_variable" href="structTFileStream.html#a68391daa44e09cd7654e765d81d937a3">BlockRead</a>(pStream, BlockOffset0, BlockOffset, BlockBuffer, BytesNeeded, bPrevBlockAvailable);</div>
<div class="line"><span class="lineno">  996</span>                <span class="keywordflow">if</span>(!bResult)</div>
<div class="line"><span class="lineno">  997</span>                    <span class="keywordflow">break</span>;</div>
<div class="line"><span class="lineno">  998</span> </div>
<div class="line"><span class="lineno">  999</span>                <span class="comment">// Move the block offset</span></div>
<div class="line"><span class="lineno"> 1000</span>                BlockBuffer += (<a class="code hl_typedef" href="StormPort_8h.html#a798af1e30bc65f319c1a246cecf59e39">DWORD</a>)(BlockOffset - BlockOffset0);</div>
<div class="line"><span class="lineno"> 1001</span>                BytesNeeded -= (<a class="code hl_typedef" href="StormPort_8h.html#a798af1e30bc65f319c1a246cecf59e39">DWORD</a>)(BlockOffset - BlockOffset0);</div>
<div class="line"><span class="lineno"> 1002</span>                bPrevBlockAvailable = bBlockAvailable;</div>
<div class="line"><span class="lineno"> 1003</span>                BlockOffset0 = BlockOffset;</div>
<div class="line"><span class="lineno"> 1004</span>            }</div>
<div class="line"><span class="lineno"> 1005</span> </div>
<div class="line"><span class="lineno"> 1006</span>            <span class="comment">// Move to the block offset in the stream</span></div>
<div class="line"><span class="lineno"> 1007</span>            BlockOffset += BlockSize;</div>
<div class="line"><span class="lineno"> 1008</span>        }</div>
<div class="line"><span class="lineno"> 1009</span> </div>
<div class="line"><span class="lineno"> 1010</span>        <span class="comment">// If there is a block(s) remaining to be read, do it</span></div>
<div class="line"><span class="lineno"> 1011</span>        <span class="keywordflow">if</span>(BlockOffset &gt; BlockOffset0)</div>
<div class="line"><span class="lineno"> 1012</span>        {</div>
<div class="line"><span class="lineno"> 1013</span>            <span class="comment">// Call the file stream callback, if the block is not available</span></div>
<div class="line"><span class="lineno"> 1014</span>            <span class="keywordflow">if</span>(pStream-&gt;<a class="code hl_variable" href="structTFileStream.html#a26faae83ba546119ac59fc35eaeec274">pMaster</a> &amp;&amp; pStream-&gt;<a class="code hl_variable" href="structTBlockStream.html#af22a8a5a72b77e2f095ac7669f365871">pfnCallback</a> &amp;&amp; bPrevBlockAvailable == <span class="keyword">false</span>)</div>
<div class="line"><span class="lineno"> 1015</span>            {</div>
<div class="line"><span class="lineno"> 1016</span>                pStream-&gt;<a class="code hl_variable" href="structTBlockStream.html#af22a8a5a72b77e2f095ac7669f365871">pfnCallback</a>(pStream-&gt;<a class="code hl_variable" href="structTBlockStream.html#a749a949501319933437ccf3bf7f08303">UserData</a>, BlockOffset0, (<a class="code hl_typedef" href="StormPort_8h.html#a798af1e30bc65f319c1a246cecf59e39">DWORD</a>)(BlockOffset - BlockOffset0));</div>
<div class="line"><span class="lineno"> 1017</span>                bCallbackCalled = <span class="keyword">true</span>;</div>
<div class="line"><span class="lineno"> 1018</span>            }</div>
<div class="line"><span class="lineno"> 1019</span> </div>
<div class="line"><span class="lineno"> 1020</span>            <span class="comment">// Read the complete blocks from the file</span></div>
<div class="line"><span class="lineno"> 1021</span>            <span class="keywordflow">if</span>(BlockOffset &gt; pStream-&gt;<a class="code hl_variable" href="structTFileStream.html#a99bdae10f74cf57156e65bd76ba64771">StreamSize</a>)</div>
<div class="line"><span class="lineno"> 1022</span>                BlockOffset = pStream-&gt;<a class="code hl_variable" href="structTFileStream.html#a99bdae10f74cf57156e65bd76ba64771">StreamSize</a>;</div>
<div class="line"><span class="lineno"> 1023</span>            bResult = pStream-&gt;<a class="code hl_variable" href="structTFileStream.html#a68391daa44e09cd7654e765d81d937a3">BlockRead</a>(pStream, BlockOffset0, BlockOffset, BlockBuffer, BytesNeeded, bPrevBlockAvailable);</div>
<div class="line"><span class="lineno"> 1024</span>        }</div>
<div class="line"><span class="lineno"> 1025</span>    }</div>
<div class="line"><span class="lineno"> 1026</span>    <span class="keywordflow">else</span></div>
<div class="line"><span class="lineno"> 1027</span>    {</div>
<div class="line"><span class="lineno"> 1028</span>        <span class="comment">// Read the complete blocks from the file</span></div>
<div class="line"><span class="lineno"> 1029</span>        <span class="keywordflow">if</span>(EndOffset &gt; pStream-&gt;<a class="code hl_variable" href="structTFileStream.html#a99bdae10f74cf57156e65bd76ba64771">StreamSize</a>)</div>
<div class="line"><span class="lineno"> 1030</span>            EndOffset = pStream-&gt;<a class="code hl_variable" href="structTFileStream.html#a99bdae10f74cf57156e65bd76ba64771">StreamSize</a>;</div>
<div class="line"><span class="lineno"> 1031</span>        bResult = pStream-&gt;<a class="code hl_variable" href="structTFileStream.html#a68391daa44e09cd7654e765d81d937a3">BlockRead</a>(pStream, BlockOffset, EndOffset, BlockBuffer, BytesNeeded, <span class="keyword">true</span>);</div>
<div class="line"><span class="lineno"> 1032</span>    }</div>
<div class="line"><span class="lineno"> 1033</span> </div>
<div class="line"><span class="lineno"> 1034</span>    <span class="comment">// Now copy the data to the user buffer</span></div>
<div class="line"><span class="lineno"> 1035</span>    <span class="keywordflow">if</span>(bResult)</div>
<div class="line"><span class="lineno"> 1036</span>    {</div>
<div class="line"><span class="lineno"> 1037</span>        memcpy(pvBuffer, TransferBuffer + BlockBufferOffset, dwBytesToRead);</div>
<div class="line"><span class="lineno"> 1038</span>        pStream-&gt;<a class="code hl_variable" href="structTFileStream.html#a84324f2f19bfc3fcbc563ef2391f84fe">StreamPos</a> = ByteOffset + dwBytesToRead;</div>
<div class="line"><span class="lineno"> 1039</span>    }</div>
<div class="line"><span class="lineno"> 1040</span>    <span class="keywordflow">else</span></div>
<div class="line"><span class="lineno"> 1041</span>    {</div>
<div class="line"><span class="lineno"> 1042</span>        <span class="comment">// If the block read failed, set the last error</span></div>
<div class="line"><span class="lineno"> 1043</span>        <a class="code hl_function" href="FileStream_8cpp.html#a65dd8d3e416ffbd6ac5f468c6bdccac9">SetLastError</a>(<a class="code hl_define" href="StormLib_8h.html#a647cc9f030c44bd40c5d8222b784647b">ERROR_FILE_INCOMPLETE</a>);</div>
<div class="line"><span class="lineno"> 1044</span>    }</div>
<div class="line"><span class="lineno"> 1045</span> </div>
<div class="line"><span class="lineno"> 1046</span>    <span class="comment">// Call the callback to indicate we are done</span></div>
<div class="line"><span class="lineno"> 1047</span>    <span class="keywordflow">if</span>(bCallbackCalled)</div>
<div class="line"><span class="lineno"> 1048</span>        pStream-&gt;<a class="code hl_variable" href="structTBlockStream.html#af22a8a5a72b77e2f095ac7669f365871">pfnCallback</a>(pStream-&gt;<a class="code hl_variable" href="structTBlockStream.html#a749a949501319933437ccf3bf7f08303">UserData</a>, 0, 0);</div>
<div class="line"><span class="lineno"> 1049</span> </div>
<div class="line"><span class="lineno"> 1050</span>    <span class="comment">// Free the block buffer and return</span></div>
<div class="line"><span class="lineno"> 1051</span>    <a class="code hl_define" href="StormCommon_8h.html#a50487dadfceefebfb0de8fa711eaf4b3">STORM_FREE</a>(TransferBuffer);</div>
<div class="line"><span class="lineno"> 1052</span>    <span class="keywordflow">return</span> bResult;</div>
<div class="line"><span class="lineno"> 1053</span>}</div>
<div class="ttc" id="aStormLib_8h_html_a647cc9f030c44bd40c5d8222b784647b"><div class="ttname"><a href="StormLib_8h.html#a647cc9f030c44bd40c5d8222b784647b">ERROR_FILE_INCOMPLETE</a></div><div class="ttdeci">#define ERROR_FILE_INCOMPLETE</div><div class="ttdef"><b>Definition</b> <a href="StormLib_8h_source.html#l00159">StormLib.h:159</a></div></div>
<div class="ttc" id="astructTBlockStream_html_a749a949501319933437ccf3bf7f08303"><div class="ttname"><a href="structTBlockStream.html#a749a949501319933437ccf3bf7f08303">TBlockStream::UserData</a></div><div class="ttdeci">void * UserData</div><div class="ttdef"><b>Definition</b> <a href="FileStream_8h_source.html#l00199">FileStream.h:199</a></div></div>
<div class="ttc" id="astructTBlockStream_html_af22a8a5a72b77e2f095ac7669f365871"><div class="ttname"><a href="structTBlockStream.html#af22a8a5a72b77e2f095ac7669f365871">TBlockStream::pfnCallback</a></div><div class="ttdeci">SFILE_DOWNLOAD_CALLBACK pfnCallback</div><div class="ttdef"><b>Definition</b> <a href="FileStream_8h_source.html#l00197">FileStream.h:197</a></div></div>
<div class="ttc" id="astructTFileStream_html_a707b42c85dd8f372ce802efb6bc1955e"><div class="ttname"><a href="structTFileStream.html#a707b42c85dd8f372ce802efb6bc1955e">TFileStream::BlockCheck</a></div><div class="ttdeci">BLOCK_CHECK BlockCheck</div><div class="ttdef"><b>Definition</b> <a href="FileStream_8h_source.html#l00165">FileStream.h:165</a></div></div>
</div><!-- fragment --><div class="dynheader">
Here is the call graph for this function:</div>
<div class="dyncontent">
<div class="center"><iframe scrolling="no" frameborder="0" src="FileStream_8cpp_a6aad894479c9e1b2cba754f7f3260747_cgraph.svg" width="306" height="36"><p><b>This browser is not able to show SVG: try Firefox, Chrome, Safari, or Opera instead.</b></p></iframe></div>
</div>
<div class="dynheader">
Here is the caller graph for this function:</div>
<div class="dyncontent">
<div class="center"><div class="zoom"><iframe scrolling="no" frameborder="0" src="FileStream_8cpp_a6aad894479c9e1b2cba754f7f3260747_icgraph.svg" width="100%" height="600"><p><b>This browser is not able to show SVG: try Firefox, Chrome, Safari, or Opera instead.</b></p></iframe></div></div>
</div>

</div>
</div>
<a id="ad34e1378609413863343bd2dac0eb723" name="ad34e1378609413863343bd2dac0eb723"></a>
<h2 class="memtitle"><span class="permalink"><a href="#ad34e1378609413863343bd2dac0eb723">&#9670;&#160;</a></span>CreateKeyFromAuthCode()</h2>

<div class="memitem">
<div class="memproto">
<table class="mlabels">
  <tr>
  <td class="mlabels-left">
      <table class="memname">
        <tr>
          <td class="memname">static void CreateKeyFromAuthCode </td>
          <td>(</td>
          <td class="paramtype"><a class="el" href="StormPort_8h.html#ac2d3fb16b5b34c1e6ab80014309020eb">LPBYTE</a>&#160;</td>
          <td class="paramname"><em>pbKeyBuffer</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype"><a class="el" href="StormLib_2src_2zlib_2zconf_8h.html#a2c212835823e3c54a8ab6d95c652660e">const</a> char *&#160;</td>
          <td class="paramname"><em>szAuthCode</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
  </td>
  <td class="mlabels-right">
<span class="mlabels"><span class="mlabel">static</span></span>  </td>
  </tr>
</table>
</div><div class="memdoc">

<p class="definition">Definition at line <a class="el" href="FileStream_8cpp_source.html#l01980">1980</a> of file <a class="el" href="FileStream_8cpp_source.html">FileStream.cpp</a>.</p>
<div class="fragment"><div class="line"><span class="lineno"> 1983</span>{</div>
<div class="line"><span class="lineno"> 1984</span>    <a class="code hl_typedef" href="StormPort_8h.html#a143be739596851314f3c386bd6f752f9">LPDWORD</a> KeyPosition = (<a class="code hl_typedef" href="StormPort_8h.html#a143be739596851314f3c386bd6f752f9">LPDWORD</a>)(pbKeyBuffer + 0x10);</div>
<div class="line"><span class="lineno"> 1985</span>    <a class="code hl_typedef" href="StormPort_8h.html#a143be739596851314f3c386bd6f752f9">LPDWORD</a> AuthCode32 = (<a class="code hl_typedef" href="StormPort_8h.html#a143be739596851314f3c386bd6f752f9">LPDWORD</a>)szAuthCode;</div>
<div class="line"><span class="lineno"> 1986</span> </div>
<div class="line"><span class="lineno"> 1987</span>    memcpy(pbKeyBuffer, <a class="code hl_variable" href="FileStream_8cpp.html#a1ba3043bfd83fe4f919a3cb4a871a9cf">szKeyTemplate</a>, <a class="code hl_define" href="FileStream_8h.html#aa7f93c6d9b01977696433566896b8ca5">MPQE_CHUNK_SIZE</a>);</div>
<div class="line"><span class="lineno"> 1988</span>    KeyPosition[0x00] = AuthCode32[0x03];</div>
<div class="line"><span class="lineno"> 1989</span>    KeyPosition[0x02] = AuthCode32[0x07];</div>
<div class="line"><span class="lineno"> 1990</span>    KeyPosition[0x03] = AuthCode32[0x02];</div>
<div class="line"><span class="lineno"> 1991</span>    KeyPosition[0x05] = AuthCode32[0x06];</div>
<div class="line"><span class="lineno"> 1992</span>    KeyPosition[0x06] = AuthCode32[0x01];</div>
<div class="line"><span class="lineno"> 1993</span>    KeyPosition[0x08] = AuthCode32[0x05];</div>
<div class="line"><span class="lineno"> 1994</span>    KeyPosition[0x09] = AuthCode32[0x00];</div>
<div class="line"><span class="lineno"> 1995</span>    KeyPosition[0x0B] = AuthCode32[0x04];</div>
<div class="line"><span class="lineno"> 1996</span>    <a class="code hl_define" href="StormPort_8h.html#ac7ba8dafbd180540281c58442f9777ee">BSWAP_ARRAY32_UNSIGNED</a>(pbKeyBuffer, <a class="code hl_define" href="FileStream_8h.html#aa7f93c6d9b01977696433566896b8ca5">MPQE_CHUNK_SIZE</a>);</div>
<div class="line"><span class="lineno"> 1997</span>}</div>
<div class="ttc" id="aFileStream_8cpp_html_a1ba3043bfd83fe4f919a3cb4a871a9cf"><div class="ttname"><a href="FileStream_8cpp.html#a1ba3043bfd83fe4f919a3cb4a871a9cf">szKeyTemplate</a></div><div class="ttdeci">static const char * szKeyTemplate</div><div class="ttdef"><b>Definition</b> <a href="FileStream_8cpp_source.html#l01920">FileStream.cpp:1920</a></div></div>
<div class="ttc" id="aFileStream_8h_html_aa7f93c6d9b01977696433566896b8ca5"><div class="ttname"><a href="FileStream_8h.html#aa7f93c6d9b01977696433566896b8ca5">MPQE_CHUNK_SIZE</a></div><div class="ttdeci">#define MPQE_CHUNK_SIZE</div><div class="ttdef"><b>Definition</b> <a href="FileStream_8h_source.html#l00210">FileStream.h:210</a></div></div>
<div class="ttc" id="aStormPort_8h_html_a143be739596851314f3c386bd6f752f9"><div class="ttname"><a href="StormPort_8h.html#a143be739596851314f3c386bd6f752f9">LPDWORD</a></div><div class="ttdeci">DWORD * LPDWORD</div><div class="ttdef"><b>Definition</b> <a href="StormPort_8h_source.html#l00347">StormPort.h:347</a></div></div>
<div class="ttc" id="aStormPort_8h_html_ac7ba8dafbd180540281c58442f9777ee"><div class="ttname"><a href="StormPort_8h.html#ac7ba8dafbd180540281c58442f9777ee">BSWAP_ARRAY32_UNSIGNED</a></div><div class="ttdeci">#define BSWAP_ARRAY32_UNSIGNED(a, b)</div><div class="ttdef"><b>Definition</b> <a href="StormPort_8h_source.html#l00435">StormPort.h:435</a></div></div>
</div><!-- fragment --><div class="dynheader">
Here is the caller graph for this function:</div>
<div class="dyncontent">
<div class="center"><div class="zoom"><iframe scrolling="no" frameborder="0" src="FileStream_8cpp_ad34e1378609413863343bd2dac0eb723_icgraph.svg" width="100%" height="600"><p><b>This browser is not able to show SVG: try Firefox, Chrome, Safari, or Opera instead.</b></p></iframe></div></div>
</div>

</div>
</div>
<a id="a801d4ae05a373852d8c7636f0d9075b8" name="a801d4ae05a373852d8c7636f0d9075b8"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a801d4ae05a373852d8c7636f0d9075b8">&#9670;&#160;</a></span>CreateNameWithSuffix()</h2>

<div class="memitem">
<div class="memproto">
<table class="mlabels">
  <tr>
  <td class="mlabels-left">
      <table class="memname">
        <tr>
          <td class="memname">static void CreateNameWithSuffix </td>
          <td>(</td>
          <td class="paramtype"><a class="el" href="StormPort_8h.html#a4164e170dcb78b7da7277a7e1f5953fc">LPTSTR</a>&#160;</td>
          <td class="paramname"><em>szBuffer</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">size_t&#160;</td>
          <td class="paramname"><em>cchMaxChars</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype"><a class="el" href="StormPort_8h.html#a8ff75c0813d9c26a6009f93b02a00254">LPCTSTR</a>&#160;</td>
          <td class="paramname"><em>szName</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">unsigned int&#160;</td>
          <td class="paramname"><em>nValue</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
  </td>
  <td class="mlabels-right">
<span class="mlabels"><span class="mlabel">static</span></span>  </td>
  </tr>
</table>
</div><div class="memdoc">

<p class="definition">Definition at line <a class="el" href="FileStream_8cpp_source.html#l00068">68</a> of file <a class="el" href="FileStream_8cpp_source.html">FileStream.cpp</a>.</p>
<div class="fragment"><div class="line"><span class="lineno">   69</span>{</div>
<div class="line"><span class="lineno">   70</span>    <a class="code hl_typedef" href="StormPort_8h.html#a4164e170dcb78b7da7277a7e1f5953fc">LPTSTR</a> szBufferEnd = szBuffer + cchMaxChars - 1;</div>
<div class="line"><span class="lineno">   71</span> </div>
<div class="line"><span class="lineno">   72</span>    <span class="comment">// Copy the name</span></div>
<div class="line"><span class="lineno">   73</span>    <span class="keywordflow">while</span>(szBuffer &lt; szBufferEnd &amp;&amp; szName[0] != 0)</div>
<div class="line"><span class="lineno">   74</span>        *szBuffer++ = *szName++;</div>
<div class="line"><span class="lineno">   75</span> </div>
<div class="line"><span class="lineno">   76</span>    <span class="comment">// Append &quot;.&quot;</span></div>
<div class="line"><span class="lineno">   77</span>    <span class="keywordflow">if</span>(szBuffer &lt; szBufferEnd)</div>
<div class="line"><span class="lineno">   78</span>        *szBuffer++ = <span class="charliteral">&#39;.&#39;</span>;</div>
<div class="line"><span class="lineno">   79</span> </div>
<div class="line"><span class="lineno">   80</span>    <span class="comment">// Append the number</span></div>
<div class="line"><span class="lineno">   81</span>    <a class="code hl_function" href="StormCommon_8h.html#a07d708b4165417af1c53780b0443b6c0">IntToString</a>(szBuffer, szBufferEnd - szBuffer + 1, nValue);</div>
<div class="line"><span class="lineno">   82</span>}</div>
<div class="ttc" id="aStormCommon_8h_html_a07d708b4165417af1c53780b0443b6c0"><div class="ttname"><a href="StormCommon_8h.html#a07d708b4165417af1c53780b0443b6c0">IntToString</a></div><div class="ttdeci">XCHAR * IntToString(XCHAR *szBuffer, size_t cchMaxChars, XINT nValue, size_t nDigitCount=0)</div><div class="ttdef"><b>Definition</b> <a href="StormCommon_8h_source.html#l00156">StormCommon.h:156</a></div></div>
<div class="ttc" id="aStormPort_8h_html_a4164e170dcb78b7da7277a7e1f5953fc"><div class="ttname"><a href="StormPort_8h.html#a4164e170dcb78b7da7277a7e1f5953fc">LPTSTR</a></div><div class="ttdeci">char * LPTSTR</div><div class="ttdef"><b>Definition</b> <a href="StormPort_8h_source.html#l00351">StormPort.h:351</a></div></div>
</div><!-- fragment --><div class="dynheader">
Here is the call graph for this function:</div>
<div class="dyncontent">
<div class="center"><iframe scrolling="no" frameborder="0" src="FileStream_8cpp_a801d4ae05a373852d8c7636f0d9075b8_cgraph.svg" width="320" height="36"><p><b>This browser is not able to show SVG: try Firefox, Chrome, Safari, or Opera instead.</b></p></iframe></div>
</div>
<div class="dynheader">
Here is the caller graph for this function:</div>
<div class="dyncontent">
<div class="center"><div class="zoom"><iframe scrolling="no" frameborder="0" src="FileStream_8cpp_a801d4ae05a373852d8c7636f0d9075b8_icgraph.svg" width="100%" height="600"><p><b>This browser is not able to show SVG: try Firefox, Chrome, Safari, or Opera instead.</b></p></iframe></div></div>
</div>

</div>
</div>
<a id="a1a04dfdeabbbf63c5e09fcda34922e7a" name="a1a04dfdeabbbf63c5e09fcda34922e7a"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a1a04dfdeabbbf63c5e09fcda34922e7a">&#9670;&#160;</a></span>DecryptFileChunk()</h2>

<div class="memitem">
<div class="memproto">
<table class="mlabels">
  <tr>
  <td class="mlabels-left">
      <table class="memname">
        <tr>
          <td class="memname">static void DecryptFileChunk </td>
          <td>(</td>
          <td class="paramtype"><a class="el" href="StormPort_8h.html#a798af1e30bc65f319c1a246cecf59e39">DWORD</a> *&#160;</td>
          <td class="paramname"><em>MpqData</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype"><a class="el" href="StormPort_8h.html#ac2d3fb16b5b34c1e6ab80014309020eb">LPBYTE</a>&#160;</td>
          <td class="paramname"><em>pbKey</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype"><a class="el" href="StormPort_8h.html#abb9abb9ce956f1a9e5a4081ac40e5649">ULONGLONG</a>&#160;</td>
          <td class="paramname"><em>ByteOffset</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype"><a class="el" href="StormPort_8h.html#a798af1e30bc65f319c1a246cecf59e39">DWORD</a>&#160;</td>
          <td class="paramname"><em>dwLength</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
  </td>
  <td class="mlabels-right">
<span class="mlabels"><span class="mlabel">static</span></span>  </td>
  </tr>
</table>
</div><div class="memdoc">

<p class="definition">Definition at line <a class="el" href="FileStream_8cpp_source.html#l01999">1999</a> of file <a class="el" href="FileStream_8cpp_source.html">FileStream.cpp</a>.</p>
<div class="fragment"><div class="line"><span class="lineno"> 2004</span>{</div>
<div class="line"><span class="lineno"> 2005</span>    <a class="code hl_typedef" href="StormPort_8h.html#abb9abb9ce956f1a9e5a4081ac40e5649">ULONGLONG</a> ChunkOffset;</div>
<div class="line"><span class="lineno"> 2006</span>    <a class="code hl_typedef" href="StormPort_8h.html#a798af1e30bc65f319c1a246cecf59e39">DWORD</a> KeyShuffled[0x10];</div>
<div class="line"><span class="lineno"> 2007</span>    <a class="code hl_typedef" href="StormPort_8h.html#a798af1e30bc65f319c1a246cecf59e39">DWORD</a> KeyMirror[0x10];</div>
<div class="line"><span class="lineno"> 2008</span>    <a class="code hl_typedef" href="StormPort_8h.html#a798af1e30bc65f319c1a246cecf59e39">DWORD</a> RoundCount = 0x14;</div>
<div class="line"><span class="lineno"> 2009</span> </div>
<div class="line"><span class="lineno"> 2010</span>    <span class="comment">// Prepare the key</span></div>
<div class="line"><span class="lineno"> 2011</span>    ChunkOffset = ByteOffset / <a class="code hl_define" href="FileStream_8h.html#aa7f93c6d9b01977696433566896b8ca5">MPQE_CHUNK_SIZE</a>;</div>
<div class="line"><span class="lineno"> 2012</span>    memcpy(KeyMirror, pbKey, <a class="code hl_define" href="FileStream_8h.html#aa7f93c6d9b01977696433566896b8ca5">MPQE_CHUNK_SIZE</a>);</div>
<div class="line"><span class="lineno"> 2013</span>    <a class="code hl_define" href="StormPort_8h.html#ac7ba8dafbd180540281c58442f9777ee">BSWAP_ARRAY32_UNSIGNED</a>(KeyMirror, <a class="code hl_define" href="FileStream_8h.html#aa7f93c6d9b01977696433566896b8ca5">MPQE_CHUNK_SIZE</a>);</div>
<div class="line"><span class="lineno"> 2014</span>    KeyMirror[0x05] = (<a class="code hl_typedef" href="StormPort_8h.html#a798af1e30bc65f319c1a246cecf59e39">DWORD</a>)(ChunkOffset &gt;&gt; 32);</div>
<div class="line"><span class="lineno"> 2015</span>    KeyMirror[0x08] = (<a class="code hl_typedef" href="StormPort_8h.html#a798af1e30bc65f319c1a246cecf59e39">DWORD</a>)(ChunkOffset);</div>
<div class="line"><span class="lineno"> 2016</span> </div>
<div class="line"><span class="lineno"> 2017</span>    <span class="keywordflow">while</span>(dwLength &gt;= <a class="code hl_define" href="FileStream_8h.html#aa7f93c6d9b01977696433566896b8ca5">MPQE_CHUNK_SIZE</a>)</div>
<div class="line"><span class="lineno"> 2018</span>    {</div>
<div class="line"><span class="lineno"> 2019</span>        <span class="comment">// Shuffle the key - part 1</span></div>
<div class="line"><span class="lineno"> 2020</span>        KeyShuffled[0x0E] = KeyMirror[0x00];</div>
<div class="line"><span class="lineno"> 2021</span>        KeyShuffled[0x0C] = KeyMirror[0x01];</div>
<div class="line"><span class="lineno"> 2022</span>        KeyShuffled[0x05] = KeyMirror[0x02];</div>
<div class="line"><span class="lineno"> 2023</span>        KeyShuffled[0x0F] = KeyMirror[0x03];</div>
<div class="line"><span class="lineno"> 2024</span>        KeyShuffled[0x0A] = KeyMirror[0x04];</div>
<div class="line"><span class="lineno"> 2025</span>        KeyShuffled[0x07] = KeyMirror[0x05];</div>
<div class="line"><span class="lineno"> 2026</span>        KeyShuffled[0x0B] = KeyMirror[0x06];</div>
<div class="line"><span class="lineno"> 2027</span>        KeyShuffled[0x09] = KeyMirror[0x07];</div>
<div class="line"><span class="lineno"> 2028</span>        KeyShuffled[0x03] = KeyMirror[0x08];</div>
<div class="line"><span class="lineno"> 2029</span>        KeyShuffled[0x06] = KeyMirror[0x09];</div>
<div class="line"><span class="lineno"> 2030</span>        KeyShuffled[0x08] = KeyMirror[0x0A];</div>
<div class="line"><span class="lineno"> 2031</span>        KeyShuffled[0x0D] = KeyMirror[0x0B];</div>
<div class="line"><span class="lineno"> 2032</span>        KeyShuffled[0x02] = KeyMirror[0x0C];</div>
<div class="line"><span class="lineno"> 2033</span>        KeyShuffled[0x04] = KeyMirror[0x0D];</div>
<div class="line"><span class="lineno"> 2034</span>        KeyShuffled[0x01] = KeyMirror[0x0E];</div>
<div class="line"><span class="lineno"> 2035</span>        KeyShuffled[0x00] = KeyMirror[0x0F];</div>
<div class="line"><span class="lineno"> 2036</span> </div>
<div class="line"><span class="lineno"> 2037</span>        <span class="comment">// Shuffle the key - part 2</span></div>
<div class="line"><span class="lineno"> 2038</span>        <span class="keywordflow">for</span>(<a class="code hl_typedef" href="StormPort_8h.html#a798af1e30bc65f319c1a246cecf59e39">DWORD</a> i = 0; i &lt; RoundCount; i += 2)</div>
<div class="line"><span class="lineno"> 2039</span>        {</div>
<div class="line"><span class="lineno"> 2040</span>            KeyShuffled[0x0A] = KeyShuffled[0x0A] ^ <a class="code hl_function" href="FileStream_8cpp.html#a2ab4669edc8efaf172b769732d83e2f0">Rol32</a>((KeyShuffled[0x0E] + KeyShuffled[0x02]), 0x07);</div>
<div class="line"><span class="lineno"> 2041</span>            KeyShuffled[0x03] = KeyShuffled[0x03] ^ <a class="code hl_function" href="FileStream_8cpp.html#a2ab4669edc8efaf172b769732d83e2f0">Rol32</a>((KeyShuffled[0x0A] + KeyShuffled[0x0E]), 0x09);</div>
<div class="line"><span class="lineno"> 2042</span>            KeyShuffled[0x02] = KeyShuffled[0x02] ^ <a class="code hl_function" href="FileStream_8cpp.html#a2ab4669edc8efaf172b769732d83e2f0">Rol32</a>((KeyShuffled[0x03] + KeyShuffled[0x0A]), 0x0D);</div>
<div class="line"><span class="lineno"> 2043</span>            KeyShuffled[0x0E] = KeyShuffled[0x0E] ^ <a class="code hl_function" href="FileStream_8cpp.html#a2ab4669edc8efaf172b769732d83e2f0">Rol32</a>((KeyShuffled[0x02] + KeyShuffled[0x03]), 0x12);</div>
<div class="line"><span class="lineno"> 2044</span> </div>
<div class="line"><span class="lineno"> 2045</span>            KeyShuffled[0x07] = KeyShuffled[0x07] ^ <a class="code hl_function" href="FileStream_8cpp.html#a2ab4669edc8efaf172b769732d83e2f0">Rol32</a>((KeyShuffled[0x0C] + KeyShuffled[0x04]), 0x07);</div>
<div class="line"><span class="lineno"> 2046</span>            KeyShuffled[0x06] = KeyShuffled[0x06] ^ <a class="code hl_function" href="FileStream_8cpp.html#a2ab4669edc8efaf172b769732d83e2f0">Rol32</a>((KeyShuffled[0x07] + KeyShuffled[0x0C]), 0x09);</div>
<div class="line"><span class="lineno"> 2047</span>            KeyShuffled[0x04] = KeyShuffled[0x04] ^ <a class="code hl_function" href="FileStream_8cpp.html#a2ab4669edc8efaf172b769732d83e2f0">Rol32</a>((KeyShuffled[0x06] + KeyShuffled[0x07]), 0x0D);</div>
<div class="line"><span class="lineno"> 2048</span>            KeyShuffled[0x0C] = KeyShuffled[0x0C] ^ <a class="code hl_function" href="FileStream_8cpp.html#a2ab4669edc8efaf172b769732d83e2f0">Rol32</a>((KeyShuffled[0x04] + KeyShuffled[0x06]), 0x12);</div>
<div class="line"><span class="lineno"> 2049</span> </div>
<div class="line"><span class="lineno"> 2050</span>            KeyShuffled[0x0B] = KeyShuffled[0x0B] ^ <a class="code hl_function" href="FileStream_8cpp.html#a2ab4669edc8efaf172b769732d83e2f0">Rol32</a>((KeyShuffled[0x05] + KeyShuffled[0x01]), 0x07);</div>
<div class="line"><span class="lineno"> 2051</span>            KeyShuffled[0x08] = KeyShuffled[0x08] ^ <a class="code hl_function" href="FileStream_8cpp.html#a2ab4669edc8efaf172b769732d83e2f0">Rol32</a>((KeyShuffled[0x0B] + KeyShuffled[0x05]), 0x09);</div>
<div class="line"><span class="lineno"> 2052</span>            KeyShuffled[0x01] = KeyShuffled[0x01] ^ <a class="code hl_function" href="FileStream_8cpp.html#a2ab4669edc8efaf172b769732d83e2f0">Rol32</a>((KeyShuffled[0x08] + KeyShuffled[0x0B]), 0x0D);</div>
<div class="line"><span class="lineno"> 2053</span>            KeyShuffled[0x05] = KeyShuffled[0x05] ^ <a class="code hl_function" href="FileStream_8cpp.html#a2ab4669edc8efaf172b769732d83e2f0">Rol32</a>((KeyShuffled[0x01] + KeyShuffled[0x08]), 0x12);</div>
<div class="line"><span class="lineno"> 2054</span> </div>
<div class="line"><span class="lineno"> 2055</span>            KeyShuffled[0x09] = KeyShuffled[0x09] ^ <a class="code hl_function" href="FileStream_8cpp.html#a2ab4669edc8efaf172b769732d83e2f0">Rol32</a>((KeyShuffled[0x0F] + KeyShuffled[0x00]), 0x07);</div>
<div class="line"><span class="lineno"> 2056</span>            KeyShuffled[0x0D] = KeyShuffled[0x0D] ^ <a class="code hl_function" href="FileStream_8cpp.html#a2ab4669edc8efaf172b769732d83e2f0">Rol32</a>((KeyShuffled[0x09] + KeyShuffled[0x0F]), 0x09);</div>
<div class="line"><span class="lineno"> 2057</span>            KeyShuffled[0x00] = KeyShuffled[0x00] ^ <a class="code hl_function" href="FileStream_8cpp.html#a2ab4669edc8efaf172b769732d83e2f0">Rol32</a>((KeyShuffled[0x0D] + KeyShuffled[0x09]), 0x0D);</div>
<div class="line"><span class="lineno"> 2058</span>            KeyShuffled[0x0F] = KeyShuffled[0x0F] ^ <a class="code hl_function" href="FileStream_8cpp.html#a2ab4669edc8efaf172b769732d83e2f0">Rol32</a>((KeyShuffled[0x00] + KeyShuffled[0x0D]), 0x12);</div>
<div class="line"><span class="lineno"> 2059</span> </div>
<div class="line"><span class="lineno"> 2060</span>            KeyShuffled[0x04] = KeyShuffled[0x04] ^ <a class="code hl_function" href="FileStream_8cpp.html#a2ab4669edc8efaf172b769732d83e2f0">Rol32</a>((KeyShuffled[0x0E] + KeyShuffled[0x09]), 0x07);</div>
<div class="line"><span class="lineno"> 2061</span>            KeyShuffled[0x08] = KeyShuffled[0x08] ^ <a class="code hl_function" href="FileStream_8cpp.html#a2ab4669edc8efaf172b769732d83e2f0">Rol32</a>((KeyShuffled[0x04] + KeyShuffled[0x0E]), 0x09);</div>
<div class="line"><span class="lineno"> 2062</span>            KeyShuffled[0x09] = KeyShuffled[0x09] ^ <a class="code hl_function" href="FileStream_8cpp.html#a2ab4669edc8efaf172b769732d83e2f0">Rol32</a>((KeyShuffled[0x08] + KeyShuffled[0x04]), 0x0D);</div>
<div class="line"><span class="lineno"> 2063</span>            KeyShuffled[0x0E] = KeyShuffled[0x0E] ^ <a class="code hl_function" href="FileStream_8cpp.html#a2ab4669edc8efaf172b769732d83e2f0">Rol32</a>((KeyShuffled[0x09] + KeyShuffled[0x08]), 0x12);</div>
<div class="line"><span class="lineno"> 2064</span> </div>
<div class="line"><span class="lineno"> 2065</span>            KeyShuffled[0x01] = KeyShuffled[0x01] ^ <a class="code hl_function" href="FileStream_8cpp.html#a2ab4669edc8efaf172b769732d83e2f0">Rol32</a>((KeyShuffled[0x0C] + KeyShuffled[0x0A]), 0x07);</div>
<div class="line"><span class="lineno"> 2066</span>            KeyShuffled[0x0D] = KeyShuffled[0x0D] ^ <a class="code hl_function" href="FileStream_8cpp.html#a2ab4669edc8efaf172b769732d83e2f0">Rol32</a>((KeyShuffled[0x01] + KeyShuffled[0x0C]), 0x09);</div>
<div class="line"><span class="lineno"> 2067</span>            KeyShuffled[0x0A] = KeyShuffled[0x0A] ^ <a class="code hl_function" href="FileStream_8cpp.html#a2ab4669edc8efaf172b769732d83e2f0">Rol32</a>((KeyShuffled[0x0D] + KeyShuffled[0x01]), 0x0D);</div>
<div class="line"><span class="lineno"> 2068</span>            KeyShuffled[0x0C] = KeyShuffled[0x0C] ^ <a class="code hl_function" href="FileStream_8cpp.html#a2ab4669edc8efaf172b769732d83e2f0">Rol32</a>((KeyShuffled[0x0A] + KeyShuffled[0x0D]), 0x12);</div>
<div class="line"><span class="lineno"> 2069</span> </div>
<div class="line"><span class="lineno"> 2070</span>            KeyShuffled[0x00] = KeyShuffled[0x00] ^ <a class="code hl_function" href="FileStream_8cpp.html#a2ab4669edc8efaf172b769732d83e2f0">Rol32</a>((KeyShuffled[0x05] + KeyShuffled[0x07]), 0x07);</div>
<div class="line"><span class="lineno"> 2071</span>            KeyShuffled[0x03] = KeyShuffled[0x03] ^ <a class="code hl_function" href="FileStream_8cpp.html#a2ab4669edc8efaf172b769732d83e2f0">Rol32</a>((KeyShuffled[0x00] + KeyShuffled[0x05]), 0x09);</div>
<div class="line"><span class="lineno"> 2072</span>            KeyShuffled[0x07] = KeyShuffled[0x07] ^ <a class="code hl_function" href="FileStream_8cpp.html#a2ab4669edc8efaf172b769732d83e2f0">Rol32</a>((KeyShuffled[0x03] + KeyShuffled[0x00]), 0x0D);</div>
<div class="line"><span class="lineno"> 2073</span>            KeyShuffled[0x05] = KeyShuffled[0x05] ^ <a class="code hl_function" href="FileStream_8cpp.html#a2ab4669edc8efaf172b769732d83e2f0">Rol32</a>((KeyShuffled[0x07] + KeyShuffled[0x03]), 0x12);</div>
<div class="line"><span class="lineno"> 2074</span> </div>
<div class="line"><span class="lineno"> 2075</span>            KeyShuffled[0x02] = KeyShuffled[0x02] ^ <a class="code hl_function" href="FileStream_8cpp.html#a2ab4669edc8efaf172b769732d83e2f0">Rol32</a>((KeyShuffled[0x0F] + KeyShuffled[0x0B]), 0x07);</div>
<div class="line"><span class="lineno"> 2076</span>            KeyShuffled[0x06] = KeyShuffled[0x06] ^ <a class="code hl_function" href="FileStream_8cpp.html#a2ab4669edc8efaf172b769732d83e2f0">Rol32</a>((KeyShuffled[0x02] + KeyShuffled[0x0F]), 0x09);</div>
<div class="line"><span class="lineno"> 2077</span>            KeyShuffled[0x0B] = KeyShuffled[0x0B] ^ <a class="code hl_function" href="FileStream_8cpp.html#a2ab4669edc8efaf172b769732d83e2f0">Rol32</a>((KeyShuffled[0x06] + KeyShuffled[0x02]), 0x0D);</div>
<div class="line"><span class="lineno"> 2078</span>            KeyShuffled[0x0F] = KeyShuffled[0x0F] ^ <a class="code hl_function" href="FileStream_8cpp.html#a2ab4669edc8efaf172b769732d83e2f0">Rol32</a>((KeyShuffled[0x0B] + KeyShuffled[0x06]), 0x12);</div>
<div class="line"><span class="lineno"> 2079</span>        }</div>
<div class="line"><span class="lineno"> 2080</span> </div>
<div class="line"><span class="lineno"> 2081</span>        <span class="comment">// Decrypt one data chunk</span></div>
<div class="line"><span class="lineno"> 2082</span>        <a class="code hl_define" href="StormPort_8h.html#ac7ba8dafbd180540281c58442f9777ee">BSWAP_ARRAY32_UNSIGNED</a>(MpqData, <a class="code hl_define" href="FileStream_8h.html#aa7f93c6d9b01977696433566896b8ca5">MPQE_CHUNK_SIZE</a>);</div>
<div class="line"><span class="lineno"> 2083</span>        MpqData[0x00] = MpqData[0x00] ^ (KeyShuffled[0x0E] + KeyMirror[0x00]);</div>
<div class="line"><span class="lineno"> 2084</span>        MpqData[0x01] = MpqData[0x01] ^ (KeyShuffled[0x04] + KeyMirror[0x0D]);</div>
<div class="line"><span class="lineno"> 2085</span>        MpqData[0x02] = MpqData[0x02] ^ (KeyShuffled[0x08] + KeyMirror[0x0A]);</div>
<div class="line"><span class="lineno"> 2086</span>        MpqData[0x03] = MpqData[0x03] ^ (KeyShuffled[0x09] + KeyMirror[0x07]);</div>
<div class="line"><span class="lineno"> 2087</span>        MpqData[0x04] = MpqData[0x04] ^ (KeyShuffled[0x0A] + KeyMirror[0x04]);</div>
<div class="line"><span class="lineno"> 2088</span>        MpqData[0x05] = MpqData[0x05] ^ (KeyShuffled[0x0C] + KeyMirror[0x01]);</div>
<div class="line"><span class="lineno"> 2089</span>        MpqData[0x06] = MpqData[0x06] ^ (KeyShuffled[0x01] + KeyMirror[0x0E]);</div>
<div class="line"><span class="lineno"> 2090</span>        MpqData[0x07] = MpqData[0x07] ^ (KeyShuffled[0x0D] + KeyMirror[0x0B]);</div>
<div class="line"><span class="lineno"> 2091</span>        MpqData[0x08] = MpqData[0x08] ^ (KeyShuffled[0x03] + KeyMirror[0x08]);</div>
<div class="line"><span class="lineno"> 2092</span>        MpqData[0x09] = MpqData[0x09] ^ (KeyShuffled[0x07] + KeyMirror[0x05]);</div>
<div class="line"><span class="lineno"> 2093</span>        MpqData[0x0A] = MpqData[0x0A] ^ (KeyShuffled[0x05] + KeyMirror[0x02]);</div>
<div class="line"><span class="lineno"> 2094</span>        MpqData[0x0B] = MpqData[0x0B] ^ (KeyShuffled[0x00] + KeyMirror[0x0F]);</div>
<div class="line"><span class="lineno"> 2095</span>        MpqData[0x0C] = MpqData[0x0C] ^ (KeyShuffled[0x02] + KeyMirror[0x0C]);</div>
<div class="line"><span class="lineno"> 2096</span>        MpqData[0x0D] = MpqData[0x0D] ^ (KeyShuffled[0x06] + KeyMirror[0x09]);</div>
<div class="line"><span class="lineno"> 2097</span>        MpqData[0x0E] = MpqData[0x0E] ^ (KeyShuffled[0x0B] + KeyMirror[0x06]);</div>
<div class="line"><span class="lineno"> 2098</span>        MpqData[0x0F] = MpqData[0x0F] ^ (KeyShuffled[0x0F] + KeyMirror[0x03]);</div>
<div class="line"><span class="lineno"> 2099</span>        <a class="code hl_define" href="StormPort_8h.html#ac7ba8dafbd180540281c58442f9777ee">BSWAP_ARRAY32_UNSIGNED</a>(MpqData, <a class="code hl_define" href="FileStream_8h.html#aa7f93c6d9b01977696433566896b8ca5">MPQE_CHUNK_SIZE</a>);</div>
<div class="line"><span class="lineno"> 2100</span> </div>
<div class="line"><span class="lineno"> 2101</span>        <span class="comment">// Update byte offset in the key</span></div>
<div class="line"><span class="lineno"> 2102</span>        KeyMirror[0x08]++;</div>
<div class="line"><span class="lineno"> 2103</span>        <span class="keywordflow">if</span>(KeyMirror[0x08] == 0)</div>
<div class="line"><span class="lineno"> 2104</span>            KeyMirror[0x05]++;</div>
<div class="line"><span class="lineno"> 2105</span> </div>
<div class="line"><span class="lineno"> 2106</span>        <span class="comment">// Move pointers and decrease number of bytes to decrypt</span></div>
<div class="line"><span class="lineno"> 2107</span>        MpqData  += (<a class="code hl_define" href="FileStream_8h.html#aa7f93c6d9b01977696433566896b8ca5">MPQE_CHUNK_SIZE</a> / <span class="keyword">sizeof</span>(<a class="code hl_typedef" href="StormPort_8h.html#a798af1e30bc65f319c1a246cecf59e39">DWORD</a>));</div>
<div class="line"><span class="lineno"> 2108</span>        dwLength -= <a class="code hl_define" href="FileStream_8h.html#aa7f93c6d9b01977696433566896b8ca5">MPQE_CHUNK_SIZE</a>;</div>
<div class="line"><span class="lineno"> 2109</span>    }</div>
<div class="line"><span class="lineno"> 2110</span>}</div>
<div class="ttc" id="aFileStream_8cpp_html_a2ab4669edc8efaf172b769732d83e2f0"><div class="ttname"><a href="FileStream_8cpp.html#a2ab4669edc8efaf172b769732d83e2f0">Rol32</a></div><div class="ttdeci">static DWORD Rol32(DWORD dwValue, DWORD dwRolCount)</div><div class="ttdef"><b>Definition</b> <a href="FileStream_8cpp_source.html#l01973">FileStream.cpp:1973</a></div></div>
</div><!-- fragment --><div class="dynheader">
Here is the call graph for this function:</div>
<div class="dyncontent">
<div class="center"><iframe scrolling="no" frameborder="0" src="FileStream_8cpp_a1a04dfdeabbbf63c5e09fcda34922e7a_cgraph.svg" width="255" height="36"><p><b>This browser is not able to show SVG: try Firefox, Chrome, Safari, or Opera instead.</b></p></iframe></div>
</div>
<div class="dynheader">
Here is the caller graph for this function:</div>
<div class="dyncontent">
<div class="center"><div class="zoom"><iframe scrolling="no" frameborder="0" src="FileStream_8cpp_a1a04dfdeabbbf63c5e09fcda34922e7a_icgraph.svg" width="100%" height="600"><p><b>This browser is not able to show SVG: try Firefox, Chrome, Safari, or Opera instead.</b></p></iframe></div></div>
</div>

</div>
</div>
<a id="ae8b75c4797726e9c5ee0b4b03bf31442" name="ae8b75c4797726e9c5ee0b4b03bf31442"></a>
<h2 class="memtitle"><span class="permalink"><a href="#ae8b75c4797726e9c5ee0b4b03bf31442">&#9670;&#160;</a></span>FileStream_Close()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void FileStream_Close </td>
          <td>(</td>
          <td class="paramtype"><a class="el" href="structTFileStream.html">TFileStream</a> *&#160;</td>
          <td class="paramname"><em>pStream</em></td><td>)</td>
          <td></td>
        </tr>
      </table>
</div><div class="memdoc">
<p>This function closes an archive file and frees any data buffers that have been allocated for stream management. The function must also support partially allocated structure, i.e. one or more buffers can be NULL, if there was an allocation failure during the process</p>
<p><em>pStream</em> Pointer to an open stream </p>

<p class="definition">Definition at line <a class="el" href="FileStream_8cpp_source.html#l02907">2907</a> of file <a class="el" href="FileStream_8cpp_source.html">FileStream.cpp</a>.</p>
<div class="fragment"><div class="line"><span class="lineno"> 2908</span>{</div>
<div class="line"><span class="lineno"> 2909</span>    <span class="comment">// Check if the stream structure is allocated at all</span></div>
<div class="line"><span class="lineno"> 2910</span>    <span class="keywordflow">if</span>(pStream != NULL)</div>
<div class="line"><span class="lineno"> 2911</span>    {</div>
<div class="line"><span class="lineno"> 2912</span>        <span class="comment">// Free the master stream, if any</span></div>
<div class="line"><span class="lineno"> 2913</span>        <span class="keywordflow">if</span>(pStream-&gt;<a class="code hl_variable" href="structTFileStream.html#a26faae83ba546119ac59fc35eaeec274">pMaster</a> != NULL)</div>
<div class="line"><span class="lineno"> 2914</span>            <a class="code hl_function" href="FileStream_8cpp.html#ae8b75c4797726e9c5ee0b4b03bf31442">FileStream_Close</a>(pStream-&gt;<a class="code hl_variable" href="structTFileStream.html#a26faae83ba546119ac59fc35eaeec274">pMaster</a>);</div>
<div class="line"><span class="lineno"> 2915</span>        pStream-&gt;<a class="code hl_variable" href="structTFileStream.html#a26faae83ba546119ac59fc35eaeec274">pMaster</a> = NULL;</div>
<div class="line"><span class="lineno"> 2916</span> </div>
<div class="line"><span class="lineno"> 2917</span>        <span class="comment">// Close the stream provider</span></div>
<div class="line"><span class="lineno"> 2918</span>        <span class="keywordflow">if</span>(pStream-&gt;<a class="code hl_variable" href="structTFileStream.html#ac3f8968d1ae374c58ab50404221834e4">StreamClose</a> != NULL)</div>
<div class="line"><span class="lineno"> 2919</span>            pStream-&gt;<a class="code hl_variable" href="structTFileStream.html#ac3f8968d1ae374c58ab50404221834e4">StreamClose</a>(pStream);</div>
<div class="line"><span class="lineno"> 2920</span> </div>
<div class="line"><span class="lineno"> 2921</span>        <span class="comment">// ... or close base stream, if any</span></div>
<div class="line"><span class="lineno"> 2922</span>        <span class="keywordflow">else</span> <span class="keywordflow">if</span>(pStream-&gt;<a class="code hl_variable" href="structTFileStream.html#acbdc7dfef3127e4c077310381f8f6c7d">BaseClose</a> != NULL)</div>
<div class="line"><span class="lineno"> 2923</span>            pStream-&gt;<a class="code hl_variable" href="structTFileStream.html#acbdc7dfef3127e4c077310381f8f6c7d">BaseClose</a>(pStream);</div>
<div class="line"><span class="lineno"> 2924</span> </div>
<div class="line"><span class="lineno"> 2925</span>        <span class="comment">// Free the stream itself</span></div>
<div class="line"><span class="lineno"> 2926</span>        <a class="code hl_define" href="StormCommon_8h.html#a50487dadfceefebfb0de8fa711eaf4b3">STORM_FREE</a>(pStream);</div>
<div class="line"><span class="lineno"> 2927</span>    }</div>
<div class="line"><span class="lineno"> 2928</span>}</div>
</div><!-- fragment --><div class="dynheader">
Here is the call graph for this function:</div>
<div class="dyncontent">
<div class="center"><iframe scrolling="no" frameborder="0" src="FileStream_8cpp_ae8b75c4797726e9c5ee0b4b03bf31442_cgraph.svg" width="146" height="60"><p><b>This browser is not able to show SVG: try Firefox, Chrome, Safari, or Opera instead.</b></p></iframe></div>
</div>
<div class="dynheader">
Here is the caller graph for this function:</div>
<div class="dyncontent">
<div class="center"><div class="zoom"><iframe scrolling="no" frameborder="0" src="FileStream_8cpp_ae8b75c4797726e9c5ee0b4b03bf31442_icgraph.svg" width="100%" height="600"><p><b>This browser is not able to show SVG: try Firefox, Chrome, Safari, or Opera instead.</b></p></iframe></div></div>
</div>

</div>
</div>
<a id="aaba1ffb5ec458bc89519a891e28ab10e" name="aaba1ffb5ec458bc89519a891e28ab10e"></a>
<h2 class="memtitle"><span class="permalink"><a href="#aaba1ffb5ec458bc89519a891e28ab10e">&#9670;&#160;</a></span>FileStream_CreateFile()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname"><a class="el" href="structTFileStream.html">TFileStream</a> * FileStream_CreateFile </td>
          <td>(</td>
          <td class="paramtype"><a class="el" href="StormLib_2src_2zlib_2zconf_8h.html#a2c212835823e3c54a8ab6d95c652660e">const</a> <a class="el" href="StormPort_8h.html#a03bdb8ce5895c7e261aadc2529637546">TCHAR</a> *&#160;</td>
          <td class="paramname"><em>szFileName</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype"><a class="el" href="StormPort_8h.html#a798af1e30bc65f319c1a246cecf59e39">DWORD</a>&#160;</td>
          <td class="paramname"><em>dwStreamFlags</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
</div><div class="memdoc">
<p>This function creates a new file for read-write access</p>
<ul>
<li>If the current platform supports file sharing, the file must be created for read sharing (i.e. another application can open the file for read, but not for write)</li>
<li>If the file does not exist, the function must create new one</li>
<li>If the file exists, the function must rewrite it and set to zero size</li>
<li>The parameters of the function must be validate by the caller</li>
<li>The function must initialize all stream function pointers in <a class="el" href="structTFileStream.html">TFileStream</a></li>
<li>If the function fails from any reason, it must close all handles and free all memory that has been allocated in the process of stream creation, including the <a class="el" href="structTFileStream.html">TFileStream</a> structure itself</li>
</ul>
<p><em>szFileName</em> Name of the file to create </p>

<p class="definition">Definition at line <a class="el" href="FileStream_8cpp_source.html#l02443">2443</a> of file <a class="el" href="FileStream_8cpp_source.html">FileStream.cpp</a>.</p>
<div class="fragment"><div class="line"><span class="lineno"> 2446</span>{</div>
<div class="line"><span class="lineno"> 2447</span>    <a class="code hl_struct" href="structTFileStream.html">TFileStream</a> * pStream;</div>
<div class="line"><span class="lineno"> 2448</span> </div>
<div class="line"><span class="lineno"> 2449</span>    <span class="comment">// We only support creation of flat, local file</span></div>
<div class="line"><span class="lineno"> 2450</span>    <span class="keywordflow">if</span>((dwStreamFlags &amp; (<a class="code hl_define" href="StormLib_8h.html#a07a964e92d9c6a64250c80b56e75c520">STREAM_PROVIDERS_MASK</a>)) != (<a class="code hl_define" href="StormLib_8h.html#a45b6170ca9e7880848cdca068234d28c">STREAM_PROVIDER_FLAT</a> | <a class="code hl_define" href="StormLib_8h.html#a3773c068cc9e5acf2ef6a0fd9b4a534e">BASE_PROVIDER_FILE</a>))</div>
<div class="line"><span class="lineno"> 2451</span>    {</div>
<div class="line"><span class="lineno"> 2452</span>        <a class="code hl_function" href="FileStream_8cpp.html#a65dd8d3e416ffbd6ac5f468c6bdccac9">SetLastError</a>(<a class="code hl_define" href="StormPort_8h.html#ab72d05032a6d1152bad9af394811d447">ERROR_NOT_SUPPORTED</a>);</div>
<div class="line"><span class="lineno"> 2453</span>        <span class="keywordflow">return</span> NULL;</div>
<div class="line"><span class="lineno"> 2454</span>    }</div>
<div class="line"><span class="lineno"> 2455</span> </div>
<div class="line"><span class="lineno"> 2456</span>    <span class="comment">// Allocate file stream structure for flat stream</span></div>
<div class="line"><span class="lineno"> 2457</span>    pStream = <a class="code hl_function" href="FileStream_8cpp.html#aa5874b3e4d05d2f6dfa3a32d62f56bea">AllocateFileStream</a>(szFileName, <span class="keyword">sizeof</span>(<a class="code hl_struct" href="structTBlockStream.html">TBlockStream</a>), dwStreamFlags);</div>
<div class="line"><span class="lineno"> 2458</span>    <span class="keywordflow">if</span>(pStream != NULL)</div>
<div class="line"><span class="lineno"> 2459</span>    {</div>
<div class="line"><span class="lineno"> 2460</span>        <span class="comment">// Attempt to create the disk file</span></div>
<div class="line"><span class="lineno"> 2461</span>        <span class="keywordflow">if</span>(<a class="code hl_function" href="FileStream_8cpp.html#a1fcabccfb3e06e3d9aaa6c20bbbf35b1">BaseFile_Create</a>(pStream))</div>
<div class="line"><span class="lineno"> 2462</span>        {</div>
<div class="line"><span class="lineno"> 2463</span>            <span class="comment">// Fill the stream provider functions</span></div>
<div class="line"><span class="lineno"> 2464</span>            pStream-&gt;<a class="code hl_variable" href="structTFileStream.html#aaf7da0af26da32b968cdb66eb87f26ce">StreamRead</a>    = pStream-&gt;<a class="code hl_variable" href="structTFileStream.html#a5b6aa0a4b5d6b97770f73fbc47412da1">BaseRead</a>;</div>
<div class="line"><span class="lineno"> 2465</span>            pStream-&gt;<a class="code hl_variable" href="structTFileStream.html#ae085fb3901c17a2b302196951a9fe412">StreamWrite</a>   = pStream-&gt;<a class="code hl_variable" href="structTFileStream.html#a811c9b3d565324e51361768847fe50a8">BaseWrite</a>;</div>
<div class="line"><span class="lineno"> 2466</span>            pStream-&gt;<a class="code hl_variable" href="structTFileStream.html#ae3358c9b5a9dfdee5e8275561eff8850">StreamResize</a>  = pStream-&gt;<a class="code hl_variable" href="structTFileStream.html#a00a7a9d0ce7cdea1c4ecdbd72a3bd282">BaseResize</a>;</div>
<div class="line"><span class="lineno"> 2467</span>            pStream-&gt;<a class="code hl_variable" href="structTFileStream.html#a95b85c4ef3254dc6a73fdb2e566ebbba">StreamGetSize</a> = pStream-&gt;<a class="code hl_variable" href="structTFileStream.html#a0366f518ffecab4131bf2527f22964e3">BaseGetSize</a>;</div>
<div class="line"><span class="lineno"> 2468</span>            pStream-&gt;<a class="code hl_variable" href="structTFileStream.html#a158f1621a05e8b3002c1729fd5d4cfca">StreamGetPos</a>  = pStream-&gt;<a class="code hl_variable" href="structTFileStream.html#aa9c8095dd8a2e07b83611e0b5dac3fde">BaseGetPos</a>;</div>
<div class="line"><span class="lineno"> 2469</span>            pStream-&gt;<a class="code hl_variable" href="structTFileStream.html#ac3f8968d1ae374c58ab50404221834e4">StreamClose</a>   = pStream-&gt;<a class="code hl_variable" href="structTFileStream.html#acbdc7dfef3127e4c077310381f8f6c7d">BaseClose</a>;</div>
<div class="line"><span class="lineno"> 2470</span>            <span class="keywordflow">return</span> pStream;</div>
<div class="line"><span class="lineno"> 2471</span>        }</div>
<div class="line"><span class="lineno"> 2472</span> </div>
<div class="line"><span class="lineno"> 2473</span>        <span class="comment">// File create failed, delete the stream</span></div>
<div class="line"><span class="lineno"> 2474</span>        <a class="code hl_define" href="StormCommon_8h.html#a50487dadfceefebfb0de8fa711eaf4b3">STORM_FREE</a>(pStream);</div>
<div class="line"><span class="lineno"> 2475</span>        pStream = NULL;</div>
<div class="line"><span class="lineno"> 2476</span>    }</div>
<div class="line"><span class="lineno"> 2477</span> </div>
<div class="line"><span class="lineno"> 2478</span>    <span class="comment">// Return the stream</span></div>
<div class="line"><span class="lineno"> 2479</span>    <span class="keywordflow">return</span> pStream;</div>
<div class="line"><span class="lineno"> 2480</span>}</div>
<div class="ttc" id="aStormLib_8h_html_a3773c068cc9e5acf2ef6a0fd9b4a534e"><div class="ttname"><a href="StormLib_8h.html#a3773c068cc9e5acf2ef6a0fd9b4a534e">BASE_PROVIDER_FILE</a></div><div class="ttdeci">#define BASE_PROVIDER_FILE</div><div class="ttdef"><b>Definition</b> <a href="StormLib_8h_source.html#l00310">StormLib.h:310</a></div></div>
<div class="ttc" id="aStormLib_8h_html_a45b6170ca9e7880848cdca068234d28c"><div class="ttname"><a href="StormLib_8h.html#a45b6170ca9e7880848cdca068234d28c">STREAM_PROVIDER_FLAT</a></div><div class="ttdeci">#define STREAM_PROVIDER_FLAT</div><div class="ttdef"><b>Definition</b> <a href="StormLib_8h_source.html#l00315">StormLib.h:315</a></div></div>
<div class="ttc" id="astructTFileStream_html_ae085fb3901c17a2b302196951a9fe412"><div class="ttname"><a href="structTFileStream.html#ae085fb3901c17a2b302196951a9fe412">TFileStream::StreamWrite</a></div><div class="ttdeci">STREAM_WRITE StreamWrite</div><div class="ttdef"><b>Definition</b> <a href="FileStream_8h_source.html#l00157">FileStream.h:157</a></div></div>
<div class="ttc" id="astructTFileStream_html_ae3358c9b5a9dfdee5e8275561eff8850"><div class="ttname"><a href="structTFileStream.html#ae3358c9b5a9dfdee5e8275561eff8850">TFileStream::StreamResize</a></div><div class="ttdeci">STREAM_RESIZE StreamResize</div><div class="ttdef"><b>Definition</b> <a href="FileStream_8h_source.html#l00158">FileStream.h:158</a></div></div>
</div><!-- fragment --><div class="dynheader">
Here is the call graph for this function:</div>
<div class="dyncontent">
<div class="center"><div class="zoom"><iframe scrolling="no" frameborder="0" src="FileStream_8cpp_aaba1ffb5ec458bc89519a891e28ab10e_cgraph.svg" width="100%" height="600"><p><b>This browser is not able to show SVG: try Firefox, Chrome, Safari, or Opera instead.</b></p></iframe></div></div>
</div>
<div class="dynheader">
Here is the caller graph for this function:</div>
<div class="dyncontent">
<div class="center"><iframe scrolling="no" frameborder="0" src="FileStream_8cpp_aaba1ffb5ec458bc89519a891e28ab10e_icgraph.svg" width="578" height="135"><p><b>This browser is not able to show SVG: try Firefox, Chrome, Safari, or Opera instead.</b></p></iframe></div>
</div>

</div>
</div>
<a id="a079730e5345bc1141a1057d4e13e95ac" name="a079730e5345bc1141a1057d4e13e95ac"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a079730e5345bc1141a1057d4e13e95ac">&#9670;&#160;</a></span>FileStream_GetBitmap()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname"><a class="el" href="StormPort_8h.html#abb452686968e48b67397da5f97445f5b">bool</a> FileStream_GetBitmap </td>
          <td>(</td>
          <td class="paramtype"><a class="el" href="structTFileStream.html">TFileStream</a> *&#160;</td>
          <td class="paramname"><em>pStream</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">void *&#160;</td>
          <td class="paramname"><em>pvBitmap</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype"><a class="el" href="StormPort_8h.html#a798af1e30bc65f319c1a246cecf59e39">DWORD</a>&#160;</td>
          <td class="paramname"><em>cbBitmap</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype"><a class="el" href="StormPort_8h.html#a798af1e30bc65f319c1a246cecf59e39">DWORD</a> *&#160;</td>
          <td class="paramname"><em>pcbLengthNeeded</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
</div><div class="memdoc">
<p>This function gives the block map. The 'pvBitmap' pointer must point to a buffer of at least sizeof(STREAM_BLOCK_MAP) size. It can also have size of the complete block map (i.e. sizeof(STREAM_BLOCK_MAP) + BitmapSize). In that case, the function also copies the bit-based block map.</p>
<p><em>pStream</em> Pointer to an open stream <em>pvBitmap</em> Pointer to buffer where the block map will be stored <em>cbBitmap</em> Length of the buffer, of the block map <em>cbLengthNeeded</em> Length of the bitmap, in bytes </p>

<p class="definition">Definition at line <a class="el" href="FileStream_8cpp_source.html#l02659">2659</a> of file <a class="el" href="FileStream_8cpp_source.html">FileStream.cpp</a>.</p>
<div class="fragment"><div class="line"><span class="lineno"> 2660</span>{</div>
<div class="line"><span class="lineno"> 2661</span>    <a class="code hl_struct" href="structTStreamBitmap.html">TStreamBitmap</a> * pBitmap = (<a class="code hl_struct" href="structTStreamBitmap.html">TStreamBitmap</a> *)pvBitmap;</div>
<div class="line"><span class="lineno"> 2662</span>    <a class="code hl_struct" href="structTBlockStream.html">TBlockStream</a> * pBlockStream = (<a class="code hl_struct" href="structTBlockStream.html">TBlockStream</a> *)pStream;</div>
<div class="line"><span class="lineno"> 2663</span>    <a class="code hl_typedef" href="StormPort_8h.html#abb9abb9ce956f1a9e5a4081ac40e5649">ULONGLONG</a> BlockOffset;</div>
<div class="line"><span class="lineno"> 2664</span>    <a class="code hl_typedef" href="StormPort_8h.html#ac2d3fb16b5b34c1e6ab80014309020eb">LPBYTE</a> Bitmap = (<a class="code hl_typedef" href="StormPort_8h.html#ac2d3fb16b5b34c1e6ab80014309020eb">LPBYTE</a>)(pBitmap + 1);</div>
<div class="line"><span class="lineno"> 2665</span>    <a class="code hl_typedef" href="StormPort_8h.html#a798af1e30bc65f319c1a246cecf59e39">DWORD</a> BitmapSize;</div>
<div class="line"><span class="lineno"> 2666</span>    <a class="code hl_typedef" href="StormPort_8h.html#a798af1e30bc65f319c1a246cecf59e39">DWORD</a> BlockCount;</div>
<div class="line"><span class="lineno"> 2667</span>    <a class="code hl_typedef" href="StormPort_8h.html#a798af1e30bc65f319c1a246cecf59e39">DWORD</a> BlockSize;</div>
<div class="line"><span class="lineno"> 2668</span>    <span class="keywordtype">bool</span> bResult = <span class="keyword">false</span>;</div>
<div class="line"><span class="lineno"> 2669</span> </div>
<div class="line"><span class="lineno"> 2670</span>    <span class="comment">// Retrieve the size of one block</span></div>
<div class="line"><span class="lineno"> 2671</span>    <span class="keywordflow">if</span>(pStream-&gt;<a class="code hl_variable" href="structTFileStream.html#a707b42c85dd8f372ce802efb6bc1955e">BlockCheck</a> != NULL)</div>
<div class="line"><span class="lineno"> 2672</span>    {</div>
<div class="line"><span class="lineno"> 2673</span>        BlockCount = pBlockStream-&gt;<a class="code hl_variable" href="structTBlockStream.html#a05210a0cd78477e541734ba7e3abe2b1">BlockCount</a>;</div>
<div class="line"><span class="lineno"> 2674</span>        BlockSize = pBlockStream-&gt;<a class="code hl_variable" href="structTBlockStream.html#a8c7180184928638b30809f7f85061fb7">BlockSize</a>;</div>
<div class="line"><span class="lineno"> 2675</span>    }</div>
<div class="line"><span class="lineno"> 2676</span>    <span class="keywordflow">else</span></div>
<div class="line"><span class="lineno"> 2677</span>    {</div>
<div class="line"><span class="lineno"> 2678</span>        BlockCount = (<a class="code hl_typedef" href="StormPort_8h.html#a798af1e30bc65f319c1a246cecf59e39">DWORD</a>)((pStream-&gt;<a class="code hl_variable" href="structTFileStream.html#a99bdae10f74cf57156e65bd76ba64771">StreamSize</a> + <a class="code hl_define" href="FileStream_8h.html#ac42c901b241f3189fb2451bfea993e1a">DEFAULT_BLOCK_SIZE</a> - 1) / <a class="code hl_define" href="FileStream_8h.html#ac42c901b241f3189fb2451bfea993e1a">DEFAULT_BLOCK_SIZE</a>);</div>
<div class="line"><span class="lineno"> 2679</span>        BlockSize = <a class="code hl_define" href="FileStream_8h.html#ac42c901b241f3189fb2451bfea993e1a">DEFAULT_BLOCK_SIZE</a>;</div>
<div class="line"><span class="lineno"> 2680</span>    }</div>
<div class="line"><span class="lineno"> 2681</span> </div>
<div class="line"><span class="lineno"> 2682</span>    <span class="comment">// Fill-in the variables</span></div>
<div class="line"><span class="lineno"> 2683</span>    BitmapSize = (BlockCount + 7) / 8;</div>
<div class="line"><span class="lineno"> 2684</span> </div>
<div class="line"><span class="lineno"> 2685</span>    <span class="comment">// Give the number of blocks</span></div>
<div class="line"><span class="lineno"> 2686</span>    <span class="keywordflow">if</span>(pcbLengthNeeded != NULL)</div>
<div class="line"><span class="lineno"> 2687</span>        pcbLengthNeeded[0] = <span class="keyword">sizeof</span>(<a class="code hl_struct" href="structTStreamBitmap.html">TStreamBitmap</a>) + BitmapSize;</div>
<div class="line"><span class="lineno"> 2688</span> </div>
<div class="line"><span class="lineno"> 2689</span>    <span class="comment">// If the length of the buffer is not enough</span></div>
<div class="line"><span class="lineno"> 2690</span>    <span class="keywordflow">if</span>(pvBitmap != NULL &amp;&amp; cbBitmap != 0)</div>
<div class="line"><span class="lineno"> 2691</span>    {</div>
<div class="line"><span class="lineno"> 2692</span>        <span class="comment">// Give the STREAM_BLOCK_MAP structure</span></div>
<div class="line"><span class="lineno"> 2693</span>        <span class="keywordflow">if</span>(cbBitmap &gt;= <span class="keyword">sizeof</span>(<a class="code hl_struct" href="structTStreamBitmap.html">TStreamBitmap</a>))</div>
<div class="line"><span class="lineno"> 2694</span>        {</div>
<div class="line"><span class="lineno"> 2695</span>            pBitmap-&gt;<a class="code hl_variable" href="structTStreamBitmap.html#a10f51b48a75b6679d43d2c687ea17c4a">StreamSize</a> = pStream-&gt;<a class="code hl_variable" href="structTFileStream.html#a99bdae10f74cf57156e65bd76ba64771">StreamSize</a>;</div>
<div class="line"><span class="lineno"> 2696</span>            pBitmap-&gt;<a class="code hl_variable" href="structTStreamBitmap.html#a08cd10b5e913016784b84a56dfa12b84">BitmapSize</a> = BitmapSize;</div>
<div class="line"><span class="lineno"> 2697</span>            pBitmap-&gt;<a class="code hl_variable" href="structTStreamBitmap.html#ab90b1cc270a2d34fdecea0e945185ca8">BlockCount</a> = BlockCount;</div>
<div class="line"><span class="lineno"> 2698</span>            pBitmap-&gt;<a class="code hl_variable" href="structTStreamBitmap.html#a146c2246f25fd3fa72abd2a413746fa0">BlockSize</a>  = BlockSize;</div>
<div class="line"><span class="lineno"> 2699</span>            pBitmap-&gt;<a class="code hl_variable" href="structTStreamBitmap.html#a0b36de5895d75734e8ac90a277109339">IsComplete</a> = (pStream-&gt;<a class="code hl_variable" href="structTFileStream.html#a707b42c85dd8f372ce802efb6bc1955e">BlockCheck</a> != NULL) ? pBlockStream-&gt;<a class="code hl_variable" href="structTBlockStream.html#a8bb8ee629c5bc59f65d01eead9b62762">IsComplete</a> : 1;</div>
<div class="line"><span class="lineno"> 2700</span>            bResult = <span class="keyword">true</span>;</div>
<div class="line"><span class="lineno"> 2701</span>        }</div>
<div class="line"><span class="lineno"> 2702</span> </div>
<div class="line"><span class="lineno"> 2703</span>        <span class="comment">// Give the block bitmap, if enough space</span></div>
<div class="line"><span class="lineno"> 2704</span>        <span class="keywordflow">if</span>(cbBitmap &gt;= <span class="keyword">sizeof</span>(<a class="code hl_struct" href="structTStreamBitmap.html">TStreamBitmap</a>) + BitmapSize)</div>
<div class="line"><span class="lineno"> 2705</span>        {</div>
<div class="line"><span class="lineno"> 2706</span>            <span class="comment">// Version with bitmap present</span></div>
<div class="line"><span class="lineno"> 2707</span>            <span class="keywordflow">if</span>(pStream-&gt;<a class="code hl_variable" href="structTFileStream.html#a707b42c85dd8f372ce802efb6bc1955e">BlockCheck</a> != NULL)</div>
<div class="line"><span class="lineno"> 2708</span>            {</div>
<div class="line"><span class="lineno"> 2709</span>                <a class="code hl_typedef" href="StormPort_8h.html#a798af1e30bc65f319c1a246cecf59e39">DWORD</a> ByteIndex = 0;</div>
<div class="line"><span class="lineno"> 2710</span>                <a class="code hl_typedef" href="StormPort_8h.html#a4ae1dab0fb4b072a66584546209e7d58">BYTE</a> BitMask = 0x01;</div>
<div class="line"><span class="lineno"> 2711</span> </div>
<div class="line"><span class="lineno"> 2712</span>                <span class="comment">// Initialize the map with zeros</span></div>
<div class="line"><span class="lineno"> 2713</span>                memset(Bitmap, 0, BitmapSize);</div>
<div class="line"><span class="lineno"> 2714</span> </div>
<div class="line"><span class="lineno"> 2715</span>                <span class="comment">// Fill the map</span></div>
<div class="line"><span class="lineno"> 2716</span>                <span class="keywordflow">for</span>(BlockOffset = 0; BlockOffset &lt; pStream-&gt;<a class="code hl_variable" href="structTFileStream.html#a99bdae10f74cf57156e65bd76ba64771">StreamSize</a>; BlockOffset += BlockSize)</div>
<div class="line"><span class="lineno"> 2717</span>                {</div>
<div class="line"><span class="lineno"> 2718</span>                    <span class="comment">// Set the bit if the block is present</span></div>
<div class="line"><span class="lineno"> 2719</span>                    <span class="keywordflow">if</span>(pBlockStream-&gt;<a class="code hl_variable" href="structTFileStream.html#a707b42c85dd8f372ce802efb6bc1955e">BlockCheck</a>(pStream, BlockOffset))</div>
<div class="line"><span class="lineno"> 2720</span>                        Bitmap[ByteIndex] |= BitMask;</div>
<div class="line"><span class="lineno"> 2721</span> </div>
<div class="line"><span class="lineno"> 2722</span>                    <span class="comment">// Move bit position</span></div>
<div class="line"><span class="lineno"> 2723</span>                    ByteIndex += (BitMask &gt;&gt; 0x07);</div>
<div class="line"><span class="lineno"> 2724</span>                    BitMask = (BitMask &gt;&gt; 0x07) | (BitMask &lt;&lt; 0x01);</div>
<div class="line"><span class="lineno"> 2725</span>                }</div>
<div class="line"><span class="lineno"> 2726</span>            }</div>
<div class="line"><span class="lineno"> 2727</span>            <span class="keywordflow">else</span></div>
<div class="line"><span class="lineno"> 2728</span>            {</div>
<div class="line"><span class="lineno"> 2729</span>                memset(Bitmap, 0xFF, BitmapSize);</div>
<div class="line"><span class="lineno"> 2730</span>            }</div>
<div class="line"><span class="lineno"> 2731</span>        }</div>
<div class="line"><span class="lineno"> 2732</span>    }</div>
<div class="line"><span class="lineno"> 2733</span> </div>
<div class="line"><span class="lineno"> 2734</span>    <span class="comment">// Set last error value and return</span></div>
<div class="line"><span class="lineno"> 2735</span>    <span class="keywordflow">if</span>(bResult == <span class="keyword">false</span>)</div>
<div class="line"><span class="lineno"> 2736</span>        <a class="code hl_function" href="FileStream_8cpp.html#a65dd8d3e416ffbd6ac5f468c6bdccac9">SetLastError</a>(<a class="code hl_define" href="StormPort_8h.html#a9ea4797ca694b9d2dfe6b408dfee69c1">ERROR_INSUFFICIENT_BUFFER</a>);</div>
<div class="line"><span class="lineno"> 2737</span>    <span class="keywordflow">return</span> bResult;</div>
<div class="line"><span class="lineno"> 2738</span>}</div>
<div class="ttc" id="aFileStream_8h_html_ac42c901b241f3189fb2451bfea993e1a"><div class="ttname"><a href="FileStream_8h.html#ac42c901b241f3189fb2451bfea993e1a">DEFAULT_BLOCK_SIZE</a></div><div class="ttdeci">#define DEFAULT_BLOCK_SIZE</div><div class="ttdef"><b>Definition</b> <a href="FileStream_8h_source.html#l00086">FileStream.h:86</a></div></div>
<div class="ttc" id="aStormPort_8h_html_a9ea4797ca694b9d2dfe6b408dfee69c1"><div class="ttname"><a href="StormPort_8h.html#a9ea4797ca694b9d2dfe6b408dfee69c1">ERROR_INSUFFICIENT_BUFFER</a></div><div class="ttdeci">#define ERROR_INSUFFICIENT_BUFFER</div><div class="ttdef"><b>Definition</b> <a href="StormPort_8h_source.html#l00411">StormPort.h:411</a></div></div>
<div class="ttc" id="astructTStreamBitmap_html"><div class="ttname"><a href="structTStreamBitmap.html">TStreamBitmap</a></div><div class="ttdef"><b>Definition</b> <a href="StormLib_8h_source.html#l00952">StormLib.h:953</a></div></div>
<div class="ttc" id="astructTStreamBitmap_html_a08cd10b5e913016784b84a56dfa12b84"><div class="ttname"><a href="structTStreamBitmap.html#a08cd10b5e913016784b84a56dfa12b84">TStreamBitmap::BitmapSize</a></div><div class="ttdeci">DWORD BitmapSize</div><div class="ttdef"><b>Definition</b> <a href="StormLib_8h_source.html#l00955">StormLib.h:955</a></div></div>
<div class="ttc" id="astructTStreamBitmap_html_a0b36de5895d75734e8ac90a277109339"><div class="ttname"><a href="structTStreamBitmap.html#a0b36de5895d75734e8ac90a277109339">TStreamBitmap::IsComplete</a></div><div class="ttdeci">DWORD IsComplete</div><div class="ttdef"><b>Definition</b> <a href="StormLib_8h_source.html#l00958">StormLib.h:958</a></div></div>
<div class="ttc" id="astructTStreamBitmap_html_a10f51b48a75b6679d43d2c687ea17c4a"><div class="ttname"><a href="structTStreamBitmap.html#a10f51b48a75b6679d43d2c687ea17c4a">TStreamBitmap::StreamSize</a></div><div class="ttdeci">ULONGLONG StreamSize</div><div class="ttdef"><b>Definition</b> <a href="StormLib_8h_source.html#l00954">StormLib.h:954</a></div></div>
<div class="ttc" id="astructTStreamBitmap_html_a146c2246f25fd3fa72abd2a413746fa0"><div class="ttname"><a href="structTStreamBitmap.html#a146c2246f25fd3fa72abd2a413746fa0">TStreamBitmap::BlockSize</a></div><div class="ttdeci">DWORD BlockSize</div><div class="ttdef"><b>Definition</b> <a href="StormLib_8h_source.html#l00957">StormLib.h:957</a></div></div>
<div class="ttc" id="astructTStreamBitmap_html_ab90b1cc270a2d34fdecea0e945185ca8"><div class="ttname"><a href="structTStreamBitmap.html#ab90b1cc270a2d34fdecea0e945185ca8">TStreamBitmap::BlockCount</a></div><div class="ttdeci">DWORD BlockCount</div><div class="ttdef"><b>Definition</b> <a href="StormLib_8h_source.html#l00956">StormLib.h:956</a></div></div>
</div><!-- fragment --><div class="dynheader">
Here is the call graph for this function:</div>
<div class="dyncontent">
<div class="center"><iframe scrolling="no" frameborder="0" src="FileStream_8cpp_a079730e5345bc1141a1057d4e13e95ac_cgraph.svg" width="330" height="36"><p><b>This browser is not able to show SVG: try Firefox, Chrome, Safari, or Opera instead.</b></p></iframe></div>
</div>
<div class="dynheader">
Here is the caller graph for this function:</div>
<div class="dyncontent">
<div class="center"><div class="zoom"><iframe scrolling="no" frameborder="0" src="FileStream_8cpp_a079730e5345bc1141a1057d4e13e95ac_icgraph.svg" width="100%" height="364"><p><b>This browser is not able to show SVG: try Firefox, Chrome, Safari, or Opera instead.</b></p></iframe></div></div>
</div>

</div>
</div>
<a id="aac8a29e50fd6c047ee9288073b54804e" name="aac8a29e50fd6c047ee9288073b54804e"></a>
<h2 class="memtitle"><span class="permalink"><a href="#aac8a29e50fd6c047ee9288073b54804e">&#9670;&#160;</a></span>FileStream_GetFileName()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname"><a class="el" href="StormLib_2src_2zlib_2zconf_8h.html#a2c212835823e3c54a8ab6d95c652660e">const</a> <a class="el" href="StormPort_8h.html#a03bdb8ce5895c7e261aadc2529637546">TCHAR</a> * FileStream_GetFileName </td>
          <td>(</td>
          <td class="paramtype"><a class="el" href="structTFileStream.html">TFileStream</a> *&#160;</td>
          <td class="paramname"><em>pStream</em></td><td>)</td>
          <td></td>
        </tr>
      </table>
</div><div class="memdoc">
<p>Returns the file name of the stream</p>
<p><em>pStream</em> Pointer to an open stream </p>

<p class="definition">Definition at line <a class="el" href="FileStream_8cpp_source.html#l02536">2536</a> of file <a class="el" href="FileStream_8cpp_source.html">FileStream.cpp</a>.</p>
<div class="fragment"><div class="line"><span class="lineno"> 2537</span>{</div>
<div class="line"><span class="lineno"> 2538</span>    assert(pStream != NULL);</div>
<div class="line"><span class="lineno"> 2539</span>    <span class="keywordflow">return</span> pStream-&gt;<a class="code hl_variable" href="structTFileStream.html#a7a4da926d708d96cb47333973e705c76">szFileName</a>;</div>
<div class="line"><span class="lineno"> 2540</span>}</div>
</div><!-- fragment --><div class="dynheader">
Here is the caller graph for this function:</div>
<div class="dyncontent">
<div class="center"><div class="zoom"><iframe scrolling="no" frameborder="0" src="FileStream_8cpp_aac8a29e50fd6c047ee9288073b54804e_icgraph.svg" width="100%" height="554"><p><b>This browser is not able to show SVG: try Firefox, Chrome, Safari, or Opera instead.</b></p></iframe></div></div>
</div>

</div>
</div>
<a id="a3b0eb2320c6401f6f1b5a92e53bc57dd" name="a3b0eb2320c6401f6f1b5a92e53bc57dd"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a3b0eb2320c6401f6f1b5a92e53bc57dd">&#9670;&#160;</a></span>FileStream_GetFlags()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname"><a class="el" href="StormPort_8h.html#abb452686968e48b67397da5f97445f5b">bool</a> FileStream_GetFlags </td>
          <td>(</td>
          <td class="paramtype"><a class="el" href="structTFileStream.html">TFileStream</a> *&#160;</td>
          <td class="paramname"><em>pStream</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype"><a class="el" href="StormPort_8h.html#a143be739596851314f3c386bd6f752f9">LPDWORD</a>&#160;</td>
          <td class="paramname"><em>pdwStreamFlags</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
</div><div class="memdoc">
<p>Returns the stream flags</p>
<p><em>pStream</em> Pointer to an open stream <em>pdwStreamFlags</em> Pointer where to store the stream flags </p>

<p class="definition">Definition at line <a class="el" href="FileStream_8cpp_source.html#l02849">2849</a> of file <a class="el" href="FileStream_8cpp_source.html">FileStream.cpp</a>.</p>
<div class="fragment"><div class="line"><span class="lineno"> 2850</span>{</div>
<div class="line"><span class="lineno"> 2851</span>    *pdwStreamFlags = pStream-&gt;<a class="code hl_variable" href="structTFileStream.html#ae61935eec67ce99ea4091bc0949de1ea">dwFlags</a>;</div>
<div class="line"><span class="lineno"> 2852</span>    <span class="keywordflow">return</span> <span class="keyword">true</span>;</div>
<div class="line"><span class="lineno"> 2853</span>}</div>
</div><!-- fragment --><div class="dynheader">
Here is the caller graph for this function:</div>
<div class="dyncontent">
<div class="center"><div class="zoom"><iframe scrolling="no" frameborder="0" src="FileStream_8cpp_a3b0eb2320c6401f6f1b5a92e53bc57dd_icgraph.svg" width="100%" height="479"><p><b>This browser is not able to show SVG: try Firefox, Chrome, Safari, or Opera instead.</b></p></iframe></div></div>
</div>

</div>
</div>
<a id="a4cda734fc220ab4b32e1f2bf9b5446fc" name="a4cda734fc220ab4b32e1f2bf9b5446fc"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a4cda734fc220ab4b32e1f2bf9b5446fc">&#9670;&#160;</a></span>FileStream_GetPos()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname"><a class="el" href="StormPort_8h.html#abb452686968e48b67397da5f97445f5b">bool</a> FileStream_GetPos </td>
          <td>(</td>
          <td class="paramtype"><a class="el" href="structTFileStream.html">TFileStream</a> *&#160;</td>
          <td class="paramname"><em>pStream</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype"><a class="el" href="StormPort_8h.html#abb9abb9ce956f1a9e5a4081ac40e5649">ULONGLONG</a> *&#160;</td>
          <td class="paramname"><em>pByteOffset</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
</div><div class="memdoc">
<p>This function returns the current file position <em>pStream</em> <em>pByteOffset</em> </p>

<p class="definition">Definition at line <a class="el" href="FileStream_8cpp_source.html#l02824">2824</a> of file <a class="el" href="FileStream_8cpp_source.html">FileStream.cpp</a>.</p>
<div class="fragment"><div class="line"><span class="lineno"> 2825</span>{</div>
<div class="line"><span class="lineno"> 2826</span>    assert(pStream-&gt;<a class="code hl_variable" href="structTFileStream.html#a158f1621a05e8b3002c1729fd5d4cfca">StreamGetPos</a> != NULL);</div>
<div class="line"><span class="lineno"> 2827</span>    <span class="keywordflow">return</span> pStream-&gt;<a class="code hl_variable" href="structTFileStream.html#a158f1621a05e8b3002c1729fd5d4cfca">StreamGetPos</a>(pStream, pByteOffset);</div>
<div class="line"><span class="lineno"> 2828</span>}</div>
</div><!-- fragment --><div class="dynheader">
Here is the caller graph for this function:</div>
<div class="dyncontent">
<div class="center"><div class="zoom"><iframe scrolling="no" frameborder="0" src="FileStream_8cpp_a4cda734fc220ab4b32e1f2bf9b5446fc_icgraph.svg" width="100%" height="600"><p><b>This browser is not able to show SVG: try Firefox, Chrome, Safari, or Opera instead.</b></p></iframe></div></div>
</div>

</div>
</div>
<a id="af505319882f0f4aaf396b6d061a2275b" name="af505319882f0f4aaf396b6d061a2275b"></a>
<h2 class="memtitle"><span class="permalink"><a href="#af505319882f0f4aaf396b6d061a2275b">&#9670;&#160;</a></span>FileStream_GetSize()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname"><a class="el" href="StormPort_8h.html#abb452686968e48b67397da5f97445f5b">bool</a> FileStream_GetSize </td>
          <td>(</td>
          <td class="paramtype"><a class="el" href="structTFileStream.html">TFileStream</a> *&#160;</td>
          <td class="paramname"><em>pStream</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype"><a class="el" href="StormPort_8h.html#abb9abb9ce956f1a9e5a4081ac40e5649">ULONGLONG</a> *&#160;</td>
          <td class="paramname"><em>pFileSize</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
</div><div class="memdoc">
<p>Returns the size of a file</p>
<p><em>pStream</em> Pointer to an open stream <em>FileSize</em> Pointer where to store the file size </p>

<p class="definition">Definition at line <a class="el" href="FileStream_8cpp_source.html#l02795">2795</a> of file <a class="el" href="FileStream_8cpp_source.html">FileStream.cpp</a>.</p>
<div class="fragment"><div class="line"><span class="lineno"> 2796</span>{</div>
<div class="line"><span class="lineno"> 2797</span>    assert(pStream-&gt;<a class="code hl_variable" href="structTFileStream.html#a95b85c4ef3254dc6a73fdb2e566ebbba">StreamGetSize</a> != NULL);</div>
<div class="line"><span class="lineno"> 2798</span>    <span class="keywordflow">return</span> pStream-&gt;<a class="code hl_variable" href="structTFileStream.html#a95b85c4ef3254dc6a73fdb2e566ebbba">StreamGetSize</a>(pStream, pFileSize);</div>
<div class="line"><span class="lineno"> 2799</span>}</div>
</div><!-- fragment --><div class="dynheader">
Here is the caller graph for this function:</div>
<div class="dyncontent">
<div class="center"><div class="zoom"><iframe scrolling="no" frameborder="0" src="FileStream_8cpp_af505319882f0f4aaf396b6d061a2275b_icgraph.svg" width="100%" height="600"><p><b>This browser is not able to show SVG: try Firefox, Chrome, Safari, or Opera instead.</b></p></iframe></div></div>
</div>

</div>
</div>
<a id="a4ea733800d58589cd80948dd23421dad" name="a4ea733800d58589cd80948dd23421dad"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a4ea733800d58589cd80948dd23421dad">&#9670;&#160;</a></span>FileStream_GetTime()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname"><a class="el" href="StormPort_8h.html#abb452686968e48b67397da5f97445f5b">bool</a> FileStream_GetTime </td>
          <td>(</td>
          <td class="paramtype"><a class="el" href="structTFileStream.html">TFileStream</a> *&#160;</td>
          <td class="paramname"><em>pStream</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype"><a class="el" href="StormPort_8h.html#abb9abb9ce956f1a9e5a4081ac40e5649">ULONGLONG</a> *&#160;</td>
          <td class="paramname"><em>pFileTime</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
</div><div class="memdoc">
<p>Returns the last write time of a file</p>
<p><em>pStream</em> Pointer to an open stream <em>pFileType</em> Pointer where to store the file last write time </p>

<p class="definition">Definition at line <a class="el" href="FileStream_8cpp_source.html#l02836">2836</a> of file <a class="el" href="FileStream_8cpp_source.html">FileStream.cpp</a>.</p>
<div class="fragment"><div class="line"><span class="lineno"> 2837</span>{</div>
<div class="line"><span class="lineno"> 2838</span>    <span class="comment">// Just use the saved filetime value</span></div>
<div class="line"><span class="lineno"> 2839</span>    *pFileTime = pStream-&gt;<a class="code hl_variable" href="structTFileStream.html#a3428b5a1e790560349940aa04e37e580">Base</a>.<a class="code hl_variable" href="unionTBaseProviderData.html#a60536cc70eff3072cd6c371a99bdf325">File</a>.<a class="code hl_variable" href="unionTBaseProviderData.html#a5488a6d2334bab001fbdd9e2ae2cdb00">FileTime</a>;</div>
<div class="line"><span class="lineno"> 2840</span>    <span class="keywordflow">return</span> <span class="keyword">true</span>;</div>
<div class="line"><span class="lineno"> 2841</span>}</div>
</div><!-- fragment --><div class="dynheader">
Here is the caller graph for this function:</div>
<div class="dyncontent">
<div class="center"><iframe scrolling="no" frameborder="0" src="FileStream_8cpp_a4ea733800d58589cd80948dd23421dad_icgraph.svg" width="494" height="86"><p><b>This browser is not able to show SVG: try Firefox, Chrome, Safari, or Opera instead.</b></p></iframe></div>
</div>

</div>
</div>
<a id="a702003c1930c608961b812259bd9dc22" name="a702003c1930c608961b812259bd9dc22"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a702003c1930c608961b812259bd9dc22">&#9670;&#160;</a></span>FileStream_OpenFile()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname"><a class="el" href="structTFileStream.html">TFileStream</a> * FileStream_OpenFile </td>
          <td>(</td>
          <td class="paramtype"><a class="el" href="StormLib_2src_2zlib_2zconf_8h.html#a2c212835823e3c54a8ab6d95c652660e">const</a> <a class="el" href="StormPort_8h.html#a03bdb8ce5895c7e261aadc2529637546">TCHAR</a> *&#160;</td>
          <td class="paramname"><em>szFileName</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype"><a class="el" href="StormPort_8h.html#a798af1e30bc65f319c1a246cecf59e39">DWORD</a>&#160;</td>
          <td class="paramname"><em>dwStreamFlags</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
</div><div class="memdoc">
<p>This function opens an existing file for read or read-write access</p><ul>
<li>If the current platform supports file sharing, the file must be open for read sharing (i.e. another application can open the file for read, but not for write)</li>
<li>If the file does not exist, the function must return NULL</li>
<li>If the file exists but cannot be open, then function must return NULL</li>
<li>The parameters of the function must be validate by the caller</li>
<li>The function must initialize all stream function pointers in <a class="el" href="structTFileStream.html">TFileStream</a></li>
<li>If the function fails from any reason, it must close all handles and free all memory that has been allocated in the process of stream creation, including the <a class="el" href="structTFileStream.html">TFileStream</a> structure itself</li>
</ul>
<p><em>szFileName</em> Name of the file to open <em>dwStreamFlags</em> specifies the provider and base storage type </p>

<p class="definition">Definition at line <a class="el" href="FileStream_8cpp_source.html#l02499">2499</a> of file <a class="el" href="FileStream_8cpp_source.html">FileStream.cpp</a>.</p>
<div class="fragment"><div class="line"><span class="lineno"> 2502</span>{</div>
<div class="line"><span class="lineno"> 2503</span>    <a class="code hl_typedef" href="StormPort_8h.html#a798af1e30bc65f319c1a246cecf59e39">DWORD</a> dwProvider = dwStreamFlags &amp; <a class="code hl_define" href="StormLib_8h.html#a07a964e92d9c6a64250c80b56e75c520">STREAM_PROVIDERS_MASK</a>;</div>
<div class="line"><span class="lineno"> 2504</span>    <span class="keywordtype">size_t</span> nPrefixLength = <a class="code hl_function" href="FileStream_8cpp.html#aa2107608d75af5dc5674f69c84637e22">FileStream_Prefix</a>(szFileName, &amp;dwProvider);</div>
<div class="line"><span class="lineno"> 2505</span> </div>
<div class="line"><span class="lineno"> 2506</span>    <span class="comment">// Re-assemble the stream flags</span></div>
<div class="line"><span class="lineno"> 2507</span>    dwStreamFlags = (dwStreamFlags &amp; <a class="code hl_define" href="StormLib_8h.html#a13ca5b98664197b09f6161b08bf02db3">STREAM_OPTIONS_MASK</a>) | dwProvider;</div>
<div class="line"><span class="lineno"> 2508</span>    szFileName += nPrefixLength;</div>
<div class="line"><span class="lineno"> 2509</span> </div>
<div class="line"><span class="lineno"> 2510</span>    <span class="comment">// Perform provider-specific open</span></div>
<div class="line"><span class="lineno"> 2511</span>    <span class="keywordflow">switch</span>(dwStreamFlags &amp; <a class="code hl_define" href="StormLib_8h.html#a85f30debca5af9c69185146dda3eba18">STREAM_PROVIDER_MASK</a>)</div>
<div class="line"><span class="lineno"> 2512</span>    {</div>
<div class="line"><span class="lineno"> 2513</span>        <span class="keywordflow">case</span> <a class="code hl_define" href="StormLib_8h.html#a45b6170ca9e7880848cdca068234d28c">STREAM_PROVIDER_FLAT</a>:</div>
<div class="line"><span class="lineno"> 2514</span>            <span class="keywordflow">return</span> <a class="code hl_function" href="FileStream_8cpp.html#a3993766ada9771cb6d9ca35a3f935322">FlatStream_Open</a>(szFileName, dwStreamFlags);</div>
<div class="line"><span class="lineno"> 2515</span> </div>
<div class="line"><span class="lineno"> 2516</span>        <span class="keywordflow">case</span> <a class="code hl_define" href="StormLib_8h.html#a4b2a4fcc373340f8488b54729205c0df">STREAM_PROVIDER_PARTIAL</a>:</div>
<div class="line"><span class="lineno"> 2517</span>            <span class="keywordflow">return</span> <a class="code hl_function" href="FileStream_8cpp.html#a9109b5dc896abb2d8d9f7fb0995dd911">PartStream_Open</a>(szFileName, dwStreamFlags);</div>
<div class="line"><span class="lineno"> 2518</span> </div>
<div class="line"><span class="lineno"> 2519</span>        <span class="keywordflow">case</span> <a class="code hl_define" href="StormLib_8h.html#aebd4c9ef6f6e60b283469eb9aeebcd8e">STREAM_PROVIDER_MPQE</a>:</div>
<div class="line"><span class="lineno"> 2520</span>            <span class="keywordflow">return</span> <a class="code hl_function" href="FileStream_8cpp.html#a2c69cb40f8c94bf20bd7c8d6918bb261">MpqeStream_Open</a>(szFileName, dwStreamFlags);</div>
<div class="line"><span class="lineno"> 2521</span> </div>
<div class="line"><span class="lineno"> 2522</span>        <span class="keywordflow">case</span> <a class="code hl_define" href="StormLib_8h.html#a5bbce6c9768ac7cbc1fb4541a2153758">STREAM_PROVIDER_BLOCK4</a>:</div>
<div class="line"><span class="lineno"> 2523</span>            <span class="keywordflow">return</span> <a class="code hl_function" href="FileStream_8cpp.html#ad81c299c6f6062d49a9d7ef331cd4520">Block4Stream_Open</a>(szFileName, dwStreamFlags);</div>
<div class="line"><span class="lineno"> 2524</span> </div>
<div class="line"><span class="lineno"> 2525</span>        <span class="keywordflow">default</span>:</div>
<div class="line"><span class="lineno"> 2526</span>            <a class="code hl_function" href="FileStream_8cpp.html#a65dd8d3e416ffbd6ac5f468c6bdccac9">SetLastError</a>(<a class="code hl_define" href="StormPort_8h.html#a176960f93d11db6f58d10a6957a80f38">ERROR_INVALID_PARAMETER</a>);</div>
<div class="line"><span class="lineno"> 2527</span>            <span class="keywordflow">return</span> NULL;</div>
<div class="line"><span class="lineno"> 2528</span>    }</div>
<div class="line"><span class="lineno"> 2529</span>}</div>
<div class="ttc" id="aFileStream_8cpp_html_a2c69cb40f8c94bf20bd7c8d6918bb261"><div class="ttname"><a href="FileStream_8cpp.html#a2c69cb40f8c94bf20bd7c8d6918bb261">MpqeStream_Open</a></div><div class="ttdeci">static TFileStream * MpqeStream_Open(const TCHAR *szFileName, DWORD dwStreamFlags)</div><div class="ttdef"><b>Definition</b> <a href="FileStream_8cpp_source.html#l02180">FileStream.cpp:2180</a></div></div>
<div class="ttc" id="aFileStream_8cpp_html_a3993766ada9771cb6d9ca35a3f935322"><div class="ttname"><a href="FileStream_8cpp.html#a3993766ada9771cb6d9ca35a3f935322">FlatStream_Open</a></div><div class="ttdeci">static TFileStream * FlatStream_Open(const TCHAR *szFileName, DWORD dwStreamFlags)</div><div class="ttdef"><b>Definition</b> <a href="FileStream_8cpp_source.html#l01443">FileStream.cpp:1443</a></div></div>
<div class="ttc" id="aFileStream_8cpp_html_a9109b5dc896abb2d8d9f7fb0995dd911"><div class="ttname"><a href="FileStream_8cpp.html#a9109b5dc896abb2d8d9f7fb0995dd911">PartStream_Open</a></div><div class="ttdeci">static TFileStream * PartStream_Open(const TCHAR *szFileName, DWORD dwStreamFlags)</div><div class="ttdef"><b>Definition</b> <a href="FileStream_8cpp_source.html#l01863">FileStream.cpp:1863</a></div></div>
<div class="ttc" id="aFileStream_8cpp_html_aa2107608d75af5dc5674f69c84637e22"><div class="ttname"><a href="FileStream_8cpp.html#aa2107608d75af5dc5674f69c84637e22">FileStream_Prefix</a></div><div class="ttdeci">size_t FileStream_Prefix(const TCHAR *szFileName, DWORD *pdwProvider)</div><div class="ttdef"><b>Definition</b> <a href="FileStream_8cpp_source.html#l02549">FileStream.cpp:2549</a></div></div>
<div class="ttc" id="aFileStream_8cpp_html_ad81c299c6f6062d49a9d7ef331cd4520"><div class="ttname"><a href="FileStream_8cpp.html#ad81c299c6f6062d49a9d7ef331cd4520">Block4Stream_Open</a></div><div class="ttdeci">static TFileStream * Block4Stream_Open(const TCHAR *szFileName, DWORD dwStreamFlags)</div><div class="ttdef"><b>Definition</b> <a href="FileStream_8cpp_source.html#l02309">FileStream.cpp:2309</a></div></div>
<div class="ttc" id="aStormLib_8h_html_a13ca5b98664197b09f6161b08bf02db3"><div class="ttname"><a href="StormLib_8h.html#a13ca5b98664197b09f6161b08bf02db3">STREAM_OPTIONS_MASK</a></div><div class="ttdeci">#define STREAM_OPTIONS_MASK</div><div class="ttdef"><b>Definition</b> <a href="StormLib_8h_source.html#l00324">StormLib.h:324</a></div></div>
<div class="ttc" id="aStormLib_8h_html_a4b2a4fcc373340f8488b54729205c0df"><div class="ttname"><a href="StormLib_8h.html#a4b2a4fcc373340f8488b54729205c0df">STREAM_PROVIDER_PARTIAL</a></div><div class="ttdeci">#define STREAM_PROVIDER_PARTIAL</div><div class="ttdef"><b>Definition</b> <a href="StormLib_8h_source.html#l00316">StormLib.h:316</a></div></div>
<div class="ttc" id="aStormLib_8h_html_a5bbce6c9768ac7cbc1fb4541a2153758"><div class="ttname"><a href="StormLib_8h.html#a5bbce6c9768ac7cbc1fb4541a2153758">STREAM_PROVIDER_BLOCK4</a></div><div class="ttdeci">#define STREAM_PROVIDER_BLOCK4</div><div class="ttdef"><b>Definition</b> <a href="StormLib_8h_source.html#l00318">StormLib.h:318</a></div></div>
<div class="ttc" id="aStormLib_8h_html_a85f30debca5af9c69185146dda3eba18"><div class="ttname"><a href="StormLib_8h.html#a85f30debca5af9c69185146dda3eba18">STREAM_PROVIDER_MASK</a></div><div class="ttdeci">#define STREAM_PROVIDER_MASK</div><div class="ttdef"><b>Definition</b> <a href="StormLib_8h_source.html#l00319">StormLib.h:319</a></div></div>
<div class="ttc" id="aStormLib_8h_html_aebd4c9ef6f6e60b283469eb9aeebcd8e"><div class="ttname"><a href="StormLib_8h.html#aebd4c9ef6f6e60b283469eb9aeebcd8e">STREAM_PROVIDER_MPQE</a></div><div class="ttdeci">#define STREAM_PROVIDER_MPQE</div><div class="ttdef"><b>Definition</b> <a href="StormLib_8h_source.html#l00317">StormLib.h:317</a></div></div>
</div><!-- fragment --><div class="dynheader">
Here is the call graph for this function:</div>
<div class="dyncontent">
<div class="center"><div class="zoom"><iframe scrolling="no" frameborder="0" src="FileStream_8cpp_a702003c1930c608961b812259bd9dc22_cgraph.svg" width="100%" height="600"><p><b>This browser is not able to show SVG: try Firefox, Chrome, Safari, or Opera instead.</b></p></iframe></div></div>
</div>
<div class="dynheader">
Here is the caller graph for this function:</div>
<div class="dyncontent">
<div class="center"><div class="zoom"><iframe scrolling="no" frameborder="0" src="FileStream_8cpp_a702003c1930c608961b812259bd9dc22_icgraph.svg" width="100%" height="600"><p><b>This browser is not able to show SVG: try Firefox, Chrome, Safari, or Opera instead.</b></p></iframe></div></div>
</div>

</div>
</div>
<a id="aa2107608d75af5dc5674f69c84637e22" name="aa2107608d75af5dc5674f69c84637e22"></a>
<h2 class="memtitle"><span class="permalink"><a href="#aa2107608d75af5dc5674f69c84637e22">&#9670;&#160;</a></span>FileStream_Prefix()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">size_t FileStream_Prefix </td>
          <td>(</td>
          <td class="paramtype"><a class="el" href="StormLib_2src_2zlib_2zconf_8h.html#a2c212835823e3c54a8ab6d95c652660e">const</a> <a class="el" href="StormPort_8h.html#a03bdb8ce5895c7e261aadc2529637546">TCHAR</a> *&#160;</td>
          <td class="paramname"><em>szFileName</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype"><a class="el" href="StormPort_8h.html#a798af1e30bc65f319c1a246cecf59e39">DWORD</a> *&#160;</td>
          <td class="paramname"><em>pdwProvider</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
</div><div class="memdoc">
<p>Returns the length of the provider prefix. Returns zero if no prefix</p>
<p><em>szFileName</em> Pointer to a stream name (file, mapped file, URL) <em>pdwStreamProvider</em> Pointer to a DWORD variable that receives stream provider (STREAM_PROVIDER_XXX) </p>

<p class="definition">Definition at line <a class="el" href="FileStream_8cpp_source.html#l02549">2549</a> of file <a class="el" href="FileStream_8cpp_source.html">FileStream.cpp</a>.</p>
<div class="fragment"><div class="line"><span class="lineno"> 2550</span>{</div>
<div class="line"><span class="lineno"> 2551</span>    <span class="keywordtype">size_t</span> nPrefixLength1 = 0;</div>
<div class="line"><span class="lineno"> 2552</span>    <span class="keywordtype">size_t</span> nPrefixLength2 = 0;</div>
<div class="line"><span class="lineno"> 2553</span>    <a class="code hl_typedef" href="StormPort_8h.html#a798af1e30bc65f319c1a246cecf59e39">DWORD</a> dwProvider = 0;</div>
<div class="line"><span class="lineno"> 2554</span> </div>
<div class="line"><span class="lineno"> 2555</span>    <span class="keywordflow">if</span>(szFileName != NULL)</div>
<div class="line"><span class="lineno"> 2556</span>    {</div>
<div class="line"><span class="lineno"> 2557</span>        <span class="comment">//</span></div>
<div class="line"><span class="lineno"> 2558</span>        <span class="comment">// Determine the stream provider</span></div>
<div class="line"><span class="lineno"> 2559</span>        <span class="comment">//</span></div>
<div class="line"><span class="lineno"> 2560</span> </div>
<div class="line"><span class="lineno"> 2561</span>        <span class="keywordflow">if</span>(!<a class="code hl_define" href="StormPort_8h.html#aa73bb733e1922cfb964b0ff6228e3089">_tcsnicmp</a>(szFileName, <a class="code hl_define" href="StormPort_8h.html#ae936e4c15227768f7da4e0951def89c8">_T</a>(<span class="stringliteral">&quot;flat-&quot;</span>), 5))</div>
<div class="line"><span class="lineno"> 2562</span>        {</div>
<div class="line"><span class="lineno"> 2563</span>            dwProvider |= <a class="code hl_define" href="StormLib_8h.html#a45b6170ca9e7880848cdca068234d28c">STREAM_PROVIDER_FLAT</a>;</div>
<div class="line"><span class="lineno"> 2564</span>            nPrefixLength1 = 5;</div>
<div class="line"><span class="lineno"> 2565</span>        }</div>
<div class="line"><span class="lineno"> 2566</span> </div>
<div class="line"><span class="lineno"> 2567</span>        <span class="keywordflow">else</span> <span class="keywordflow">if</span>(!<a class="code hl_define" href="StormPort_8h.html#aa73bb733e1922cfb964b0ff6228e3089">_tcsnicmp</a>(szFileName, <a class="code hl_define" href="StormPort_8h.html#ae936e4c15227768f7da4e0951def89c8">_T</a>(<span class="stringliteral">&quot;part-&quot;</span>), 5))</div>
<div class="line"><span class="lineno"> 2568</span>        {</div>
<div class="line"><span class="lineno"> 2569</span>            dwProvider |= <a class="code hl_define" href="StormLib_8h.html#a4b2a4fcc373340f8488b54729205c0df">STREAM_PROVIDER_PARTIAL</a>;</div>
<div class="line"><span class="lineno"> 2570</span>            nPrefixLength1 = 5;</div>
<div class="line"><span class="lineno"> 2571</span>        }</div>
<div class="line"><span class="lineno"> 2572</span> </div>
<div class="line"><span class="lineno"> 2573</span>        <span class="keywordflow">else</span> <span class="keywordflow">if</span>(!<a class="code hl_define" href="StormPort_8h.html#aa73bb733e1922cfb964b0ff6228e3089">_tcsnicmp</a>(szFileName, <a class="code hl_define" href="StormPort_8h.html#ae936e4c15227768f7da4e0951def89c8">_T</a>(<span class="stringliteral">&quot;mpqe-&quot;</span>), 5))</div>
<div class="line"><span class="lineno"> 2574</span>        {</div>
<div class="line"><span class="lineno"> 2575</span>            dwProvider |= <a class="code hl_define" href="StormLib_8h.html#aebd4c9ef6f6e60b283469eb9aeebcd8e">STREAM_PROVIDER_MPQE</a>;</div>
<div class="line"><span class="lineno"> 2576</span>            nPrefixLength1 = 5;</div>
<div class="line"><span class="lineno"> 2577</span>        }</div>
<div class="line"><span class="lineno"> 2578</span> </div>
<div class="line"><span class="lineno"> 2579</span>        <span class="keywordflow">else</span> <span class="keywordflow">if</span>(!<a class="code hl_define" href="StormPort_8h.html#aa73bb733e1922cfb964b0ff6228e3089">_tcsnicmp</a>(szFileName, <a class="code hl_define" href="StormPort_8h.html#ae936e4c15227768f7da4e0951def89c8">_T</a>(<span class="stringliteral">&quot;blk4-&quot;</span>), 5))</div>
<div class="line"><span class="lineno"> 2580</span>        {</div>
<div class="line"><span class="lineno"> 2581</span>            dwProvider |= <a class="code hl_define" href="StormLib_8h.html#a5bbce6c9768ac7cbc1fb4541a2153758">STREAM_PROVIDER_BLOCK4</a>;</div>
<div class="line"><span class="lineno"> 2582</span>            nPrefixLength1 = 5;</div>
<div class="line"><span class="lineno"> 2583</span>        }</div>
<div class="line"><span class="lineno"> 2584</span> </div>
<div class="line"><span class="lineno"> 2585</span>        <span class="comment">//</span></div>
<div class="line"><span class="lineno"> 2586</span>        <span class="comment">// Determine the base provider</span></div>
<div class="line"><span class="lineno"> 2587</span>        <span class="comment">//</span></div>
<div class="line"><span class="lineno"> 2588</span> </div>
<div class="line"><span class="lineno"> 2589</span>        <span class="keywordflow">if</span>(!<a class="code hl_define" href="StormPort_8h.html#aa73bb733e1922cfb964b0ff6228e3089">_tcsnicmp</a>(szFileName+nPrefixLength1, <a class="code hl_define" href="StormPort_8h.html#ae936e4c15227768f7da4e0951def89c8">_T</a>(<span class="stringliteral">&quot;file:&quot;</span>), 5))</div>
<div class="line"><span class="lineno"> 2590</span>        {</div>
<div class="line"><span class="lineno"> 2591</span>            dwProvider |= <a class="code hl_define" href="StormLib_8h.html#a3773c068cc9e5acf2ef6a0fd9b4a534e">BASE_PROVIDER_FILE</a>;</div>
<div class="line"><span class="lineno"> 2592</span>            nPrefixLength2 = 5;</div>
<div class="line"><span class="lineno"> 2593</span>        }</div>
<div class="line"><span class="lineno"> 2594</span> </div>
<div class="line"><span class="lineno"> 2595</span>        <span class="keywordflow">else</span> <span class="keywordflow">if</span>(!<a class="code hl_define" href="StormPort_8h.html#aa73bb733e1922cfb964b0ff6228e3089">_tcsnicmp</a>(szFileName+nPrefixLength1, <a class="code hl_define" href="StormPort_8h.html#ae936e4c15227768f7da4e0951def89c8">_T</a>(<span class="stringliteral">&quot;map:&quot;</span>), 4))</div>
<div class="line"><span class="lineno"> 2596</span>        {</div>
<div class="line"><span class="lineno"> 2597</span>            dwProvider |= <a class="code hl_define" href="StormLib_8h.html#a232c23ccf69f395a9edb5e6280b26513">BASE_PROVIDER_MAP</a>;</div>
<div class="line"><span class="lineno"> 2598</span>            nPrefixLength2 = 4;</div>
<div class="line"><span class="lineno"> 2599</span>        }</div>
<div class="line"><span class="lineno"> 2600</span> </div>
<div class="line"><span class="lineno"> 2601</span>        <span class="keywordflow">else</span> <span class="keywordflow">if</span>(!<a class="code hl_define" href="StormPort_8h.html#aa73bb733e1922cfb964b0ff6228e3089">_tcsnicmp</a>(szFileName+nPrefixLength1, <a class="code hl_define" href="StormPort_8h.html#ae936e4c15227768f7da4e0951def89c8">_T</a>(<span class="stringliteral">&quot;http:&quot;</span>), 5))</div>
<div class="line"><span class="lineno"> 2602</span>        {</div>
<div class="line"><span class="lineno"> 2603</span>            dwProvider |= <a class="code hl_define" href="StormLib_8h.html#a120d1199a5c9b89d84bd7d3cdacd6b68">BASE_PROVIDER_HTTP</a>;</div>
<div class="line"><span class="lineno"> 2604</span>            nPrefixLength2 = 5;</div>
<div class="line"><span class="lineno"> 2605</span>        }</div>
<div class="line"><span class="lineno"> 2606</span> </div>
<div class="line"><span class="lineno"> 2607</span>        <span class="comment">// Only accept stream provider if we recognized the base provider</span></div>
<div class="line"><span class="lineno"> 2608</span>        <span class="keywordflow">if</span>(nPrefixLength2 != 0)</div>
<div class="line"><span class="lineno"> 2609</span>        {</div>
<div class="line"><span class="lineno"> 2610</span>            <span class="comment">// It is also allowed to put &quot;//&quot; after the base provider, e.g. &quot;file://&quot;, &quot;http://&quot;</span></div>
<div class="line"><span class="lineno"> 2611</span>            <span class="keywordflow">if</span>(szFileName[nPrefixLength1+nPrefixLength2] == <span class="charliteral">&#39;/&#39;</span> &amp;&amp; szFileName[nPrefixLength1+nPrefixLength2+1] == <span class="charliteral">&#39;/&#39;</span>)</div>
<div class="line"><span class="lineno"> 2612</span>                nPrefixLength2 += 2;</div>
<div class="line"><span class="lineno"> 2613</span> </div>
<div class="line"><span class="lineno"> 2614</span>            <span class="keywordflow">if</span>(pdwProvider != NULL)</div>
<div class="line"><span class="lineno"> 2615</span>                *pdwProvider = dwProvider;</div>
<div class="line"><span class="lineno"> 2616</span>            <span class="keywordflow">return</span> nPrefixLength1 + nPrefixLength2;</div>
<div class="line"><span class="lineno"> 2617</span>        }</div>
<div class="line"><span class="lineno"> 2618</span>    }</div>
<div class="line"><span class="lineno"> 2619</span> </div>
<div class="line"><span class="lineno"> 2620</span>    <span class="keywordflow">return</span> 0;</div>
<div class="line"><span class="lineno"> 2621</span>}</div>
<div class="ttc" id="aStormLib_8h_html_a120d1199a5c9b89d84bd7d3cdacd6b68"><div class="ttname"><a href="StormLib_8h.html#a120d1199a5c9b89d84bd7d3cdacd6b68">BASE_PROVIDER_HTTP</a></div><div class="ttdeci">#define BASE_PROVIDER_HTTP</div><div class="ttdef"><b>Definition</b> <a href="StormLib_8h_source.html#l00312">StormLib.h:312</a></div></div>
<div class="ttc" id="aStormLib_8h_html_a232c23ccf69f395a9edb5e6280b26513"><div class="ttname"><a href="StormLib_8h.html#a232c23ccf69f395a9edb5e6280b26513">BASE_PROVIDER_MAP</a></div><div class="ttdeci">#define BASE_PROVIDER_MAP</div><div class="ttdef"><b>Definition</b> <a href="StormLib_8h_source.html#l00311">StormLib.h:311</a></div></div>
</div><!-- fragment --><div class="dynheader">
Here is the caller graph for this function:</div>
<div class="dyncontent">
<div class="center"><div class="zoom"><iframe scrolling="no" frameborder="0" src="FileStream_8cpp_aa2107608d75af5dc5674f69c84637e22_icgraph.svg" width="100%" height="600"><p><b>This browser is not able to show SVG: try Firefox, Chrome, Safari, or Opera instead.</b></p></iframe></div></div>
</div>

</div>
</div>
<a id="a593f3b1416f7497c28fa5552cd1b3003" name="a593f3b1416f7497c28fa5552cd1b3003"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a593f3b1416f7497c28fa5552cd1b3003">&#9670;&#160;</a></span>FileStream_Read()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname"><a class="el" href="StormPort_8h.html#abb452686968e48b67397da5f97445f5b">bool</a> FileStream_Read </td>
          <td>(</td>
          <td class="paramtype"><a class="el" href="structTFileStream.html">TFileStream</a> *&#160;</td>
          <td class="paramname"><em>pStream</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype"><a class="el" href="StormPort_8h.html#abb9abb9ce956f1a9e5a4081ac40e5649">ULONGLONG</a> *&#160;</td>
          <td class="paramname"><em>pByteOffset</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">void *&#160;</td>
          <td class="paramname"><em>pvBuffer</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype"><a class="el" href="StormPort_8h.html#a798af1e30bc65f319c1a246cecf59e39">DWORD</a>&#160;</td>
          <td class="paramname"><em>dwBytesToRead</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
</div><div class="memdoc">
<p>Reads data from the stream</p>
<ul>
<li>Returns true if the read operation succeeded and all bytes have been read</li>
<li>Returns false if either read failed or not all bytes have been read</li>
<li>If the pByteOffset is NULL, the function must read the data from the current file position</li>
<li>The function can be called with dwBytesToRead = 0. In that case, pvBuffer is ignored and the function just adjusts file pointer.</li>
</ul>
<p><em>pStream</em> Pointer to an open stream <em>pByteOffset</em> Pointer to file byte offset. If NULL, it reads from the current position <em>pvBuffer</em> Pointer to data to be read <em>dwBytesToRead</em> Number of bytes to read from the file</p>
<dl class="section return"><dt>Returns</dt><dd><ul>
<li>If the function reads the required amount of bytes, it returns true.</li>
<li>If the function reads less than required bytes, it returns false and <a class="el" href="FileStream_8cpp.html#ad0f1ed530318d4f8cecb3dfb53e15b0a">GetLastError()</a> returns ERROR_HANDLE_EOF</li>
<li>If the function fails, it reads false and <a class="el" href="FileStream_8cpp.html#ad0f1ed530318d4f8cecb3dfb53e15b0a">GetLastError()</a> returns an error code different from ERROR_HANDLE_EOF </li>
</ul>
</dd></dl>

<p class="definition">Definition at line <a class="el" href="FileStream_8cpp_source.html#l02759">2759</a> of file <a class="el" href="FileStream_8cpp_source.html">FileStream.cpp</a>.</p>
<div class="fragment"><div class="line"><span class="lineno"> 2760</span>{</div>
<div class="line"><span class="lineno"> 2761</span>    assert(pStream-&gt;<a class="code hl_variable" href="structTFileStream.html#aaf7da0af26da32b968cdb66eb87f26ce">StreamRead</a> != NULL);</div>
<div class="line"><span class="lineno"> 2762</span>    <span class="keywordflow">return</span> pStream-&gt;<a class="code hl_variable" href="structTFileStream.html#aaf7da0af26da32b968cdb66eb87f26ce">StreamRead</a>(pStream, pByteOffset, pvBuffer, dwBytesToRead);</div>
<div class="line"><span class="lineno"> 2763</span>}</div>
</div><!-- fragment --><div class="dynheader">
Here is the caller graph for this function:</div>
<div class="dyncontent">
<div class="center"><div class="zoom"><iframe scrolling="no" frameborder="0" src="FileStream_8cpp_a593f3b1416f7497c28fa5552cd1b3003_icgraph.svg" width="100%" height="600"><p><b>This browser is not able to show SVG: try Firefox, Chrome, Safari, or Opera instead.</b></p></iframe></div></div>
</div>

</div>
</div>
<a id="afcf883cb4bc8ff873bb286e8f7bf5002" name="afcf883cb4bc8ff873bb286e8f7bf5002"></a>
<h2 class="memtitle"><span class="permalink"><a href="#afcf883cb4bc8ff873bb286e8f7bf5002">&#9670;&#160;</a></span>FileStream_Replace()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname"><a class="el" href="StormPort_8h.html#abb452686968e48b67397da5f97445f5b">bool</a> FileStream_Replace </td>
          <td>(</td>
          <td class="paramtype"><a class="el" href="structTFileStream.html">TFileStream</a> *&#160;</td>
          <td class="paramname"><em>pStream</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype"><a class="el" href="structTFileStream.html">TFileStream</a> *&#160;</td>
          <td class="paramname"><em>pNewStream</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
</div><div class="memdoc">
<p>Switches a stream with another. Used for final phase of archive compacting. Performs these steps:</p>
<p>1) Closes the handle to the existing MPQ 2) Renames the temporary MPQ to the original MPQ, overwrites existing one 3) Opens the MPQ stores the handle and stream position to the new stream structure</p>
<p><em>pStream</em> Pointer to an open stream <em>pNewStream</em> Temporary ("working") stream (created during archive compacting) </p>

<p class="definition">Definition at line <a class="el" href="FileStream_8cpp_source.html#l02866">2866</a> of file <a class="el" href="FileStream_8cpp_source.html">FileStream.cpp</a>.</p>
<div class="fragment"><div class="line"><span class="lineno"> 2867</span>{</div>
<div class="line"><span class="lineno"> 2868</span>    <span class="comment">// Only supported on flat files</span></div>
<div class="line"><span class="lineno"> 2869</span>    <span class="keywordflow">if</span>((pStream-&gt;<a class="code hl_variable" href="structTFileStream.html#ae61935eec67ce99ea4091bc0949de1ea">dwFlags</a> &amp; <a class="code hl_define" href="StormLib_8h.html#a07a964e92d9c6a64250c80b56e75c520">STREAM_PROVIDERS_MASK</a>) != (<a class="code hl_define" href="StormLib_8h.html#a45b6170ca9e7880848cdca068234d28c">STREAM_PROVIDER_FLAT</a> | <a class="code hl_define" href="StormLib_8h.html#a3773c068cc9e5acf2ef6a0fd9b4a534e">BASE_PROVIDER_FILE</a>))</div>
<div class="line"><span class="lineno"> 2870</span>    {</div>
<div class="line"><span class="lineno"> 2871</span>        <a class="code hl_function" href="FileStream_8cpp.html#a65dd8d3e416ffbd6ac5f468c6bdccac9">SetLastError</a>(<a class="code hl_define" href="StormPort_8h.html#ab72d05032a6d1152bad9af394811d447">ERROR_NOT_SUPPORTED</a>);</div>
<div class="line"><span class="lineno"> 2872</span>        <span class="keywordflow">return</span> <span class="keyword">false</span>;</div>
<div class="line"><span class="lineno"> 2873</span>    }</div>
<div class="line"><span class="lineno"> 2874</span> </div>
<div class="line"><span class="lineno"> 2875</span>    <span class="comment">// Not supported on read-only streams</span></div>
<div class="line"><span class="lineno"> 2876</span>    <span class="keywordflow">if</span>(pStream-&gt;<a class="code hl_variable" href="structTFileStream.html#ae61935eec67ce99ea4091bc0949de1ea">dwFlags</a> &amp; <a class="code hl_define" href="StormLib_8h.html#abdbbf06488f24699775afe6aadaeafc3">STREAM_FLAG_READ_ONLY</a>)</div>
<div class="line"><span class="lineno"> 2877</span>    {</div>
<div class="line"><span class="lineno"> 2878</span>        <a class="code hl_function" href="FileStream_8cpp.html#a65dd8d3e416ffbd6ac5f468c6bdccac9">SetLastError</a>(<a class="code hl_define" href="StormPort_8h.html#aeed98d3d6aec00b22a04eb8836d77a51">ERROR_ACCESS_DENIED</a>);</div>
<div class="line"><span class="lineno"> 2879</span>        <span class="keywordflow">return</span> <span class="keyword">false</span>;</div>
<div class="line"><span class="lineno"> 2880</span>    }</div>
<div class="line"><span class="lineno"> 2881</span> </div>
<div class="line"><span class="lineno"> 2882</span>    <span class="comment">// Close both stream&#39;s base providers</span></div>
<div class="line"><span class="lineno"> 2883</span>    pNewStream-&gt;<a class="code hl_variable" href="structTFileStream.html#acbdc7dfef3127e4c077310381f8f6c7d">BaseClose</a>(pNewStream);</div>
<div class="line"><span class="lineno"> 2884</span>    pStream-&gt;<a class="code hl_variable" href="structTFileStream.html#acbdc7dfef3127e4c077310381f8f6c7d">BaseClose</a>(pStream);</div>
<div class="line"><span class="lineno"> 2885</span> </div>
<div class="line"><span class="lineno"> 2886</span>    <span class="comment">// Now we have to delete the (now closed) old file and rename the new file</span></div>
<div class="line"><span class="lineno"> 2887</span>    <span class="keywordflow">if</span>(!<a class="code hl_function" href="FileStream_8cpp.html#ab7eae20c598963167111f04222211b23">BaseFile_Replace</a>(pStream, pNewStream))</div>
<div class="line"><span class="lineno"> 2888</span>        <span class="keywordflow">return</span> <span class="keyword">false</span>;</div>
<div class="line"><span class="lineno"> 2889</span> </div>
<div class="line"><span class="lineno"> 2890</span>    <span class="comment">// Now open the base file again</span></div>
<div class="line"><span class="lineno"> 2891</span>    <span class="keywordflow">if</span>(!<a class="code hl_function" href="FileStream_8cpp.html#a2065e645a0a5e3202253dda12bb14063">BaseFile_Open</a>(pStream, pStream-&gt;<a class="code hl_variable" href="structTFileStream.html#a7a4da926d708d96cb47333973e705c76">szFileName</a>, pStream-&gt;<a class="code hl_variable" href="structTFileStream.html#ae61935eec67ce99ea4091bc0949de1ea">dwFlags</a>))</div>
<div class="line"><span class="lineno"> 2892</span>        <span class="keywordflow">return</span> <span class="keyword">false</span>;</div>
<div class="line"><span class="lineno"> 2893</span> </div>
<div class="line"><span class="lineno"> 2894</span>    <span class="comment">// Cleanup the new stream</span></div>
<div class="line"><span class="lineno"> 2895</span>    <a class="code hl_function" href="FileStream_8cpp.html#ae8b75c4797726e9c5ee0b4b03bf31442">FileStream_Close</a>(pNewStream);</div>
<div class="line"><span class="lineno"> 2896</span>    <span class="keywordflow">return</span> <span class="keyword">true</span>;</div>
<div class="line"><span class="lineno"> 2897</span>}</div>
<div class="ttc" id="aFileStream_8cpp_html_ab7eae20c598963167111f04222211b23"><div class="ttname"><a href="FileStream_8cpp.html#ab7eae20c598963167111f04222211b23">BaseFile_Replace</a></div><div class="ttdeci">static bool BaseFile_Replace(TFileStream *pStream, TFileStream *pNewStream)</div><div class="ttdef"><b>Definition</b> <a href="FileStream_8cpp_source.html#l00405">FileStream.cpp:405</a></div></div>
<div class="ttc" id="aStormPort_8h_html_aeed98d3d6aec00b22a04eb8836d77a51"><div class="ttname"><a href="StormPort_8h.html#aeed98d3d6aec00b22a04eb8836d77a51">ERROR_ACCESS_DENIED</a></div><div class="ttdeci">#define ERROR_ACCESS_DENIED</div><div class="ttdef"><b>Definition</b> <a href="StormPort_8h_source.html#l00403">StormPort.h:403</a></div></div>
</div><!-- fragment --><div class="dynheader">
Here is the call graph for this function:</div>
<div class="dyncontent">
<div class="center"><iframe scrolling="no" frameborder="0" src="FileStream_8cpp_afcf883cb4bc8ff873bb286e8f7bf5002_cgraph.svg" width="638" height="211"><p><b>This browser is not able to show SVG: try Firefox, Chrome, Safari, or Opera instead.</b></p></iframe></div>
</div>
<div class="dynheader">
Here is the caller graph for this function:</div>
<div class="dyncontent">
<div class="center"><iframe scrolling="no" frameborder="0" src="FileStream_8cpp_afcf883cb4bc8ff873bb286e8f7bf5002_icgraph.svg" width="370" height="36"><p><b>This browser is not able to show SVG: try Firefox, Chrome, Safari, or Opera instead.</b></p></iframe></div>
</div>

</div>
</div>
<a id="ae33c8e38a5379adbbe49471f8d0ca5af" name="ae33c8e38a5379adbbe49471f8d0ca5af"></a>
<h2 class="memtitle"><span class="permalink"><a href="#ae33c8e38a5379adbbe49471f8d0ca5af">&#9670;&#160;</a></span>FileStream_SetCallback()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname"><a class="el" href="StormPort_8h.html#abb452686968e48b67397da5f97445f5b">bool</a> FileStream_SetCallback </td>
          <td>(</td>
          <td class="paramtype"><a class="el" href="structTFileStream.html">TFileStream</a> *&#160;</td>
          <td class="paramname"><em>pStream</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype"><a class="el" href="StormLib_8h.html#aec85f6efb05064d79de5e05fff77c639">SFILE_DOWNLOAD_CALLBACK</a>&#160;</td>
          <td class="paramname"><em>pfnCallback</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">void *&#160;</td>
          <td class="paramname"><em>pvUserData</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
</div><div class="memdoc">
<p>Sets a download callback. Whenever the stream needs to download one or more blocks from the server, the callback is called</p>
<p><em>pStream</em> Pointer to an open stream <em>pfnCallback</em> Pointer to callback function <em>pvUserData</em> Arbitrary user pointer passed to the download callback </p>

<p class="definition">Definition at line <a class="el" href="FileStream_8cpp_source.html#l02632">2632</a> of file <a class="el" href="FileStream_8cpp_source.html">FileStream.cpp</a>.</p>
<div class="fragment"><div class="line"><span class="lineno"> 2633</span>{</div>
<div class="line"><span class="lineno"> 2634</span>    <a class="code hl_struct" href="structTBlockStream.html">TBlockStream</a> * pBlockStream = (<a class="code hl_struct" href="structTBlockStream.html">TBlockStream</a> *)pStream;</div>
<div class="line"><span class="lineno"> 2635</span> </div>
<div class="line"><span class="lineno"> 2636</span>    <span class="keywordflow">if</span>(pStream-&gt;<a class="code hl_variable" href="structTFileStream.html#a68391daa44e09cd7654e765d81d937a3">BlockRead</a> == NULL)</div>
<div class="line"><span class="lineno"> 2637</span>    {</div>
<div class="line"><span class="lineno"> 2638</span>        <a class="code hl_function" href="FileStream_8cpp.html#a65dd8d3e416ffbd6ac5f468c6bdccac9">SetLastError</a>(<a class="code hl_define" href="StormPort_8h.html#ab72d05032a6d1152bad9af394811d447">ERROR_NOT_SUPPORTED</a>);</div>
<div class="line"><span class="lineno"> 2639</span>        <span class="keywordflow">return</span> <span class="keyword">false</span>;</div>
<div class="line"><span class="lineno"> 2640</span>    }</div>
<div class="line"><span class="lineno"> 2641</span> </div>
<div class="line"><span class="lineno"> 2642</span>    pBlockStream-&gt;<a class="code hl_variable" href="structTBlockStream.html#af22a8a5a72b77e2f095ac7669f365871">pfnCallback</a> = pfnCallback;</div>
<div class="line"><span class="lineno"> 2643</span>    pBlockStream-&gt;<a class="code hl_variable" href="structTBlockStream.html#a749a949501319933437ccf3bf7f08303">UserData</a> = pvUserData;</div>
<div class="line"><span class="lineno"> 2644</span>    <span class="keywordflow">return</span> <span class="keyword">true</span>;</div>
<div class="line"><span class="lineno"> 2645</span>}</div>
</div><!-- fragment --><div class="dynheader">
Here is the call graph for this function:</div>
<div class="dyncontent">
<div class="center"><iframe scrolling="no" frameborder="0" src="FileStream_8cpp_ae33c8e38a5379adbbe49471f8d0ca5af_cgraph.svg" width="336" height="36"><p><b>This browser is not able to show SVG: try Firefox, Chrome, Safari, or Opera instead.</b></p></iframe></div>
</div>
<div class="dynheader">
Here is the caller graph for this function:</div>
<div class="dyncontent">
<div class="center"><iframe scrolling="no" frameborder="0" src="FileStream_8cpp_ae33c8e38a5379adbbe49471f8d0ca5af_icgraph.svg" width="430" height="36"><p><b>This browser is not able to show SVG: try Firefox, Chrome, Safari, or Opera instead.</b></p></iframe></div>
</div>

</div>
</div>
<a id="abc0fbb4156c7eef2e3162841ffb0d74a" name="abc0fbb4156c7eef2e3162841ffb0d74a"></a>
<h2 class="memtitle"><span class="permalink"><a href="#abc0fbb4156c7eef2e3162841ffb0d74a">&#9670;&#160;</a></span>FileStream_SetSize()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname"><a class="el" href="StormPort_8h.html#abb452686968e48b67397da5f97445f5b">bool</a> FileStream_SetSize </td>
          <td>(</td>
          <td class="paramtype"><a class="el" href="structTFileStream.html">TFileStream</a> *&#160;</td>
          <td class="paramname"><em>pStream</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype"><a class="el" href="StormPort_8h.html#abb9abb9ce956f1a9e5a4081ac40e5649">ULONGLONG</a>&#160;</td>
          <td class="paramname"><em>NewFileSize</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
</div><div class="memdoc">
<p>Sets the size of a file</p>
<p><em>pStream</em> Pointer to an open stream <em>NewFileSize</em> File size to set </p>

<p class="definition">Definition at line <a class="el" href="FileStream_8cpp_source.html#l02807">2807</a> of file <a class="el" href="FileStream_8cpp_source.html">FileStream.cpp</a>.</p>
<div class="fragment"><div class="line"><span class="lineno"> 2808</span>{</div>
<div class="line"><span class="lineno"> 2809</span>    <span class="keywordflow">if</span>(pStream-&gt;<a class="code hl_variable" href="structTFileStream.html#ae61935eec67ce99ea4091bc0949de1ea">dwFlags</a> &amp; <a class="code hl_define" href="StormLib_8h.html#abdbbf06488f24699775afe6aadaeafc3">STREAM_FLAG_READ_ONLY</a>)</div>
<div class="line"><span class="lineno"> 2810</span>    {</div>
<div class="line"><span class="lineno"> 2811</span>        <a class="code hl_function" href="FileStream_8cpp.html#a65dd8d3e416ffbd6ac5f468c6bdccac9">SetLastError</a>(<a class="code hl_define" href="StormPort_8h.html#aeed98d3d6aec00b22a04eb8836d77a51">ERROR_ACCESS_DENIED</a>);</div>
<div class="line"><span class="lineno"> 2812</span>        <span class="keywordflow">return</span> <span class="keyword">false</span>;</div>
<div class="line"><span class="lineno"> 2813</span>    }</div>
<div class="line"><span class="lineno"> 2814</span> </div>
<div class="line"><span class="lineno"> 2815</span>    assert(pStream-&gt;<a class="code hl_variable" href="structTFileStream.html#ae3358c9b5a9dfdee5e8275561eff8850">StreamResize</a> != NULL);</div>
<div class="line"><span class="lineno"> 2816</span>    <span class="keywordflow">return</span> pStream-&gt;<a class="code hl_variable" href="structTFileStream.html#ae3358c9b5a9dfdee5e8275561eff8850">StreamResize</a>(pStream, NewFileSize);</div>
<div class="line"><span class="lineno"> 2817</span>}</div>
</div><!-- fragment --><div class="dynheader">
Here is the call graph for this function:</div>
<div class="dyncontent">
<div class="center"><iframe scrolling="no" frameborder="0" src="FileStream_8cpp_abc0fbb4156c7eef2e3162841ffb0d74a_cgraph.svg" width="307" height="36"><p><b>This browser is not able to show SVG: try Firefox, Chrome, Safari, or Opera instead.</b></p></iframe></div>
</div>
<div class="dynheader">
Here is the caller graph for this function:</div>
<div class="dyncontent">
<div class="center"><div class="zoom"><iframe scrolling="no" frameborder="0" src="FileStream_8cpp_abc0fbb4156c7eef2e3162841ffb0d74a_icgraph.svg" width="100%" height="440"><p><b>This browser is not able to show SVG: try Firefox, Chrome, Safari, or Opera instead.</b></p></iframe></div></div>
</div>

</div>
</div>
<a id="a36307955e8de92f5ea26be07ea3b9cb4" name="a36307955e8de92f5ea26be07ea3b9cb4"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a36307955e8de92f5ea26be07ea3b9cb4">&#9670;&#160;</a></span>FileStream_Write()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname"><a class="el" href="StormPort_8h.html#abb452686968e48b67397da5f97445f5b">bool</a> FileStream_Write </td>
          <td>(</td>
          <td class="paramtype"><a class="el" href="structTFileStream.html">TFileStream</a> *&#160;</td>
          <td class="paramname"><em>pStream</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype"><a class="el" href="StormPort_8h.html#abb9abb9ce956f1a9e5a4081ac40e5649">ULONGLONG</a> *&#160;</td>
          <td class="paramname"><em>pByteOffset</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype"><a class="el" href="StormLib_2src_2zlib_2zconf_8h.html#a2c212835823e3c54a8ab6d95c652660e">const</a> void *&#160;</td>
          <td class="paramname"><em>pvBuffer</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype"><a class="el" href="StormPort_8h.html#a798af1e30bc65f319c1a246cecf59e39">DWORD</a>&#160;</td>
          <td class="paramname"><em>dwBytesToWrite</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
</div><div class="memdoc">
<p>This function writes data to the stream</p>
<ul>
<li>Returns true if the write operation succeeded and all bytes have been written</li>
<li>Returns false if either write failed or not all bytes have been written</li>
<li>If the pByteOffset is NULL, the function must write the data to the current file position</li>
</ul>
<p><em>pStream</em> Pointer to an open stream <em>pByteOffset</em> Pointer to file byte offset. If NULL, it reads from the current position <em>pvBuffer</em> Pointer to data to be written <em>dwBytesToWrite</em> Number of bytes to write to the file </p>

<p class="definition">Definition at line <a class="el" href="FileStream_8cpp_source.html#l02777">2777</a> of file <a class="el" href="FileStream_8cpp_source.html">FileStream.cpp</a>.</p>
<div class="fragment"><div class="line"><span class="lineno"> 2778</span>{</div>
<div class="line"><span class="lineno"> 2779</span>    <span class="keywordflow">if</span>(pStream-&gt;<a class="code hl_variable" href="structTFileStream.html#ae61935eec67ce99ea4091bc0949de1ea">dwFlags</a> &amp; <a class="code hl_define" href="StormLib_8h.html#abdbbf06488f24699775afe6aadaeafc3">STREAM_FLAG_READ_ONLY</a>)</div>
<div class="line"><span class="lineno"> 2780</span>    {</div>
<div class="line"><span class="lineno"> 2781</span>        <a class="code hl_function" href="FileStream_8cpp.html#a65dd8d3e416ffbd6ac5f468c6bdccac9">SetLastError</a>(<a class="code hl_define" href="StormPort_8h.html#aeed98d3d6aec00b22a04eb8836d77a51">ERROR_ACCESS_DENIED</a>);</div>
<div class="line"><span class="lineno"> 2782</span>        <span class="keywordflow">return</span> <span class="keyword">false</span>;</div>
<div class="line"><span class="lineno"> 2783</span>    }</div>
<div class="line"><span class="lineno"> 2784</span> </div>
<div class="line"><span class="lineno"> 2785</span>    assert(pStream-&gt;<a class="code hl_variable" href="structTFileStream.html#ae085fb3901c17a2b302196951a9fe412">StreamWrite</a> != NULL);</div>
<div class="line"><span class="lineno"> 2786</span>    <span class="keywordflow">return</span> pStream-&gt;<a class="code hl_variable" href="structTFileStream.html#ae085fb3901c17a2b302196951a9fe412">StreamWrite</a>(pStream, pByteOffset, pvBuffer, dwBytesToWrite);</div>
<div class="line"><span class="lineno"> 2787</span>}</div>
</div><!-- fragment --><div class="dynheader">
Here is the call graph for this function:</div>
<div class="dyncontent">
<div class="center"><iframe scrolling="no" frameborder="0" src="FileStream_8cpp_a36307955e8de92f5ea26be07ea3b9cb4_cgraph.svg" width="295" height="36"><p><b>This browser is not able to show SVG: try Firefox, Chrome, Safari, or Opera instead.</b></p></iframe></div>
</div>
<div class="dynheader">
Here is the caller graph for this function:</div>
<div class="dyncontent">
<div class="center"><div class="zoom"><iframe scrolling="no" frameborder="0" src="FileStream_8cpp_a36307955e8de92f5ea26be07ea3b9cb4_icgraph.svg" width="100%" height="600"><p><b>This browser is not able to show SVG: try Firefox, Chrome, Safari, or Opera instead.</b></p></iframe></div></div>
</div>

</div>
</div>
<a id="a4e4466215f5a417ba8e4e8d77dd0703a" name="a4e4466215f5a417ba8e4e8d77dd0703a"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a4e4466215f5a417ba8e4e8d77dd0703a">&#9670;&#160;</a></span>FlatStream_BlockCheck()</h2>

<div class="memitem">
<div class="memproto">
<table class="mlabels">
  <tr>
  <td class="mlabels-left">
      <table class="memname">
        <tr>
          <td class="memname">static <a class="el" href="StormPort_8h.html#abb452686968e48b67397da5f97445f5b">bool</a> FlatStream_BlockCheck </td>
          <td>(</td>
          <td class="paramtype"><a class="el" href="structTBlockStream.html">TBlockStream</a> *&#160;</td>
          <td class="paramname"><em>pStream</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype"><a class="el" href="StormPort_8h.html#abb9abb9ce956f1a9e5a4081ac40e5649">ULONGLONG</a>&#160;</td>
          <td class="paramname"><em>BlockOffset</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
  </td>
  <td class="mlabels-right">
<span class="mlabels"><span class="mlabel">static</span></span>  </td>
  </tr>
</table>
</div><div class="memdoc">

<p class="definition">Definition at line <a class="el" href="FileStream_8cpp_source.html#l01278">1278</a> of file <a class="el" href="FileStream_8cpp_source.html">FileStream.cpp</a>.</p>
<div class="fragment"><div class="line"><span class="lineno"> 1281</span>{</div>
<div class="line"><span class="lineno"> 1282</span>    <a class="code hl_typedef" href="StormPort_8h.html#ac2d3fb16b5b34c1e6ab80014309020eb">LPBYTE</a> FileBitmap = (<a class="code hl_typedef" href="StormPort_8h.html#ac2d3fb16b5b34c1e6ab80014309020eb">LPBYTE</a>)pStream-&gt;<a class="code hl_variable" href="structTBlockStream.html#a1e2d4a2467ab4b43cec1bdd1a2f6d21a">FileBitmap</a>;</div>
<div class="line"><span class="lineno"> 1283</span>    <a class="code hl_typedef" href="StormPort_8h.html#a798af1e30bc65f319c1a246cecf59e39">DWORD</a> BlockIndex;</div>
<div class="line"><span class="lineno"> 1284</span>    <a class="code hl_typedef" href="StormPort_8h.html#a4ae1dab0fb4b072a66584546209e7d58">BYTE</a> BitMask;</div>
<div class="line"><span class="lineno"> 1285</span> </div>
<div class="line"><span class="lineno"> 1286</span>    <span class="comment">// Sanity checks</span></div>
<div class="line"><span class="lineno"> 1287</span>    assert((BlockOffset &amp; (pStream-&gt;<a class="code hl_variable" href="structTBlockStream.html#a8c7180184928638b30809f7f85061fb7">BlockSize</a> - 1)) == 0);</div>
<div class="line"><span class="lineno"> 1288</span>    assert(FileBitmap != NULL);</div>
<div class="line"><span class="lineno"> 1289</span> </div>
<div class="line"><span class="lineno"> 1290</span>    <span class="comment">// Calculate the index of the block</span></div>
<div class="line"><span class="lineno"> 1291</span>    BlockIndex = (<a class="code hl_typedef" href="StormPort_8h.html#a798af1e30bc65f319c1a246cecf59e39">DWORD</a>)(BlockOffset / pStream-&gt;<a class="code hl_variable" href="structTBlockStream.html#a8c7180184928638b30809f7f85061fb7">BlockSize</a>);</div>
<div class="line"><span class="lineno"> 1292</span>    BitMask = (<a class="code hl_typedef" href="StormPort_8h.html#a4ae1dab0fb4b072a66584546209e7d58">BYTE</a>)(1 &lt;&lt; (BlockIndex &amp; 0x07));</div>
<div class="line"><span class="lineno"> 1293</span> </div>
<div class="line"><span class="lineno"> 1294</span>    <span class="comment">// Check if the bit is present</span></div>
<div class="line"><span class="lineno"> 1295</span>    <span class="keywordflow">return</span> (FileBitmap[BlockIndex / 0x08] &amp; BitMask) ? <a class="code hl_define" href="StormPort_8h.html#a41f9c5fb8b08eb5dc3edce4dcb37fee7">true</a> : <span class="keyword">false</span>;</div>
<div class="line"><span class="lineno"> 1296</span>}</div>
<div class="ttc" id="aStormPort_8h_html_a41f9c5fb8b08eb5dc3edce4dcb37fee7"><div class="ttname"><a href="StormPort_8h.html#a41f9c5fb8b08eb5dc3edce4dcb37fee7">true</a></div><div class="ttdeci">#define true</div><div class="ttdef"><b>Definition</b> <a href="StormPort_8h_source.html#l00032">StormPort.h:32</a></div></div>
</div><!-- fragment --><div class="dynheader">
Here is the caller graph for this function:</div>
<div class="dyncontent">
<div class="center"><div class="zoom"><iframe scrolling="no" frameborder="0" src="FileStream_8cpp_a4e4466215f5a417ba8e4e8d77dd0703a_icgraph.svg" width="100%" height="600"><p><b>This browser is not able to show SVG: try Firefox, Chrome, Safari, or Opera instead.</b></p></iframe></div></div>
</div>

</div>
</div>
<a id="a1637f8242ad3484abb17a40d0e4f99b6" name="a1637f8242ad3484abb17a40d0e4f99b6"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a1637f8242ad3484abb17a40d0e4f99b6">&#9670;&#160;</a></span>FlatStream_BlockRead()</h2>

<div class="memitem">
<div class="memproto">
<table class="mlabels">
  <tr>
  <td class="mlabels-left">
      <table class="memname">
        <tr>
          <td class="memname">static <a class="el" href="StormPort_8h.html#abb452686968e48b67397da5f97445f5b">bool</a> FlatStream_BlockRead </td>
          <td>(</td>
          <td class="paramtype"><a class="el" href="structTBlockStream.html">TBlockStream</a> *&#160;</td>
          <td class="paramname"><em>pStream</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype"><a class="el" href="StormPort_8h.html#abb9abb9ce956f1a9e5a4081ac40e5649">ULONGLONG</a>&#160;</td>
          <td class="paramname"><em>StartOffset</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype"><a class="el" href="StormPort_8h.html#abb9abb9ce956f1a9e5a4081ac40e5649">ULONGLONG</a>&#160;</td>
          <td class="paramname"><em>EndOffset</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype"><a class="el" href="StormPort_8h.html#ac2d3fb16b5b34c1e6ab80014309020eb">LPBYTE</a>&#160;</td>
          <td class="paramname"><em>BlockBuffer</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype"><a class="el" href="StormPort_8h.html#a798af1e30bc65f319c1a246cecf59e39">DWORD</a>&#160;</td>
          <td class="paramname"><em>BytesNeeded</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype"><a class="el" href="StormPort_8h.html#abb452686968e48b67397da5f97445f5b">bool</a>&#160;</td>
          <td class="paramname"><em>bAvailable</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
  </td>
  <td class="mlabels-right">
<span class="mlabels"><span class="mlabel">static</span></span>  </td>
  </tr>
</table>
</div><div class="memdoc">

<p class="definition">Definition at line <a class="el" href="FileStream_8cpp_source.html#l01298">1298</a> of file <a class="el" href="FileStream_8cpp_source.html">FileStream.cpp</a>.</p>
<div class="fragment"><div class="line"><span class="lineno"> 1305</span>{</div>
<div class="line"><span class="lineno"> 1306</span>    <a class="code hl_typedef" href="StormPort_8h.html#a798af1e30bc65f319c1a246cecf59e39">DWORD</a> BytesToRead = (<a class="code hl_typedef" href="StormPort_8h.html#a798af1e30bc65f319c1a246cecf59e39">DWORD</a>)(EndOffset - StartOffset);</div>
<div class="line"><span class="lineno"> 1307</span> </div>
<div class="line"><span class="lineno"> 1308</span>    <span class="comment">// The starting offset must be aligned to size of the block</span></div>
<div class="line"><span class="lineno"> 1309</span>    assert(pStream-&gt;<a class="code hl_variable" href="structTBlockStream.html#a1e2d4a2467ab4b43cec1bdd1a2f6d21a">FileBitmap</a> != NULL);</div>
<div class="line"><span class="lineno"> 1310</span>    assert((StartOffset &amp; (pStream-&gt;<a class="code hl_variable" href="structTBlockStream.html#a8c7180184928638b30809f7f85061fb7">BlockSize</a> - 1)) == 0);</div>
<div class="line"><span class="lineno"> 1311</span>    assert(StartOffset &lt; EndOffset);</div>
<div class="line"><span class="lineno"> 1312</span> </div>
<div class="line"><span class="lineno"> 1313</span>    <span class="comment">// If the blocks are not available, we need to load them from the master</span></div>
<div class="line"><span class="lineno"> 1314</span>    <span class="comment">// and then save to the mirror</span></div>
<div class="line"><span class="lineno"> 1315</span>    <span class="keywordflow">if</span>(bAvailable == <span class="keyword">false</span>)</div>
<div class="line"><span class="lineno"> 1316</span>    {</div>
<div class="line"><span class="lineno"> 1317</span>        <span class="comment">// If we have no master, we cannot satisfy read request</span></div>
<div class="line"><span class="lineno"> 1318</span>        <span class="keywordflow">if</span>(pStream-&gt;<a class="code hl_variable" href="structTFileStream.html#a26faae83ba546119ac59fc35eaeec274">pMaster</a> == NULL)</div>
<div class="line"><span class="lineno"> 1319</span>            <span class="keywordflow">return</span> <span class="keyword">false</span>;</div>
<div class="line"><span class="lineno"> 1320</span> </div>
<div class="line"><span class="lineno"> 1321</span>        <span class="comment">// Load the blocks from the master stream</span></div>
<div class="line"><span class="lineno"> 1322</span>        <span class="comment">// Note that we always have to read complete blocks</span></div>
<div class="line"><span class="lineno"> 1323</span>        <span class="comment">// so they get properly stored to the mirror stream</span></div>
<div class="line"><span class="lineno"> 1324</span>        <span class="keywordflow">if</span>(!<a class="code hl_function" href="FileStream_8cpp.html#a593f3b1416f7497c28fa5552cd1b3003">FileStream_Read</a>(pStream-&gt;<a class="code hl_variable" href="structTFileStream.html#a26faae83ba546119ac59fc35eaeec274">pMaster</a>, &amp;StartOffset, BlockBuffer, BytesToRead))</div>
<div class="line"><span class="lineno"> 1325</span>            <span class="keywordflow">return</span> <span class="keyword">false</span>;</div>
<div class="line"><span class="lineno"> 1326</span> </div>
<div class="line"><span class="lineno"> 1327</span>        <span class="comment">// Store the loaded blocks to the mirror file.</span></div>
<div class="line"><span class="lineno"> 1328</span>        <span class="comment">// Note that this operation is not required to succeed</span></div>
<div class="line"><span class="lineno"> 1329</span>        <span class="keywordflow">if</span>(pStream-&gt;<a class="code hl_variable" href="structTFileStream.html#a811c9b3d565324e51361768847fe50a8">BaseWrite</a>(pStream, &amp;StartOffset, BlockBuffer, BytesToRead))</div>
<div class="line"><span class="lineno"> 1330</span>            <a class="code hl_function" href="FileStream_8cpp.html#a4680036b442f496fde288fabbd9a2c0e">FlatStream_UpdateBitmap</a>(pStream, StartOffset, EndOffset);</div>
<div class="line"><span class="lineno"> 1331</span> </div>
<div class="line"><span class="lineno"> 1332</span>        <span class="keywordflow">return</span> <span class="keyword">true</span>;</div>
<div class="line"><span class="lineno"> 1333</span>    }</div>
<div class="line"><span class="lineno"> 1334</span>    <span class="keywordflow">else</span></div>
<div class="line"><span class="lineno"> 1335</span>    {</div>
<div class="line"><span class="lineno"> 1336</span>        <span class="keywordflow">if</span>(BytesToRead &gt; BytesNeeded)</div>
<div class="line"><span class="lineno"> 1337</span>            BytesToRead = BytesNeeded;</div>
<div class="line"><span class="lineno"> 1338</span>        <span class="keywordflow">return</span> pStream-&gt;<a class="code hl_variable" href="structTFileStream.html#a5b6aa0a4b5d6b97770f73fbc47412da1">BaseRead</a>(pStream, &amp;StartOffset, BlockBuffer, BytesToRead);</div>
<div class="line"><span class="lineno"> 1339</span>    }</div>
<div class="line"><span class="lineno"> 1340</span>}</div>
<div class="ttc" id="aFileStream_8cpp_html_a4680036b442f496fde288fabbd9a2c0e"><div class="ttname"><a href="FileStream_8cpp.html#a4680036b442f496fde288fabbd9a2c0e">FlatStream_UpdateBitmap</a></div><div class="ttdeci">static void FlatStream_UpdateBitmap(TBlockStream *pStream, ULONGLONG StartOffset, ULONGLONG EndOffset)</div><div class="ttdef"><b>Definition</b> <a href="FileStream_8cpp_source.html#l01242">FileStream.cpp:1242</a></div></div>
<div class="ttc" id="aFileStream_8cpp_html_a593f3b1416f7497c28fa5552cd1b3003"><div class="ttname"><a href="FileStream_8cpp.html#a593f3b1416f7497c28fa5552cd1b3003">FileStream_Read</a></div><div class="ttdeci">bool FileStream_Read(TFileStream *pStream, ULONGLONG *pByteOffset, void *pvBuffer, DWORD dwBytesToRead)</div><div class="ttdef"><b>Definition</b> <a href="FileStream_8cpp_source.html#l02759">FileStream.cpp:2759</a></div></div>
</div><!-- fragment --><div class="dynheader">
Here is the call graph for this function:</div>
<div class="dyncontent">
<div class="center"><iframe scrolling="no" frameborder="0" src="FileStream_8cpp_a1637f8242ad3484abb17a40d0e4f99b6_cgraph.svg" width="424" height="86"><p><b>This browser is not able to show SVG: try Firefox, Chrome, Safari, or Opera instead.</b></p></iframe></div>
</div>
<div class="dynheader">
Here is the caller graph for this function:</div>
<div class="dyncontent">
<div class="center"><div class="zoom"><iframe scrolling="no" frameborder="0" src="FileStream_8cpp_a1637f8242ad3484abb17a40d0e4f99b6_icgraph.svg" width="100%" height="600"><p><b>This browser is not able to show SVG: try Firefox, Chrome, Safari, or Opera instead.</b></p></iframe></div></div>
</div>

</div>
</div>
<a id="ace69b2f2759cc834b194c9681b0e2465" name="ace69b2f2759cc834b194c9681b0e2465"></a>
<h2 class="memtitle"><span class="permalink"><a href="#ace69b2f2759cc834b194c9681b0e2465">&#9670;&#160;</a></span>FlatStream_CheckFile()</h2>

<div class="memitem">
<div class="memproto">
<table class="mlabels">
  <tr>
  <td class="mlabels-left">
      <table class="memname">
        <tr>
          <td class="memname">static <a class="el" href="StormPort_8h.html#a798af1e30bc65f319c1a246cecf59e39">DWORD</a> FlatStream_CheckFile </td>
          <td>(</td>
          <td class="paramtype"><a class="el" href="structTBlockStream.html">TBlockStream</a> *&#160;</td>
          <td class="paramname"><em>pStream</em></td><td>)</td>
          <td></td>
        </tr>
      </table>
  </td>
  <td class="mlabels-right">
<span class="mlabels"><span class="mlabel">static</span></span>  </td>
  </tr>
</table>
</div><div class="memdoc">

<p class="definition">Definition at line <a class="el" href="FileStream_8cpp_source.html#l01152">1152</a> of file <a class="el" href="FileStream_8cpp_source.html">FileStream.cpp</a>.</p>
<div class="fragment"><div class="line"><span class="lineno"> 1153</span>{</div>
<div class="line"><span class="lineno"> 1154</span>    <a class="code hl_typedef" href="StormPort_8h.html#ac2d3fb16b5b34c1e6ab80014309020eb">LPBYTE</a> FileBitmap = (<a class="code hl_typedef" href="StormPort_8h.html#ac2d3fb16b5b34c1e6ab80014309020eb">LPBYTE</a>)pStream-&gt;<a class="code hl_variable" href="structTBlockStream.html#a1e2d4a2467ab4b43cec1bdd1a2f6d21a">FileBitmap</a>;</div>
<div class="line"><span class="lineno"> 1155</span>    <a class="code hl_typedef" href="StormPort_8h.html#a798af1e30bc65f319c1a246cecf59e39">DWORD</a> WholeByteCount = (pStream-&gt;<a class="code hl_variable" href="structTBlockStream.html#a05210a0cd78477e541734ba7e3abe2b1">BlockCount</a> / 8);</div>
<div class="line"><span class="lineno"> 1156</span>    <a class="code hl_typedef" href="StormPort_8h.html#a798af1e30bc65f319c1a246cecf59e39">DWORD</a> ExtraBitsCount = (pStream-&gt;<a class="code hl_variable" href="structTBlockStream.html#a05210a0cd78477e541734ba7e3abe2b1">BlockCount</a> &amp; 7);</div>
<div class="line"><span class="lineno"> 1157</span>    <a class="code hl_typedef" href="StormPort_8h.html#a4ae1dab0fb4b072a66584546209e7d58">BYTE</a> ExpectedValue;</div>
<div class="line"><span class="lineno"> 1158</span> </div>
<div class="line"><span class="lineno"> 1159</span>    <span class="comment">// Verify the whole bytes - their value must be 0xFF</span></div>
<div class="line"><span class="lineno"> 1160</span>    <span class="keywordflow">for</span>(<a class="code hl_typedef" href="StormPort_8h.html#a798af1e30bc65f319c1a246cecf59e39">DWORD</a> i = 0; i &lt; WholeByteCount; i++)</div>
<div class="line"><span class="lineno"> 1161</span>    {</div>
<div class="line"><span class="lineno"> 1162</span>        <span class="keywordflow">if</span>(FileBitmap[i] != 0xFF)</div>
<div class="line"><span class="lineno"> 1163</span>            <span class="keywordflow">return</span> 0;</div>
<div class="line"><span class="lineno"> 1164</span>    }</div>
<div class="line"><span class="lineno"> 1165</span> </div>
<div class="line"><span class="lineno"> 1166</span>    <span class="comment">// If there are extra bits, calculate the mask</span></div>
<div class="line"><span class="lineno"> 1167</span>    <span class="keywordflow">if</span>(ExtraBitsCount != 0)</div>
<div class="line"><span class="lineno"> 1168</span>    {</div>
<div class="line"><span class="lineno"> 1169</span>        ExpectedValue = (<a class="code hl_typedef" href="StormPort_8h.html#a4ae1dab0fb4b072a66584546209e7d58">BYTE</a>)((1 &lt;&lt; ExtraBitsCount) - 1);</div>
<div class="line"><span class="lineno"> 1170</span>        <span class="keywordflow">if</span>(FileBitmap[WholeByteCount] != ExpectedValue)</div>
<div class="line"><span class="lineno"> 1171</span>            <span class="keywordflow">return</span> 0;</div>
<div class="line"><span class="lineno"> 1172</span>    }</div>
<div class="line"><span class="lineno"> 1173</span> </div>
<div class="line"><span class="lineno"> 1174</span>    <span class="comment">// Yes, the file is complete</span></div>
<div class="line"><span class="lineno"> 1175</span>    <span class="keywordflow">return</span> 1;</div>
<div class="line"><span class="lineno"> 1176</span>}</div>
</div><!-- fragment --><div class="dynheader">
Here is the caller graph for this function:</div>
<div class="dyncontent">
<div class="center"><div class="zoom"><iframe scrolling="no" frameborder="0" src="FileStream_8cpp_ace69b2f2759cc834b194c9681b0e2465_icgraph.svg" width="100%" height="600"><p><b>This browser is not able to show SVG: try Firefox, Chrome, Safari, or Opera instead.</b></p></iframe></div></div>
</div>

</div>
</div>
<a id="af082ffb0012c931f640399221d1016b2" name="af082ffb0012c931f640399221d1016b2"></a>
<h2 class="memtitle"><span class="permalink"><a href="#af082ffb0012c931f640399221d1016b2">&#9670;&#160;</a></span>FlatStream_Close()</h2>

<div class="memitem">
<div class="memproto">
<table class="mlabels">
  <tr>
  <td class="mlabels-left">
      <table class="memname">
        <tr>
          <td class="memname">static void FlatStream_Close </td>
          <td>(</td>
          <td class="paramtype"><a class="el" href="structTBlockStream.html">TBlockStream</a> *&#160;</td>
          <td class="paramname"><em>pStream</em></td><td>)</td>
          <td></td>
        </tr>
      </table>
  </td>
  <td class="mlabels-right">
<span class="mlabels"><span class="mlabel">static</span></span>  </td>
  </tr>
</table>
</div><div class="memdoc">

<p class="definition">Definition at line <a class="el" href="FileStream_8cpp_source.html#l01342">1342</a> of file <a class="el" href="FileStream_8cpp_source.html">FileStream.cpp</a>.</p>
<div class="fragment"><div class="line"><span class="lineno"> 1343</span>{</div>
<div class="line"><span class="lineno"> 1344</span>    <a class="code hl_struct" href="struct__FILE__BITMAP__FOOTER.html">FILE_BITMAP_FOOTER</a> Footer;</div>
<div class="line"><span class="lineno"> 1345</span> </div>
<div class="line"><span class="lineno"> 1346</span>    <span class="keywordflow">if</span>(pStream-&gt;<a class="code hl_variable" href="structTBlockStream.html#a1e2d4a2467ab4b43cec1bdd1a2f6d21a">FileBitmap</a> &amp;&amp; pStream-&gt;<a class="code hl_variable" href="structTBlockStream.html#ab405154b8f27af633d8f3116cce2ac66">IsModified</a>)</div>
<div class="line"><span class="lineno"> 1347</span>    {</div>
<div class="line"><span class="lineno"> 1348</span>        <span class="comment">// Write the file bitmap</span></div>
<div class="line"><span class="lineno"> 1349</span>        pStream-&gt;<a class="code hl_variable" href="structTFileStream.html#a811c9b3d565324e51361768847fe50a8">BaseWrite</a>(pStream, &amp;pStream-&gt;<a class="code hl_variable" href="structTFileStream.html#a99bdae10f74cf57156e65bd76ba64771">StreamSize</a>, pStream-&gt;<a class="code hl_variable" href="structTBlockStream.html#a1e2d4a2467ab4b43cec1bdd1a2f6d21a">FileBitmap</a>, pStream-&gt;<a class="code hl_variable" href="structTBlockStream.html#a15f8225b96883446b4c4076ba8deca2b">BitmapSize</a>);</div>
<div class="line"><span class="lineno"> 1350</span> </div>
<div class="line"><span class="lineno"> 1351</span>        <span class="comment">// Prepare and write the file footer</span></div>
<div class="line"><span class="lineno"> 1352</span>        Footer.<a class="code hl_variable" href="struct__FILE__BITMAP__FOOTER.html#a7dfdb65bf1c5a72d99f1d2cbda4bbce1">Signature</a>   = <a class="code hl_define" href="FileStream_8h.html#a253bb48b64ee280957de7945ece599ef">ID_FILE_BITMAP_FOOTER</a>;</div>
<div class="line"><span class="lineno"> 1353</span>        Footer.<a class="code hl_variable" href="struct__FILE__BITMAP__FOOTER.html#a2ee45d0448cd4a196235d423886402df">Version</a>     = 3;</div>
<div class="line"><span class="lineno"> 1354</span>        Footer.<a class="code hl_variable" href="struct__FILE__BITMAP__FOOTER.html#a8519f3ca78611ad97e95604c0c75960b">BuildNumber</a> = pStream-&gt;<a class="code hl_variable" href="structTFileStream.html#a656f54e9e282a350dd68bdfd4a56d8ad">BuildNumber</a>;</div>
<div class="line"><span class="lineno"> 1355</span>        Footer.<a class="code hl_variable" href="struct__FILE__BITMAP__FOOTER.html#a62079a929d943efb362696f93c389498">MapOffsetLo</a> = (<a class="code hl_typedef" href="StormPort_8h.html#a798af1e30bc65f319c1a246cecf59e39">DWORD</a>)(pStream-&gt;<a class="code hl_variable" href="structTFileStream.html#a99bdae10f74cf57156e65bd76ba64771">StreamSize</a> &amp; 0xFFFFFFFF);</div>
<div class="line"><span class="lineno"> 1356</span>        Footer.<a class="code hl_variable" href="struct__FILE__BITMAP__FOOTER.html#a28ffd63d4201e17cda85b6ac3fd2f3fe">MapOffsetHi</a> = (<a class="code hl_typedef" href="StormPort_8h.html#a798af1e30bc65f319c1a246cecf59e39">DWORD</a>)(pStream-&gt;<a class="code hl_variable" href="structTFileStream.html#a99bdae10f74cf57156e65bd76ba64771">StreamSize</a> &gt;&gt; 0x20);</div>
<div class="line"><span class="lineno"> 1357</span>        Footer.<a class="code hl_variable" href="struct__FILE__BITMAP__FOOTER.html#a27eaec8c2708d8bc815c026e6f4f4ef2">BlockSize</a>   = pStream-&gt;<a class="code hl_variable" href="structTBlockStream.html#a8c7180184928638b30809f7f85061fb7">BlockSize</a>;</div>
<div class="line"><span class="lineno"> 1358</span>        <a class="code hl_define" href="StormPort_8h.html#ac7ba8dafbd180540281c58442f9777ee">BSWAP_ARRAY32_UNSIGNED</a>(&amp;Footer, <span class="keyword">sizeof</span>(<a class="code hl_struct" href="struct__FILE__BITMAP__FOOTER.html">FILE_BITMAP_FOOTER</a>));</div>
<div class="line"><span class="lineno"> 1359</span>        pStream-&gt;<a class="code hl_variable" href="structTFileStream.html#a811c9b3d565324e51361768847fe50a8">BaseWrite</a>(pStream, NULL, &amp;Footer, <span class="keyword">sizeof</span>(<a class="code hl_struct" href="struct__FILE__BITMAP__FOOTER.html">FILE_BITMAP_FOOTER</a>));</div>
<div class="line"><span class="lineno"> 1360</span>    }</div>
<div class="line"><span class="lineno"> 1361</span> </div>
<div class="line"><span class="lineno"> 1362</span>    <span class="comment">// Close the base class</span></div>
<div class="line"><span class="lineno"> 1363</span>    <a class="code hl_function" href="FileStream_8cpp.html#a5074c346733483a14dce339c940186a9">BlockStream_Close</a>(pStream);</div>
<div class="line"><span class="lineno"> 1364</span>}</div>
<div class="ttc" id="aFileStream_8cpp_html_a5074c346733483a14dce339c940186a9"><div class="ttname"><a href="FileStream_8cpp.html#a5074c346733483a14dce339c940186a9">BlockStream_Close</a></div><div class="ttdeci">static void BlockStream_Close(TBlockStream *pStream)</div><div class="ttdef"><b>Definition</b> <a href="FileStream_8cpp_source.html#l01067">FileStream.cpp:1067</a></div></div>
<div class="ttc" id="aFileStream_8h_html_a253bb48b64ee280957de7945ece599ef"><div class="ttname"><a href="FileStream_8h.html#a253bb48b64ee280957de7945ece599ef">ID_FILE_BITMAP_FOOTER</a></div><div class="ttdeci">#define ID_FILE_BITMAP_FOOTER</div><div class="ttdef"><b>Definition</b> <a href="FileStream_8h_source.html#l00085">FileStream.h:85</a></div></div>
<div class="ttc" id="astructTFileStream_html_a656f54e9e282a350dd68bdfd4a56d8ad"><div class="ttname"><a href="structTFileStream.html#a656f54e9e282a350dd68bdfd4a56d8ad">TFileStream::BuildNumber</a></div><div class="ttdeci">DWORD BuildNumber</div><div class="ttdef"><b>Definition</b> <a href="FileStream_8h_source.html#l00186">FileStream.h:186</a></div></div>
<div class="ttc" id="astruct__FILE__BITMAP__FOOTER_html"><div class="ttname"><a href="struct__FILE__BITMAP__FOOTER.html">_FILE_BITMAP_FOOTER</a></div><div class="ttdef"><b>Definition</b> <a href="FileStream_8h_source.html#l00111">FileStream.h:112</a></div></div>
<div class="ttc" id="astruct__FILE__BITMAP__FOOTER_html_a27eaec8c2708d8bc815c026e6f4f4ef2"><div class="ttname"><a href="struct__FILE__BITMAP__FOOTER.html#a27eaec8c2708d8bc815c026e6f4f4ef2">_FILE_BITMAP_FOOTER::BlockSize</a></div><div class="ttdeci">DWORD BlockSize</div><div class="ttdef"><b>Definition</b> <a href="FileStream_8h_source.html#l00118">FileStream.h:118</a></div></div>
<div class="ttc" id="astruct__FILE__BITMAP__FOOTER_html_a28ffd63d4201e17cda85b6ac3fd2f3fe"><div class="ttname"><a href="struct__FILE__BITMAP__FOOTER.html#a28ffd63d4201e17cda85b6ac3fd2f3fe">_FILE_BITMAP_FOOTER::MapOffsetHi</a></div><div class="ttdeci">DWORD MapOffsetHi</div><div class="ttdef"><b>Definition</b> <a href="FileStream_8h_source.html#l00117">FileStream.h:117</a></div></div>
<div class="ttc" id="astruct__FILE__BITMAP__FOOTER_html_a2ee45d0448cd4a196235d423886402df"><div class="ttname"><a href="struct__FILE__BITMAP__FOOTER.html#a2ee45d0448cd4a196235d423886402df">_FILE_BITMAP_FOOTER::Version</a></div><div class="ttdeci">DWORD Version</div><div class="ttdef"><b>Definition</b> <a href="FileStream_8h_source.html#l00114">FileStream.h:114</a></div></div>
<div class="ttc" id="astruct__FILE__BITMAP__FOOTER_html_a62079a929d943efb362696f93c389498"><div class="ttname"><a href="struct__FILE__BITMAP__FOOTER.html#a62079a929d943efb362696f93c389498">_FILE_BITMAP_FOOTER::MapOffsetLo</a></div><div class="ttdeci">DWORD MapOffsetLo</div><div class="ttdef"><b>Definition</b> <a href="FileStream_8h_source.html#l00116">FileStream.h:116</a></div></div>
<div class="ttc" id="astruct__FILE__BITMAP__FOOTER_html_a7dfdb65bf1c5a72d99f1d2cbda4bbce1"><div class="ttname"><a href="struct__FILE__BITMAP__FOOTER.html#a7dfdb65bf1c5a72d99f1d2cbda4bbce1">_FILE_BITMAP_FOOTER::Signature</a></div><div class="ttdeci">DWORD Signature</div><div class="ttdef"><b>Definition</b> <a href="FileStream_8h_source.html#l00113">FileStream.h:113</a></div></div>
<div class="ttc" id="astruct__FILE__BITMAP__FOOTER_html_a8519f3ca78611ad97e95604c0c75960b"><div class="ttname"><a href="struct__FILE__BITMAP__FOOTER.html#a8519f3ca78611ad97e95604c0c75960b">_FILE_BITMAP_FOOTER::BuildNumber</a></div><div class="ttdeci">DWORD BuildNumber</div><div class="ttdef"><b>Definition</b> <a href="FileStream_8h_source.html#l00115">FileStream.h:115</a></div></div>
</div><!-- fragment --><div class="dynheader">
Here is the call graph for this function:</div>
<div class="dyncontent">
<div class="center"><iframe scrolling="no" frameborder="0" src="FileStream_8cpp_af082ffb0012c931f640399221d1016b2_cgraph.svg" width="344" height="36"><p><b>This browser is not able to show SVG: try Firefox, Chrome, Safari, or Opera instead.</b></p></iframe></div>
</div>
<div class="dynheader">
Here is the caller graph for this function:</div>
<div class="dyncontent">
<div class="center"><div class="zoom"><iframe scrolling="no" frameborder="0" src="FileStream_8cpp_af082ffb0012c931f640399221d1016b2_icgraph.svg" width="100%" height="600"><p><b>This browser is not able to show SVG: try Firefox, Chrome, Safari, or Opera instead.</b></p></iframe></div></div>
</div>

</div>
</div>
<a id="aafefeeb7fed0c48dca2d374277dc08ee" name="aafefeeb7fed0c48dca2d374277dc08ee"></a>
<h2 class="memtitle"><span class="permalink"><a href="#aafefeeb7fed0c48dca2d374277dc08ee">&#9670;&#160;</a></span>FlatStream_CreateMirror()</h2>

<div class="memitem">
<div class="memproto">
<table class="mlabels">
  <tr>
  <td class="mlabels-left">
      <table class="memname">
        <tr>
          <td class="memname">static <a class="el" href="StormPort_8h.html#abb452686968e48b67397da5f97445f5b">bool</a> FlatStream_CreateMirror </td>
          <td>(</td>
          <td class="paramtype"><a class="el" href="structTBlockStream.html">TBlockStream</a> *&#160;</td>
          <td class="paramname"><em>pStream</em></td><td>)</td>
          <td></td>
        </tr>
      </table>
  </td>
  <td class="mlabels-right">
<span class="mlabels"><span class="mlabel">static</span></span>  </td>
  </tr>
</table>
</div><div class="memdoc">

<p class="definition">Definition at line <a class="el" href="FileStream_8cpp_source.html#l01366">1366</a> of file <a class="el" href="FileStream_8cpp_source.html">FileStream.cpp</a>.</p>
<div class="fragment"><div class="line"><span class="lineno"> 1367</span>{</div>
<div class="line"><span class="lineno"> 1368</span>    <a class="code hl_typedef" href="StormPort_8h.html#abb9abb9ce956f1a9e5a4081ac40e5649">ULONGLONG</a> MasterSize = 0;</div>
<div class="line"><span class="lineno"> 1369</span>    <a class="code hl_typedef" href="StormPort_8h.html#abb9abb9ce956f1a9e5a4081ac40e5649">ULONGLONG</a> MirrorSize = 0;</div>
<div class="line"><span class="lineno"> 1370</span>    <a class="code hl_typedef" href="StormPort_8h.html#ac2d3fb16b5b34c1e6ab80014309020eb">LPBYTE</a> FileBitmap = NULL;</div>
<div class="line"><span class="lineno"> 1371</span>    <a class="code hl_typedef" href="StormPort_8h.html#a798af1e30bc65f319c1a246cecf59e39">DWORD</a> dwBitmapSize;</div>
<div class="line"><span class="lineno"> 1372</span>    <a class="code hl_typedef" href="StormPort_8h.html#a798af1e30bc65f319c1a246cecf59e39">DWORD</a> dwBlockCount;</div>
<div class="line"><span class="lineno"> 1373</span>    <span class="keywordtype">bool</span> bNeedCreateMirrorStream = <span class="keyword">true</span>;</div>
<div class="line"><span class="lineno"> 1374</span>    <span class="keywordtype">bool</span> bNeedResizeMirrorStream = <span class="keyword">true</span>;</div>
<div class="line"><span class="lineno"> 1375</span> </div>
<div class="line"><span class="lineno"> 1376</span>    <span class="comment">// Do we have master function and base creation function?</span></div>
<div class="line"><span class="lineno"> 1377</span>    <span class="keywordflow">if</span>(pStream-&gt;<a class="code hl_variable" href="structTFileStream.html#a26faae83ba546119ac59fc35eaeec274">pMaster</a> == NULL || pStream-&gt;<a class="code hl_variable" href="structTFileStream.html#a1082d451ef30de1e906bc3a4d26d8d65">BaseCreate</a> == NULL)</div>
<div class="line"><span class="lineno"> 1378</span>        <span class="keywordflow">return</span> <span class="keyword">false</span>;</div>
<div class="line"><span class="lineno"> 1379</span> </div>
<div class="line"><span class="lineno"> 1380</span>    <span class="comment">// Retrieve the master file size, block count and bitmap size</span></div>
<div class="line"><span class="lineno"> 1381</span>    <a class="code hl_function" href="FileStream_8cpp.html#af505319882f0f4aaf396b6d061a2275b">FileStream_GetSize</a>(pStream-&gt;<a class="code hl_variable" href="structTFileStream.html#a26faae83ba546119ac59fc35eaeec274">pMaster</a>, &amp;MasterSize);</div>
<div class="line"><span class="lineno"> 1382</span>    dwBlockCount = (<a class="code hl_typedef" href="StormPort_8h.html#a798af1e30bc65f319c1a246cecf59e39">DWORD</a>)((MasterSize + <a class="code hl_define" href="FileStream_8h.html#ac42c901b241f3189fb2451bfea993e1a">DEFAULT_BLOCK_SIZE</a> - 1) / <a class="code hl_define" href="FileStream_8h.html#ac42c901b241f3189fb2451bfea993e1a">DEFAULT_BLOCK_SIZE</a>);</div>
<div class="line"><span class="lineno"> 1383</span>    dwBitmapSize = (<a class="code hl_typedef" href="StormPort_8h.html#a798af1e30bc65f319c1a246cecf59e39">DWORD</a>)((dwBlockCount + 7) / 8);</div>
<div class="line"><span class="lineno"> 1384</span> </div>
<div class="line"><span class="lineno"> 1385</span>    <span class="comment">// Setup stream size and position</span></div>
<div class="line"><span class="lineno"> 1386</span>    pStream-&gt;<a class="code hl_variable" href="structTFileStream.html#a656f54e9e282a350dd68bdfd4a56d8ad">BuildNumber</a> = <a class="code hl_define" href="FileStream_8h.html#a8b2bae6779544561db298ba09b50866c">DEFAULT_BUILD_NUMBER</a>;        <span class="comment">// BUGBUG: Really???</span></div>
<div class="line"><span class="lineno"> 1387</span>    pStream-&gt;<a class="code hl_variable" href="structTFileStream.html#a99bdae10f74cf57156e65bd76ba64771">StreamSize</a> = MasterSize;</div>
<div class="line"><span class="lineno"> 1388</span>    pStream-&gt;<a class="code hl_variable" href="structTFileStream.html#a84324f2f19bfc3fcbc563ef2391f84fe">StreamPos</a> = 0;</div>
<div class="line"><span class="lineno"> 1389</span> </div>
<div class="line"><span class="lineno"> 1390</span>    <span class="comment">// Open the base stream for write access</span></div>
<div class="line"><span class="lineno"> 1391</span>    <span class="keywordflow">if</span>(pStream-&gt;<a class="code hl_variable" href="structTFileStream.html#a82013f6bc9d5e52d1efe42b0dc464d4c">BaseOpen</a>(pStream, pStream-&gt;<a class="code hl_variable" href="structTFileStream.html#a7a4da926d708d96cb47333973e705c76">szFileName</a>, 0))</div>
<div class="line"><span class="lineno"> 1392</span>    {</div>
<div class="line"><span class="lineno"> 1393</span>        <span class="comment">// If the file open succeeded, check if the file size matches required size</span></div>
<div class="line"><span class="lineno"> 1394</span>        pStream-&gt;<a class="code hl_variable" href="structTFileStream.html#a0366f518ffecab4131bf2527f22964e3">BaseGetSize</a>(pStream, &amp;MirrorSize);</div>
<div class="line"><span class="lineno"> 1395</span>        <span class="keywordflow">if</span>(MirrorSize == MasterSize + dwBitmapSize + <span class="keyword">sizeof</span>(<a class="code hl_struct" href="struct__FILE__BITMAP__FOOTER.html">FILE_BITMAP_FOOTER</a>))</div>
<div class="line"><span class="lineno"> 1396</span>        {</div>
<div class="line"><span class="lineno"> 1397</span>            <span class="comment">// Attempt to load an existing file bitmap</span></div>
<div class="line"><span class="lineno"> 1398</span>            <span class="keywordflow">if</span>(<a class="code hl_function" href="FileStream_8cpp.html#aa42d0ab738da3b67ff30e784323d1da6">FlatStream_LoadBitmap</a>(pStream))</div>
<div class="line"><span class="lineno"> 1399</span>                <span class="keywordflow">return</span> <span class="keyword">true</span>;</div>
<div class="line"><span class="lineno"> 1400</span> </div>
<div class="line"><span class="lineno"> 1401</span>            <span class="comment">// We need to create new file bitmap</span></div>
<div class="line"><span class="lineno"> 1402</span>            bNeedResizeMirrorStream = <span class="keyword">false</span>;</div>
<div class="line"><span class="lineno"> 1403</span>        }</div>
<div class="line"><span class="lineno"> 1404</span> </div>
<div class="line"><span class="lineno"> 1405</span>        <span class="comment">// We need to create mirror stream</span></div>
<div class="line"><span class="lineno"> 1406</span>        bNeedCreateMirrorStream = <span class="keyword">false</span>;</div>
<div class="line"><span class="lineno"> 1407</span>    }</div>
<div class="line"><span class="lineno"> 1408</span> </div>
<div class="line"><span class="lineno"> 1409</span>    <span class="comment">// Create a new stream, if needed</span></div>
<div class="line"><span class="lineno"> 1410</span>    <span class="keywordflow">if</span>(bNeedCreateMirrorStream)</div>
<div class="line"><span class="lineno"> 1411</span>    {</div>
<div class="line"><span class="lineno"> 1412</span>        <span class="keywordflow">if</span>(!pStream-&gt;<a class="code hl_variable" href="structTFileStream.html#a1082d451ef30de1e906bc3a4d26d8d65">BaseCreate</a>(pStream))</div>
<div class="line"><span class="lineno"> 1413</span>            <span class="keywordflow">return</span> <span class="keyword">false</span>;</div>
<div class="line"><span class="lineno"> 1414</span>    }</div>
<div class="line"><span class="lineno"> 1415</span> </div>
<div class="line"><span class="lineno"> 1416</span>    <span class="comment">// If we need to, then resize the mirror stream</span></div>
<div class="line"><span class="lineno"> 1417</span>    <span class="keywordflow">if</span>(bNeedResizeMirrorStream)</div>
<div class="line"><span class="lineno"> 1418</span>    {</div>
<div class="line"><span class="lineno"> 1419</span>        <span class="keywordflow">if</span>(!pStream-&gt;<a class="code hl_variable" href="structTFileStream.html#a00a7a9d0ce7cdea1c4ecdbd72a3bd282">BaseResize</a>(pStream, MasterSize + dwBitmapSize + <span class="keyword">sizeof</span>(<a class="code hl_struct" href="struct__FILE__BITMAP__FOOTER.html">FILE_BITMAP_FOOTER</a>)))</div>
<div class="line"><span class="lineno"> 1420</span>            <span class="keywordflow">return</span> <span class="keyword">false</span>;</div>
<div class="line"><span class="lineno"> 1421</span>    }</div>
<div class="line"><span class="lineno"> 1422</span> </div>
<div class="line"><span class="lineno"> 1423</span>    <span class="comment">// Allocate the bitmap array</span></div>
<div class="line"><span class="lineno"> 1424</span>    FileBitmap = <a class="code hl_define" href="StormCommon_8h.html#a6fe0c42173ef1a4b9f0e837b0c631660">STORM_ALLOC</a>(<a class="code hl_typedef" href="StormPort_8h.html#a4ae1dab0fb4b072a66584546209e7d58">BYTE</a>, dwBitmapSize);</div>
<div class="line"><span class="lineno"> 1425</span>    <span class="keywordflow">if</span>(FileBitmap == NULL)</div>
<div class="line"><span class="lineno"> 1426</span>        <span class="keywordflow">return</span> <span class="keyword">false</span>;</div>
<div class="line"><span class="lineno"> 1427</span> </div>
<div class="line"><span class="lineno"> 1428</span>    <span class="comment">// Initialize the bitmap</span></div>
<div class="line"><span class="lineno"> 1429</span>    memset(FileBitmap, 0, dwBitmapSize);</div>
<div class="line"><span class="lineno"> 1430</span>    pStream-&gt;<a class="code hl_variable" href="structTBlockStream.html#a1e2d4a2467ab4b43cec1bdd1a2f6d21a">FileBitmap</a> = FileBitmap;</div>
<div class="line"><span class="lineno"> 1431</span>    pStream-&gt;<a class="code hl_variable" href="structTBlockStream.html#a15f8225b96883446b4c4076ba8deca2b">BitmapSize</a> = dwBitmapSize;</div>
<div class="line"><span class="lineno"> 1432</span>    pStream-&gt;<a class="code hl_variable" href="structTBlockStream.html#a8c7180184928638b30809f7f85061fb7">BlockSize</a>  = <a class="code hl_define" href="FileStream_8h.html#ac42c901b241f3189fb2451bfea993e1a">DEFAULT_BLOCK_SIZE</a>;</div>
<div class="line"><span class="lineno"> 1433</span>    pStream-&gt;<a class="code hl_variable" href="structTBlockStream.html#a05210a0cd78477e541734ba7e3abe2b1">BlockCount</a> = dwBlockCount;</div>
<div class="line"><span class="lineno"> 1434</span>    pStream-&gt;<a class="code hl_variable" href="structTBlockStream.html#a8bb8ee629c5bc59f65d01eead9b62762">IsComplete</a> = 0;</div>
<div class="line"><span class="lineno"> 1435</span>    pStream-&gt;<a class="code hl_variable" href="structTBlockStream.html#ab405154b8f27af633d8f3116cce2ac66">IsModified</a> = 1;</div>
<div class="line"><span class="lineno"> 1436</span> </div>
<div class="line"><span class="lineno"> 1437</span>    <span class="comment">// Note: Don&#39;t write the stream bitmap right away.</span></div>
<div class="line"><span class="lineno"> 1438</span>    <span class="comment">// Doing so would cause sparse file resize on NTFS,</span></div>
<div class="line"><span class="lineno"> 1439</span>    <span class="comment">// which would take long time on larger files.</span></div>
<div class="line"><span class="lineno"> 1440</span>    <span class="keywordflow">return</span> <span class="keyword">true</span>;</div>
<div class="line"><span class="lineno"> 1441</span>}</div>
<div class="ttc" id="aFileStream_8cpp_html_aa42d0ab738da3b67ff30e784323d1da6"><div class="ttname"><a href="FileStream_8cpp.html#aa42d0ab738da3b67ff30e784323d1da6">FlatStream_LoadBitmap</a></div><div class="ttdeci">static bool FlatStream_LoadBitmap(TBlockStream *pStream)</div><div class="ttdef"><b>Definition</b> <a href="FileStream_8cpp_source.html#l01178">FileStream.cpp:1178</a></div></div>
<div class="ttc" id="aFileStream_8cpp_html_af505319882f0f4aaf396b6d061a2275b"><div class="ttname"><a href="FileStream_8cpp.html#af505319882f0f4aaf396b6d061a2275b">FileStream_GetSize</a></div><div class="ttdeci">bool FileStream_GetSize(TFileStream *pStream, ULONGLONG *pFileSize)</div><div class="ttdef"><b>Definition</b> <a href="FileStream_8cpp_source.html#l02795">FileStream.cpp:2795</a></div></div>
<div class="ttc" id="aFileStream_8h_html_a8b2bae6779544561db298ba09b50866c"><div class="ttname"><a href="FileStream_8h.html#a8b2bae6779544561db298ba09b50866c">DEFAULT_BUILD_NUMBER</a></div><div class="ttdeci">#define DEFAULT_BUILD_NUMBER</div><div class="ttdef"><b>Definition</b> <a href="FileStream_8h_source.html#l00087">FileStream.h:87</a></div></div>
</div><!-- fragment --><div class="dynheader">
Here is the call graph for this function:</div>
<div class="dyncontent">
<div class="center"><iframe scrolling="no" frameborder="0" src="FileStream_8cpp_aafefeeb7fed0c48dca2d374277dc08ee_cgraph.svg" width="632" height="86"><p><b>This browser is not able to show SVG: try Firefox, Chrome, Safari, or Opera instead.</b></p></iframe></div>
</div>
<div class="dynheader">
Here is the caller graph for this function:</div>
<div class="dyncontent">
<div class="center"><div class="zoom"><iframe scrolling="no" frameborder="0" src="FileStream_8cpp_aafefeeb7fed0c48dca2d374277dc08ee_icgraph.svg" width="100%" height="600"><p><b>This browser is not able to show SVG: try Firefox, Chrome, Safari, or Opera instead.</b></p></iframe></div></div>
</div>

</div>
</div>
<a id="aa42d0ab738da3b67ff30e784323d1da6" name="aa42d0ab738da3b67ff30e784323d1da6"></a>
<h2 class="memtitle"><span class="permalink"><a href="#aa42d0ab738da3b67ff30e784323d1da6">&#9670;&#160;</a></span>FlatStream_LoadBitmap()</h2>

<div class="memitem">
<div class="memproto">
<table class="mlabels">
  <tr>
  <td class="mlabels-left">
      <table class="memname">
        <tr>
          <td class="memname">static <a class="el" href="StormPort_8h.html#abb452686968e48b67397da5f97445f5b">bool</a> FlatStream_LoadBitmap </td>
          <td>(</td>
          <td class="paramtype"><a class="el" href="structTBlockStream.html">TBlockStream</a> *&#160;</td>
          <td class="paramname"><em>pStream</em></td><td>)</td>
          <td></td>
        </tr>
      </table>
  </td>
  <td class="mlabels-right">
<span class="mlabels"><span class="mlabel">static</span></span>  </td>
  </tr>
</table>
</div><div class="memdoc">

<p class="definition">Definition at line <a class="el" href="FileStream_8cpp_source.html#l01178">1178</a> of file <a class="el" href="FileStream_8cpp_source.html">FileStream.cpp</a>.</p>
<div class="fragment"><div class="line"><span class="lineno"> 1179</span>{</div>
<div class="line"><span class="lineno"> 1180</span>    <a class="code hl_struct" href="struct__FILE__BITMAP__FOOTER.html">FILE_BITMAP_FOOTER</a> Footer;</div>
<div class="line"><span class="lineno"> 1181</span>    <a class="code hl_typedef" href="StormPort_8h.html#abb9abb9ce956f1a9e5a4081ac40e5649">ULONGLONG</a> ByteOffset;</div>
<div class="line"><span class="lineno"> 1182</span>    <a class="code hl_typedef" href="StormPort_8h.html#ac2d3fb16b5b34c1e6ab80014309020eb">LPBYTE</a> FileBitmap;</div>
<div class="line"><span class="lineno"> 1183</span>    <a class="code hl_typedef" href="StormPort_8h.html#a798af1e30bc65f319c1a246cecf59e39">DWORD</a> BlockCount;</div>
<div class="line"><span class="lineno"> 1184</span>    <a class="code hl_typedef" href="StormPort_8h.html#a798af1e30bc65f319c1a246cecf59e39">DWORD</a> BitmapSize;</div>
<div class="line"><span class="lineno"> 1185</span> </div>
<div class="line"><span class="lineno"> 1186</span>    <span class="comment">// Do not load the bitmap if we should not have to</span></div>
<div class="line"><span class="lineno"> 1187</span>    <span class="keywordflow">if</span>(!(pStream-&gt;<a class="code hl_variable" href="structTFileStream.html#ae61935eec67ce99ea4091bc0949de1ea">dwFlags</a> &amp; <a class="code hl_define" href="StormLib_8h.html#a77521bc89504101b3294646ad1b462c0">STREAM_FLAG_USE_BITMAP</a>))</div>
<div class="line"><span class="lineno"> 1188</span>        <span class="keywordflow">return</span> <span class="keyword">false</span>;</div>
<div class="line"><span class="lineno"> 1189</span> </div>
<div class="line"><span class="lineno"> 1190</span>    <span class="comment">// Only if the size is greater than size of bitmap footer</span></div>
<div class="line"><span class="lineno"> 1191</span>    <span class="keywordflow">if</span>(pStream-&gt;<a class="code hl_variable" href="structTFileStream.html#a3428b5a1e790560349940aa04e37e580">Base</a>.<a class="code hl_variable" href="unionTBaseProviderData.html#a60536cc70eff3072cd6c371a99bdf325">File</a>.<a class="code hl_variable" href="unionTBaseProviderData.html#ad644c7067435cf51727186729b970d55">FileSize</a> &gt; <span class="keyword">sizeof</span>(<a class="code hl_struct" href="struct__FILE__BITMAP__FOOTER.html">FILE_BITMAP_FOOTER</a>))</div>
<div class="line"><span class="lineno"> 1192</span>    {</div>
<div class="line"><span class="lineno"> 1193</span>        <span class="comment">// Load the bitmap footer</span></div>
<div class="line"><span class="lineno"> 1194</span>        ByteOffset = pStream-&gt;<a class="code hl_variable" href="structTFileStream.html#a3428b5a1e790560349940aa04e37e580">Base</a>.<a class="code hl_variable" href="unionTBaseProviderData.html#a60536cc70eff3072cd6c371a99bdf325">File</a>.<a class="code hl_variable" href="unionTBaseProviderData.html#ad644c7067435cf51727186729b970d55">FileSize</a> - <span class="keyword">sizeof</span>(<a class="code hl_typedef" href="FileStream_8h.html#ac29e43c226750dc9728f9106abd07ebc">FILE_BITMAP_FOOTER</a>);</div>
<div class="line"><span class="lineno"> 1195</span>        <span class="keywordflow">if</span>(pStream-&gt;<a class="code hl_variable" href="structTFileStream.html#a5b6aa0a4b5d6b97770f73fbc47412da1">BaseRead</a>(pStream, &amp;ByteOffset, &amp;Footer, <span class="keyword">sizeof</span>(<a class="code hl_struct" href="struct__FILE__BITMAP__FOOTER.html">FILE_BITMAP_FOOTER</a>)))</div>
<div class="line"><span class="lineno"> 1196</span>        {</div>
<div class="line"><span class="lineno"> 1197</span>            <span class="comment">// Make sure that the array is properly BSWAP-ed</span></div>
<div class="line"><span class="lineno"> 1198</span>            <a class="code hl_define" href="StormPort_8h.html#ac7ba8dafbd180540281c58442f9777ee">BSWAP_ARRAY32_UNSIGNED</a>((<a class="code hl_typedef" href="StormPort_8h.html#a143be739596851314f3c386bd6f752f9">LPDWORD</a>)(&amp;Footer), <span class="keyword">sizeof</span>(<a class="code hl_struct" href="struct__FILE__BITMAP__FOOTER.html">FILE_BITMAP_FOOTER</a>));</div>
<div class="line"><span class="lineno"> 1199</span> </div>
<div class="line"><span class="lineno"> 1200</span>            <span class="comment">// Verify if there is actually a footer</span></div>
<div class="line"><span class="lineno"> 1201</span>            <span class="keywordflow">if</span>(Footer.<a class="code hl_variable" href="struct__FILE__BITMAP__FOOTER.html#a7dfdb65bf1c5a72d99f1d2cbda4bbce1">Signature</a> == <a class="code hl_define" href="FileStream_8h.html#a253bb48b64ee280957de7945ece599ef">ID_FILE_BITMAP_FOOTER</a> &amp;&amp; Footer.<a class="code hl_variable" href="struct__FILE__BITMAP__FOOTER.html#a2ee45d0448cd4a196235d423886402df">Version</a> == 0x03)</div>
<div class="line"><span class="lineno"> 1202</span>            {</div>
<div class="line"><span class="lineno"> 1203</span>                <span class="comment">// Get the offset of the bitmap, number of blocks and size of the bitmap</span></div>
<div class="line"><span class="lineno"> 1204</span>                ByteOffset = <a class="code hl_define" href="StormCommon_8h.html#ac67482b4d06c66c34ad0dc9686c12fd4">MAKE_OFFSET64</a>(Footer.<a class="code hl_variable" href="struct__FILE__BITMAP__FOOTER.html#a28ffd63d4201e17cda85b6ac3fd2f3fe">MapOffsetHi</a>, Footer.<a class="code hl_variable" href="struct__FILE__BITMAP__FOOTER.html#a62079a929d943efb362696f93c389498">MapOffsetLo</a>);</div>
<div class="line"><span class="lineno"> 1205</span>                BlockCount = (<a class="code hl_typedef" href="StormPort_8h.html#a798af1e30bc65f319c1a246cecf59e39">DWORD</a>)(((ByteOffset - 1) / Footer.<a class="code hl_variable" href="struct__FILE__BITMAP__FOOTER.html#a27eaec8c2708d8bc815c026e6f4f4ef2">BlockSize</a>) + 1);</div>
<div class="line"><span class="lineno"> 1206</span>                BitmapSize = ((BlockCount + 7) / 8);</div>
<div class="line"><span class="lineno"> 1207</span> </div>
<div class="line"><span class="lineno"> 1208</span>                <span class="comment">// Check if the sizes match</span></div>
<div class="line"><span class="lineno"> 1209</span>                <span class="keywordflow">if</span>(ByteOffset + BitmapSize + <span class="keyword">sizeof</span>(<a class="code hl_struct" href="struct__FILE__BITMAP__FOOTER.html">FILE_BITMAP_FOOTER</a>) == pStream-&gt;<a class="code hl_variable" href="structTFileStream.html#a3428b5a1e790560349940aa04e37e580">Base</a>.<a class="code hl_variable" href="unionTBaseProviderData.html#a60536cc70eff3072cd6c371a99bdf325">File</a>.<a class="code hl_variable" href="unionTBaseProviderData.html#ad644c7067435cf51727186729b970d55">FileSize</a>)</div>
<div class="line"><span class="lineno"> 1210</span>                {</div>
<div class="line"><span class="lineno"> 1211</span>                    <span class="comment">// Allocate space for the bitmap</span></div>
<div class="line"><span class="lineno"> 1212</span>                    FileBitmap = <a class="code hl_define" href="StormCommon_8h.html#a6fe0c42173ef1a4b9f0e837b0c631660">STORM_ALLOC</a>(<a class="code hl_typedef" href="StormPort_8h.html#a4ae1dab0fb4b072a66584546209e7d58">BYTE</a>, BitmapSize);</div>
<div class="line"><span class="lineno"> 1213</span>                    <span class="keywordflow">if</span>(FileBitmap != NULL)</div>
<div class="line"><span class="lineno"> 1214</span>                    {</div>
<div class="line"><span class="lineno"> 1215</span>                        <span class="comment">// Load the bitmap bits</span></div>
<div class="line"><span class="lineno"> 1216</span>                        <span class="keywordflow">if</span>(!pStream-&gt;<a class="code hl_variable" href="structTFileStream.html#a5b6aa0a4b5d6b97770f73fbc47412da1">BaseRead</a>(pStream, &amp;ByteOffset, FileBitmap, BitmapSize))</div>
<div class="line"><span class="lineno"> 1217</span>                        {</div>
<div class="line"><span class="lineno"> 1218</span>                            <a class="code hl_define" href="StormCommon_8h.html#a50487dadfceefebfb0de8fa711eaf4b3">STORM_FREE</a>(FileBitmap);</div>
<div class="line"><span class="lineno"> 1219</span>                            <span class="keywordflow">return</span> <span class="keyword">false</span>;</div>
<div class="line"><span class="lineno"> 1220</span>                        }</div>
<div class="line"><span class="lineno"> 1221</span> </div>
<div class="line"><span class="lineno"> 1222</span>                        <span class="comment">// Update the stream size</span></div>
<div class="line"><span class="lineno"> 1223</span>                        pStream-&gt;<a class="code hl_variable" href="structTFileStream.html#a656f54e9e282a350dd68bdfd4a56d8ad">BuildNumber</a> = Footer.<a class="code hl_variable" href="struct__FILE__BITMAP__FOOTER.html#a8519f3ca78611ad97e95604c0c75960b">BuildNumber</a>;</div>
<div class="line"><span class="lineno"> 1224</span>                        pStream-&gt;<a class="code hl_variable" href="structTFileStream.html#a99bdae10f74cf57156e65bd76ba64771">StreamSize</a> = ByteOffset;</div>
<div class="line"><span class="lineno"> 1225</span> </div>
<div class="line"><span class="lineno"> 1226</span>                        <span class="comment">// Fill the bitmap information</span></div>
<div class="line"><span class="lineno"> 1227</span>                        pStream-&gt;<a class="code hl_variable" href="structTBlockStream.html#a1e2d4a2467ab4b43cec1bdd1a2f6d21a">FileBitmap</a> = FileBitmap;</div>
<div class="line"><span class="lineno"> 1228</span>                        pStream-&gt;<a class="code hl_variable" href="structTBlockStream.html#a15f8225b96883446b4c4076ba8deca2b">BitmapSize</a> = BitmapSize;</div>
<div class="line"><span class="lineno"> 1229</span>                        pStream-&gt;<a class="code hl_variable" href="structTBlockStream.html#a8c7180184928638b30809f7f85061fb7">BlockSize</a>  = Footer.<a class="code hl_variable" href="struct__FILE__BITMAP__FOOTER.html#a27eaec8c2708d8bc815c026e6f4f4ef2">BlockSize</a>;</div>
<div class="line"><span class="lineno"> 1230</span>                        pStream-&gt;<a class="code hl_variable" href="structTBlockStream.html#a05210a0cd78477e541734ba7e3abe2b1">BlockCount</a> = BlockCount;</div>
<div class="line"><span class="lineno"> 1231</span>                        pStream-&gt;<a class="code hl_variable" href="structTBlockStream.html#a8bb8ee629c5bc59f65d01eead9b62762">IsComplete</a> = <a class="code hl_function" href="FileStream_8cpp.html#ace69b2f2759cc834b194c9681b0e2465">FlatStream_CheckFile</a>(pStream);</div>
<div class="line"><span class="lineno"> 1232</span>                        <span class="keywordflow">return</span> <span class="keyword">true</span>;</div>
<div class="line"><span class="lineno"> 1233</span>                    }</div>
<div class="line"><span class="lineno"> 1234</span>                }</div>
<div class="line"><span class="lineno"> 1235</span>            }</div>
<div class="line"><span class="lineno"> 1236</span>        }</div>
<div class="line"><span class="lineno"> 1237</span>    }</div>
<div class="line"><span class="lineno"> 1238</span> </div>
<div class="line"><span class="lineno"> 1239</span>    <span class="keywordflow">return</span> <span class="keyword">false</span>;</div>
<div class="line"><span class="lineno"> 1240</span>}</div>
<div class="ttc" id="aFileStream_8cpp_html_ace69b2f2759cc834b194c9681b0e2465"><div class="ttname"><a href="FileStream_8cpp.html#ace69b2f2759cc834b194c9681b0e2465">FlatStream_CheckFile</a></div><div class="ttdeci">static DWORD FlatStream_CheckFile(TBlockStream *pStream)</div><div class="ttdef"><b>Definition</b> <a href="FileStream_8cpp_source.html#l01152">FileStream.cpp:1152</a></div></div>
<div class="ttc" id="aFileStream_8h_html_ac29e43c226750dc9728f9106abd07ebc"><div class="ttname"><a href="FileStream_8h.html#ac29e43c226750dc9728f9106abd07ebc">FILE_BITMAP_FOOTER</a></div><div class="ttdeci">struct _FILE_BITMAP_FOOTER FILE_BITMAP_FOOTER</div></div>
<div class="ttc" id="aStormCommon_8h_html_ac67482b4d06c66c34ad0dc9686c12fd4"><div class="ttname"><a href="StormCommon_8h.html#ac67482b4d06c66c34ad0dc9686c12fd4">MAKE_OFFSET64</a></div><div class="ttdeci">#define MAKE_OFFSET64(hi, lo)</div><div class="ttdef"><b>Definition</b> <a href="StormCommon_8h_source.html#l00074">StormCommon.h:74</a></div></div>
<div class="ttc" id="aStormLib_8h_html_a77521bc89504101b3294646ad1b462c0"><div class="ttname"><a href="StormLib_8h.html#a77521bc89504101b3294646ad1b462c0">STREAM_FLAG_USE_BITMAP</a></div><div class="ttdeci">#define STREAM_FLAG_USE_BITMAP</div><div class="ttdef"><b>Definition</b> <a href="StormLib_8h_source.html#l00323">StormLib.h:323</a></div></div>
</div><!-- fragment --><div class="dynheader">
Here is the call graph for this function:</div>
<div class="dyncontent">
<div class="center"><iframe scrolling="no" frameborder="0" src="FileStream_8cpp_aa42d0ab738da3b67ff30e784323d1da6_cgraph.svg" width="402" height="36"><p><b>This browser is not able to show SVG: try Firefox, Chrome, Safari, or Opera instead.</b></p></iframe></div>
</div>
<div class="dynheader">
Here is the caller graph for this function:</div>
<div class="dyncontent">
<div class="center"><div class="zoom"><iframe scrolling="no" frameborder="0" src="FileStream_8cpp_aa42d0ab738da3b67ff30e784323d1da6_icgraph.svg" width="100%" height="600"><p><b>This browser is not able to show SVG: try Firefox, Chrome, Safari, or Opera instead.</b></p></iframe></div></div>
</div>

</div>
</div>
<a id="a3993766ada9771cb6d9ca35a3f935322" name="a3993766ada9771cb6d9ca35a3f935322"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a3993766ada9771cb6d9ca35a3f935322">&#9670;&#160;</a></span>FlatStream_Open()</h2>

<div class="memitem">
<div class="memproto">
<table class="mlabels">
  <tr>
  <td class="mlabels-left">
      <table class="memname">
        <tr>
          <td class="memname">static <a class="el" href="structTFileStream.html">TFileStream</a> * FlatStream_Open </td>
          <td>(</td>
          <td class="paramtype"><a class="el" href="StormLib_2src_2zlib_2zconf_8h.html#a2c212835823e3c54a8ab6d95c652660e">const</a> <a class="el" href="StormPort_8h.html#a03bdb8ce5895c7e261aadc2529637546">TCHAR</a> *&#160;</td>
          <td class="paramname"><em>szFileName</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype"><a class="el" href="StormPort_8h.html#a798af1e30bc65f319c1a246cecf59e39">DWORD</a>&#160;</td>
          <td class="paramname"><em>dwStreamFlags</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
  </td>
  <td class="mlabels-right">
<span class="mlabels"><span class="mlabel">static</span></span>  </td>
  </tr>
</table>
</div><div class="memdoc">

<p class="definition">Definition at line <a class="el" href="FileStream_8cpp_source.html#l01443">1443</a> of file <a class="el" href="FileStream_8cpp_source.html">FileStream.cpp</a>.</p>
<div class="fragment"><div class="line"><span class="lineno"> 1444</span>{</div>
<div class="line"><span class="lineno"> 1445</span>    <a class="code hl_struct" href="structTBlockStream.html">TBlockStream</a> * pStream;</div>
<div class="line"><span class="lineno"> 1446</span>    <a class="code hl_typedef" href="StormPort_8h.html#abb9abb9ce956f1a9e5a4081ac40e5649">ULONGLONG</a> ByteOffset = 0;</div>
<div class="line"><span class="lineno"> 1447</span> </div>
<div class="line"><span class="lineno"> 1448</span>    <span class="comment">// Create new empty stream</span></div>
<div class="line"><span class="lineno"> 1449</span>    pStream = (<a class="code hl_struct" href="structTBlockStream.html">TBlockStream</a> *)<a class="code hl_function" href="FileStream_8cpp.html#aa5874b3e4d05d2f6dfa3a32d62f56bea">AllocateFileStream</a>(szFileName, <span class="keyword">sizeof</span>(<a class="code hl_struct" href="structTBlockStream.html">TBlockStream</a>), dwStreamFlags);</div>
<div class="line"><span class="lineno"> 1450</span>    <span class="keywordflow">if</span>(pStream == NULL)</div>
<div class="line"><span class="lineno"> 1451</span>        <span class="keywordflow">return</span> NULL;</div>
<div class="line"><span class="lineno"> 1452</span> </div>
<div class="line"><span class="lineno"> 1453</span>    <span class="comment">// Do we have a master stream?</span></div>
<div class="line"><span class="lineno"> 1454</span>    <span class="keywordflow">if</span>(pStream-&gt;<a class="code hl_variable" href="structTFileStream.html#a26faae83ba546119ac59fc35eaeec274">pMaster</a> != NULL)</div>
<div class="line"><span class="lineno"> 1455</span>    {</div>
<div class="line"><span class="lineno"> 1456</span>        <span class="keywordflow">if</span>(!<a class="code hl_function" href="FileStream_8cpp.html#aafefeeb7fed0c48dca2d374277dc08ee">FlatStream_CreateMirror</a>(pStream))</div>
<div class="line"><span class="lineno"> 1457</span>        {</div>
<div class="line"><span class="lineno"> 1458</span>            <a class="code hl_function" href="FileStream_8cpp.html#ae8b75c4797726e9c5ee0b4b03bf31442">FileStream_Close</a>(pStream);</div>
<div class="line"><span class="lineno"> 1459</span>            <a class="code hl_function" href="FileStream_8cpp.html#a65dd8d3e416ffbd6ac5f468c6bdccac9">SetLastError</a>(<a class="code hl_define" href="StormPort_8h.html#aecc8b368d5ba0386b219fdd6a916b0b2">ERROR_FILE_NOT_FOUND</a>);</div>
<div class="line"><span class="lineno"> 1460</span>            <span class="keywordflow">return</span> NULL;</div>
<div class="line"><span class="lineno"> 1461</span>        }</div>
<div class="line"><span class="lineno"> 1462</span>    }</div>
<div class="line"><span class="lineno"> 1463</span>    <span class="keywordflow">else</span></div>
<div class="line"><span class="lineno"> 1464</span>    {</div>
<div class="line"><span class="lineno"> 1465</span>        <span class="comment">// Attempt to open the base stream</span></div>
<div class="line"><span class="lineno"> 1466</span>        <span class="keywordflow">if</span>(!pStream-&gt;<a class="code hl_variable" href="structTFileStream.html#a82013f6bc9d5e52d1efe42b0dc464d4c">BaseOpen</a>(pStream, pStream-&gt;<a class="code hl_variable" href="structTFileStream.html#a7a4da926d708d96cb47333973e705c76">szFileName</a>, dwStreamFlags))</div>
<div class="line"><span class="lineno"> 1467</span>        {</div>
<div class="line"><span class="lineno"> 1468</span>            <a class="code hl_function" href="FileStream_8cpp.html#ae8b75c4797726e9c5ee0b4b03bf31442">FileStream_Close</a>(pStream);</div>
<div class="line"><span class="lineno"> 1469</span>            <span class="keywordflow">return</span> NULL;</div>
<div class="line"><span class="lineno"> 1470</span>        }</div>
<div class="line"><span class="lineno"> 1471</span> </div>
<div class="line"><span class="lineno"> 1472</span>        <span class="comment">// Load the bitmap, if required to</span></div>
<div class="line"><span class="lineno"> 1473</span>        <span class="keywordflow">if</span>(dwStreamFlags &amp; <a class="code hl_define" href="StormLib_8h.html#a77521bc89504101b3294646ad1b462c0">STREAM_FLAG_USE_BITMAP</a>)</div>
<div class="line"><span class="lineno"> 1474</span>            <a class="code hl_function" href="FileStream_8cpp.html#aa42d0ab738da3b67ff30e784323d1da6">FlatStream_LoadBitmap</a>(pStream);</div>
<div class="line"><span class="lineno"> 1475</span>    }</div>
<div class="line"><span class="lineno"> 1476</span> </div>
<div class="line"><span class="lineno"> 1477</span>    <span class="comment">// If we have a stream bitmap, set the reading functions</span></div>
<div class="line"><span class="lineno"> 1478</span>    <span class="comment">// which check presence of each file block</span></div>
<div class="line"><span class="lineno"> 1479</span>    <span class="keywordflow">if</span>(pStream-&gt;<a class="code hl_variable" href="structTBlockStream.html#a1e2d4a2467ab4b43cec1bdd1a2f6d21a">FileBitmap</a> != NULL)</div>
<div class="line"><span class="lineno"> 1480</span>    {</div>
<div class="line"><span class="lineno"> 1481</span>        <span class="comment">// Set the stream position to zero. Stream size is already set</span></div>
<div class="line"><span class="lineno"> 1482</span>        assert(pStream-&gt;<a class="code hl_variable" href="structTFileStream.html#a99bdae10f74cf57156e65bd76ba64771">StreamSize</a> != 0);</div>
<div class="line"><span class="lineno"> 1483</span>        pStream-&gt;<a class="code hl_variable" href="structTFileStream.html#a84324f2f19bfc3fcbc563ef2391f84fe">StreamPos</a> = 0;</div>
<div class="line"><span class="lineno"> 1484</span>        pStream-&gt;<a class="code hl_variable" href="structTFileStream.html#ae61935eec67ce99ea4091bc0949de1ea">dwFlags</a> |= <a class="code hl_define" href="StormLib_8h.html#abdbbf06488f24699775afe6aadaeafc3">STREAM_FLAG_READ_ONLY</a>;</div>
<div class="line"><span class="lineno"> 1485</span> </div>
<div class="line"><span class="lineno"> 1486</span>        <span class="comment">// Supply the stream functions</span></div>
<div class="line"><span class="lineno"> 1487</span>        pStream-&gt;<a class="code hl_variable" href="structTFileStream.html#aaf7da0af26da32b968cdb66eb87f26ce">StreamRead</a>    = (<a class="code hl_typedef" href="FileStream_8h.html#a606a64221d9b9881a1f52bce34bbbf02">STREAM_READ</a>)<a class="code hl_function" href="FileStream_8cpp.html#a6aad894479c9e1b2cba754f7f3260747">BlockStream_Read</a>;</div>
<div class="line"><span class="lineno"> 1488</span>        pStream-&gt;<a class="code hl_variable" href="structTFileStream.html#a95b85c4ef3254dc6a73fdb2e566ebbba">StreamGetSize</a> = <a class="code hl_function" href="FileStream_8cpp.html#a3e8398bb76df8b526932fe0c4623cef9">BlockStream_GetSize</a>;</div>
<div class="line"><span class="lineno"> 1489</span>        pStream-&gt;<a class="code hl_variable" href="structTFileStream.html#a158f1621a05e8b3002c1729fd5d4cfca">StreamGetPos</a>  = <a class="code hl_function" href="FileStream_8cpp.html#a298aac8ccf15fff07223077eedbf2db7">BlockStream_GetPos</a>;</div>
<div class="line"><span class="lineno"> 1490</span>        pStream-&gt;<a class="code hl_variable" href="structTFileStream.html#ac3f8968d1ae374c58ab50404221834e4">StreamClose</a>   = (<a class="code hl_typedef" href="FileStream_8h.html#a585e2b6ef8c0d46cf78a6be488f8685d">STREAM_CLOSE</a>)<a class="code hl_function" href="FileStream_8cpp.html#af082ffb0012c931f640399221d1016b2">FlatStream_Close</a>;</div>
<div class="line"><span class="lineno"> 1491</span> </div>
<div class="line"><span class="lineno"> 1492</span>        <span class="comment">// Supply the block functions</span></div>
<div class="line"><span class="lineno"> 1493</span>        pStream-&gt;<a class="code hl_variable" href="structTFileStream.html#a707b42c85dd8f372ce802efb6bc1955e">BlockCheck</a>    = (<a class="code hl_typedef" href="FileStream_8h.html#a1e317346e5993e4386975327be8e04f2">BLOCK_CHECK</a>)<a class="code hl_function" href="FileStream_8cpp.html#a4e4466215f5a417ba8e4e8d77dd0703a">FlatStream_BlockCheck</a>;</div>
<div class="line"><span class="lineno"> 1494</span>        pStream-&gt;<a class="code hl_variable" href="structTFileStream.html#a68391daa44e09cd7654e765d81d937a3">BlockRead</a>     = (<a class="code hl_typedef" href="FileStream_8h.html#ad07760b526786fe7097b34605659f3dc">BLOCK_READ</a>)<a class="code hl_function" href="FileStream_8cpp.html#a1637f8242ad3484abb17a40d0e4f99b6">FlatStream_BlockRead</a>;</div>
<div class="line"><span class="lineno"> 1495</span>    }</div>
<div class="line"><span class="lineno"> 1496</span>    <span class="keywordflow">else</span></div>
<div class="line"><span class="lineno"> 1497</span>    {</div>
<div class="line"><span class="lineno"> 1498</span>        <span class="comment">// Reset the base position to zero</span></div>
<div class="line"><span class="lineno"> 1499</span>        pStream-&gt;<a class="code hl_variable" href="structTFileStream.html#a5b6aa0a4b5d6b97770f73fbc47412da1">BaseRead</a>(pStream, &amp;ByteOffset, NULL, 0);</div>
<div class="line"><span class="lineno"> 1500</span> </div>
<div class="line"><span class="lineno"> 1501</span>        <span class="comment">// Setup stream size and position</span></div>
<div class="line"><span class="lineno"> 1502</span>        pStream-&gt;<a class="code hl_variable" href="structTFileStream.html#a99bdae10f74cf57156e65bd76ba64771">StreamSize</a> = pStream-&gt;<a class="code hl_variable" href="structTFileStream.html#a3428b5a1e790560349940aa04e37e580">Base</a>.<a class="code hl_variable" href="unionTBaseProviderData.html#a60536cc70eff3072cd6c371a99bdf325">File</a>.<a class="code hl_variable" href="unionTBaseProviderData.html#ad644c7067435cf51727186729b970d55">FileSize</a>;</div>
<div class="line"><span class="lineno"> 1503</span>        pStream-&gt;<a class="code hl_variable" href="structTFileStream.html#a84324f2f19bfc3fcbc563ef2391f84fe">StreamPos</a> = 0;</div>
<div class="line"><span class="lineno"> 1504</span> </div>
<div class="line"><span class="lineno"> 1505</span>        <span class="comment">// Set the base functions</span></div>
<div class="line"><span class="lineno"> 1506</span>        pStream-&gt;<a class="code hl_variable" href="structTFileStream.html#aaf7da0af26da32b968cdb66eb87f26ce">StreamRead</a>    = pStream-&gt;<a class="code hl_variable" href="structTFileStream.html#a5b6aa0a4b5d6b97770f73fbc47412da1">BaseRead</a>;</div>
<div class="line"><span class="lineno"> 1507</span>        pStream-&gt;<a class="code hl_variable" href="structTFileStream.html#ae085fb3901c17a2b302196951a9fe412">StreamWrite</a>   = pStream-&gt;<a class="code hl_variable" href="structTFileStream.html#a811c9b3d565324e51361768847fe50a8">BaseWrite</a>;</div>
<div class="line"><span class="lineno"> 1508</span>        pStream-&gt;<a class="code hl_variable" href="structTFileStream.html#ae3358c9b5a9dfdee5e8275561eff8850">StreamResize</a>  = pStream-&gt;<a class="code hl_variable" href="structTFileStream.html#a00a7a9d0ce7cdea1c4ecdbd72a3bd282">BaseResize</a>;</div>
<div class="line"><span class="lineno"> 1509</span>        pStream-&gt;<a class="code hl_variable" href="structTFileStream.html#a95b85c4ef3254dc6a73fdb2e566ebbba">StreamGetSize</a> = pStream-&gt;<a class="code hl_variable" href="structTFileStream.html#a0366f518ffecab4131bf2527f22964e3">BaseGetSize</a>;</div>
<div class="line"><span class="lineno"> 1510</span>        pStream-&gt;<a class="code hl_variable" href="structTFileStream.html#a158f1621a05e8b3002c1729fd5d4cfca">StreamGetPos</a>  = pStream-&gt;<a class="code hl_variable" href="structTFileStream.html#aa9c8095dd8a2e07b83611e0b5dac3fde">BaseGetPos</a>;</div>
<div class="line"><span class="lineno"> 1511</span>        pStream-&gt;<a class="code hl_variable" href="structTFileStream.html#ac3f8968d1ae374c58ab50404221834e4">StreamClose</a>   = pStream-&gt;<a class="code hl_variable" href="structTFileStream.html#acbdc7dfef3127e4c077310381f8f6c7d">BaseClose</a>;</div>
<div class="line"><span class="lineno"> 1512</span>    }</div>
<div class="line"><span class="lineno"> 1513</span> </div>
<div class="line"><span class="lineno"> 1514</span>    <span class="keywordflow">return</span> pStream;</div>
<div class="line"><span class="lineno"> 1515</span>}</div>
<div class="ttc" id="aFileStream_8cpp_html_a1637f8242ad3484abb17a40d0e4f99b6"><div class="ttname"><a href="FileStream_8cpp.html#a1637f8242ad3484abb17a40d0e4f99b6">FlatStream_BlockRead</a></div><div class="ttdeci">static bool FlatStream_BlockRead(TBlockStream *pStream, ULONGLONG StartOffset, ULONGLONG EndOffset, LPBYTE BlockBuffer, DWORD BytesNeeded, bool bAvailable)</div><div class="ttdef"><b>Definition</b> <a href="FileStream_8cpp_source.html#l01298">FileStream.cpp:1298</a></div></div>
<div class="ttc" id="aFileStream_8cpp_html_a4e4466215f5a417ba8e4e8d77dd0703a"><div class="ttname"><a href="FileStream_8cpp.html#a4e4466215f5a417ba8e4e8d77dd0703a">FlatStream_BlockCheck</a></div><div class="ttdeci">static bool FlatStream_BlockCheck(TBlockStream *pStream, ULONGLONG BlockOffset)</div><div class="ttdef"><b>Definition</b> <a href="FileStream_8cpp_source.html#l01278">FileStream.cpp:1278</a></div></div>
<div class="ttc" id="aFileStream_8cpp_html_aafefeeb7fed0c48dca2d374277dc08ee"><div class="ttname"><a href="FileStream_8cpp.html#aafefeeb7fed0c48dca2d374277dc08ee">FlatStream_CreateMirror</a></div><div class="ttdeci">static bool FlatStream_CreateMirror(TBlockStream *pStream)</div><div class="ttdef"><b>Definition</b> <a href="FileStream_8cpp_source.html#l01366">FileStream.cpp:1366</a></div></div>
<div class="ttc" id="aFileStream_8cpp_html_af082ffb0012c931f640399221d1016b2"><div class="ttname"><a href="FileStream_8cpp.html#af082ffb0012c931f640399221d1016b2">FlatStream_Close</a></div><div class="ttdeci">static void FlatStream_Close(TBlockStream *pStream)</div><div class="ttdef"><b>Definition</b> <a href="FileStream_8cpp_source.html#l01342">FileStream.cpp:1342</a></div></div>
<div class="ttc" id="aFileStream_8h_html_a1e317346e5993e4386975327be8e04f2"><div class="ttname"><a href="FileStream_8h.html#a1e317346e5993e4386975327be8e04f2">BLOCK_CHECK</a></div><div class="ttdeci">bool(* BLOCK_CHECK)(struct TFileStream *pStream, ULONGLONG BlockOffset)</div><div class="ttdef"><b>Definition</b> <a href="FileStream_8h_source.html#l00073">FileStream.h:73</a></div></div>
</div><!-- fragment --><div class="dynheader">
Here is the call graph for this function:</div>
<div class="dyncontent">
<div class="center"><div class="zoom"><iframe scrolling="no" frameborder="0" src="FileStream_8cpp_a3993766ada9771cb6d9ca35a3f935322_cgraph.svg" width="100%" height="600"><p><b>This browser is not able to show SVG: try Firefox, Chrome, Safari, or Opera instead.</b></p></iframe></div></div>
</div>
<div class="dynheader">
Here is the caller graph for this function:</div>
<div class="dyncontent">
<div class="center"><div class="zoom"><iframe scrolling="no" frameborder="0" src="FileStream_8cpp_a3993766ada9771cb6d9ca35a3f935322_icgraph.svg" width="100%" height="600"><p><b>This browser is not able to show SVG: try Firefox, Chrome, Safari, or Opera instead.</b></p></iframe></div></div>
</div>

</div>
</div>
<a id="a4680036b442f496fde288fabbd9a2c0e" name="a4680036b442f496fde288fabbd9a2c0e"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a4680036b442f496fde288fabbd9a2c0e">&#9670;&#160;</a></span>FlatStream_UpdateBitmap()</h2>

<div class="memitem">
<div class="memproto">
<table class="mlabels">
  <tr>
  <td class="mlabels-left">
      <table class="memname">
        <tr>
          <td class="memname">static void FlatStream_UpdateBitmap </td>
          <td>(</td>
          <td class="paramtype"><a class="el" href="structTBlockStream.html">TBlockStream</a> *&#160;</td>
          <td class="paramname"><em>pStream</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype"><a class="el" href="StormPort_8h.html#abb9abb9ce956f1a9e5a4081ac40e5649">ULONGLONG</a>&#160;</td>
          <td class="paramname"><em>StartOffset</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype"><a class="el" href="StormPort_8h.html#abb9abb9ce956f1a9e5a4081ac40e5649">ULONGLONG</a>&#160;</td>
          <td class="paramname"><em>EndOffset</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
  </td>
  <td class="mlabels-right">
<span class="mlabels"><span class="mlabel">static</span></span>  </td>
  </tr>
</table>
</div><div class="memdoc">

<p class="definition">Definition at line <a class="el" href="FileStream_8cpp_source.html#l01242">1242</a> of file <a class="el" href="FileStream_8cpp_source.html">FileStream.cpp</a>.</p>
<div class="fragment"><div class="line"><span class="lineno"> 1246</span>{</div>
<div class="line"><span class="lineno"> 1247</span>    <a class="code hl_typedef" href="StormPort_8h.html#ac2d3fb16b5b34c1e6ab80014309020eb">LPBYTE</a> FileBitmap = (<a class="code hl_typedef" href="StormPort_8h.html#ac2d3fb16b5b34c1e6ab80014309020eb">LPBYTE</a>)pStream-&gt;<a class="code hl_variable" href="structTBlockStream.html#a1e2d4a2467ab4b43cec1bdd1a2f6d21a">FileBitmap</a>;</div>
<div class="line"><span class="lineno"> 1248</span>    <a class="code hl_typedef" href="StormPort_8h.html#a798af1e30bc65f319c1a246cecf59e39">DWORD</a> BlockIndex;</div>
<div class="line"><span class="lineno"> 1249</span>    <a class="code hl_typedef" href="StormPort_8h.html#a798af1e30bc65f319c1a246cecf59e39">DWORD</a> BlockSize = pStream-&gt;<a class="code hl_variable" href="structTBlockStream.html#a8c7180184928638b30809f7f85061fb7">BlockSize</a>;</div>
<div class="line"><span class="lineno"> 1250</span>    <a class="code hl_typedef" href="StormPort_8h.html#a798af1e30bc65f319c1a246cecf59e39">DWORD</a> ByteIndex;</div>
<div class="line"><span class="lineno"> 1251</span>    <a class="code hl_typedef" href="StormPort_8h.html#a4ae1dab0fb4b072a66584546209e7d58">BYTE</a> BitMask;</div>
<div class="line"><span class="lineno"> 1252</span> </div>
<div class="line"><span class="lineno"> 1253</span>    <span class="comment">// Sanity checks</span></div>
<div class="line"><span class="lineno"> 1254</span>    assert((StartOffset &amp; (BlockSize - 1)) == 0);</div>
<div class="line"><span class="lineno"> 1255</span>    assert(FileBitmap != NULL);</div>
<div class="line"><span class="lineno"> 1256</span> </div>
<div class="line"><span class="lineno"> 1257</span>    <span class="comment">// Calculate the index of the block</span></div>
<div class="line"><span class="lineno"> 1258</span>    BlockIndex = (<a class="code hl_typedef" href="StormPort_8h.html#a798af1e30bc65f319c1a246cecf59e39">DWORD</a>)(StartOffset / BlockSize);</div>
<div class="line"><span class="lineno"> 1259</span>    ByteIndex = (BlockIndex / 0x08);</div>
<div class="line"><span class="lineno"> 1260</span>    BitMask = (<a class="code hl_typedef" href="StormPort_8h.html#a4ae1dab0fb4b072a66584546209e7d58">BYTE</a>)(1 &lt;&lt; (BlockIndex &amp; 0x07));</div>
<div class="line"><span class="lineno"> 1261</span> </div>
<div class="line"><span class="lineno"> 1262</span>    <span class="comment">// Set all bits for the specified range</span></div>
<div class="line"><span class="lineno"> 1263</span>    <span class="keywordflow">while</span>(StartOffset &lt; EndOffset)</div>
<div class="line"><span class="lineno"> 1264</span>    {</div>
<div class="line"><span class="lineno"> 1265</span>        <span class="comment">// Set the bit</span></div>
<div class="line"><span class="lineno"> 1266</span>        FileBitmap[ByteIndex] |= BitMask;</div>
<div class="line"><span class="lineno"> 1267</span> </div>
<div class="line"><span class="lineno"> 1268</span>        <span class="comment">// Move all</span></div>
<div class="line"><span class="lineno"> 1269</span>        StartOffset += BlockSize;</div>
<div class="line"><span class="lineno"> 1270</span>        ByteIndex += (BitMask &gt;&gt; 0x07);</div>
<div class="line"><span class="lineno"> 1271</span>        BitMask = (BitMask &gt;&gt; 0x07) | (BitMask &lt;&lt; 0x01);</div>
<div class="line"><span class="lineno"> 1272</span>    }</div>
<div class="line"><span class="lineno"> 1273</span> </div>
<div class="line"><span class="lineno"> 1274</span>    <span class="comment">// Increment the bitmap update count</span></div>
<div class="line"><span class="lineno"> 1275</span>    pStream-&gt;<a class="code hl_variable" href="structTBlockStream.html#ab405154b8f27af633d8f3116cce2ac66">IsModified</a> = 1;</div>
<div class="line"><span class="lineno"> 1276</span>}</div>
</div><!-- fragment --><div class="dynheader">
Here is the caller graph for this function:</div>
<div class="dyncontent">
<div class="center"><div class="zoom"><iframe scrolling="no" frameborder="0" src="FileStream_8cpp_a4680036b442f496fde288fabbd9a2c0e_icgraph.svg" width="100%" height="600"><p><b>This browser is not able to show SVG: try Firefox, Chrome, Safari, or Opera instead.</b></p></iframe></div></div>
</div>

</div>
</div>
<a id="ad0f1ed530318d4f8cecb3dfb53e15b0a" name="ad0f1ed530318d4f8cecb3dfb53e15b0a"></a>
<h2 class="memtitle"><span class="permalink"><a href="#ad0f1ed530318d4f8cecb3dfb53e15b0a">&#9670;&#160;</a></span>GetLastError()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname"><a class="el" href="StormPort_8h.html#a798af1e30bc65f319c1a246cecf59e39">DWORD</a> GetLastError </td>
          <td>(</td>
          <td class="paramname"></td><td>)</td>
          <td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p class="definition">Definition at line <a class="el" href="FileStream_8cpp_source.html#l00044">44</a> of file <a class="el" href="FileStream_8cpp_source.html">FileStream.cpp</a>.</p>
<div class="fragment"><div class="line"><span class="lineno">   45</span>{</div>
<div class="line"><span class="lineno">   46</span>    <span class="keywordflow">return</span> <a class="code hl_variable" href="FileStream_8cpp.html#ae1b34ad1b2653fcef5fac54d2fea9943">dwLastError</a>;</div>
<div class="line"><span class="lineno">   47</span>}</div>
</div><!-- fragment --><div class="dynheader">
Here is the caller graph for this function:</div>
<div class="dyncontent">
<div class="center"><div class="zoom"><iframe scrolling="no" frameborder="0" src="FileStream_8cpp_ad0f1ed530318d4f8cecb3dfb53e15b0a_icgraph.svg" width="100%" height="600"><p><b>This browser is not able to show SVG: try Firefox, Chrome, Safari, or Opera instead.</b></p></iframe></div></div>
</div>

</div>
</div>
<a id="ab6a8ad643ebb16a4c5fe5b744195d5db" name="ab6a8ad643ebb16a4c5fe5b744195d5db"></a>
<h2 class="memtitle"><span class="permalink"><a href="#ab6a8ad643ebb16a4c5fe5b744195d5db">&#9670;&#160;</a></span>IsPartHeader()</h2>

<div class="memitem">
<div class="memproto">
<table class="mlabels">
  <tr>
  <td class="mlabels-left">
      <table class="memname">
        <tr>
          <td class="memname">static <a class="el" href="StormPort_8h.html#abb452686968e48b67397da5f97445f5b">bool</a> IsPartHeader </td>
          <td>(</td>
          <td class="paramtype"><a class="el" href="FileStream_8h.html#a6e1415da659848b71bc27051cace9452">PPART_FILE_HEADER</a>&#160;</td>
          <td class="paramname"><em>pPartHdr</em></td><td>)</td>
          <td></td>
        </tr>
      </table>
  </td>
  <td class="mlabels-right">
<span class="mlabels"><span class="mlabel">static</span></span>  </td>
  </tr>
</table>
</div><div class="memdoc">

<p class="definition">Definition at line <a class="el" href="FileStream_8cpp_source.html#l01520">1520</a> of file <a class="el" href="FileStream_8cpp_source.html">FileStream.cpp</a>.</p>
<div class="fragment"><div class="line"><span class="lineno"> 1521</span>{</div>
<div class="line"><span class="lineno"> 1522</span>    <span class="comment">// Version number must be 2</span></div>
<div class="line"><span class="lineno"> 1523</span>    <span class="keywordflow">if</span>(pPartHdr-&gt;<a class="code hl_variable" href="struct__PART__FILE__HEADER.html#a10e8c7b983a0349462fd3ca0aa5d495a">PartialVersion</a> == 2)</div>
<div class="line"><span class="lineno"> 1524</span>    {</div>
<div class="line"><span class="lineno"> 1525</span>        <span class="comment">// GameBuildNumber must be an ASCII number</span></div>
<div class="line"><span class="lineno"> 1526</span>        <span class="keywordflow">if</span>(isdigit(pPartHdr-&gt;<a class="code hl_variable" href="struct__PART__FILE__HEADER.html#ad66801f8212a8d897df401ca248b46e3">GameBuildNumber</a>[0]) &amp;&amp; isdigit(pPartHdr-&gt;<a class="code hl_variable" href="struct__PART__FILE__HEADER.html#ad66801f8212a8d897df401ca248b46e3">GameBuildNumber</a>[1]) &amp;&amp; isdigit(pPartHdr-&gt;<a class="code hl_variable" href="struct__PART__FILE__HEADER.html#ad66801f8212a8d897df401ca248b46e3">GameBuildNumber</a>[2]))</div>
<div class="line"><span class="lineno"> 1527</span>        {</div>
<div class="line"><span class="lineno"> 1528</span>            <span class="comment">// Block size must be power of 2</span></div>
<div class="line"><span class="lineno"> 1529</span>            <span class="keywordflow">if</span>((pPartHdr-&gt;<a class="code hl_variable" href="struct__PART__FILE__HEADER.html#a43a8ba79d2d5ccb8d2baf168faf4bd3d">BlockSize</a> &amp; (pPartHdr-&gt;<a class="code hl_variable" href="struct__PART__FILE__HEADER.html#a43a8ba79d2d5ccb8d2baf168faf4bd3d">BlockSize</a> - 1)) == 0)</div>
<div class="line"><span class="lineno"> 1530</span>                <span class="keywordflow">return</span> <span class="keyword">true</span>;</div>
<div class="line"><span class="lineno"> 1531</span>        }</div>
<div class="line"><span class="lineno"> 1532</span>    }</div>
<div class="line"><span class="lineno"> 1533</span> </div>
<div class="line"><span class="lineno"> 1534</span>    <span class="keywordflow">return</span> <span class="keyword">false</span>;</div>
<div class="line"><span class="lineno"> 1535</span>}</div>
<div class="ttc" id="astruct__PART__FILE__HEADER_html_a10e8c7b983a0349462fd3ca0aa5d495a"><div class="ttname"><a href="struct__PART__FILE__HEADER.html#a10e8c7b983a0349462fd3ca0aa5d495a">_PART_FILE_HEADER::PartialVersion</a></div><div class="ttdeci">DWORD PartialVersion</div><div class="ttdef"><b>Definition</b> <a href="FileStream_8h_source.html#l00091">FileStream.h:91</a></div></div>
<div class="ttc" id="astruct__PART__FILE__HEADER_html_a43a8ba79d2d5ccb8d2baf168faf4bd3d"><div class="ttname"><a href="struct__PART__FILE__HEADER.html#a43a8ba79d2d5ccb8d2baf168faf4bd3d">_PART_FILE_HEADER::BlockSize</a></div><div class="ttdeci">DWORD BlockSize</div><div class="ttdef"><b>Definition</b> <a href="FileStream_8h_source.html#l00096">FileStream.h:96</a></div></div>
<div class="ttc" id="astruct__PART__FILE__HEADER_html_ad66801f8212a8d897df401ca248b46e3"><div class="ttname"><a href="struct__PART__FILE__HEADER.html#ad66801f8212a8d897df401ca248b46e3">_PART_FILE_HEADER::GameBuildNumber</a></div><div class="ttdeci">char GameBuildNumber[0x20]</div><div class="ttdef"><b>Definition</b> <a href="FileStream_8h_source.html#l00092">FileStream.h:92</a></div></div>
</div><!-- fragment --><div class="dynheader">
Here is the caller graph for this function:</div>
<div class="dyncontent">
<div class="center"><div class="zoom"><iframe scrolling="no" frameborder="0" src="FileStream_8cpp_ab6a8ad643ebb16a4c5fe5b744195d5db_icgraph.svg" width="100%" height="600"><p><b>This browser is not able to show SVG: try Firefox, Chrome, Safari, or Opera instead.</b></p></iframe></div></div>
</div>

</div>
</div>
<a id="a5ade6a02922359f4aee05c2009bc2c82" name="a5ade6a02922359f4aee05c2009bc2c82"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a5ade6a02922359f4aee05c2009bc2c82">&#9670;&#160;</a></span>MpqeStream_BlockRead()</h2>

<div class="memitem">
<div class="memproto">
<table class="mlabels">
  <tr>
  <td class="mlabels-left">
      <table class="memname">
        <tr>
          <td class="memname">static <a class="el" href="StormPort_8h.html#abb452686968e48b67397da5f97445f5b">bool</a> MpqeStream_BlockRead </td>
          <td>(</td>
          <td class="paramtype"><a class="el" href="structTEncryptedStream.html">TEncryptedStream</a> *&#160;</td>
          <td class="paramname"><em>pStream</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype"><a class="el" href="StormPort_8h.html#abb9abb9ce956f1a9e5a4081ac40e5649">ULONGLONG</a>&#160;</td>
          <td class="paramname"><em>StartOffset</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype"><a class="el" href="StormPort_8h.html#abb9abb9ce956f1a9e5a4081ac40e5649">ULONGLONG</a>&#160;</td>
          <td class="paramname"><em>EndOffset</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype"><a class="el" href="StormPort_8h.html#ac2d3fb16b5b34c1e6ab80014309020eb">LPBYTE</a>&#160;</td>
          <td class="paramname"><em>BlockBuffer</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype"><a class="el" href="StormPort_8h.html#a798af1e30bc65f319c1a246cecf59e39">DWORD</a>&#160;</td>
          <td class="paramname"><em>BytesNeeded</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype"><a class="el" href="StormPort_8h.html#abb452686968e48b67397da5f97445f5b">bool</a>&#160;</td>
          <td class="paramname"><em>bAvailable</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
  </td>
  <td class="mlabels-right">
<span class="mlabels"><span class="mlabel">static</span></span>  </td>
  </tr>
</table>
</div><div class="memdoc">

<p class="definition">Definition at line <a class="el" href="FileStream_8cpp_source.html#l02152">2152</a> of file <a class="el" href="FileStream_8cpp_source.html">FileStream.cpp</a>.</p>
<div class="fragment"><div class="line"><span class="lineno"> 2159</span>{</div>
<div class="line"><span class="lineno"> 2160</span>    <a class="code hl_typedef" href="StormPort_8h.html#a798af1e30bc65f319c1a246cecf59e39">DWORD</a> dwBytesToRead;</div>
<div class="line"><span class="lineno"> 2161</span> </div>
<div class="line"><span class="lineno"> 2162</span>    assert((StartOffset &amp; (pStream-&gt;<a class="code hl_variable" href="structTBlockStream.html#a8c7180184928638b30809f7f85061fb7">BlockSize</a> - 1)) == 0);</div>
<div class="line"><span class="lineno"> 2163</span>    assert(StartOffset &lt; EndOffset);</div>
<div class="line"><span class="lineno"> 2164</span>    assert(bAvailable != <span class="keyword">false</span>);</div>
<div class="line"><span class="lineno"> 2165</span>    BytesNeeded = BytesNeeded;</div>
<div class="line"><span class="lineno"> 2166</span>    bAvailable = bAvailable;</div>
<div class="line"><span class="lineno"> 2167</span> </div>
<div class="line"><span class="lineno"> 2168</span>    <span class="comment">// Read the file from the stream as-is</span></div>
<div class="line"><span class="lineno"> 2169</span>    <span class="comment">// Limit the reading to number of blocks really needed</span></div>
<div class="line"><span class="lineno"> 2170</span>    dwBytesToRead = (<a class="code hl_typedef" href="StormPort_8h.html#a798af1e30bc65f319c1a246cecf59e39">DWORD</a>)(EndOffset - StartOffset);</div>
<div class="line"><span class="lineno"> 2171</span>    <span class="keywordflow">if</span>(!pStream-&gt;<a class="code hl_variable" href="structTFileStream.html#a5b6aa0a4b5d6b97770f73fbc47412da1">BaseRead</a>(pStream, &amp;StartOffset, BlockBuffer, dwBytesToRead))</div>
<div class="line"><span class="lineno"> 2172</span>        <span class="keywordflow">return</span> <span class="keyword">false</span>;</div>
<div class="line"><span class="lineno"> 2173</span> </div>
<div class="line"><span class="lineno"> 2174</span>    <span class="comment">// Decrypt the data</span></div>
<div class="line"><span class="lineno"> 2175</span>    dwBytesToRead = (dwBytesToRead + <a class="code hl_define" href="FileStream_8h.html#aa7f93c6d9b01977696433566896b8ca5">MPQE_CHUNK_SIZE</a> - 1) &amp; ~(<a class="code hl_define" href="FileStream_8h.html#aa7f93c6d9b01977696433566896b8ca5">MPQE_CHUNK_SIZE</a> - 1);</div>
<div class="line"><span class="lineno"> 2176</span>    <a class="code hl_function" href="FileStream_8cpp.html#a1a04dfdeabbbf63c5e09fcda34922e7a">DecryptFileChunk</a>((<a class="code hl_typedef" href="StormPort_8h.html#a143be739596851314f3c386bd6f752f9">LPDWORD</a>)BlockBuffer, pStream-&gt;<a class="code hl_variable" href="structTEncryptedStream.html#a25e2d16bf0195e14e11f31eb3d9f1aed">Key</a>, StartOffset, dwBytesToRead);</div>
<div class="line"><span class="lineno"> 2177</span>    <span class="keywordflow">return</span> <span class="keyword">true</span>;</div>
<div class="line"><span class="lineno"> 2178</span>}</div>
<div class="ttc" id="aFileStream_8cpp_html_a1a04dfdeabbbf63c5e09fcda34922e7a"><div class="ttname"><a href="FileStream_8cpp.html#a1a04dfdeabbbf63c5e09fcda34922e7a">DecryptFileChunk</a></div><div class="ttdeci">static void DecryptFileChunk(DWORD *MpqData, LPBYTE pbKey, ULONGLONG ByteOffset, DWORD dwLength)</div><div class="ttdef"><b>Definition</b> <a href="FileStream_8cpp_source.html#l01999">FileStream.cpp:1999</a></div></div>
<div class="ttc" id="astructTEncryptedStream_html_a25e2d16bf0195e14e11f31eb3d9f1aed"><div class="ttname"><a href="structTEncryptedStream.html#a25e2d16bf0195e14e11f31eb3d9f1aed">TEncryptedStream::Key</a></div><div class="ttdeci">BYTE Key[MPQE_CHUNK_SIZE]</div><div class="ttdef"><b>Definition</b> <a href="FileStream_8h_source.html#l00214">FileStream.h:214</a></div></div>
</div><!-- fragment --><div class="dynheader">
Here is the call graph for this function:</div>
<div class="dyncontent">
<div class="center"><iframe scrolling="no" frameborder="0" src="FileStream_8cpp_a5ade6a02922359f4aee05c2009bc2c82_cgraph.svg" width="484" height="36"><p><b>This browser is not able to show SVG: try Firefox, Chrome, Safari, or Opera instead.</b></p></iframe></div>
</div>
<div class="dynheader">
Here is the caller graph for this function:</div>
<div class="dyncontent">
<div class="center"><div class="zoom"><iframe scrolling="no" frameborder="0" src="FileStream_8cpp_a5ade6a02922359f4aee05c2009bc2c82_icgraph.svg" width="100%" height="600"><p><b>This browser is not able to show SVG: try Firefox, Chrome, Safari, or Opera instead.</b></p></iframe></div></div>
</div>

</div>
</div>
<a id="a57e39d6cd61a2d41926009c0213025b7" name="a57e39d6cd61a2d41926009c0213025b7"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a57e39d6cd61a2d41926009c0213025b7">&#9670;&#160;</a></span>MpqeStream_DetectFileKey()</h2>

<div class="memitem">
<div class="memproto">
<table class="mlabels">
  <tr>
  <td class="mlabels-left">
      <table class="memname">
        <tr>
          <td class="memname">static <a class="el" href="StormPort_8h.html#abb452686968e48b67397da5f97445f5b">bool</a> MpqeStream_DetectFileKey </td>
          <td>(</td>
          <td class="paramtype"><a class="el" href="structTEncryptedStream.html">TEncryptedStream</a> *&#160;</td>
          <td class="paramname"><em>pStream</em></td><td>)</td>
          <td></td>
        </tr>
      </table>
  </td>
  <td class="mlabels-right">
<span class="mlabels"><span class="mlabel">static</span></span>  </td>
  </tr>
</table>
</div><div class="memdoc">

<p class="definition">Definition at line <a class="el" href="FileStream_8cpp_source.html#l02112">2112</a> of file <a class="el" href="FileStream_8cpp_source.html">FileStream.cpp</a>.</p>
<div class="fragment"><div class="line"><span class="lineno"> 2113</span>{</div>
<div class="line"><span class="lineno"> 2114</span>    <a class="code hl_typedef" href="StormPort_8h.html#abb9abb9ce956f1a9e5a4081ac40e5649">ULONGLONG</a> ByteOffset = 0;</div>
<div class="line"><span class="lineno"> 2115</span>    <a class="code hl_typedef" href="StormPort_8h.html#a4ae1dab0fb4b072a66584546209e7d58">BYTE</a> EncryptedHeader[<a class="code hl_define" href="FileStream_8h.html#aa7f93c6d9b01977696433566896b8ca5">MPQE_CHUNK_SIZE</a>];</div>
<div class="line"><span class="lineno"> 2116</span>    <a class="code hl_typedef" href="StormPort_8h.html#a4ae1dab0fb4b072a66584546209e7d58">BYTE</a> FileHeader[<a class="code hl_define" href="FileStream_8h.html#aa7f93c6d9b01977696433566896b8ca5">MPQE_CHUNK_SIZE</a>];</div>
<div class="line"><span class="lineno"> 2117</span> </div>
<div class="line"><span class="lineno"> 2118</span>    <span class="comment">// Read the first file chunk</span></div>
<div class="line"><span class="lineno"> 2119</span>    <span class="keywordflow">if</span>(pStream-&gt;<a class="code hl_variable" href="structTFileStream.html#a5b6aa0a4b5d6b97770f73fbc47412da1">BaseRead</a>(pStream, &amp;ByteOffset, EncryptedHeader, <span class="keyword">sizeof</span>(EncryptedHeader)))</div>
<div class="line"><span class="lineno"> 2120</span>    {</div>
<div class="line"><span class="lineno"> 2121</span>        <span class="comment">// We just try all known keys one by one</span></div>
<div class="line"><span class="lineno"> 2122</span>        <span class="keywordflow">for</span>(<span class="keywordtype">int</span> i = 0; <a class="code hl_variable" href="FileStream_8cpp.html#aec446bcf08e7a651f948295e316b9475">AuthCodeArray</a>[i] != NULL; i++)</div>
<div class="line"><span class="lineno"> 2123</span>        {</div>
<div class="line"><span class="lineno"> 2124</span>            <span class="comment">// Prepare they decryption key from game serial number</span></div>
<div class="line"><span class="lineno"> 2125</span>            <a class="code hl_function" href="FileStream_8cpp.html#ad34e1378609413863343bd2dac0eb723">CreateKeyFromAuthCode</a>(pStream-&gt;<a class="code hl_variable" href="structTEncryptedStream.html#a25e2d16bf0195e14e11f31eb3d9f1aed">Key</a>, <a class="code hl_variable" href="FileStream_8cpp.html#aec446bcf08e7a651f948295e316b9475">AuthCodeArray</a>[i]);</div>
<div class="line"><span class="lineno"> 2126</span> </div>
<div class="line"><span class="lineno"> 2127</span>            <span class="comment">// Try to decrypt with the given key</span></div>
<div class="line"><span class="lineno"> 2128</span>            memcpy(FileHeader, EncryptedHeader, <a class="code hl_define" href="FileStream_8h.html#aa7f93c6d9b01977696433566896b8ca5">MPQE_CHUNK_SIZE</a>);</div>
<div class="line"><span class="lineno"> 2129</span>            <a class="code hl_function" href="FileStream_8cpp.html#a1a04dfdeabbbf63c5e09fcda34922e7a">DecryptFileChunk</a>((<a class="code hl_typedef" href="StormPort_8h.html#a143be739596851314f3c386bd6f752f9">LPDWORD</a>)FileHeader, pStream-&gt;<a class="code hl_variable" href="structTEncryptedStream.html#a25e2d16bf0195e14e11f31eb3d9f1aed">Key</a>, ByteOffset, <a class="code hl_define" href="FileStream_8h.html#aa7f93c6d9b01977696433566896b8ca5">MPQE_CHUNK_SIZE</a>);</div>
<div class="line"><span class="lineno"> 2130</span> </div>
<div class="line"><span class="lineno"> 2131</span>            <span class="comment">// We check the decrypted data</span></div>
<div class="line"><span class="lineno"> 2132</span>            <span class="comment">// All known encrypted MPQs have header at the begin of the file,</span></div>
<div class="line"><span class="lineno"> 2133</span>            <span class="comment">// so we check for MPQ signature there.</span></div>
<div class="line"><span class="lineno"> 2134</span>            <span class="keywordflow">if</span>(FileHeader[0] == <span class="charliteral">&#39;M&#39;</span> &amp;&amp; FileHeader[1] == <span class="charliteral">&#39;P&#39;</span> &amp;&amp; FileHeader[2] == <span class="charliteral">&#39;Q&#39;</span>)</div>
<div class="line"><span class="lineno"> 2135</span>            {</div>
<div class="line"><span class="lineno"> 2136</span>                <span class="comment">// Update the stream size</span></div>
<div class="line"><span class="lineno"> 2137</span>                pStream-&gt;<a class="code hl_variable" href="structTFileStream.html#a99bdae10f74cf57156e65bd76ba64771">StreamSize</a> = pStream-&gt;<a class="code hl_variable" href="structTFileStream.html#a3428b5a1e790560349940aa04e37e580">Base</a>.<a class="code hl_variable" href="unionTBaseProviderData.html#a60536cc70eff3072cd6c371a99bdf325">File</a>.<a class="code hl_variable" href="unionTBaseProviderData.html#ad644c7067435cf51727186729b970d55">FileSize</a>;</div>
<div class="line"><span class="lineno"> 2138</span> </div>
<div class="line"><span class="lineno"> 2139</span>                <span class="comment">// Fill the block information</span></div>
<div class="line"><span class="lineno"> 2140</span>                pStream-&gt;<a class="code hl_variable" href="structTBlockStream.html#a8c7180184928638b30809f7f85061fb7">BlockSize</a>  = <a class="code hl_define" href="FileStream_8h.html#aa7f93c6d9b01977696433566896b8ca5">MPQE_CHUNK_SIZE</a>;</div>
<div class="line"><span class="lineno"> 2141</span>                pStream-&gt;<a class="code hl_variable" href="structTBlockStream.html#a05210a0cd78477e541734ba7e3abe2b1">BlockCount</a> = (<a class="code hl_typedef" href="StormPort_8h.html#a798af1e30bc65f319c1a246cecf59e39">DWORD</a>)(pStream-&gt;<a class="code hl_variable" href="structTFileStream.html#a3428b5a1e790560349940aa04e37e580">Base</a>.<a class="code hl_variable" href="unionTBaseProviderData.html#a60536cc70eff3072cd6c371a99bdf325">File</a>.<a class="code hl_variable" href="unionTBaseProviderData.html#ad644c7067435cf51727186729b970d55">FileSize</a> + <a class="code hl_define" href="FileStream_8h.html#aa7f93c6d9b01977696433566896b8ca5">MPQE_CHUNK_SIZE</a> - 1) / <a class="code hl_define" href="FileStream_8h.html#aa7f93c6d9b01977696433566896b8ca5">MPQE_CHUNK_SIZE</a>;</div>
<div class="line"><span class="lineno"> 2142</span>                pStream-&gt;<a class="code hl_variable" href="structTBlockStream.html#a8bb8ee629c5bc59f65d01eead9b62762">IsComplete</a> = 1;</div>
<div class="line"><span class="lineno"> 2143</span>                <span class="keywordflow">return</span> <span class="keyword">true</span>;</div>
<div class="line"><span class="lineno"> 2144</span>            }</div>
<div class="line"><span class="lineno"> 2145</span>        }</div>
<div class="line"><span class="lineno"> 2146</span>    }</div>
<div class="line"><span class="lineno"> 2147</span> </div>
<div class="line"><span class="lineno"> 2148</span>    <span class="comment">// Key not found, sorry</span></div>
<div class="line"><span class="lineno"> 2149</span>    <span class="keywordflow">return</span> <span class="keyword">false</span>;</div>
<div class="line"><span class="lineno"> 2150</span>}</div>
<div class="ttc" id="aFileStream_8cpp_html_ad34e1378609413863343bd2dac0eb723"><div class="ttname"><a href="FileStream_8cpp.html#ad34e1378609413863343bd2dac0eb723">CreateKeyFromAuthCode</a></div><div class="ttdeci">static void CreateKeyFromAuthCode(LPBYTE pbKeyBuffer, const char *szAuthCode)</div><div class="ttdef"><b>Definition</b> <a href="FileStream_8cpp_source.html#l01980">FileStream.cpp:1980</a></div></div>
<div class="ttc" id="aFileStream_8cpp_html_aec446bcf08e7a651f948295e316b9475"><div class="ttname"><a href="FileStream_8cpp.html#aec446bcf08e7a651f948295e316b9475">AuthCodeArray</a></div><div class="ttdeci">static const char * AuthCodeArray[]</div><div class="ttdef"><b>Definition</b> <a href="FileStream_8cpp_source.html#l01922">FileStream.cpp:1922</a></div></div>
</div><!-- fragment --><div class="dynheader">
Here is the call graph for this function:</div>
<div class="dyncontent">
<div class="center"><iframe scrolling="no" frameborder="0" src="FileStream_8cpp_a57e39d6cd61a2d41926009c0213025b7_cgraph.svg" width="554" height="86"><p><b>This browser is not able to show SVG: try Firefox, Chrome, Safari, or Opera instead.</b></p></iframe></div>
</div>
<div class="dynheader">
Here is the caller graph for this function:</div>
<div class="dyncontent">
<div class="center"><div class="zoom"><iframe scrolling="no" frameborder="0" src="FileStream_8cpp_a57e39d6cd61a2d41926009c0213025b7_icgraph.svg" width="100%" height="600"><p><b>This browser is not able to show SVG: try Firefox, Chrome, Safari, or Opera instead.</b></p></iframe></div></div>
</div>

</div>
</div>
<a id="a2c69cb40f8c94bf20bd7c8d6918bb261" name="a2c69cb40f8c94bf20bd7c8d6918bb261"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a2c69cb40f8c94bf20bd7c8d6918bb261">&#9670;&#160;</a></span>MpqeStream_Open()</h2>

<div class="memitem">
<div class="memproto">
<table class="mlabels">
  <tr>
  <td class="mlabels-left">
      <table class="memname">
        <tr>
          <td class="memname">static <a class="el" href="structTFileStream.html">TFileStream</a> * MpqeStream_Open </td>
          <td>(</td>
          <td class="paramtype"><a class="el" href="StormLib_2src_2zlib_2zconf_8h.html#a2c212835823e3c54a8ab6d95c652660e">const</a> <a class="el" href="StormPort_8h.html#a03bdb8ce5895c7e261aadc2529637546">TCHAR</a> *&#160;</td>
          <td class="paramname"><em>szFileName</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype"><a class="el" href="StormPort_8h.html#a798af1e30bc65f319c1a246cecf59e39">DWORD</a>&#160;</td>
          <td class="paramname"><em>dwStreamFlags</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
  </td>
  <td class="mlabels-right">
<span class="mlabels"><span class="mlabel">static</span></span>  </td>
  </tr>
</table>
</div><div class="memdoc">

<p class="definition">Definition at line <a class="el" href="FileStream_8cpp_source.html#l02180">2180</a> of file <a class="el" href="FileStream_8cpp_source.html">FileStream.cpp</a>.</p>
<div class="fragment"><div class="line"><span class="lineno"> 2181</span>{</div>
<div class="line"><span class="lineno"> 2182</span>    <a class="code hl_struct" href="structTEncryptedStream.html">TEncryptedStream</a> * pStream;</div>
<div class="line"><span class="lineno"> 2183</span> </div>
<div class="line"><span class="lineno"> 2184</span>    <span class="comment">// Create new empty stream</span></div>
<div class="line"><span class="lineno"> 2185</span>    pStream = (<a class="code hl_struct" href="structTEncryptedStream.html">TEncryptedStream</a> *)<a class="code hl_function" href="FileStream_8cpp.html#aa5874b3e4d05d2f6dfa3a32d62f56bea">AllocateFileStream</a>(szFileName, <span class="keyword">sizeof</span>(<a class="code hl_struct" href="structTEncryptedStream.html">TEncryptedStream</a>), dwStreamFlags);</div>
<div class="line"><span class="lineno"> 2186</span>    <span class="keywordflow">if</span>(pStream == NULL)</div>
<div class="line"><span class="lineno"> 2187</span>        <span class="keywordflow">return</span> NULL;</div>
<div class="line"><span class="lineno"> 2188</span> </div>
<div class="line"><span class="lineno"> 2189</span>    <span class="comment">// Attempt to open the base stream</span></div>
<div class="line"><span class="lineno"> 2190</span>    assert(pStream-&gt;<a class="code hl_variable" href="structTFileStream.html#a82013f6bc9d5e52d1efe42b0dc464d4c">BaseOpen</a> != NULL);</div>
<div class="line"><span class="lineno"> 2191</span>    <span class="keywordflow">if</span>(!pStream-&gt;<a class="code hl_variable" href="structTFileStream.html#a82013f6bc9d5e52d1efe42b0dc464d4c">BaseOpen</a>(pStream, pStream-&gt;<a class="code hl_variable" href="structTFileStream.html#a7a4da926d708d96cb47333973e705c76">szFileName</a>, dwStreamFlags))</div>
<div class="line"><span class="lineno"> 2192</span>        <span class="keywordflow">return</span> NULL;</div>
<div class="line"><span class="lineno"> 2193</span> </div>
<div class="line"><span class="lineno"> 2194</span>    <span class="comment">// Determine the encryption key for the MPQ</span></div>
<div class="line"><span class="lineno"> 2195</span>    <span class="keywordflow">if</span>(<a class="code hl_function" href="FileStream_8cpp.html#a57e39d6cd61a2d41926009c0213025b7">MpqeStream_DetectFileKey</a>(pStream))</div>
<div class="line"><span class="lineno"> 2196</span>    {</div>
<div class="line"><span class="lineno"> 2197</span>        <span class="comment">// Set the stream position and size</span></div>
<div class="line"><span class="lineno"> 2198</span>        assert(pStream-&gt;<a class="code hl_variable" href="structTFileStream.html#a99bdae10f74cf57156e65bd76ba64771">StreamSize</a> != 0);</div>
<div class="line"><span class="lineno"> 2199</span>        pStream-&gt;<a class="code hl_variable" href="structTFileStream.html#a84324f2f19bfc3fcbc563ef2391f84fe">StreamPos</a> = 0;</div>
<div class="line"><span class="lineno"> 2200</span>        pStream-&gt;<a class="code hl_variable" href="structTFileStream.html#ae61935eec67ce99ea4091bc0949de1ea">dwFlags</a> |= <a class="code hl_define" href="StormLib_8h.html#abdbbf06488f24699775afe6aadaeafc3">STREAM_FLAG_READ_ONLY</a>;</div>
<div class="line"><span class="lineno"> 2201</span> </div>
<div class="line"><span class="lineno"> 2202</span>        <span class="comment">// Set new function pointers</span></div>
<div class="line"><span class="lineno"> 2203</span>        pStream-&gt;<a class="code hl_variable" href="structTFileStream.html#aaf7da0af26da32b968cdb66eb87f26ce">StreamRead</a>    = (<a class="code hl_typedef" href="FileStream_8h.html#a606a64221d9b9881a1f52bce34bbbf02">STREAM_READ</a>)<a class="code hl_function" href="FileStream_8cpp.html#a6aad894479c9e1b2cba754f7f3260747">BlockStream_Read</a>;</div>
<div class="line"><span class="lineno"> 2204</span>        pStream-&gt;<a class="code hl_variable" href="structTFileStream.html#a158f1621a05e8b3002c1729fd5d4cfca">StreamGetPos</a>  = <a class="code hl_function" href="FileStream_8cpp.html#a298aac8ccf15fff07223077eedbf2db7">BlockStream_GetPos</a>;</div>
<div class="line"><span class="lineno"> 2205</span>        pStream-&gt;<a class="code hl_variable" href="structTFileStream.html#a95b85c4ef3254dc6a73fdb2e566ebbba">StreamGetSize</a> = <a class="code hl_function" href="FileStream_8cpp.html#a3e8398bb76df8b526932fe0c4623cef9">BlockStream_GetSize</a>;</div>
<div class="line"><span class="lineno"> 2206</span>        pStream-&gt;<a class="code hl_variable" href="structTFileStream.html#ac3f8968d1ae374c58ab50404221834e4">StreamClose</a>   = pStream-&gt;<a class="code hl_variable" href="structTFileStream.html#acbdc7dfef3127e4c077310381f8f6c7d">BaseClose</a>;</div>
<div class="line"><span class="lineno"> 2207</span> </div>
<div class="line"><span class="lineno"> 2208</span>        <span class="comment">// Supply the block functions</span></div>
<div class="line"><span class="lineno"> 2209</span>        pStream-&gt;<a class="code hl_variable" href="structTFileStream.html#a68391daa44e09cd7654e765d81d937a3">BlockRead</a>     = (<a class="code hl_typedef" href="FileStream_8h.html#ad07760b526786fe7097b34605659f3dc">BLOCK_READ</a>)<a class="code hl_function" href="FileStream_8cpp.html#a5ade6a02922359f4aee05c2009bc2c82">MpqeStream_BlockRead</a>;</div>
<div class="line"><span class="lineno"> 2210</span>        <span class="keywordflow">return</span> pStream;</div>
<div class="line"><span class="lineno"> 2211</span>    }</div>
<div class="line"><span class="lineno"> 2212</span> </div>
<div class="line"><span class="lineno"> 2213</span>    <span class="comment">// Cleanup the stream and return</span></div>
<div class="line"><span class="lineno"> 2214</span>    <a class="code hl_function" href="FileStream_8cpp.html#ae8b75c4797726e9c5ee0b4b03bf31442">FileStream_Close</a>(pStream);</div>
<div class="line"><span class="lineno"> 2215</span>    <a class="code hl_function" href="FileStream_8cpp.html#a65dd8d3e416ffbd6ac5f468c6bdccac9">SetLastError</a>(<a class="code hl_define" href="StormLib_8h.html#aa2030502390a47def8b04f44cb34d3f9">ERROR_UNKNOWN_FILE_KEY</a>);</div>
<div class="line"><span class="lineno"> 2216</span>    <span class="keywordflow">return</span> NULL;</div>
<div class="line"><span class="lineno"> 2217</span>}</div>
<div class="ttc" id="aFileStream_8cpp_html_a57e39d6cd61a2d41926009c0213025b7"><div class="ttname"><a href="FileStream_8cpp.html#a57e39d6cd61a2d41926009c0213025b7">MpqeStream_DetectFileKey</a></div><div class="ttdeci">static bool MpqeStream_DetectFileKey(TEncryptedStream *pStream)</div><div class="ttdef"><b>Definition</b> <a href="FileStream_8cpp_source.html#l02112">FileStream.cpp:2112</a></div></div>
<div class="ttc" id="aFileStream_8cpp_html_a5ade6a02922359f4aee05c2009bc2c82"><div class="ttname"><a href="FileStream_8cpp.html#a5ade6a02922359f4aee05c2009bc2c82">MpqeStream_BlockRead</a></div><div class="ttdeci">static bool MpqeStream_BlockRead(TEncryptedStream *pStream, ULONGLONG StartOffset, ULONGLONG EndOffset, LPBYTE BlockBuffer, DWORD BytesNeeded, bool bAvailable)</div><div class="ttdef"><b>Definition</b> <a href="FileStream_8cpp_source.html#l02152">FileStream.cpp:2152</a></div></div>
<div class="ttc" id="aStormLib_8h_html_aa2030502390a47def8b04f44cb34d3f9"><div class="ttname"><a href="StormLib_8h.html#aa2030502390a47def8b04f44cb34d3f9">ERROR_UNKNOWN_FILE_KEY</a></div><div class="ttdeci">#define ERROR_UNKNOWN_FILE_KEY</div><div class="ttdef"><b>Definition</b> <a href="StormLib_8h_source.html#l00154">StormLib.h:154</a></div></div>
<div class="ttc" id="astructTEncryptedStream_html"><div class="ttname"><a href="structTEncryptedStream.html">TEncryptedStream</a></div><div class="ttdef"><b>Definition</b> <a href="FileStream_8h_source.html#l00212">FileStream.h:213</a></div></div>
</div><!-- fragment --><div class="dynheader">
Here is the call graph for this function:</div>
<div class="dyncontent">
<div class="center"><div class="zoom"><iframe scrolling="no" frameborder="0" src="FileStream_8cpp_a2c69cb40f8c94bf20bd7c8d6918bb261_cgraph.svg" width="100%" height="600"><p><b>This browser is not able to show SVG: try Firefox, Chrome, Safari, or Opera instead.</b></p></iframe></div></div>
</div>
<div class="dynheader">
Here is the caller graph for this function:</div>
<div class="dyncontent">
<div class="center"><div class="zoom"><iframe scrolling="no" frameborder="0" src="FileStream_8cpp_a2c69cb40f8c94bf20bd7c8d6918bb261_icgraph.svg" width="100%" height="600"><p><b>This browser is not able to show SVG: try Firefox, Chrome, Safari, or Opera instead.</b></p></iframe></div></div>
</div>

</div>
</div>
<a id="aa248b7a4855fbd7cb0e0451eb7afdf96" name="aa248b7a4855fbd7cb0e0451eb7afdf96"></a>
<h2 class="memtitle"><span class="permalink"><a href="#aa248b7a4855fbd7cb0e0451eb7afdf96">&#9670;&#160;</a></span>PartStream_BlockCheck()</h2>

<div class="memitem">
<div class="memproto">
<table class="mlabels">
  <tr>
  <td class="mlabels-left">
      <table class="memname">
        <tr>
          <td class="memname">static <a class="el" href="StormPort_8h.html#abb452686968e48b67397da5f97445f5b">bool</a> PartStream_BlockCheck </td>
          <td>(</td>
          <td class="paramtype"><a class="el" href="structTBlockStream.html">TBlockStream</a> *&#160;</td>
          <td class="paramname"><em>pStream</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype"><a class="el" href="StormPort_8h.html#abb9abb9ce956f1a9e5a4081ac40e5649">ULONGLONG</a>&#160;</td>
          <td class="paramname"><em>BlockOffset</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
  </td>
  <td class="mlabels-right">
<span class="mlabels"><span class="mlabel">static</span></span>  </td>
  </tr>
</table>
</div><div class="memdoc">

<p class="definition">Definition at line <a class="el" href="FileStream_8cpp_source.html#l01660">1660</a> of file <a class="el" href="FileStream_8cpp_source.html">FileStream.cpp</a>.</p>
<div class="fragment"><div class="line"><span class="lineno"> 1663</span>{</div>
<div class="line"><span class="lineno"> 1664</span>    <a class="code hl_struct" href="struct__PART__FILE__MAP__ENTRY.html">PPART_FILE_MAP_ENTRY</a> FileBitmap;</div>
<div class="line"><span class="lineno"> 1665</span> </div>
<div class="line"><span class="lineno"> 1666</span>    <span class="comment">// Sanity checks</span></div>
<div class="line"><span class="lineno"> 1667</span>    assert((BlockOffset &amp; (pStream-&gt;<a class="code hl_variable" href="structTBlockStream.html#a8c7180184928638b30809f7f85061fb7">BlockSize</a> - 1)) == 0);</div>
<div class="line"><span class="lineno"> 1668</span>    assert(pStream-&gt;<a class="code hl_variable" href="structTBlockStream.html#a1e2d4a2467ab4b43cec1bdd1a2f6d21a">FileBitmap</a> != NULL);</div>
<div class="line"><span class="lineno"> 1669</span> </div>
<div class="line"><span class="lineno"> 1670</span>    <span class="comment">// Calculate the block map entry</span></div>
<div class="line"><span class="lineno"> 1671</span>    FileBitmap = (<a class="code hl_typedef" href="FileStream_8h.html#a9d177641cfa38af6f1cb6c09ed836760">PPART_FILE_MAP_ENTRY</a>)pStream-&gt;<a class="code hl_variable" href="structTBlockStream.html#a1e2d4a2467ab4b43cec1bdd1a2f6d21a">FileBitmap</a> + (BlockOffset / pStream-&gt;<a class="code hl_variable" href="structTBlockStream.html#a8c7180184928638b30809f7f85061fb7">BlockSize</a>);</div>
<div class="line"><span class="lineno"> 1672</span> </div>
<div class="line"><span class="lineno"> 1673</span>    <span class="comment">// Check if the flags are present</span></div>
<div class="line"><span class="lineno"> 1674</span>    <span class="keywordflow">return</span> (FileBitmap-&gt;<a class="code hl_variable" href="struct__PART__FILE__MAP__ENTRY.html#abd1801ee4295f9608122a2fc81876354">Flags</a> &amp; 0x03) ? <a class="code hl_define" href="StormPort_8h.html#a41f9c5fb8b08eb5dc3edce4dcb37fee7">true</a> : <span class="keyword">false</span>;</div>
<div class="line"><span class="lineno"> 1675</span>}</div>
<div class="ttc" id="aFileStream_8h_html_a9d177641cfa38af6f1cb6c09ed836760"><div class="ttname"><a href="FileStream_8h.html#a9d177641cfa38af6f1cb6c09ed836760">PPART_FILE_MAP_ENTRY</a></div><div class="ttdeci">struct _PART_FILE_MAP_ENTRY * PPART_FILE_MAP_ENTRY</div></div>
<div class="ttc" id="astruct__PART__FILE__MAP__ENTRY_html"><div class="ttname"><a href="struct__PART__FILE__MAP__ENTRY.html">_PART_FILE_MAP_ENTRY</a></div><div class="ttdef"><b>Definition</b> <a href="FileStream_8h_source.html#l00101">FileStream.h:102</a></div></div>
<div class="ttc" id="astruct__PART__FILE__MAP__ENTRY_html_abd1801ee4295f9608122a2fc81876354"><div class="ttname"><a href="struct__PART__FILE__MAP__ENTRY.html#abd1801ee4295f9608122a2fc81876354">_PART_FILE_MAP_ENTRY::Flags</a></div><div class="ttdeci">DWORD Flags</div><div class="ttdef"><b>Definition</b> <a href="FileStream_8h_source.html#l00103">FileStream.h:103</a></div></div>
</div><!-- fragment --><div class="dynheader">
Here is the caller graph for this function:</div>
<div class="dyncontent">
<div class="center"><div class="zoom"><iframe scrolling="no" frameborder="0" src="FileStream_8cpp_aa248b7a4855fbd7cb0e0451eb7afdf96_icgraph.svg" width="100%" height="600"><p><b>This browser is not able to show SVG: try Firefox, Chrome, Safari, or Opera instead.</b></p></iframe></div></div>
</div>

</div>
</div>
<a id="a2791646c1575f1cec2fbd508772ad641" name="a2791646c1575f1cec2fbd508772ad641"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a2791646c1575f1cec2fbd508772ad641">&#9670;&#160;</a></span>PartStream_BlockRead()</h2>

<div class="memitem">
<div class="memproto">
<table class="mlabels">
  <tr>
  <td class="mlabels-left">
      <table class="memname">
        <tr>
          <td class="memname">static <a class="el" href="StormPort_8h.html#abb452686968e48b67397da5f97445f5b">bool</a> PartStream_BlockRead </td>
          <td>(</td>
          <td class="paramtype"><a class="el" href="structTBlockStream.html">TBlockStream</a> *&#160;</td>
          <td class="paramname"><em>pStream</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype"><a class="el" href="StormPort_8h.html#abb9abb9ce956f1a9e5a4081ac40e5649">ULONGLONG</a>&#160;</td>
          <td class="paramname"><em>StartOffset</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype"><a class="el" href="StormPort_8h.html#abb9abb9ce956f1a9e5a4081ac40e5649">ULONGLONG</a>&#160;</td>
          <td class="paramname"><em>EndOffset</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype"><a class="el" href="StormPort_8h.html#ac2d3fb16b5b34c1e6ab80014309020eb">LPBYTE</a>&#160;</td>
          <td class="paramname"><em>BlockBuffer</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype"><a class="el" href="StormPort_8h.html#a798af1e30bc65f319c1a246cecf59e39">DWORD</a>&#160;</td>
          <td class="paramname"><em>BytesNeeded</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype"><a class="el" href="StormPort_8h.html#abb452686968e48b67397da5f97445f5b">bool</a>&#160;</td>
          <td class="paramname"><em>bAvailable</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
  </td>
  <td class="mlabels-right">
<span class="mlabels"><span class="mlabel">static</span></span>  </td>
  </tr>
</table>
</div><div class="memdoc">

<p class="definition">Definition at line <a class="el" href="FileStream_8cpp_source.html#l01677">1677</a> of file <a class="el" href="FileStream_8cpp_source.html">FileStream.cpp</a>.</p>
<div class="fragment"><div class="line"><span class="lineno"> 1684</span>{</div>
<div class="line"><span class="lineno"> 1685</span>    <a class="code hl_struct" href="struct__PART__FILE__MAP__ENTRY.html">PPART_FILE_MAP_ENTRY</a> FileBitmap;</div>
<div class="line"><span class="lineno"> 1686</span>    <a class="code hl_typedef" href="StormPort_8h.html#abb9abb9ce956f1a9e5a4081ac40e5649">ULONGLONG</a> ByteOffset;</div>
<div class="line"><span class="lineno"> 1687</span>    <a class="code hl_typedef" href="StormPort_8h.html#a798af1e30bc65f319c1a246cecf59e39">DWORD</a> BytesToRead;</div>
<div class="line"><span class="lineno"> 1688</span>    <a class="code hl_typedef" href="StormPort_8h.html#a798af1e30bc65f319c1a246cecf59e39">DWORD</a> BlockIndex = (<a class="code hl_typedef" href="StormPort_8h.html#a798af1e30bc65f319c1a246cecf59e39">DWORD</a>)(StartOffset / pStream-&gt;<a class="code hl_variable" href="structTBlockStream.html#a8c7180184928638b30809f7f85061fb7">BlockSize</a>);</div>
<div class="line"><span class="lineno"> 1689</span> </div>
<div class="line"><span class="lineno"> 1690</span>    <span class="comment">// The starting offset must be aligned to size of the block</span></div>
<div class="line"><span class="lineno"> 1691</span>    assert(pStream-&gt;<a class="code hl_variable" href="structTBlockStream.html#a1e2d4a2467ab4b43cec1bdd1a2f6d21a">FileBitmap</a> != NULL);</div>
<div class="line"><span class="lineno"> 1692</span>    assert((StartOffset &amp; (pStream-&gt;<a class="code hl_variable" href="structTBlockStream.html#a8c7180184928638b30809f7f85061fb7">BlockSize</a> - 1)) == 0);</div>
<div class="line"><span class="lineno"> 1693</span>    assert(StartOffset &lt; EndOffset);</div>
<div class="line"><span class="lineno"> 1694</span> </div>
<div class="line"><span class="lineno"> 1695</span>    <span class="comment">// If the blocks are not available, we need to load them from the master</span></div>
<div class="line"><span class="lineno"> 1696</span>    <span class="comment">// and then save to the mirror</span></div>
<div class="line"><span class="lineno"> 1697</span>    <span class="keywordflow">if</span>(bAvailable == <span class="keyword">false</span>)</div>
<div class="line"><span class="lineno"> 1698</span>    {</div>
<div class="line"><span class="lineno"> 1699</span>        <span class="comment">// If we have no master, we cannot satisfy read request</span></div>
<div class="line"><span class="lineno"> 1700</span>        <span class="keywordflow">if</span>(pStream-&gt;<a class="code hl_variable" href="structTFileStream.html#a26faae83ba546119ac59fc35eaeec274">pMaster</a> == NULL)</div>
<div class="line"><span class="lineno"> 1701</span>            <span class="keywordflow">return</span> <span class="keyword">false</span>;</div>
<div class="line"><span class="lineno"> 1702</span> </div>
<div class="line"><span class="lineno"> 1703</span>        <span class="comment">// Load the blocks from the master stream</span></div>
<div class="line"><span class="lineno"> 1704</span>        <span class="comment">// Note that we always have to read complete blocks</span></div>
<div class="line"><span class="lineno"> 1705</span>        <span class="comment">// so they get properly stored to the mirror stream</span></div>
<div class="line"><span class="lineno"> 1706</span>        BytesToRead = (<a class="code hl_typedef" href="StormPort_8h.html#a798af1e30bc65f319c1a246cecf59e39">DWORD</a>)(EndOffset - StartOffset);</div>
<div class="line"><span class="lineno"> 1707</span>        <span class="keywordflow">if</span>(!<a class="code hl_function" href="FileStream_8cpp.html#a593f3b1416f7497c28fa5552cd1b3003">FileStream_Read</a>(pStream-&gt;<a class="code hl_variable" href="structTFileStream.html#a26faae83ba546119ac59fc35eaeec274">pMaster</a>, &amp;StartOffset, BlockBuffer, BytesToRead))</div>
<div class="line"><span class="lineno"> 1708</span>            <span class="keywordflow">return</span> <span class="keyword">false</span>;</div>
<div class="line"><span class="lineno"> 1709</span> </div>
<div class="line"><span class="lineno"> 1710</span>        <span class="comment">// The loaded blocks are going to be stored to the end of the file</span></div>
<div class="line"><span class="lineno"> 1711</span>        <span class="comment">// Note that this operation is not required to succeed</span></div>
<div class="line"><span class="lineno"> 1712</span>        <span class="keywordflow">if</span>(pStream-&gt;<a class="code hl_variable" href="structTFileStream.html#a0366f518ffecab4131bf2527f22964e3">BaseGetSize</a>(pStream, &amp;ByteOffset))</div>
<div class="line"><span class="lineno"> 1713</span>        {</div>
<div class="line"><span class="lineno"> 1714</span>            <span class="comment">// Store the loaded blocks to the mirror file.</span></div>
<div class="line"><span class="lineno"> 1715</span>            <span class="keywordflow">if</span>(pStream-&gt;<a class="code hl_variable" href="structTFileStream.html#a811c9b3d565324e51361768847fe50a8">BaseWrite</a>(pStream, &amp;ByteOffset, BlockBuffer, BytesToRead))</div>
<div class="line"><span class="lineno"> 1716</span>            {</div>
<div class="line"><span class="lineno"> 1717</span>                <a class="code hl_function" href="FileStream_8cpp.html#a162a6e284e6e7c5c8577e0b98fe76ad3">PartStream_UpdateBitmap</a>(pStream, StartOffset, EndOffset, ByteOffset);</div>
<div class="line"><span class="lineno"> 1718</span>            }</div>
<div class="line"><span class="lineno"> 1719</span>        }</div>
<div class="line"><span class="lineno"> 1720</span>    }</div>
<div class="line"><span class="lineno"> 1721</span>    <span class="keywordflow">else</span></div>
<div class="line"><span class="lineno"> 1722</span>    {</div>
<div class="line"><span class="lineno"> 1723</span>        <span class="comment">// Get the file map entry</span></div>
<div class="line"><span class="lineno"> 1724</span>        FileBitmap = (<a class="code hl_typedef" href="FileStream_8h.html#a9d177641cfa38af6f1cb6c09ed836760">PPART_FILE_MAP_ENTRY</a>)pStream-&gt;<a class="code hl_variable" href="structTBlockStream.html#a1e2d4a2467ab4b43cec1bdd1a2f6d21a">FileBitmap</a> + BlockIndex;</div>
<div class="line"><span class="lineno"> 1725</span> </div>
<div class="line"><span class="lineno"> 1726</span>        <span class="comment">// Read all blocks</span></div>
<div class="line"><span class="lineno"> 1727</span>        <span class="keywordflow">while</span>(StartOffset &lt; EndOffset)</div>
<div class="line"><span class="lineno"> 1728</span>        {</div>
<div class="line"><span class="lineno"> 1729</span>            <span class="comment">// Get the number of bytes to be read</span></div>
<div class="line"><span class="lineno"> 1730</span>            BytesToRead = (<a class="code hl_typedef" href="StormPort_8h.html#a798af1e30bc65f319c1a246cecf59e39">DWORD</a>)(EndOffset - StartOffset);</div>
<div class="line"><span class="lineno"> 1731</span>            <span class="keywordflow">if</span>(BytesToRead &gt; pStream-&gt;<a class="code hl_variable" href="structTBlockStream.html#a8c7180184928638b30809f7f85061fb7">BlockSize</a>)</div>
<div class="line"><span class="lineno"> 1732</span>                BytesToRead = pStream-&gt;<a class="code hl_variable" href="structTBlockStream.html#a8c7180184928638b30809f7f85061fb7">BlockSize</a>;</div>
<div class="line"><span class="lineno"> 1733</span>            <span class="keywordflow">if</span>(BytesToRead &gt; BytesNeeded)</div>
<div class="line"><span class="lineno"> 1734</span>                BytesToRead = BytesNeeded;</div>
<div class="line"><span class="lineno"> 1735</span> </div>
<div class="line"><span class="lineno"> 1736</span>            <span class="comment">// Read the block</span></div>
<div class="line"><span class="lineno"> 1737</span>            ByteOffset = <a class="code hl_define" href="StormCommon_8h.html#ac67482b4d06c66c34ad0dc9686c12fd4">MAKE_OFFSET64</a>(FileBitmap-&gt;<a class="code hl_variable" href="struct__PART__FILE__MAP__ENTRY.html#a4d655b24011047e42086f249ecae7301">BlockOffsHi</a>, FileBitmap-&gt;<a class="code hl_variable" href="struct__PART__FILE__MAP__ENTRY.html#aa6b4281b7f137d2bea41d1225b3da146">BlockOffsLo</a>);</div>
<div class="line"><span class="lineno"> 1738</span>            <span class="keywordflow">if</span>(!pStream-&gt;<a class="code hl_variable" href="structTFileStream.html#a5b6aa0a4b5d6b97770f73fbc47412da1">BaseRead</a>(pStream, &amp;ByteOffset, BlockBuffer, BytesToRead))</div>
<div class="line"><span class="lineno"> 1739</span>                <span class="keywordflow">return</span> <span class="keyword">false</span>;</div>
<div class="line"><span class="lineno"> 1740</span> </div>
<div class="line"><span class="lineno"> 1741</span>            <span class="comment">// Move the pointers</span></div>
<div class="line"><span class="lineno"> 1742</span>            StartOffset += pStream-&gt;<a class="code hl_variable" href="structTBlockStream.html#a8c7180184928638b30809f7f85061fb7">BlockSize</a>;</div>
<div class="line"><span class="lineno"> 1743</span>            BlockBuffer += pStream-&gt;<a class="code hl_variable" href="structTBlockStream.html#a8c7180184928638b30809f7f85061fb7">BlockSize</a>;</div>
<div class="line"><span class="lineno"> 1744</span>            BytesNeeded -= pStream-&gt;<a class="code hl_variable" href="structTBlockStream.html#a8c7180184928638b30809f7f85061fb7">BlockSize</a>;</div>
<div class="line"><span class="lineno"> 1745</span>            FileBitmap++;</div>
<div class="line"><span class="lineno"> 1746</span>        }</div>
<div class="line"><span class="lineno"> 1747</span>    }</div>
<div class="line"><span class="lineno"> 1748</span> </div>
<div class="line"><span class="lineno"> 1749</span>    <span class="keywordflow">return</span> <span class="keyword">true</span>;</div>
<div class="line"><span class="lineno"> 1750</span>}</div>
<div class="ttc" id="aFileStream_8cpp_html_a162a6e284e6e7c5c8577e0b98fe76ad3"><div class="ttname"><a href="FileStream_8cpp.html#a162a6e284e6e7c5c8577e0b98fe76ad3">PartStream_UpdateBitmap</a></div><div class="ttdeci">static void PartStream_UpdateBitmap(TBlockStream *pStream, ULONGLONG StartOffset, ULONGLONG EndOffset, ULONGLONG RealOffset)</div><div class="ttdef"><b>Definition</b> <a href="FileStream_8cpp_source.html#l01626">FileStream.cpp:1626</a></div></div>
<div class="ttc" id="astruct__PART__FILE__MAP__ENTRY_html_a4d655b24011047e42086f249ecae7301"><div class="ttname"><a href="struct__PART__FILE__MAP__ENTRY.html#a4d655b24011047e42086f249ecae7301">_PART_FILE_MAP_ENTRY::BlockOffsHi</a></div><div class="ttdeci">DWORD BlockOffsHi</div><div class="ttdef"><b>Definition</b> <a href="FileStream_8h_source.html#l00105">FileStream.h:105</a></div></div>
<div class="ttc" id="astruct__PART__FILE__MAP__ENTRY_html_aa6b4281b7f137d2bea41d1225b3da146"><div class="ttname"><a href="struct__PART__FILE__MAP__ENTRY.html#aa6b4281b7f137d2bea41d1225b3da146">_PART_FILE_MAP_ENTRY::BlockOffsLo</a></div><div class="ttdeci">DWORD BlockOffsLo</div><div class="ttdef"><b>Definition</b> <a href="FileStream_8h_source.html#l00104">FileStream.h:104</a></div></div>
</div><!-- fragment --><div class="dynheader">
Here is the call graph for this function:</div>
<div class="dyncontent">
<div class="center"><iframe scrolling="no" frameborder="0" src="FileStream_8cpp_a2791646c1575f1cec2fbd508772ad641_cgraph.svg" width="424" height="86"><p><b>This browser is not able to show SVG: try Firefox, Chrome, Safari, or Opera instead.</b></p></iframe></div>
</div>
<div class="dynheader">
Here is the caller graph for this function:</div>
<div class="dyncontent">
<div class="center"><div class="zoom"><iframe scrolling="no" frameborder="0" src="FileStream_8cpp_a2791646c1575f1cec2fbd508772ad641_icgraph.svg" width="100%" height="600"><p><b>This browser is not able to show SVG: try Firefox, Chrome, Safari, or Opera instead.</b></p></iframe></div></div>
</div>

</div>
</div>
<a id="aaffd3fca4e0a45595bc2f73e6bea76f3" name="aaffd3fca4e0a45595bc2f73e6bea76f3"></a>
<h2 class="memtitle"><span class="permalink"><a href="#aaffd3fca4e0a45595bc2f73e6bea76f3">&#9670;&#160;</a></span>PartStream_CheckFile()</h2>

<div class="memitem">
<div class="memproto">
<table class="mlabels">
  <tr>
  <td class="mlabels-left">
      <table class="memname">
        <tr>
          <td class="memname">static <a class="el" href="StormPort_8h.html#a798af1e30bc65f319c1a246cecf59e39">DWORD</a> PartStream_CheckFile </td>
          <td>(</td>
          <td class="paramtype"><a class="el" href="structTBlockStream.html">TBlockStream</a> *&#160;</td>
          <td class="paramname"><em>pStream</em></td><td>)</td>
          <td></td>
        </tr>
      </table>
  </td>
  <td class="mlabels-right">
<span class="mlabels"><span class="mlabel">static</span></span>  </td>
  </tr>
</table>
</div><div class="memdoc">

<p class="definition">Definition at line <a class="el" href="FileStream_8cpp_source.html#l01537">1537</a> of file <a class="el" href="FileStream_8cpp_source.html">FileStream.cpp</a>.</p>
<div class="fragment"><div class="line"><span class="lineno"> 1538</span>{</div>
<div class="line"><span class="lineno"> 1539</span>    <a class="code hl_struct" href="struct__PART__FILE__MAP__ENTRY.html">PPART_FILE_MAP_ENTRY</a> FileBitmap = (<a class="code hl_typedef" href="FileStream_8h.html#a9d177641cfa38af6f1cb6c09ed836760">PPART_FILE_MAP_ENTRY</a>)pStream-&gt;<a class="code hl_variable" href="structTBlockStream.html#a1e2d4a2467ab4b43cec1bdd1a2f6d21a">FileBitmap</a>;</div>
<div class="line"><span class="lineno"> 1540</span>    <a class="code hl_typedef" href="StormPort_8h.html#a798af1e30bc65f319c1a246cecf59e39">DWORD</a> dwBlockCount;</div>
<div class="line"><span class="lineno"> 1541</span> </div>
<div class="line"><span class="lineno"> 1542</span>    <span class="comment">// Get the number of blocks</span></div>
<div class="line"><span class="lineno"> 1543</span>    dwBlockCount = (<a class="code hl_typedef" href="StormPort_8h.html#a798af1e30bc65f319c1a246cecf59e39">DWORD</a>)((pStream-&gt;<a class="code hl_variable" href="structTFileStream.html#a99bdae10f74cf57156e65bd76ba64771">StreamSize</a> + pStream-&gt;<a class="code hl_variable" href="structTBlockStream.html#a8c7180184928638b30809f7f85061fb7">BlockSize</a> - 1) / pStream-&gt;<a class="code hl_variable" href="structTBlockStream.html#a8c7180184928638b30809f7f85061fb7">BlockSize</a>);</div>
<div class="line"><span class="lineno"> 1544</span> </div>
<div class="line"><span class="lineno"> 1545</span>    <span class="comment">// Check all blocks</span></div>
<div class="line"><span class="lineno"> 1546</span>    <span class="keywordflow">for</span>(<a class="code hl_typedef" href="StormPort_8h.html#a798af1e30bc65f319c1a246cecf59e39">DWORD</a> i = 0; i &lt; dwBlockCount; i++, FileBitmap++)</div>
<div class="line"><span class="lineno"> 1547</span>    {</div>
<div class="line"><span class="lineno"> 1548</span>        <span class="comment">// Few sanity checks</span></div>
<div class="line"><span class="lineno"> 1549</span>        assert(FileBitmap-&gt;LargeValueHi == 0);</div>
<div class="line"><span class="lineno"> 1550</span>        assert(FileBitmap-&gt;LargeValueLo == 0);</div>
<div class="line"><span class="lineno"> 1551</span>        assert(FileBitmap-&gt;Flags == 0 || FileBitmap-&gt;Flags == 3);</div>
<div class="line"><span class="lineno"> 1552</span> </div>
<div class="line"><span class="lineno"> 1553</span>        <span class="comment">// Check if this block is present</span></div>
<div class="line"><span class="lineno"> 1554</span>        <span class="keywordflow">if</span>(FileBitmap-&gt;Flags != 3)</div>
<div class="line"><span class="lineno"> 1555</span>            <span class="keywordflow">return</span> 0;</div>
<div class="line"><span class="lineno"> 1556</span>    }</div>
<div class="line"><span class="lineno"> 1557</span> </div>
<div class="line"><span class="lineno"> 1558</span>    <span class="comment">// Yes, the file is complete</span></div>
<div class="line"><span class="lineno"> 1559</span>    <span class="keywordflow">return</span> 1;</div>
<div class="line"><span class="lineno"> 1560</span>}</div>
</div><!-- fragment --><div class="dynheader">
Here is the caller graph for this function:</div>
<div class="dyncontent">
<div class="center"><div class="zoom"><iframe scrolling="no" frameborder="0" src="FileStream_8cpp_aaffd3fca4e0a45595bc2f73e6bea76f3_icgraph.svg" width="100%" height="600"><p><b>This browser is not able to show SVG: try Firefox, Chrome, Safari, or Opera instead.</b></p></iframe></div></div>
</div>

</div>
</div>
<a id="a44ffcada567ee94f23e575dfe83e9c64" name="a44ffcada567ee94f23e575dfe83e9c64"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a44ffcada567ee94f23e575dfe83e9c64">&#9670;&#160;</a></span>PartStream_Close()</h2>

<div class="memitem">
<div class="memproto">
<table class="mlabels">
  <tr>
  <td class="mlabels-left">
      <table class="memname">
        <tr>
          <td class="memname">static void PartStream_Close </td>
          <td>(</td>
          <td class="paramtype"><a class="el" href="structTBlockStream.html">TBlockStream</a> *&#160;</td>
          <td class="paramname"><em>pStream</em></td><td>)</td>
          <td></td>
        </tr>
      </table>
  </td>
  <td class="mlabels-right">
<span class="mlabels"><span class="mlabel">static</span></span>  </td>
  </tr>
</table>
</div><div class="memdoc">

<p class="definition">Definition at line <a class="el" href="FileStream_8cpp_source.html#l01752">1752</a> of file <a class="el" href="FileStream_8cpp_source.html">FileStream.cpp</a>.</p>
<div class="fragment"><div class="line"><span class="lineno"> 1753</span>{</div>
<div class="line"><span class="lineno"> 1754</span>    <a class="code hl_struct" href="struct__PART__FILE__HEADER.html">PART_FILE_HEADER</a> PartHeader;</div>
<div class="line"><span class="lineno"> 1755</span>    <a class="code hl_typedef" href="StormPort_8h.html#abb9abb9ce956f1a9e5a4081ac40e5649">ULONGLONG</a> ByteOffset = 0;</div>
<div class="line"><span class="lineno"> 1756</span> </div>
<div class="line"><span class="lineno"> 1757</span>    <span class="keywordflow">if</span>(pStream-&gt;<a class="code hl_variable" href="structTBlockStream.html#a1e2d4a2467ab4b43cec1bdd1a2f6d21a">FileBitmap</a> &amp;&amp; pStream-&gt;<a class="code hl_variable" href="structTBlockStream.html#ab405154b8f27af633d8f3116cce2ac66">IsModified</a>)</div>
<div class="line"><span class="lineno"> 1758</span>    {</div>
<div class="line"><span class="lineno"> 1759</span>        <span class="comment">// Prepare the part file header</span></div>
<div class="line"><span class="lineno"> 1760</span>        memset(&amp;PartHeader, 0, <span class="keyword">sizeof</span>(<a class="code hl_struct" href="struct__PART__FILE__HEADER.html">PART_FILE_HEADER</a>));</div>
<div class="line"><span class="lineno"> 1761</span>        PartHeader.<a class="code hl_variable" href="struct__PART__FILE__HEADER.html#a10e8c7b983a0349462fd3ca0aa5d495a">PartialVersion</a> = 2;</div>
<div class="line"><span class="lineno"> 1762</span>        PartHeader.<a class="code hl_variable" href="struct__PART__FILE__HEADER.html#acd472d1a4c6cb85c620343a46765ba12">FileSizeHi</a>     = (<a class="code hl_typedef" href="StormPort_8h.html#a798af1e30bc65f319c1a246cecf59e39">DWORD</a>)(pStream-&gt;<a class="code hl_variable" href="structTFileStream.html#a99bdae10f74cf57156e65bd76ba64771">StreamSize</a> &gt;&gt; 0x20);</div>
<div class="line"><span class="lineno"> 1763</span>        PartHeader.<a class="code hl_variable" href="struct__PART__FILE__HEADER.html#abfac03a810cc32e4489aa9bd81610ffa">FileSizeLo</a>     = (<a class="code hl_typedef" href="StormPort_8h.html#a798af1e30bc65f319c1a246cecf59e39">DWORD</a>)(pStream-&gt;<a class="code hl_variable" href="structTFileStream.html#a99bdae10f74cf57156e65bd76ba64771">StreamSize</a> &amp; 0xFFFFFFFF);</div>
<div class="line"><span class="lineno"> 1764</span>        PartHeader.<a class="code hl_variable" href="struct__PART__FILE__HEADER.html#a43a8ba79d2d5ccb8d2baf168faf4bd3d">BlockSize</a>      = pStream-&gt;<a class="code hl_variable" href="structTBlockStream.html#a8c7180184928638b30809f7f85061fb7">BlockSize</a>;</div>
<div class="line"><span class="lineno"> 1765</span> </div>
<div class="line"><span class="lineno"> 1766</span>        <span class="comment">// Make sure that the header is properly BSWAPed</span></div>
<div class="line"><span class="lineno"> 1767</span>        <a class="code hl_define" href="StormPort_8h.html#ac7ba8dafbd180540281c58442f9777ee">BSWAP_ARRAY32_UNSIGNED</a>(&amp;PartHeader, <span class="keyword">sizeof</span>(<a class="code hl_struct" href="struct__PART__FILE__HEADER.html">PART_FILE_HEADER</a>));</div>
<div class="line"><span class="lineno"> 1768</span>        <a class="code hl_function" href="StormCommon_8h.html#a07d708b4165417af1c53780b0443b6c0">IntToString</a>(PartHeader.<a class="code hl_variable" href="struct__PART__FILE__HEADER.html#ad66801f8212a8d897df401ca248b46e3">GameBuildNumber</a>, <a class="code hl_define" href="StormPort_8h.html#a4987dd6844197a1b6267f4261ae70cf3">_countof</a>(PartHeader.<a class="code hl_variable" href="struct__PART__FILE__HEADER.html#ad66801f8212a8d897df401ca248b46e3">GameBuildNumber</a>), pStream-&gt;<a class="code hl_variable" href="structTFileStream.html#a656f54e9e282a350dd68bdfd4a56d8ad">BuildNumber</a>);</div>
<div class="line"><span class="lineno"> 1769</span> </div>
<div class="line"><span class="lineno"> 1770</span>        <span class="comment">// Write the part header</span></div>
<div class="line"><span class="lineno"> 1771</span>        pStream-&gt;<a class="code hl_variable" href="structTFileStream.html#a811c9b3d565324e51361768847fe50a8">BaseWrite</a>(pStream, &amp;ByteOffset, &amp;PartHeader, <span class="keyword">sizeof</span>(<a class="code hl_struct" href="struct__PART__FILE__HEADER.html">PART_FILE_HEADER</a>));</div>
<div class="line"><span class="lineno"> 1772</span> </div>
<div class="line"><span class="lineno"> 1773</span>        <span class="comment">// Write the block bitmap</span></div>
<div class="line"><span class="lineno"> 1774</span>        <a class="code hl_define" href="StormPort_8h.html#ac7ba8dafbd180540281c58442f9777ee">BSWAP_ARRAY32_UNSIGNED</a>(pStream-&gt;<a class="code hl_variable" href="structTBlockStream.html#a1e2d4a2467ab4b43cec1bdd1a2f6d21a">FileBitmap</a>, pStream-&gt;<a class="code hl_variable" href="structTBlockStream.html#a15f8225b96883446b4c4076ba8deca2b">BitmapSize</a>);</div>
<div class="line"><span class="lineno"> 1775</span>        pStream-&gt;<a class="code hl_variable" href="structTFileStream.html#a811c9b3d565324e51361768847fe50a8">BaseWrite</a>(pStream, NULL, pStream-&gt;<a class="code hl_variable" href="structTBlockStream.html#a1e2d4a2467ab4b43cec1bdd1a2f6d21a">FileBitmap</a>, pStream-&gt;<a class="code hl_variable" href="structTBlockStream.html#a15f8225b96883446b4c4076ba8deca2b">BitmapSize</a>);</div>
<div class="line"><span class="lineno"> 1776</span>    }</div>
<div class="line"><span class="lineno"> 1777</span> </div>
<div class="line"><span class="lineno"> 1778</span>    <span class="comment">// Close the base class</span></div>
<div class="line"><span class="lineno"> 1779</span>    <a class="code hl_function" href="FileStream_8cpp.html#a5074c346733483a14dce339c940186a9">BlockStream_Close</a>(pStream);</div>
<div class="line"><span class="lineno"> 1780</span>}</div>
<div class="ttc" id="aStormPort_8h_html_a4987dd6844197a1b6267f4261ae70cf3"><div class="ttname"><a href="StormPort_8h.html#a4987dd6844197a1b6267f4261ae70cf3">_countof</a></div><div class="ttdeci">#define _countof(x)</div><div class="ttdef"><b>Definition</b> <a href="StormPort_8h_source.html#l00421">StormPort.h:421</a></div></div>
<div class="ttc" id="astruct__PART__FILE__HEADER_html"><div class="ttname"><a href="struct__PART__FILE__HEADER.html">_PART_FILE_HEADER</a></div><div class="ttdef"><b>Definition</b> <a href="FileStream_8h_source.html#l00089">FileStream.h:90</a></div></div>
<div class="ttc" id="astruct__PART__FILE__HEADER_html_abfac03a810cc32e4489aa9bd81610ffa"><div class="ttname"><a href="struct__PART__FILE__HEADER.html#abfac03a810cc32e4489aa9bd81610ffa">_PART_FILE_HEADER::FileSizeLo</a></div><div class="ttdeci">DWORD FileSizeLo</div><div class="ttdef"><b>Definition</b> <a href="FileStream_8h_source.html#l00094">FileStream.h:94</a></div></div>
<div class="ttc" id="astruct__PART__FILE__HEADER_html_acd472d1a4c6cb85c620343a46765ba12"><div class="ttname"><a href="struct__PART__FILE__HEADER.html#acd472d1a4c6cb85c620343a46765ba12">_PART_FILE_HEADER::FileSizeHi</a></div><div class="ttdeci">DWORD FileSizeHi</div><div class="ttdef"><b>Definition</b> <a href="FileStream_8h_source.html#l00095">FileStream.h:95</a></div></div>
</div><!-- fragment --><div class="dynheader">
Here is the call graph for this function:</div>
<div class="dyncontent">
<div class="center"><iframe scrolling="no" frameborder="0" src="FileStream_8cpp_a44ffcada567ee94f23e575dfe83e9c64_cgraph.svg" width="344" height="86"><p><b>This browser is not able to show SVG: try Firefox, Chrome, Safari, or Opera instead.</b></p></iframe></div>
</div>
<div class="dynheader">
Here is the caller graph for this function:</div>
<div class="dyncontent">
<div class="center"><div class="zoom"><iframe scrolling="no" frameborder="0" src="FileStream_8cpp_a44ffcada567ee94f23e575dfe83e9c64_icgraph.svg" width="100%" height="600"><p><b>This browser is not able to show SVG: try Firefox, Chrome, Safari, or Opera instead.</b></p></iframe></div></div>
</div>

</div>
</div>
<a id="ac44f22d4353fc2b39957149e3b588f36" name="ac44f22d4353fc2b39957149e3b588f36"></a>
<h2 class="memtitle"><span class="permalink"><a href="#ac44f22d4353fc2b39957149e3b588f36">&#9670;&#160;</a></span>PartStream_CreateMirror()</h2>

<div class="memitem">
<div class="memproto">
<table class="mlabels">
  <tr>
  <td class="mlabels-left">
      <table class="memname">
        <tr>
          <td class="memname">static <a class="el" href="StormPort_8h.html#abb452686968e48b67397da5f97445f5b">bool</a> PartStream_CreateMirror </td>
          <td>(</td>
          <td class="paramtype"><a class="el" href="structTBlockStream.html">TBlockStream</a> *&#160;</td>
          <td class="paramname"><em>pStream</em></td><td>)</td>
          <td></td>
        </tr>
      </table>
  </td>
  <td class="mlabels-right">
<span class="mlabels"><span class="mlabel">static</span></span>  </td>
  </tr>
</table>
</div><div class="memdoc">

<p class="definition">Definition at line <a class="el" href="FileStream_8cpp_source.html#l01782">1782</a> of file <a class="el" href="FileStream_8cpp_source.html">FileStream.cpp</a>.</p>
<div class="fragment"><div class="line"><span class="lineno"> 1783</span>{</div>
<div class="line"><span class="lineno"> 1784</span>    <a class="code hl_typedef" href="StormPort_8h.html#abb9abb9ce956f1a9e5a4081ac40e5649">ULONGLONG</a> RemainingSize;</div>
<div class="line"><span class="lineno"> 1785</span>    <a class="code hl_typedef" href="StormPort_8h.html#abb9abb9ce956f1a9e5a4081ac40e5649">ULONGLONG</a> MasterSize = 0;</div>
<div class="line"><span class="lineno"> 1786</span>    <a class="code hl_typedef" href="StormPort_8h.html#abb9abb9ce956f1a9e5a4081ac40e5649">ULONGLONG</a> MirrorSize = 0;</div>
<div class="line"><span class="lineno"> 1787</span>    <a class="code hl_typedef" href="StormPort_8h.html#ac2d3fb16b5b34c1e6ab80014309020eb">LPBYTE</a> FileBitmap = NULL;</div>
<div class="line"><span class="lineno"> 1788</span>    <a class="code hl_typedef" href="StormPort_8h.html#a798af1e30bc65f319c1a246cecf59e39">DWORD</a> dwBitmapSize;</div>
<div class="line"><span class="lineno"> 1789</span>    <a class="code hl_typedef" href="StormPort_8h.html#a798af1e30bc65f319c1a246cecf59e39">DWORD</a> dwBlockCount;</div>
<div class="line"><span class="lineno"> 1790</span>    <span class="keywordtype">bool</span> bNeedCreateMirrorStream = <span class="keyword">true</span>;</div>
<div class="line"><span class="lineno"> 1791</span>    <span class="keywordtype">bool</span> bNeedResizeMirrorStream = <span class="keyword">true</span>;</div>
<div class="line"><span class="lineno"> 1792</span> </div>
<div class="line"><span class="lineno"> 1793</span>    <span class="comment">// Do we have master function and base creation function?</span></div>
<div class="line"><span class="lineno"> 1794</span>    <span class="keywordflow">if</span>(pStream-&gt;<a class="code hl_variable" href="structTFileStream.html#a26faae83ba546119ac59fc35eaeec274">pMaster</a> == NULL || pStream-&gt;<a class="code hl_variable" href="structTFileStream.html#a1082d451ef30de1e906bc3a4d26d8d65">BaseCreate</a> == NULL)</div>
<div class="line"><span class="lineno"> 1795</span>        <span class="keywordflow">return</span> <span class="keyword">false</span>;</div>
<div class="line"><span class="lineno"> 1796</span> </div>
<div class="line"><span class="lineno"> 1797</span>    <span class="comment">// Retrieve the master file size, block count and bitmap size</span></div>
<div class="line"><span class="lineno"> 1798</span>    <a class="code hl_function" href="FileStream_8cpp.html#af505319882f0f4aaf396b6d061a2275b">FileStream_GetSize</a>(pStream-&gt;<a class="code hl_variable" href="structTFileStream.html#a26faae83ba546119ac59fc35eaeec274">pMaster</a>, &amp;MasterSize);</div>
<div class="line"><span class="lineno"> 1799</span>    dwBlockCount = (<a class="code hl_typedef" href="StormPort_8h.html#a798af1e30bc65f319c1a246cecf59e39">DWORD</a>)((MasterSize + <a class="code hl_define" href="FileStream_8h.html#ac42c901b241f3189fb2451bfea993e1a">DEFAULT_BLOCK_SIZE</a> - 1) / <a class="code hl_define" href="FileStream_8h.html#ac42c901b241f3189fb2451bfea993e1a">DEFAULT_BLOCK_SIZE</a>);</div>
<div class="line"><span class="lineno"> 1800</span>    dwBitmapSize = (<a class="code hl_typedef" href="StormPort_8h.html#a798af1e30bc65f319c1a246cecf59e39">DWORD</a>)(dwBlockCount * <span class="keyword">sizeof</span>(<a class="code hl_struct" href="struct__PART__FILE__MAP__ENTRY.html">PART_FILE_MAP_ENTRY</a>));</div>
<div class="line"><span class="lineno"> 1801</span> </div>
<div class="line"><span class="lineno"> 1802</span>    <span class="comment">// Setup stream size and position</span></div>
<div class="line"><span class="lineno"> 1803</span>    pStream-&gt;<a class="code hl_variable" href="structTFileStream.html#a656f54e9e282a350dd68bdfd4a56d8ad">BuildNumber</a> = <a class="code hl_define" href="FileStream_8h.html#a8b2bae6779544561db298ba09b50866c">DEFAULT_BUILD_NUMBER</a>;        <span class="comment">// BUGBUG: Really???</span></div>
<div class="line"><span class="lineno"> 1804</span>    pStream-&gt;<a class="code hl_variable" href="structTFileStream.html#a99bdae10f74cf57156e65bd76ba64771">StreamSize</a> = MasterSize;</div>
<div class="line"><span class="lineno"> 1805</span>    pStream-&gt;<a class="code hl_variable" href="structTFileStream.html#a84324f2f19bfc3fcbc563ef2391f84fe">StreamPos</a> = 0;</div>
<div class="line"><span class="lineno"> 1806</span> </div>
<div class="line"><span class="lineno"> 1807</span>    <span class="comment">// Open the base stream for write access</span></div>
<div class="line"><span class="lineno"> 1808</span>    <span class="keywordflow">if</span>(pStream-&gt;<a class="code hl_variable" href="structTFileStream.html#a82013f6bc9d5e52d1efe42b0dc464d4c">BaseOpen</a>(pStream, pStream-&gt;<a class="code hl_variable" href="structTFileStream.html#a7a4da926d708d96cb47333973e705c76">szFileName</a>, 0))</div>
<div class="line"><span class="lineno"> 1809</span>    {</div>
<div class="line"><span class="lineno"> 1810</span>        <span class="comment">// If the file open succeeded, check if the file size matches required size</span></div>
<div class="line"><span class="lineno"> 1811</span>        pStream-&gt;<a class="code hl_variable" href="structTFileStream.html#a0366f518ffecab4131bf2527f22964e3">BaseGetSize</a>(pStream, &amp;MirrorSize);</div>
<div class="line"><span class="lineno"> 1812</span>        <span class="keywordflow">if</span>(MirrorSize &gt;= <span class="keyword">sizeof</span>(<a class="code hl_struct" href="struct__PART__FILE__HEADER.html">PART_FILE_HEADER</a>) + dwBitmapSize)</div>
<div class="line"><span class="lineno"> 1813</span>        {</div>
<div class="line"><span class="lineno"> 1814</span>            <span class="comment">// Check if the remaining size is aligned to block</span></div>
<div class="line"><span class="lineno"> 1815</span>            RemainingSize = MirrorSize - <span class="keyword">sizeof</span>(<a class="code hl_typedef" href="FileStream_8h.html#a2d26fde2f12d7df3e8d702f6b745c5df">PART_FILE_HEADER</a>) - dwBitmapSize;</div>
<div class="line"><span class="lineno"> 1816</span>            <span class="keywordflow">if</span>((RemainingSize &amp; (<a class="code hl_define" href="FileStream_8h.html#ac42c901b241f3189fb2451bfea993e1a">DEFAULT_BLOCK_SIZE</a> - 1)) == 0 || RemainingSize == MasterSize)</div>
<div class="line"><span class="lineno"> 1817</span>            {</div>
<div class="line"><span class="lineno"> 1818</span>                <span class="comment">// Attempt to load an existing file bitmap</span></div>
<div class="line"><span class="lineno"> 1819</span>                <span class="keywordflow">if</span>(<a class="code hl_function" href="FileStream_8cpp.html#abab48f6b34ad7933671864dd7f1e6ad5">PartStream_LoadBitmap</a>(pStream))</div>
<div class="line"><span class="lineno"> 1820</span>                    <span class="keywordflow">return</span> <span class="keyword">true</span>;</div>
<div class="line"><span class="lineno"> 1821</span>            }</div>
<div class="line"><span class="lineno"> 1822</span>        }</div>
<div class="line"><span class="lineno"> 1823</span> </div>
<div class="line"><span class="lineno"> 1824</span>        <span class="comment">// We need to create mirror stream</span></div>
<div class="line"><span class="lineno"> 1825</span>        bNeedCreateMirrorStream = <span class="keyword">false</span>;</div>
<div class="line"><span class="lineno"> 1826</span>    }</div>
<div class="line"><span class="lineno"> 1827</span> </div>
<div class="line"><span class="lineno"> 1828</span>    <span class="comment">// Create a new stream, if needed</span></div>
<div class="line"><span class="lineno"> 1829</span>    <span class="keywordflow">if</span>(bNeedCreateMirrorStream)</div>
<div class="line"><span class="lineno"> 1830</span>    {</div>
<div class="line"><span class="lineno"> 1831</span>        <span class="keywordflow">if</span>(!pStream-&gt;<a class="code hl_variable" href="structTFileStream.html#a1082d451ef30de1e906bc3a4d26d8d65">BaseCreate</a>(pStream))</div>
<div class="line"><span class="lineno"> 1832</span>            <span class="keywordflow">return</span> <span class="keyword">false</span>;</div>
<div class="line"><span class="lineno"> 1833</span>    }</div>
<div class="line"><span class="lineno"> 1834</span> </div>
<div class="line"><span class="lineno"> 1835</span>    <span class="comment">// If we need to, then resize the mirror stream</span></div>
<div class="line"><span class="lineno"> 1836</span>    <span class="keywordflow">if</span>(bNeedResizeMirrorStream)</div>
<div class="line"><span class="lineno"> 1837</span>    {</div>
<div class="line"><span class="lineno"> 1838</span>        <span class="keywordflow">if</span>(!pStream-&gt;<a class="code hl_variable" href="structTFileStream.html#a00a7a9d0ce7cdea1c4ecdbd72a3bd282">BaseResize</a>(pStream, <span class="keyword">sizeof</span>(<a class="code hl_struct" href="struct__PART__FILE__HEADER.html">PART_FILE_HEADER</a>) + dwBitmapSize))</div>
<div class="line"><span class="lineno"> 1839</span>            <span class="keywordflow">return</span> <span class="keyword">false</span>;</div>
<div class="line"><span class="lineno"> 1840</span>    }</div>
<div class="line"><span class="lineno"> 1841</span> </div>
<div class="line"><span class="lineno"> 1842</span>    <span class="comment">// Allocate the bitmap array</span></div>
<div class="line"><span class="lineno"> 1843</span>    FileBitmap = <a class="code hl_define" href="StormCommon_8h.html#a6fe0c42173ef1a4b9f0e837b0c631660">STORM_ALLOC</a>(<a class="code hl_typedef" href="StormPort_8h.html#a4ae1dab0fb4b072a66584546209e7d58">BYTE</a>, dwBitmapSize);</div>
<div class="line"><span class="lineno"> 1844</span>    <span class="keywordflow">if</span>(FileBitmap == NULL)</div>
<div class="line"><span class="lineno"> 1845</span>        <span class="keywordflow">return</span> <span class="keyword">false</span>;</div>
<div class="line"><span class="lineno"> 1846</span> </div>
<div class="line"><span class="lineno"> 1847</span>    <span class="comment">// Initialize the bitmap</span></div>
<div class="line"><span class="lineno"> 1848</span>    memset(FileBitmap, 0, dwBitmapSize);</div>
<div class="line"><span class="lineno"> 1849</span>    pStream-&gt;<a class="code hl_variable" href="structTBlockStream.html#a1e2d4a2467ab4b43cec1bdd1a2f6d21a">FileBitmap</a> = FileBitmap;</div>
<div class="line"><span class="lineno"> 1850</span>    pStream-&gt;<a class="code hl_variable" href="structTBlockStream.html#a15f8225b96883446b4c4076ba8deca2b">BitmapSize</a> = dwBitmapSize;</div>
<div class="line"><span class="lineno"> 1851</span>    pStream-&gt;<a class="code hl_variable" href="structTBlockStream.html#a8c7180184928638b30809f7f85061fb7">BlockSize</a>  = <a class="code hl_define" href="FileStream_8h.html#ac42c901b241f3189fb2451bfea993e1a">DEFAULT_BLOCK_SIZE</a>;</div>
<div class="line"><span class="lineno"> 1852</span>    pStream-&gt;<a class="code hl_variable" href="structTBlockStream.html#a05210a0cd78477e541734ba7e3abe2b1">BlockCount</a> = dwBlockCount;</div>
<div class="line"><span class="lineno"> 1853</span>    pStream-&gt;<a class="code hl_variable" href="structTBlockStream.html#a8bb8ee629c5bc59f65d01eead9b62762">IsComplete</a> = 0;</div>
<div class="line"><span class="lineno"> 1854</span>    pStream-&gt;<a class="code hl_variable" href="structTBlockStream.html#ab405154b8f27af633d8f3116cce2ac66">IsModified</a> = 1;</div>
<div class="line"><span class="lineno"> 1855</span> </div>
<div class="line"><span class="lineno"> 1856</span>    <span class="comment">// Note: Don&#39;t write the stream bitmap right away.</span></div>
<div class="line"><span class="lineno"> 1857</span>    <span class="comment">// Doing so would cause sparse file resize on NTFS,</span></div>
<div class="line"><span class="lineno"> 1858</span>    <span class="comment">// which would take long time on larger files.</span></div>
<div class="line"><span class="lineno"> 1859</span>    <span class="keywordflow">return</span> <span class="keyword">true</span>;</div>
<div class="line"><span class="lineno"> 1860</span>}</div>
<div class="ttc" id="aFileStream_8cpp_html_abab48f6b34ad7933671864dd7f1e6ad5"><div class="ttname"><a href="FileStream_8cpp.html#abab48f6b34ad7933671864dd7f1e6ad5">PartStream_LoadBitmap</a></div><div class="ttdeci">static bool PartStream_LoadBitmap(TBlockStream *pStream)</div><div class="ttdef"><b>Definition</b> <a href="FileStream_8cpp_source.html#l01562">FileStream.cpp:1562</a></div></div>
<div class="ttc" id="aFileStream_8h_html_a2d26fde2f12d7df3e8d702f6b745c5df"><div class="ttname"><a href="FileStream_8h.html#a2d26fde2f12d7df3e8d702f6b745c5df">PART_FILE_HEADER</a></div><div class="ttdeci">struct _PART_FILE_HEADER PART_FILE_HEADER</div></div>
</div><!-- fragment --><div class="dynheader">
Here is the call graph for this function:</div>
<div class="dyncontent">
<div class="center"><iframe scrolling="no" frameborder="0" src="FileStream_8cpp_ac44f22d4353fc2b39957149e3b588f36_cgraph.svg" width="632" height="135"><p><b>This browser is not able to show SVG: try Firefox, Chrome, Safari, or Opera instead.</b></p></iframe></div>
</div>
<div class="dynheader">
Here is the caller graph for this function:</div>
<div class="dyncontent">
<div class="center"><div class="zoom"><iframe scrolling="no" frameborder="0" src="FileStream_8cpp_ac44f22d4353fc2b39957149e3b588f36_icgraph.svg" width="100%" height="600"><p><b>This browser is not able to show SVG: try Firefox, Chrome, Safari, or Opera instead.</b></p></iframe></div></div>
</div>

</div>
</div>
<a id="abab48f6b34ad7933671864dd7f1e6ad5" name="abab48f6b34ad7933671864dd7f1e6ad5"></a>
<h2 class="memtitle"><span class="permalink"><a href="#abab48f6b34ad7933671864dd7f1e6ad5">&#9670;&#160;</a></span>PartStream_LoadBitmap()</h2>

<div class="memitem">
<div class="memproto">
<table class="mlabels">
  <tr>
  <td class="mlabels-left">
      <table class="memname">
        <tr>
          <td class="memname">static <a class="el" href="StormPort_8h.html#abb452686968e48b67397da5f97445f5b">bool</a> PartStream_LoadBitmap </td>
          <td>(</td>
          <td class="paramtype"><a class="el" href="structTBlockStream.html">TBlockStream</a> *&#160;</td>
          <td class="paramname"><em>pStream</em></td><td>)</td>
          <td></td>
        </tr>
      </table>
  </td>
  <td class="mlabels-right">
<span class="mlabels"><span class="mlabel">static</span></span>  </td>
  </tr>
</table>
</div><div class="memdoc">

<p class="definition">Definition at line <a class="el" href="FileStream_8cpp_source.html#l01562">1562</a> of file <a class="el" href="FileStream_8cpp_source.html">FileStream.cpp</a>.</p>
<div class="fragment"><div class="line"><span class="lineno"> 1563</span>{</div>
<div class="line"><span class="lineno"> 1564</span>    <a class="code hl_struct" href="struct__PART__FILE__MAP__ENTRY.html">PPART_FILE_MAP_ENTRY</a> FileBitmap;</div>
<div class="line"><span class="lineno"> 1565</span>    <a class="code hl_struct" href="struct__PART__FILE__HEADER.html">PART_FILE_HEADER</a> PartHdr;</div>
<div class="line"><span class="lineno"> 1566</span>    <a class="code hl_typedef" href="StormPort_8h.html#abb9abb9ce956f1a9e5a4081ac40e5649">ULONGLONG</a> ByteOffset = 0;</div>
<div class="line"><span class="lineno"> 1567</span>    <a class="code hl_typedef" href="StormPort_8h.html#abb9abb9ce956f1a9e5a4081ac40e5649">ULONGLONG</a> StreamSize = 0;</div>
<div class="line"><span class="lineno"> 1568</span>    <a class="code hl_typedef" href="StormPort_8h.html#a798af1e30bc65f319c1a246cecf59e39">DWORD</a> BlockCount;</div>
<div class="line"><span class="lineno"> 1569</span>    <a class="code hl_typedef" href="StormPort_8h.html#a798af1e30bc65f319c1a246cecf59e39">DWORD</a> BitmapSize;</div>
<div class="line"><span class="lineno"> 1570</span> </div>
<div class="line"><span class="lineno"> 1571</span>    <span class="comment">// Only if the size is greater than size of the bitmap header</span></div>
<div class="line"><span class="lineno"> 1572</span>    <span class="keywordflow">if</span>(pStream-&gt;<a class="code hl_variable" href="structTFileStream.html#a3428b5a1e790560349940aa04e37e580">Base</a>.<a class="code hl_variable" href="unionTBaseProviderData.html#a60536cc70eff3072cd6c371a99bdf325">File</a>.<a class="code hl_variable" href="unionTBaseProviderData.html#ad644c7067435cf51727186729b970d55">FileSize</a> &gt; <span class="keyword">sizeof</span>(<a class="code hl_struct" href="struct__PART__FILE__HEADER.html">PART_FILE_HEADER</a>))</div>
<div class="line"><span class="lineno"> 1573</span>    {</div>
<div class="line"><span class="lineno"> 1574</span>        <span class="comment">// Attempt to read PART file header</span></div>
<div class="line"><span class="lineno"> 1575</span>        <span class="keywordflow">if</span>(pStream-&gt;<a class="code hl_variable" href="structTFileStream.html#a5b6aa0a4b5d6b97770f73fbc47412da1">BaseRead</a>(pStream, &amp;ByteOffset, &amp;PartHdr, <span class="keyword">sizeof</span>(<a class="code hl_struct" href="struct__PART__FILE__HEADER.html">PART_FILE_HEADER</a>)))</div>
<div class="line"><span class="lineno"> 1576</span>        {</div>
<div class="line"><span class="lineno"> 1577</span>            <span class="comment">// We need to swap PART file header on big-endian platforms</span></div>
<div class="line"><span class="lineno"> 1578</span>            <a class="code hl_define" href="StormPort_8h.html#ac7ba8dafbd180540281c58442f9777ee">BSWAP_ARRAY32_UNSIGNED</a>(&amp;PartHdr, <span class="keyword">sizeof</span>(<a class="code hl_struct" href="struct__PART__FILE__HEADER.html">PART_FILE_HEADER</a>));</div>
<div class="line"><span class="lineno"> 1579</span> </div>
<div class="line"><span class="lineno"> 1580</span>            <span class="comment">// Verify the PART file header</span></div>
<div class="line"><span class="lineno"> 1581</span>            <span class="keywordflow">if</span>(<a class="code hl_function" href="FileStream_8cpp.html#ab6a8ad643ebb16a4c5fe5b744195d5db">IsPartHeader</a>(&amp;PartHdr))</div>
<div class="line"><span class="lineno"> 1582</span>            {</div>
<div class="line"><span class="lineno"> 1583</span>                <span class="comment">// Get the number of blocks and size of one block</span></div>
<div class="line"><span class="lineno"> 1584</span>                StreamSize = <a class="code hl_define" href="StormCommon_8h.html#ac67482b4d06c66c34ad0dc9686c12fd4">MAKE_OFFSET64</a>(PartHdr.<a class="code hl_variable" href="struct__PART__FILE__HEADER.html#acd472d1a4c6cb85c620343a46765ba12">FileSizeHi</a>, PartHdr.<a class="code hl_variable" href="struct__PART__FILE__HEADER.html#abfac03a810cc32e4489aa9bd81610ffa">FileSizeLo</a>);</div>
<div class="line"><span class="lineno"> 1585</span>                ByteOffset = <span class="keyword">sizeof</span>(<a class="code hl_typedef" href="FileStream_8h.html#a2d26fde2f12d7df3e8d702f6b745c5df">PART_FILE_HEADER</a>);</div>
<div class="line"><span class="lineno"> 1586</span>                BlockCount = (<a class="code hl_typedef" href="StormPort_8h.html#a798af1e30bc65f319c1a246cecf59e39">DWORD</a>)((StreamSize + PartHdr.<a class="code hl_variable" href="struct__PART__FILE__HEADER.html#a43a8ba79d2d5ccb8d2baf168faf4bd3d">BlockSize</a> - 1) / PartHdr.<a class="code hl_variable" href="struct__PART__FILE__HEADER.html#a43a8ba79d2d5ccb8d2baf168faf4bd3d">BlockSize</a>);</div>
<div class="line"><span class="lineno"> 1587</span>                BitmapSize = BlockCount * <span class="keyword">sizeof</span>(<a class="code hl_typedef" href="FileStream_8h.html#aa8c367fe1417d23655345e05264a72c7">PART_FILE_MAP_ENTRY</a>);</div>
<div class="line"><span class="lineno"> 1588</span> </div>
<div class="line"><span class="lineno"> 1589</span>                <span class="comment">// Check if sizes match</span></div>
<div class="line"><span class="lineno"> 1590</span>                <span class="keywordflow">if</span>((ByteOffset + BitmapSize) &lt; pStream-&gt;<a class="code hl_variable" href="structTFileStream.html#a3428b5a1e790560349940aa04e37e580">Base</a>.<a class="code hl_variable" href="unionTBaseProviderData.html#a60536cc70eff3072cd6c371a99bdf325">File</a>.<a class="code hl_variable" href="unionTBaseProviderData.html#ad644c7067435cf51727186729b970d55">FileSize</a>)</div>
<div class="line"><span class="lineno"> 1591</span>                {</div>
<div class="line"><span class="lineno"> 1592</span>                    <span class="comment">// Allocate space for the array of PART_FILE_MAP_ENTRY</span></div>
<div class="line"><span class="lineno"> 1593</span>                    FileBitmap = <a class="code hl_define" href="StormCommon_8h.html#a6fe0c42173ef1a4b9f0e837b0c631660">STORM_ALLOC</a>(<a class="code hl_struct" href="struct__PART__FILE__MAP__ENTRY.html">PART_FILE_MAP_ENTRY</a>, BlockCount);</div>
<div class="line"><span class="lineno"> 1594</span>                    <span class="keywordflow">if</span>(FileBitmap != NULL)</div>
<div class="line"><span class="lineno"> 1595</span>                    {</div>
<div class="line"><span class="lineno"> 1596</span>                        <span class="comment">// Load the block map</span></div>
<div class="line"><span class="lineno"> 1597</span>                        <span class="keywordflow">if</span>(!pStream-&gt;<a class="code hl_variable" href="structTFileStream.html#a5b6aa0a4b5d6b97770f73fbc47412da1">BaseRead</a>(pStream, &amp;ByteOffset, FileBitmap, BitmapSize))</div>
<div class="line"><span class="lineno"> 1598</span>                        {</div>
<div class="line"><span class="lineno"> 1599</span>                            <a class="code hl_define" href="StormCommon_8h.html#a50487dadfceefebfb0de8fa711eaf4b3">STORM_FREE</a>(FileBitmap);</div>
<div class="line"><span class="lineno"> 1600</span>                            <span class="keywordflow">return</span> <span class="keyword">false</span>;</div>
<div class="line"><span class="lineno"> 1601</span>                        }</div>
<div class="line"><span class="lineno"> 1602</span> </div>
<div class="line"><span class="lineno"> 1603</span>                        <span class="comment">// Make sure that the byte order is correct</span></div>
<div class="line"><span class="lineno"> 1604</span>                        <a class="code hl_define" href="StormPort_8h.html#ac7ba8dafbd180540281c58442f9777ee">BSWAP_ARRAY32_UNSIGNED</a>(FileBitmap, BitmapSize);</div>
<div class="line"><span class="lineno"> 1605</span> </div>
<div class="line"><span class="lineno"> 1606</span>                        <span class="comment">// Update the stream size</span></div>
<div class="line"><span class="lineno"> 1607</span>                        pStream-&gt;<a class="code hl_variable" href="structTFileStream.html#a656f54e9e282a350dd68bdfd4a56d8ad">BuildNumber</a> = <a class="code hl_function" href="FileStream_8cpp.html#ab6c0b30e08b7e1e527b2d1ca2a162b93">StringToInt</a>(PartHdr.<a class="code hl_variable" href="struct__PART__FILE__HEADER.html#ad66801f8212a8d897df401ca248b46e3">GameBuildNumber</a>);</div>
<div class="line"><span class="lineno"> 1608</span>                        pStream-&gt;<a class="code hl_variable" href="structTFileStream.html#a99bdae10f74cf57156e65bd76ba64771">StreamSize</a> = StreamSize;</div>
<div class="line"><span class="lineno"> 1609</span> </div>
<div class="line"><span class="lineno"> 1610</span>                        <span class="comment">// Fill the bitmap information</span></div>
<div class="line"><span class="lineno"> 1611</span>                        pStream-&gt;<a class="code hl_variable" href="structTBlockStream.html#a1e2d4a2467ab4b43cec1bdd1a2f6d21a">FileBitmap</a> = FileBitmap;</div>
<div class="line"><span class="lineno"> 1612</span>                        pStream-&gt;<a class="code hl_variable" href="structTBlockStream.html#a15f8225b96883446b4c4076ba8deca2b">BitmapSize</a> = BitmapSize;</div>
<div class="line"><span class="lineno"> 1613</span>                        pStream-&gt;<a class="code hl_variable" href="structTBlockStream.html#a8c7180184928638b30809f7f85061fb7">BlockSize</a>  = PartHdr.<a class="code hl_variable" href="struct__PART__FILE__HEADER.html#a43a8ba79d2d5ccb8d2baf168faf4bd3d">BlockSize</a>;</div>
<div class="line"><span class="lineno"> 1614</span>                        pStream-&gt;<a class="code hl_variable" href="structTBlockStream.html#a05210a0cd78477e541734ba7e3abe2b1">BlockCount</a> = BlockCount;</div>
<div class="line"><span class="lineno"> 1615</span>                        pStream-&gt;<a class="code hl_variable" href="structTBlockStream.html#a8bb8ee629c5bc59f65d01eead9b62762">IsComplete</a> = <a class="code hl_function" href="FileStream_8cpp.html#aaffd3fca4e0a45595bc2f73e6bea76f3">PartStream_CheckFile</a>(pStream);</div>
<div class="line"><span class="lineno"> 1616</span>                        <span class="keywordflow">return</span> <span class="keyword">true</span>;</div>
<div class="line"><span class="lineno"> 1617</span>                    }</div>
<div class="line"><span class="lineno"> 1618</span>                }</div>
<div class="line"><span class="lineno"> 1619</span>            }</div>
<div class="line"><span class="lineno"> 1620</span>        }</div>
<div class="line"><span class="lineno"> 1621</span>    }</div>
<div class="line"><span class="lineno"> 1622</span> </div>
<div class="line"><span class="lineno"> 1623</span>    <span class="keywordflow">return</span> <span class="keyword">false</span>;</div>
<div class="line"><span class="lineno"> 1624</span>}</div>
<div class="ttc" id="aFileStream_8cpp_html_aaffd3fca4e0a45595bc2f73e6bea76f3"><div class="ttname"><a href="FileStream_8cpp.html#aaffd3fca4e0a45595bc2f73e6bea76f3">PartStream_CheckFile</a></div><div class="ttdeci">static DWORD PartStream_CheckFile(TBlockStream *pStream)</div><div class="ttdef"><b>Definition</b> <a href="FileStream_8cpp_source.html#l01537">FileStream.cpp:1537</a></div></div>
<div class="ttc" id="aFileStream_8cpp_html_ab6a8ad643ebb16a4c5fe5b744195d5db"><div class="ttname"><a href="FileStream_8cpp.html#ab6a8ad643ebb16a4c5fe5b744195d5db">IsPartHeader</a></div><div class="ttdeci">static bool IsPartHeader(PPART_FILE_HEADER pPartHdr)</div><div class="ttdef"><b>Definition</b> <a href="FileStream_8cpp_source.html#l01520">FileStream.cpp:1520</a></div></div>
<div class="ttc" id="aFileStream_8cpp_html_ab6c0b30e08b7e1e527b2d1ca2a162b93"><div class="ttname"><a href="FileStream_8cpp.html#ab6c0b30e08b7e1e527b2d1ca2a162b93">StringToInt</a></div><div class="ttdeci">static DWORD StringToInt(const char *szString)</div><div class="ttdef"><b>Definition</b> <a href="FileStream_8cpp_source.html#l00055">FileStream.cpp:55</a></div></div>
<div class="ttc" id="aFileStream_8h_html_aa8c367fe1417d23655345e05264a72c7"><div class="ttname"><a href="FileStream_8h.html#aa8c367fe1417d23655345e05264a72c7">PART_FILE_MAP_ENTRY</a></div><div class="ttdeci">struct _PART_FILE_MAP_ENTRY PART_FILE_MAP_ENTRY</div></div>
</div><!-- fragment --><div class="dynheader">
Here is the call graph for this function:</div>
<div class="dyncontent">
<div class="center"><iframe scrolling="no" frameborder="0" src="FileStream_8cpp_abab48f6b34ad7933671864dd7f1e6ad5_cgraph.svg" width="402" height="135"><p><b>This browser is not able to show SVG: try Firefox, Chrome, Safari, or Opera instead.</b></p></iframe></div>
</div>
<div class="dynheader">
Here is the caller graph for this function:</div>
<div class="dyncontent">
<div class="center"><div class="zoom"><iframe scrolling="no" frameborder="0" src="FileStream_8cpp_abab48f6b34ad7933671864dd7f1e6ad5_icgraph.svg" width="100%" height="600"><p><b>This browser is not able to show SVG: try Firefox, Chrome, Safari, or Opera instead.</b></p></iframe></div></div>
</div>

</div>
</div>
<a id="a9109b5dc896abb2d8d9f7fb0995dd911" name="a9109b5dc896abb2d8d9f7fb0995dd911"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a9109b5dc896abb2d8d9f7fb0995dd911">&#9670;&#160;</a></span>PartStream_Open()</h2>

<div class="memitem">
<div class="memproto">
<table class="mlabels">
  <tr>
  <td class="mlabels-left">
      <table class="memname">
        <tr>
          <td class="memname">static <a class="el" href="structTFileStream.html">TFileStream</a> * PartStream_Open </td>
          <td>(</td>
          <td class="paramtype"><a class="el" href="StormLib_2src_2zlib_2zconf_8h.html#a2c212835823e3c54a8ab6d95c652660e">const</a> <a class="el" href="StormPort_8h.html#a03bdb8ce5895c7e261aadc2529637546">TCHAR</a> *&#160;</td>
          <td class="paramname"><em>szFileName</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype"><a class="el" href="StormPort_8h.html#a798af1e30bc65f319c1a246cecf59e39">DWORD</a>&#160;</td>
          <td class="paramname"><em>dwStreamFlags</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
  </td>
  <td class="mlabels-right">
<span class="mlabels"><span class="mlabel">static</span></span>  </td>
  </tr>
</table>
</div><div class="memdoc">

<p class="definition">Definition at line <a class="el" href="FileStream_8cpp_source.html#l01863">1863</a> of file <a class="el" href="FileStream_8cpp_source.html">FileStream.cpp</a>.</p>
<div class="fragment"><div class="line"><span class="lineno"> 1864</span>{</div>
<div class="line"><span class="lineno"> 1865</span>    <a class="code hl_struct" href="structTBlockStream.html">TBlockStream</a> * pStream;</div>
<div class="line"><span class="lineno"> 1866</span> </div>
<div class="line"><span class="lineno"> 1867</span>    <span class="comment">// Create new empty stream</span></div>
<div class="line"><span class="lineno"> 1868</span>    pStream = (<a class="code hl_struct" href="structTBlockStream.html">TBlockStream</a> *)<a class="code hl_function" href="FileStream_8cpp.html#aa5874b3e4d05d2f6dfa3a32d62f56bea">AllocateFileStream</a>(szFileName, <span class="keyword">sizeof</span>(<a class="code hl_struct" href="structTBlockStream.html">TBlockStream</a>), dwStreamFlags);</div>
<div class="line"><span class="lineno"> 1869</span>    <span class="keywordflow">if</span>(pStream == NULL)</div>
<div class="line"><span class="lineno"> 1870</span>        <span class="keywordflow">return</span> NULL;</div>
<div class="line"><span class="lineno"> 1871</span> </div>
<div class="line"><span class="lineno"> 1872</span>    <span class="comment">// Do we have a master stream?</span></div>
<div class="line"><span class="lineno"> 1873</span>    <span class="keywordflow">if</span>(pStream-&gt;<a class="code hl_variable" href="structTFileStream.html#a26faae83ba546119ac59fc35eaeec274">pMaster</a> != NULL)</div>
<div class="line"><span class="lineno"> 1874</span>    {</div>
<div class="line"><span class="lineno"> 1875</span>        <span class="keywordflow">if</span>(!<a class="code hl_function" href="FileStream_8cpp.html#ac44f22d4353fc2b39957149e3b588f36">PartStream_CreateMirror</a>(pStream))</div>
<div class="line"><span class="lineno"> 1876</span>        {</div>
<div class="line"><span class="lineno"> 1877</span>            <a class="code hl_function" href="FileStream_8cpp.html#ae8b75c4797726e9c5ee0b4b03bf31442">FileStream_Close</a>(pStream);</div>
<div class="line"><span class="lineno"> 1878</span>            <a class="code hl_function" href="FileStream_8cpp.html#a65dd8d3e416ffbd6ac5f468c6bdccac9">SetLastError</a>(<a class="code hl_define" href="StormPort_8h.html#aecc8b368d5ba0386b219fdd6a916b0b2">ERROR_FILE_NOT_FOUND</a>);</div>
<div class="line"><span class="lineno"> 1879</span>            <span class="keywordflow">return</span> NULL;</div>
<div class="line"><span class="lineno"> 1880</span>        }</div>
<div class="line"><span class="lineno"> 1881</span>    }</div>
<div class="line"><span class="lineno"> 1882</span>    <span class="keywordflow">else</span></div>
<div class="line"><span class="lineno"> 1883</span>    {</div>
<div class="line"><span class="lineno"> 1884</span>        <span class="comment">// Attempt to open the base stream</span></div>
<div class="line"><span class="lineno"> 1885</span>        <span class="keywordflow">if</span>(!pStream-&gt;<a class="code hl_variable" href="structTFileStream.html#a82013f6bc9d5e52d1efe42b0dc464d4c">BaseOpen</a>(pStream, pStream-&gt;<a class="code hl_variable" href="structTFileStream.html#a7a4da926d708d96cb47333973e705c76">szFileName</a>, dwStreamFlags))</div>
<div class="line"><span class="lineno"> 1886</span>        {</div>
<div class="line"><span class="lineno"> 1887</span>            <a class="code hl_function" href="FileStream_8cpp.html#ae8b75c4797726e9c5ee0b4b03bf31442">FileStream_Close</a>(pStream);</div>
<div class="line"><span class="lineno"> 1888</span>            <span class="keywordflow">return</span> NULL;</div>
<div class="line"><span class="lineno"> 1889</span>        }</div>
<div class="line"><span class="lineno"> 1890</span> </div>
<div class="line"><span class="lineno"> 1891</span>        <span class="comment">// Load the part stream block map</span></div>
<div class="line"><span class="lineno"> 1892</span>        <span class="keywordflow">if</span>(!<a class="code hl_function" href="FileStream_8cpp.html#abab48f6b34ad7933671864dd7f1e6ad5">PartStream_LoadBitmap</a>(pStream))</div>
<div class="line"><span class="lineno"> 1893</span>        {</div>
<div class="line"><span class="lineno"> 1894</span>            <a class="code hl_function" href="FileStream_8cpp.html#ae8b75c4797726e9c5ee0b4b03bf31442">FileStream_Close</a>(pStream);</div>
<div class="line"><span class="lineno"> 1895</span>            <a class="code hl_function" href="FileStream_8cpp.html#a65dd8d3e416ffbd6ac5f468c6bdccac9">SetLastError</a>(<a class="code hl_define" href="StormPort_8h.html#aac798118bc41679864a280a79f6449da">ERROR_BAD_FORMAT</a>);</div>
<div class="line"><span class="lineno"> 1896</span>            <span class="keywordflow">return</span> NULL;</div>
<div class="line"><span class="lineno"> 1897</span>        }</div>
<div class="line"><span class="lineno"> 1898</span>    }</div>
<div class="line"><span class="lineno"> 1899</span> </div>
<div class="line"><span class="lineno"> 1900</span>    <span class="comment">// Set the stream position to zero. Stream size is already set</span></div>
<div class="line"><span class="lineno"> 1901</span>    assert(pStream-&gt;<a class="code hl_variable" href="structTFileStream.html#a99bdae10f74cf57156e65bd76ba64771">StreamSize</a> != 0);</div>
<div class="line"><span class="lineno"> 1902</span>    pStream-&gt;<a class="code hl_variable" href="structTFileStream.html#a84324f2f19bfc3fcbc563ef2391f84fe">StreamPos</a> = 0;</div>
<div class="line"><span class="lineno"> 1903</span>    pStream-&gt;<a class="code hl_variable" href="structTFileStream.html#ae61935eec67ce99ea4091bc0949de1ea">dwFlags</a> |= <a class="code hl_define" href="StormLib_8h.html#abdbbf06488f24699775afe6aadaeafc3">STREAM_FLAG_READ_ONLY</a>;</div>
<div class="line"><span class="lineno"> 1904</span> </div>
<div class="line"><span class="lineno"> 1905</span>    <span class="comment">// Set new function pointers</span></div>
<div class="line"><span class="lineno"> 1906</span>    pStream-&gt;<a class="code hl_variable" href="structTFileStream.html#aaf7da0af26da32b968cdb66eb87f26ce">StreamRead</a>    = (<a class="code hl_typedef" href="FileStream_8h.html#a606a64221d9b9881a1f52bce34bbbf02">STREAM_READ</a>)<a class="code hl_function" href="FileStream_8cpp.html#a6aad894479c9e1b2cba754f7f3260747">BlockStream_Read</a>;</div>
<div class="line"><span class="lineno"> 1907</span>    pStream-&gt;<a class="code hl_variable" href="structTFileStream.html#a158f1621a05e8b3002c1729fd5d4cfca">StreamGetPos</a>  = <a class="code hl_function" href="FileStream_8cpp.html#a298aac8ccf15fff07223077eedbf2db7">BlockStream_GetPos</a>;</div>
<div class="line"><span class="lineno"> 1908</span>    pStream-&gt;<a class="code hl_variable" href="structTFileStream.html#a95b85c4ef3254dc6a73fdb2e566ebbba">StreamGetSize</a> = <a class="code hl_function" href="FileStream_8cpp.html#a3e8398bb76df8b526932fe0c4623cef9">BlockStream_GetSize</a>;</div>
<div class="line"><span class="lineno"> 1909</span>    pStream-&gt;<a class="code hl_variable" href="structTFileStream.html#ac3f8968d1ae374c58ab50404221834e4">StreamClose</a>   = (<a class="code hl_typedef" href="FileStream_8h.html#a585e2b6ef8c0d46cf78a6be488f8685d">STREAM_CLOSE</a>)<a class="code hl_function" href="FileStream_8cpp.html#a44ffcada567ee94f23e575dfe83e9c64">PartStream_Close</a>;</div>
<div class="line"><span class="lineno"> 1910</span> </div>
<div class="line"><span class="lineno"> 1911</span>    <span class="comment">// Supply the block functions</span></div>
<div class="line"><span class="lineno"> 1912</span>    pStream-&gt;<a class="code hl_variable" href="structTFileStream.html#a707b42c85dd8f372ce802efb6bc1955e">BlockCheck</a>    = (<a class="code hl_typedef" href="FileStream_8h.html#a1e317346e5993e4386975327be8e04f2">BLOCK_CHECK</a>)<a class="code hl_function" href="FileStream_8cpp.html#aa248b7a4855fbd7cb0e0451eb7afdf96">PartStream_BlockCheck</a>;</div>
<div class="line"><span class="lineno"> 1913</span>    pStream-&gt;<a class="code hl_variable" href="structTFileStream.html#a68391daa44e09cd7654e765d81d937a3">BlockRead</a>     = (<a class="code hl_typedef" href="FileStream_8h.html#ad07760b526786fe7097b34605659f3dc">BLOCK_READ</a>)<a class="code hl_function" href="FileStream_8cpp.html#a2791646c1575f1cec2fbd508772ad641">PartStream_BlockRead</a>;</div>
<div class="line"><span class="lineno"> 1914</span>    <span class="keywordflow">return</span> pStream;</div>
<div class="line"><span class="lineno"> 1915</span>}</div>
<div class="ttc" id="aFileStream_8cpp_html_a2791646c1575f1cec2fbd508772ad641"><div class="ttname"><a href="FileStream_8cpp.html#a2791646c1575f1cec2fbd508772ad641">PartStream_BlockRead</a></div><div class="ttdeci">static bool PartStream_BlockRead(TBlockStream *pStream, ULONGLONG StartOffset, ULONGLONG EndOffset, LPBYTE BlockBuffer, DWORD BytesNeeded, bool bAvailable)</div><div class="ttdef"><b>Definition</b> <a href="FileStream_8cpp_source.html#l01677">FileStream.cpp:1677</a></div></div>
<div class="ttc" id="aFileStream_8cpp_html_a44ffcada567ee94f23e575dfe83e9c64"><div class="ttname"><a href="FileStream_8cpp.html#a44ffcada567ee94f23e575dfe83e9c64">PartStream_Close</a></div><div class="ttdeci">static void PartStream_Close(TBlockStream *pStream)</div><div class="ttdef"><b>Definition</b> <a href="FileStream_8cpp_source.html#l01752">FileStream.cpp:1752</a></div></div>
<div class="ttc" id="aFileStream_8cpp_html_aa248b7a4855fbd7cb0e0451eb7afdf96"><div class="ttname"><a href="FileStream_8cpp.html#aa248b7a4855fbd7cb0e0451eb7afdf96">PartStream_BlockCheck</a></div><div class="ttdeci">static bool PartStream_BlockCheck(TBlockStream *pStream, ULONGLONG BlockOffset)</div><div class="ttdef"><b>Definition</b> <a href="FileStream_8cpp_source.html#l01660">FileStream.cpp:1660</a></div></div>
<div class="ttc" id="aFileStream_8cpp_html_ac44f22d4353fc2b39957149e3b588f36"><div class="ttname"><a href="FileStream_8cpp.html#ac44f22d4353fc2b39957149e3b588f36">PartStream_CreateMirror</a></div><div class="ttdeci">static bool PartStream_CreateMirror(TBlockStream *pStream)</div><div class="ttdef"><b>Definition</b> <a href="FileStream_8cpp_source.html#l01782">FileStream.cpp:1782</a></div></div>
<div class="ttc" id="aStormPort_8h_html_aac798118bc41679864a280a79f6449da"><div class="ttname"><a href="StormPort_8h.html#aac798118bc41679864a280a79f6449da">ERROR_BAD_FORMAT</a></div><div class="ttdeci">#define ERROR_BAD_FORMAT</div><div class="ttdef"><b>Definition</b> <a href="StormPort_8h_source.html#l00412">StormPort.h:412</a></div></div>
</div><!-- fragment --><div class="dynheader">
Here is the call graph for this function:</div>
<div class="dyncontent">
<div class="center"><div class="zoom"><iframe scrolling="no" frameborder="0" src="FileStream_8cpp_a9109b5dc896abb2d8d9f7fb0995dd911_cgraph.svg" width="100%" height="600"><p><b>This browser is not able to show SVG: try Firefox, Chrome, Safari, or Opera instead.</b></p></iframe></div></div>
</div>
<div class="dynheader">
Here is the caller graph for this function:</div>
<div class="dyncontent">
<div class="center"><div class="zoom"><iframe scrolling="no" frameborder="0" src="FileStream_8cpp_a9109b5dc896abb2d8d9f7fb0995dd911_icgraph.svg" width="100%" height="600"><p><b>This browser is not able to show SVG: try Firefox, Chrome, Safari, or Opera instead.</b></p></iframe></div></div>
</div>

</div>
</div>
<a id="a162a6e284e6e7c5c8577e0b98fe76ad3" name="a162a6e284e6e7c5c8577e0b98fe76ad3"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a162a6e284e6e7c5c8577e0b98fe76ad3">&#9670;&#160;</a></span>PartStream_UpdateBitmap()</h2>

<div class="memitem">
<div class="memproto">
<table class="mlabels">
  <tr>
  <td class="mlabels-left">
      <table class="memname">
        <tr>
          <td class="memname">static void PartStream_UpdateBitmap </td>
          <td>(</td>
          <td class="paramtype"><a class="el" href="structTBlockStream.html">TBlockStream</a> *&#160;</td>
          <td class="paramname"><em>pStream</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype"><a class="el" href="StormPort_8h.html#abb9abb9ce956f1a9e5a4081ac40e5649">ULONGLONG</a>&#160;</td>
          <td class="paramname"><em>StartOffset</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype"><a class="el" href="StormPort_8h.html#abb9abb9ce956f1a9e5a4081ac40e5649">ULONGLONG</a>&#160;</td>
          <td class="paramname"><em>EndOffset</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype"><a class="el" href="StormPort_8h.html#abb9abb9ce956f1a9e5a4081ac40e5649">ULONGLONG</a>&#160;</td>
          <td class="paramname"><em>RealOffset</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
  </td>
  <td class="mlabels-right">
<span class="mlabels"><span class="mlabel">static</span></span>  </td>
  </tr>
</table>
</div><div class="memdoc">

<p class="definition">Definition at line <a class="el" href="FileStream_8cpp_source.html#l01626">1626</a> of file <a class="el" href="FileStream_8cpp_source.html">FileStream.cpp</a>.</p>
<div class="fragment"><div class="line"><span class="lineno"> 1631</span>{</div>
<div class="line"><span class="lineno"> 1632</span>    <a class="code hl_struct" href="struct__PART__FILE__MAP__ENTRY.html">PPART_FILE_MAP_ENTRY</a> FileBitmap;</div>
<div class="line"><span class="lineno"> 1633</span>    <a class="code hl_typedef" href="StormPort_8h.html#a798af1e30bc65f319c1a246cecf59e39">DWORD</a> BlockSize = pStream-&gt;<a class="code hl_variable" href="structTBlockStream.html#a8c7180184928638b30809f7f85061fb7">BlockSize</a>;</div>
<div class="line"><span class="lineno"> 1634</span> </div>
<div class="line"><span class="lineno"> 1635</span>    <span class="comment">// Sanity checks</span></div>
<div class="line"><span class="lineno"> 1636</span>    assert((StartOffset &amp; (BlockSize - 1)) == 0);</div>
<div class="line"><span class="lineno"> 1637</span>    assert(pStream-&gt;<a class="code hl_variable" href="structTBlockStream.html#a1e2d4a2467ab4b43cec1bdd1a2f6d21a">FileBitmap</a> != NULL);</div>
<div class="line"><span class="lineno"> 1638</span> </div>
<div class="line"><span class="lineno"> 1639</span>    <span class="comment">// Calculate the first entry in the block map</span></div>
<div class="line"><span class="lineno"> 1640</span>    FileBitmap = (<a class="code hl_typedef" href="FileStream_8h.html#a9d177641cfa38af6f1cb6c09ed836760">PPART_FILE_MAP_ENTRY</a>)pStream-&gt;<a class="code hl_variable" href="structTBlockStream.html#a1e2d4a2467ab4b43cec1bdd1a2f6d21a">FileBitmap</a> + (StartOffset / BlockSize);</div>
<div class="line"><span class="lineno"> 1641</span> </div>
<div class="line"><span class="lineno"> 1642</span>    <span class="comment">// Set all bits for the specified range</span></div>
<div class="line"><span class="lineno"> 1643</span>    <span class="keywordflow">while</span>(StartOffset &lt; EndOffset)</div>
<div class="line"><span class="lineno"> 1644</span>    {</div>
<div class="line"><span class="lineno"> 1645</span>        <span class="comment">// Set the bit</span></div>
<div class="line"><span class="lineno"> 1646</span>        FileBitmap-&gt;<a class="code hl_variable" href="struct__PART__FILE__MAP__ENTRY.html#a4d655b24011047e42086f249ecae7301">BlockOffsHi</a> = (<a class="code hl_typedef" href="StormPort_8h.html#a798af1e30bc65f319c1a246cecf59e39">DWORD</a>)(RealOffset &gt;&gt; 0x20);</div>
<div class="line"><span class="lineno"> 1647</span>        FileBitmap-&gt;<a class="code hl_variable" href="struct__PART__FILE__MAP__ENTRY.html#aa6b4281b7f137d2bea41d1225b3da146">BlockOffsLo</a> = (<a class="code hl_typedef" href="StormPort_8h.html#a798af1e30bc65f319c1a246cecf59e39">DWORD</a>)(RealOffset &amp; 0xFFFFFFFF);</div>
<div class="line"><span class="lineno"> 1648</span>        FileBitmap-&gt;<a class="code hl_variable" href="struct__PART__FILE__MAP__ENTRY.html#abd1801ee4295f9608122a2fc81876354">Flags</a> = 3;</div>
<div class="line"><span class="lineno"> 1649</span> </div>
<div class="line"><span class="lineno"> 1650</span>        <span class="comment">// Move all</span></div>
<div class="line"><span class="lineno"> 1651</span>        StartOffset += BlockSize;</div>
<div class="line"><span class="lineno"> 1652</span>        RealOffset += BlockSize;</div>
<div class="line"><span class="lineno"> 1653</span>        FileBitmap++;</div>
<div class="line"><span class="lineno"> 1654</span>    }</div>
<div class="line"><span class="lineno"> 1655</span> </div>
<div class="line"><span class="lineno"> 1656</span>    <span class="comment">// Increment the bitmap update count</span></div>
<div class="line"><span class="lineno"> 1657</span>    pStream-&gt;<a class="code hl_variable" href="structTBlockStream.html#ab405154b8f27af633d8f3116cce2ac66">IsModified</a> = 1;</div>
<div class="line"><span class="lineno"> 1658</span>}</div>
</div><!-- fragment --><div class="dynheader">
Here is the caller graph for this function:</div>
<div class="dyncontent">
<div class="center"><div class="zoom"><iframe scrolling="no" frameborder="0" src="FileStream_8cpp_a162a6e284e6e7c5c8577e0b98fe76ad3_icgraph.svg" width="100%" height="600"><p><b>This browser is not able to show SVG: try Firefox, Chrome, Safari, or Opera instead.</b></p></iframe></div></div>
</div>

</div>
</div>
<a id="a2ab4669edc8efaf172b769732d83e2f0" name="a2ab4669edc8efaf172b769732d83e2f0"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a2ab4669edc8efaf172b769732d83e2f0">&#9670;&#160;</a></span>Rol32()</h2>

<div class="memitem">
<div class="memproto">
<table class="mlabels">
  <tr>
  <td class="mlabels-left">
      <table class="memname">
        <tr>
          <td class="memname">static <a class="el" href="StormPort_8h.html#a798af1e30bc65f319c1a246cecf59e39">DWORD</a> Rol32 </td>
          <td>(</td>
          <td class="paramtype"><a class="el" href="StormPort_8h.html#a798af1e30bc65f319c1a246cecf59e39">DWORD</a>&#160;</td>
          <td class="paramname"><em>dwValue</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype"><a class="el" href="StormPort_8h.html#a798af1e30bc65f319c1a246cecf59e39">DWORD</a>&#160;</td>
          <td class="paramname"><em>dwRolCount</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
  </td>
  <td class="mlabels-right">
<span class="mlabels"><span class="mlabel">static</span></span>  </td>
  </tr>
</table>
</div><div class="memdoc">

<p class="definition">Definition at line <a class="el" href="FileStream_8cpp_source.html#l01973">1973</a> of file <a class="el" href="FileStream_8cpp_source.html">FileStream.cpp</a>.</p>
<div class="fragment"><div class="line"><span class="lineno"> 1974</span>{</div>
<div class="line"><span class="lineno"> 1975</span>    <a class="code hl_typedef" href="StormPort_8h.html#a798af1e30bc65f319c1a246cecf59e39">DWORD</a> dwShiftRight = 32 - dwRolCount;</div>
<div class="line"><span class="lineno"> 1976</span> </div>
<div class="line"><span class="lineno"> 1977</span>    <span class="keywordflow">return</span> (dwValue &lt;&lt; dwRolCount) | (dwValue &gt;&gt; dwShiftRight);</div>
<div class="line"><span class="lineno"> 1978</span>}</div>
</div><!-- fragment --><div class="dynheader">
Here is the caller graph for this function:</div>
<div class="dyncontent">
<div class="center"><div class="zoom"><iframe scrolling="no" frameborder="0" src="FileStream_8cpp_a2ab4669edc8efaf172b769732d83e2f0_icgraph.svg" width="100%" height="600"><p><b>This browser is not able to show SVG: try Firefox, Chrome, Safari, or Opera instead.</b></p></iframe></div></div>
</div>

</div>
</div>
<a id="a65dd8d3e416ffbd6ac5f468c6bdccac9" name="a65dd8d3e416ffbd6ac5f468c6bdccac9"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a65dd8d3e416ffbd6ac5f468c6bdccac9">&#9670;&#160;</a></span>SetLastError()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void SetLastError </td>
          <td>(</td>
          <td class="paramtype"><a class="el" href="StormPort_8h.html#a798af1e30bc65f319c1a246cecf59e39">DWORD</a>&#160;</td>
          <td class="paramname"><em>dwErrCode</em></td><td>)</td>
          <td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p class="definition">Definition at line <a class="el" href="FileStream_8cpp_source.html#l00049">49</a> of file <a class="el" href="FileStream_8cpp_source.html">FileStream.cpp</a>.</p>
<div class="fragment"><div class="line"><span class="lineno">   50</span>{</div>
<div class="line"><span class="lineno">   51</span>    <a class="code hl_variable" href="FileStream_8cpp.html#ae1b34ad1b2653fcef5fac54d2fea9943">dwLastError</a> = dwErrCode;</div>
<div class="line"><span class="lineno">   52</span>}</div>
</div><!-- fragment -->
</div>
</div>
<a id="ab6c0b30e08b7e1e527b2d1ca2a162b93" name="ab6c0b30e08b7e1e527b2d1ca2a162b93"></a>
<h2 class="memtitle"><span class="permalink"><a href="#ab6c0b30e08b7e1e527b2d1ca2a162b93">&#9670;&#160;</a></span>StringToInt()</h2>

<div class="memitem">
<div class="memproto">
<table class="mlabels">
  <tr>
  <td class="mlabels-left">
      <table class="memname">
        <tr>
          <td class="memname">static <a class="el" href="StormPort_8h.html#a798af1e30bc65f319c1a246cecf59e39">DWORD</a> StringToInt </td>
          <td>(</td>
          <td class="paramtype"><a class="el" href="StormLib_2src_2zlib_2zconf_8h.html#a2c212835823e3c54a8ab6d95c652660e">const</a> char *&#160;</td>
          <td class="paramname"><em>szString</em></td><td>)</td>
          <td></td>
        </tr>
      </table>
  </td>
  <td class="mlabels-right">
<span class="mlabels"><span class="mlabel">static</span></span>  </td>
  </tr>
</table>
</div><div class="memdoc">

<p class="definition">Definition at line <a class="el" href="FileStream_8cpp_source.html#l00055">55</a> of file <a class="el" href="FileStream_8cpp_source.html">FileStream.cpp</a>.</p>
<div class="fragment"><div class="line"><span class="lineno">   56</span>{</div>
<div class="line"><span class="lineno">   57</span>    <a class="code hl_typedef" href="StormPort_8h.html#a798af1e30bc65f319c1a246cecf59e39">DWORD</a> dwValue = 0;</div>
<div class="line"><span class="lineno">   58</span> </div>
<div class="line"><span class="lineno">   59</span>    <span class="keywordflow">while</span>(<span class="charliteral">&#39;0&#39;</span> &lt;= szString[0] &amp;&amp; szString[0] &lt;= <span class="charliteral">&#39;9&#39;</span>)</div>
<div class="line"><span class="lineno">   60</span>    {</div>
<div class="line"><span class="lineno">   61</span>        dwValue = (dwValue * 10) + (szString[0] - <span class="charliteral">&#39;0&#39;</span>);</div>
<div class="line"><span class="lineno">   62</span>        szString++;</div>
<div class="line"><span class="lineno">   63</span>    }</div>
<div class="line"><span class="lineno">   64</span> </div>
<div class="line"><span class="lineno">   65</span>    <span class="keywordflow">return</span> dwValue;</div>
<div class="line"><span class="lineno">   66</span>}</div>
</div><!-- fragment --><div class="dynheader">
Here is the caller graph for this function:</div>
<div class="dyncontent">
<div class="center"><div class="zoom"><iframe scrolling="no" frameborder="0" src="FileStream_8cpp_ab6c0b30e08b7e1e527b2d1ca2a162b93_icgraph.svg" width="100%" height="600"><p><b>This browser is not able to show SVG: try Firefox, Chrome, Safari, or Opera instead.</b></p></iframe></div></div>
</div>

</div>
</div>
<h2 class="groupheader">Variable Documentation</h2>
<a id="aec446bcf08e7a651f948295e316b9475" name="aec446bcf08e7a651f948295e316b9475"></a>
<h2 class="memtitle"><span class="permalink"><a href="#aec446bcf08e7a651f948295e316b9475">&#9670;&#160;</a></span>AuthCodeArray</h2>

<div class="memitem">
<div class="memproto">
<table class="mlabels">
  <tr>
  <td class="mlabels-left">
      <table class="memname">
        <tr>
          <td class="memname"><a class="el" href="StormLib_2src_2zlib_2zconf_8h.html#a2c212835823e3c54a8ab6d95c652660e">const</a> char* AuthCodeArray[]</td>
        </tr>
      </table>
  </td>
  <td class="mlabels-right">
<span class="mlabels"><span class="mlabel">static</span></span>  </td>
  </tr>
</table>
</div><div class="memdoc">

<p class="definition">Definition at line <a class="el" href="FileStream_8cpp_source.html#l01922">1922</a> of file <a class="el" href="FileStream_8cpp_source.html">FileStream.cpp</a>.</p>
<div class="fragment"><div class="line"><span class="lineno"> 1923</span>{</div>
<div class="line"><span class="lineno"> 1924</span>    <span class="comment">// Starcraft II (Heart of the Swarm)</span></div>
<div class="line"><span class="lineno"> 1925</span>    <span class="comment">// Authentication code URL: http://dist.blizzard.com/mediakey/hots-authenticationcode-bgdl.txt</span></div>
<div class="line"><span class="lineno"> 1926</span>    <span class="comment">//                                                                                          -0C-    -1C--08-    -18--04-    -14--00-    -10-</span></div>
<div class="line"><span class="lineno"> 1927</span>    <span class="stringliteral">&quot;S48B6CDTN5XEQAKQDJNDLJBJ73FDFM3U&quot;</span>,         <span class="comment">// SC2 Heart of the Swarm-all : &quot;expand 32-byte kQAKQ0000FM3UN5XE000073FD6CDT0000LJBJS48B0000DJND&quot;</span></div>
<div class="line"><span class="lineno"> 1928</span> </div>
<div class="line"><span class="lineno"> 1929</span>    <span class="comment">// Diablo III: Agent.exe (1.0.0.954)</span></div>
<div class="line"><span class="lineno"> 1930</span>    <span class="comment">// Address of decryption routine: 00502b00</span></div>
<div class="line"><span class="lineno"> 1931</span>    <span class="comment">// Pointer to decryptor object: ECX</span></div>
<div class="line"><span class="lineno"> 1932</span>    <span class="comment">// Pointer to key: ECX+0x5C</span></div>
<div class="line"><span class="lineno"> 1933</span>    <span class="comment">// Authentication code URL: http://dist.blizzard.com/mediakey/d3-authenticationcode-enGB.txt</span></div>
<div class="line"><span class="lineno"> 1934</span>    <span class="comment">//                                                                                           -0C-    -1C--08-    -18--04-    -14--00-    -10-</span></div>
<div class="line"><span class="lineno"> 1935</span>    <span class="stringliteral">&quot;UCMXF6EJY352EFH4XFRXCFH2XC9MQRZK&quot;</span>,         <span class="comment">// Diablo III Installer (deDE): &quot;expand 32-byte kEFH40000QRZKY3520000XC9MF6EJ0000CFH2UCMX0000XFRX&quot;</span></div>
<div class="line"><span class="lineno"> 1936</span>    <span class="stringliteral">&quot;MMKVHY48RP7WXP4GHYBQ7SL9J9UNPHBP&quot;</span>,         <span class="comment">// Diablo III Installer (enGB): &quot;expand 32-byte kXP4G0000PHBPRP7W0000J9UNHY4800007SL9MMKV0000HYBQ&quot;</span></div>
<div class="line"><span class="lineno"> 1937</span>    <span class="stringliteral">&quot;8MXLWHQ7VGGLTZ9MQZQSFDCLJYET3CPP&quot;</span>,         <span class="comment">// Diablo III Installer (enSG): &quot;expand 32-byte kTZ9M00003CPPVGGL0000JYETWHQ70000FDCL8MXL0000QZQS&quot;</span></div>
<div class="line"><span class="lineno"> 1938</span>    <span class="stringliteral">&quot;EJ2R5TM6XFE2GUNG5QDGHKQ9UAKPWZSZ&quot;</span>,         <span class="comment">// Diablo III Installer (enUS): &quot;expand 32-byte kGUNG0000WZSZXFE20000UAKP5TM60000HKQ9EJ2R00005QDG&quot;</span></div>
<div class="line"><span class="lineno"> 1939</span>    <span class="stringliteral">&quot;PBGFBE42Z6LNK65UGJQ3WZVMCLP4HQQT&quot;</span>,         <span class="comment">// Diablo III Installer (esES): &quot;expand 32-byte kK65U0000HQQTZ6LN0000CLP4BE420000WZVMPBGF0000GJQ3&quot;</span></div>
<div class="line"><span class="lineno"> 1940</span>    <span class="stringliteral">&quot;X7SEJJS9TSGCW5P28EBSC47AJPEY8VU2&quot;</span>,         <span class="comment">// Diablo III Installer (esMX): &quot;expand 32-byte kW5P200008VU2TSGC0000JPEYJJS90000C47AX7SE00008EBS&quot;</span></div>
<div class="line"><span class="lineno"> 1941</span>    <span class="stringliteral">&quot;5KVBQA8VYE6XRY3DLGC5ZDE4XS4P7YA2&quot;</span>,         <span class="comment">// Diablo III Installer (frFR): &quot;expand 32-byte kRY3D00007YA2YE6X0000XS4PQA8V0000ZDE45KVB0000LGC5&quot;</span></div>
<div class="line"><span class="lineno"> 1942</span>    <span class="stringliteral">&quot;478JD2K56EVNVVY4XX8TDWYT5B8KB254&quot;</span>,         <span class="comment">// Diablo III Installer (itIT): &quot;expand 32-byte kVVY40000B2546EVN00005B8KD2K50000DWYT478J0000XX8T&quot;</span></div>
<div class="line"><span class="lineno"> 1943</span>    <span class="stringliteral">&quot;8TS4VNFQRZTN6YWHE9CHVDH9NVWD474A&quot;</span>,         <span class="comment">// Diablo III Installer (koKR): &quot;expand 32-byte k6YWH0000474ARZTN0000NVWDVNFQ0000VDH98TS40000E9CH&quot;</span></div>
<div class="line"><span class="lineno"> 1944</span>    <span class="stringliteral">&quot;LJ52Z32DF4LZ4ZJJXVKK3AZQA6GABLJB&quot;</span>,         <span class="comment">// Diablo III Installer (plPL): &quot;expand 32-byte k4ZJJ0000BLJBF4LZ0000A6GAZ32D00003AZQLJ520000XVKK&quot;</span></div>
<div class="line"><span class="lineno"> 1945</span>    <span class="stringliteral">&quot;K6BDHY2ECUE2545YKNLBJPVYWHE7XYAG&quot;</span>,         <span class="comment">// Diablo III Installer (ptBR): &quot;expand 32-byte k545Y0000XYAGCUE20000WHE7HY2E0000JPVYK6BD0000KNLB&quot;</span></div>
<div class="line"><span class="lineno"> 1946</span>    <span class="stringliteral">&quot;NDVW8GWLAYCRPGRNY8RT7ZZUQU63VLPR&quot;</span>,         <span class="comment">// Diablo III Installer (ruRU): &quot;expand 32-byte kXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXX&quot;</span></div>
<div class="line"><span class="lineno"> 1947</span>    <span class="stringliteral">&quot;6VWCQTN8V3ZZMRUCZXV8A8CGUX2TAA8H&quot;</span>,         <span class="comment">// Diablo III Installer (zhTW): &quot;expand 32-byte kMRUC0000AA8HV3ZZ0000UX2TQTN80000A8CG6VWC0000ZXV8&quot;</span></div>
<div class="line"><span class="lineno"> 1948</span><span class="comment">//  &quot;XXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXX&quot;,         // Diablo III Installer (zhCN): &quot;expand 32-byte kXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXX&quot;</span></div>
<div class="line"><span class="lineno"> 1949</span> </div>
<div class="line"><span class="lineno"> 1950</span>    <span class="comment">// Starcraft II (Wings of Liberty): Installer.exe (4.1.1.4219)</span></div>
<div class="line"><span class="lineno"> 1951</span>    <span class="comment">// Address of decryption routine: 0053A3D0</span></div>
<div class="line"><span class="lineno"> 1952</span>    <span class="comment">// Pointer to decryptor object: ECX</span></div>
<div class="line"><span class="lineno"> 1953</span>    <span class="comment">// Pointer to key: ECX+0x5C</span></div>
<div class="line"><span class="lineno"> 1954</span>    <span class="comment">// Authentication code URL: http://dist.blizzard.com/mediakey/sc2-authenticationcode-enUS.txt</span></div>
<div class="line"><span class="lineno"> 1955</span>    <span class="comment">//                                                                                          -0C-    -1C--08-    -18--04-    -14--00-    -10-</span></div>
<div class="line"><span class="lineno"> 1956</span>    <span class="stringliteral">&quot;Y45MD3CAK4KXSSXHYD9VY64Z8EKJ4XFX&quot;</span>,         <span class="comment">// SC2 Wings of Liberty (deDE): &quot;expand 32-byte kSSXH00004XFXK4KX00008EKJD3CA0000Y64ZY45M0000YD9V&quot;</span></div>
<div class="line"><span class="lineno"> 1957</span>    <span class="stringliteral">&quot;G8MN8UDG6NA2ANGY6A3DNY82HRGF29ZH&quot;</span>,         <span class="comment">// SC2 Wings of Liberty (enGB): &quot;expand 32-byte kANGY000029ZH6NA20000HRGF8UDG0000NY82G8MN00006A3D&quot;</span></div>
<div class="line"><span class="lineno"> 1958</span>    <span class="stringliteral">&quot;W9RRHLB2FDU9WW5B3ECEBLRSFWZSF7HW&quot;</span>,         <span class="comment">// SC2 Wings of Liberty (enSG): &quot;expand 32-byte kWW5B0000F7HWFDU90000FWZSHLB20000BLRSW9RR00003ECE&quot;</span></div>
<div class="line"><span class="lineno"> 1959</span>    <span class="stringliteral">&quot;3DH5RE5NVM5GTFD85LXGWT6FK859ETR5&quot;</span>,         <span class="comment">// SC2 Wings of Liberty (enUS): &quot;expand 32-byte kTFD80000ETR5VM5G0000K859RE5N0000WT6F3DH500005LXG&quot;</span></div>
<div class="line"><span class="lineno"> 1960</span>    <span class="stringliteral">&quot;8WLKUAXE94PFQU4Y249PAZ24N4R4XKTQ&quot;</span>,         <span class="comment">// SC2 Wings of Liberty (esES): &quot;expand 32-byte kQU4Y0000XKTQ94PF0000N4R4UAXE0000AZ248WLK0000249P&quot;</span></div>
<div class="line"><span class="lineno"> 1961</span>    <span class="stringliteral">&quot;A34DXX3VHGGXSQBRFE5UFFDXMF9G4G54&quot;</span>,         <span class="comment">// SC2 Wings of Liberty (esMX): &quot;expand 32-byte kSQBR00004G54HGGX0000MF9GXX3V0000FFDXA34D0000FE5U&quot;</span></div>
<div class="line"><span class="lineno"> 1962</span>    <span class="stringliteral">&quot;ZG7J9K938HJEFWPQUA768MA2PFER6EAJ&quot;</span>,         <span class="comment">// SC2 Wings of Liberty (frFR): &quot;expand 32-byte kFWPQ00006EAJ8HJE0000PFER9K9300008MA2ZG7J0000UA76&quot;</span></div>
<div class="line"><span class="lineno"> 1963</span>    <span class="stringliteral">&quot;NE7CUNNNTVAPXV7E3G2BSVBWGVMW8BL2&quot;</span>,         <span class="comment">// SC2 Wings of Liberty (itIT): &quot;expand 32-byte kXV7E00008BL2TVAP0000GVMWUNNN0000SVBWNE7C00003G2B&quot;</span></div>
<div class="line"><span class="lineno"> 1964</span>    <span class="stringliteral">&quot;3V9E2FTMBM9QQWK7U6MAMWAZWQDB838F&quot;</span>,         <span class="comment">// SC2 Wings of Liberty (koKR): &quot;expand 32-byte kQWK70000838FBM9Q0000WQDB2FTM0000MWAZ3V9E0000U6MA&quot;</span></div>
<div class="line"><span class="lineno"> 1965</span>    <span class="stringliteral">&quot;2NSFB8MELULJ83U6YHA3UP6K4MQD48L6&quot;</span>,         <span class="comment">// SC2 Wings of Liberty (plPL): &quot;expand 32-byte k83U6000048L6LULJ00004MQDB8ME0000UP6K2NSF0000YHA3&quot;</span></div>
<div class="line"><span class="lineno"> 1966</span>    <span class="stringliteral">&quot;QA2TZ9EWZ4CUU8BMB5WXCTY65F9CSW4E&quot;</span>,         <span class="comment">// SC2 Wings of Liberty (ptBR): &quot;expand 32-byte kU8BM0000SW4EZ4CU00005F9CZ9EW0000CTY6QA2T0000B5WX&quot;</span></div>
<div class="line"><span class="lineno"> 1967</span>    <span class="stringliteral">&quot;VHB378W64BAT9SH7D68VV9NLQDK9YEGT&quot;</span>,         <span class="comment">// SC2 Wings of Liberty (ruRU): &quot;expand 32-byte k9SH70000YEGT4BAT0000QDK978W60000V9NLVHB30000D68V&quot;</span></div>
<div class="line"><span class="lineno"> 1968</span>    <span class="stringliteral">&quot;U3NFQJV4M6GC7KBN9XQJ3BRDN3PLD9NE&quot;</span>,         <span class="comment">// SC2 Wings of Liberty (zhTW): &quot;expand 32-byte k7KBN0000D9NEM6GC0000N3PLQJV400003BRDU3NF00009XQJ&quot;</span></div>
<div class="line"><span class="lineno"> 1969</span> </div>
<div class="line"><span class="lineno"> 1970</span>    NULL</div>
<div class="line"><span class="lineno"> 1971</span>};</div>
</div><!-- fragment -->
</div>
</div>
<a id="ae1b34ad1b2653fcef5fac54d2fea9943" name="ae1b34ad1b2653fcef5fac54d2fea9943"></a>
<h2 class="memtitle"><span class="permalink"><a href="#ae1b34ad1b2653fcef5fac54d2fea9943">&#9670;&#160;</a></span>dwLastError</h2>

<div class="memitem">
<div class="memproto">
<table class="mlabels">
  <tr>
  <td class="mlabels-left">
      <table class="memname">
        <tr>
          <td class="memname">thread_local <a class="el" href="StormPort_8h.html#a798af1e30bc65f319c1a246cecf59e39">DWORD</a> dwLastError = <a class="el" href="StormPort_8h.html#aea0ae801b7d25c979655a7eb20d034af">ERROR_SUCCESS</a></td>
        </tr>
      </table>
  </td>
  <td class="mlabels-right">
<span class="mlabels"><span class="mlabel">static</span></span>  </td>
  </tr>
</table>
</div><div class="memdoc">

<p class="definition">Definition at line <a class="el" href="FileStream_8cpp_source.html#l00039">39</a> of file <a class="el" href="FileStream_8cpp_source.html">FileStream.cpp</a>.</p>

</div>
</div>
<a id="afa38e27a30d69630dd4a86504004742a" name="afa38e27a30d69630dd4a86504004742a"></a>
<h2 class="memtitle"><span class="permalink"><a href="#afa38e27a30d69630dd4a86504004742a">&#9670;&#160;</a></span>StreamBaseInit</h2>

<div class="memitem">
<div class="memproto">
<table class="mlabels">
  <tr>
  <td class="mlabels-left">
      <table class="memname">
        <tr>
          <td class="memname"><a class="el" href="FileStream_8h.html#ae3d842ec0479cdc757f18d01f9d5095d">STREAM_INIT</a> StreamBaseInit[4]</td>
        </tr>
      </table>
  </td>
  <td class="mlabels-right">
<span class="mlabels"><span class="mlabel">static</span></span>  </td>
  </tr>
</table>
</div><div class="memdoc">
<b>Initial value:</b><div class="fragment"><div class="line">=</div>
<div class="line">{</div>
<div class="line">    <a class="code hl_function" href="FileStream_8cpp.html#a9637c2e0c115380fbdfc33e19891d73b">BaseFile_Init</a>,</div>
<div class="line">    <a class="code hl_function" href="FileStream_8cpp.html#ad38ec64c05bb01e557120b0aa95107fe">BaseMap_Init</a>,</div>
<div class="line">    <a class="code hl_function" href="FileStream_8cpp.html#a5ba2b0289e1a1521baf9174aafce7aa2">BaseHttp_Init</a>,</div>
<div class="line">    <a class="code hl_function" href="FileStream_8cpp.html#a87399e74057f7c5abc1d107319f5c9eb">BaseNone_Init</a></div>
<div class="line">}</div>
<div class="ttc" id="aFileStream_8cpp_html_a5ba2b0289e1a1521baf9174aafce7aa2"><div class="ttname"><a href="FileStream_8cpp.html#a5ba2b0289e1a1521baf9174aafce7aa2">BaseHttp_Init</a></div><div class="ttdeci">static void BaseHttp_Init(TFileStream *pStream)</div><div class="ttdef"><b>Definition</b> <a href="FileStream_8cpp_source.html#l00896">FileStream.cpp:896</a></div></div>
<div class="ttc" id="aFileStream_8cpp_html_a87399e74057f7c5abc1d107319f5c9eb"><div class="ttname"><a href="FileStream_8cpp.html#a87399e74057f7c5abc1d107319f5c9eb">BaseNone_Init</a></div><div class="ttdeci">static void BaseNone_Init(TFileStream *)</div><div class="ttdef"><b>Definition</b> <a href="FileStream_8cpp_source.html#l00087">FileStream.cpp:87</a></div></div>
<div class="ttc" id="aFileStream_8cpp_html_a9637c2e0c115380fbdfc33e19891d73b"><div class="ttname"><a href="FileStream_8cpp.html#a9637c2e0c115380fbdfc33e19891d73b">BaseFile_Init</a></div><div class="ttdeci">static void BaseFile_Init(TFileStream *pStream)</div><div class="ttdef"><b>Definition</b> <a href="FileStream_8cpp_source.html#l00446">FileStream.cpp:446</a></div></div>
<div class="ttc" id="aFileStream_8cpp_html_ad38ec64c05bb01e557120b0aa95107fe"><div class="ttname"><a href="FileStream_8cpp.html#ad38ec64c05bb01e557120b0aa95107fe">BaseMap_Init</a></div><div class="ttdeci">static void BaseMap_Init(TFileStream *pStream)</div><div class="ttdef"><b>Definition</b> <a href="FileStream_8cpp_source.html#l00656">FileStream.cpp:656</a></div></div>
</div><!-- fragment -->
<p class="definition">Definition at line <a class="el" href="FileStream_8cpp_source.html#l01081">1081</a> of file <a class="el" href="FileStream_8cpp_source.html">FileStream.cpp</a>.</p>
<div class="fragment"><div class="line"><span class="lineno"> 1082</span>{</div>
<div class="line"><span class="lineno"> 1083</span>    <a class="code hl_function" href="FileStream_8cpp.html#a9637c2e0c115380fbdfc33e19891d73b">BaseFile_Init</a>,</div>
<div class="line"><span class="lineno"> 1084</span>    <a class="code hl_function" href="FileStream_8cpp.html#ad38ec64c05bb01e557120b0aa95107fe">BaseMap_Init</a>,</div>
<div class="line"><span class="lineno"> 1085</span>    <a class="code hl_function" href="FileStream_8cpp.html#a5ba2b0289e1a1521baf9174aafce7aa2">BaseHttp_Init</a>,</div>
<div class="line"><span class="lineno"> 1086</span>    <a class="code hl_function" href="FileStream_8cpp.html#a87399e74057f7c5abc1d107319f5c9eb">BaseNone_Init</a></div>
<div class="line"><span class="lineno"> 1087</span>};</div>
</div><!-- fragment -->
</div>
</div>
<a id="a1ba3043bfd83fe4f919a3cb4a871a9cf" name="a1ba3043bfd83fe4f919a3cb4a871a9cf"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a1ba3043bfd83fe4f919a3cb4a871a9cf">&#9670;&#160;</a></span>szKeyTemplate</h2>

<div class="memitem">
<div class="memproto">
<table class="mlabels">
  <tr>
  <td class="mlabels-left">
      <table class="memname">
        <tr>
          <td class="memname"><a class="el" href="StormLib_2src_2zlib_2zconf_8h.html#a2c212835823e3c54a8ab6d95c652660e">const</a> char* szKeyTemplate = &quot;expand 32-<a class="el" href="tomcrypt__macros_8h.html#a76134035baa59a42ca0b5b8fb99d9d53">byte</a> k000000000000000000000000000000000000000000000000&quot;</td>
        </tr>
      </table>
  </td>
  <td class="mlabels-right">
<span class="mlabels"><span class="mlabel">static</span></span>  </td>
  </tr>
</table>
</div><div class="memdoc">

<p class="definition">Definition at line <a class="el" href="FileStream_8cpp_source.html#l01920">1920</a> of file <a class="el" href="FileStream_8cpp_source.html">FileStream.cpp</a>.</p>

</div>
</div>
</div><!-- contents -->
</div><!-- doc-content -->
<!-- start footer part -->
<div id="nav-path" class="navpath"><!-- id is needed for treeview function! -->
  <ul>
    <li class="navelem"><a class="el" href="dir_5a65adb78194d8b06ca6fd510af8357a.html">AscEmu</a></li><li class="navelem"><a class="el" href="dir_d0fc04153d74feb886fd2096a57dc87f.html">dep</a></li><li class="navelem"><a class="el" href="dir_2594a7fc2f53d73154bdbd3e3b1986ef.html">StormLib</a></li><li class="navelem"><a class="el" href="dir_77224f19d90cfc88aa172a2cc692c112.html">src</a></li><li class="navelem"><a class="el" href="FileStream_8cpp.html">FileStream.cpp</a></li>
    <li class="footer">Generated by <a href="https://www.doxygen.org/index.html"><img class="footer" src="doxygen.svg" width="104" height="31" alt="doxygen"/></a> 1.9.8 </li>
  </ul>
</div>
</body>
</html>
